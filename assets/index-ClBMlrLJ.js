const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-AkjzMQrs.js","assets/index-CyhyWCTU.js","assets/index-D-0QUoyZ.css","assets/legendasService-DUcmGvtQ.js","assets/CompletenessDashboard-oByofA09.js","assets/house-DnK_cZUG.js","assets/arrow-left-CwqklN5y.js","assets/videoService-Cg8hYg7c.js","assets/videoService-BtPuoxOl.css","assets/index-Bd6mlG8-.js"])))=>i.map(i=>d[i]);
import{c as Ne,o as Us,s as re,l as B,r as w,B as Bh,j as a,p as zh,X as ze,S as Ko,E as Hh,q as Dd,C as xt,t as ui,v as Vh,R as hi,U as _s,F as Za,_ as Xr,g as $d,w as Gh,x as Kh,y as Wh,P as R}from"./index-CyhyWCTU.js";import{A as Zh}from"./arrow-left-CwqklN5y.js";import{aD as As,aE as Hi,aF as Vi,as as Ws,ay as fi,az as Xh,aA as Yh,aC as Qh,aG as Jh,aH as ef,aI as tf,ax as rf,at as gi,aJ as sf,aK as af,aL as nf,ar as of,ao as lf,aq as cf,am as df,aa as Gi,ac as Ki,an as uf,a9 as hf,ab as ff,O as gf,a3 as mf,a4 as pf,aB as Xa,au as Ht,aM as Ya,aN as Wi,aw as Fd}from"./videoService-Cg8hYg7c.js";import{E as bf}from"./index-Bd6mlG8-.js";import{updateMultipleImageOrders as xf,getLegendaByImageUrl as Zi,updateLegendaFoto as yf,addLegendaFoto as vf,testLegendasTable as Ud}from"./legendasService-DUcmGvtQ.js";const wf=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Cs=Ne("archive",wf);const Nf=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Bd=Ne("chevron-up",Nf);const jf=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],$r=Ne("database",jf);const Ef=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Wo=Ne("download",Ef);const _f=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],Xi=Ne("file-down",_f);const Af=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Yi=Ne("file",Af);const Cf=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],zd=Ne("grip-vertical",Cf);const Tf=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Sf=Ne("history",Tf);const kf=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Kr=Ne("image",kf);const qf=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],mi=Ne("info",qf);const If=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Lf=Ne("palette",If);const Of=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Rf=Ne("pen-line",Of);const Mf=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Pf=Ne("pen",Mf);const Df=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],$f=Ne("plus",Df);const Ff=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Zs=Ne("save",Ff);const Uf=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Hd=Ne("settings",Uf);const Bf=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Xs=Ne("upload",Bf);const zf=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Hf=Ne("video",zf);class mr{static async obterAutorAtual(){try{return await Us.isAuthenticated()?(await Us.getCurrentUser())?.username||"admin":null}catch{return null}}static async registrarVersaoDados({nomeTabela:e,chaveLinha:t,nomeCampo:s=null,fonteId:n=null,autor:o=null,observacoes:i=null}){try{if(!e||e.trim()==="")throw new Error("nomeTabela é obrigatório");if(!t||t.toString().trim()==="")throw new Error("chaveLinha é obrigatório");let l=o;l||(l=await this.obterAutorAtual());const d={nome_tabela:e.trim(),chave_linha:t.toString().trim(),autor:l,criado_em:new Date().toISOString()};s&&s.trim()!==""&&(d.nome_campo=s.trim()),n&&(d.fonte_id=n),i&&i.trim()!==""&&(d.observacoes=i.trim());const{data:h,error:f}=await re.from("versoes_dados").insert(d).select().single();if(f)throw B.error("Erro ao registrar versão de dados:",f),f;return{success:!0,data:h}}catch(l){return B.error("Erro no serviço de versionamento:",l),{success:!1,error:l.message||"Erro ao registrar versão de dados"}}}static async buscarFontesDados(){try{const{data:e,error:t}=await re.from("fontes_dados").select("id, nome, descricao").order("nome",{ascending:!0});if(t)throw t;return{success:!0,data:e||[]}}catch(e){return B.error("Erro ao buscar fontes de dados:",e),{success:!1,error:e.message||"Erro ao buscar fontes de dados",data:[]}}}static async buscarVersoesPorLinha(e,t){try{const{data:s,error:n}=await re.from("versoes_dados").select(`
          id,
          nome_tabela,
          chave_linha,
          autor,
          observacoes,
          criado_em,
          fonte_id,
          fontes_dados:nome,
          fontes_dados:descricao
        `).eq("nome_tabela",e).eq("chave_linha",t.toString()).order("criado_em",{ascending:!1});if(n)throw n;return{success:!0,data:s||[]}}catch(s){return B.error("Erro ao buscar versões:",s),{success:!1,error:s.message||"Erro ao buscar versões",data:[]}}}}const Vd=()=>{const[r,e]=w.useState([]),[t,s]=w.useState(!0),[n,o]=w.useState(null),[i,l]=w.useState(""),[d,h]=w.useState("todos"),f=w.useCallback(async()=>{try{s(!0),o(null);const{data:v,error:k}=await re.from("escolas_completa").select("*").order("Escola",{ascending:!0});if(k)throw k;const _=v.map(q=>({...q,logradouro:q.logradouro||"",numero:q.numero||"",complemento:q.complemento||"",bairro:q.bairro||"",cep:q.cep||"",estado:q.estado||"SP"}));e(_)}catch(v){B.error("Erro ao buscar escolas:",v),o(v.message)}finally{s(!1)}},[]),m=w.useCallback((v,k)=>{e(_=>_.map(q=>q.id===v?{...q,...k}:q))},[]),u=w.useCallback(v=>{e(k=>[...k,v])},[]),g=w.useCallback(v=>{e(k=>k.filter(_=>_.id!==v))},[]),y=w.useCallback(v=>r.find(k=>k.id===v),[r]),x=w.useCallback(v=>r.find(k=>k.Escola?.toLowerCase()===v.toLowerCase()),[r]),A=w.useCallback(async(v,k=null)=>{try{if(o(null),v.id){const{data:_,error:q}=await re.from("escolas_completa").update({Escola:v.Escola,Município:v.Município,Endereço:v.Endereço,"Terra Indigena (TI)":v["Terra Indigena (TI)"],"Escola Estadual ou Municipal":v["Escola Estadual ou Municipal"],"Parcerias com o município":v["Parcerias com o município"],"Diretoria de Ensino":v["Diretoria de Ensino"],"Ano de criação da escola":v["Ano de criação da escola"],"Povos indigenas":v["Povos indigenas"],"Linguas faladas":v["Linguas faladas"],"Modalidade de Ensino/turnos de funcionamento":v["Modalidade de Ensino/turnos de funcionamento"],"Numero de alunos":v["Numero de alunos"],turnos_funcionamento:v.turnos_funcionamento,"Espaço escolar e estrutura":v["Espaço escolar e estrutura"],"Acesso à água":v["Acesso à água"],"Tem coleta de lixo?":v["Tem coleta de lixo?"],"Acesso à internet":v["Acesso à internet"],"Equipamentos Tecs":v["Equipamentos Tecs"],"Modo de acesso à escola":v["Modo de acesso à escola"],"Gestão/Nome":v["Gestão/Nome"],"Outros funcionários":v["Outros funcionários"],"Quantidade de professores indígenas":v["Quantidade de professores indígenas"],"Quantidade de professores não indígenas":v["Quantidade de professores não indígenas"],"Professores falam a língua indígena?":v["Professores falam a língua indígena?"],"Formação dos professores":v["Formação dos professores"],"Formação continuada oferecida":v["Formação continuada oferecida"],"PPP elaborado com a comunidade?":v["PPP elaborado com a comunidade?"],"Material pedagógico não indígena":v["Material pedagógico não indígena"],"Material pedagógico indígena":v["Material pedagógico indígena"],"Práticas pedagógicas indígenas":v["Práticas pedagógicas indígenas"],"Formas de avaliação":v["Formas de avaliação"],"Projetos em andamento":v["Projetos em andamento"],"Parcerias com universidades?":v["Parcerias com universidades?"],"Ações com ONGs ou coletivos?":v["Ações com ONGs ou coletivos?"],"Desejos da comunidade para a escola":v["Desejos da comunidade para a escola"],"Escola utiliza redes sociais?":v["Escola utiliza redes sociais?"],"Links das redes sociais":v["Links das redes sociais"],historia_da_escola:v.historia_da_escola,Latitude:v.Latitude,Longitude:v.Longitude,link_para_videos:v.link_para_videos,logradouro:v.logradouro,numero:v.numero,complemento:v.complemento,bairro:v.bairro,cep:v.cep,estado:v.estado,diferenciada:v.diferenciada,imagem_header:v.imagem_header,cards_visibilidade:v.cards_visibilidade||null}).eq("id",v.id).select();if(q)throw q;if(m(v.id,_[0]),k!==null)try{await mr.registrarVersaoDados({nomeTabela:"escolas_completa",chaveLinha:v.id.toString(),fonteId:k?.fonte_id||null,autor:k?.autor||null,observacoes:k?.observacoes||null})}catch(D){B.warn("Erro ao registrar versão de dados (não crítico):",D)}return{success:!0,data:_[0]}}else{const{data:_,error:q}=await re.from("escolas_completa").insert({Escola:v.Escola,Município:v.Município,Endereço:v.Endereço,"Terra Indigena (TI)":v["Terra Indigena (TI)"],"Escola Estadual ou Municipal":v["Escola Estadual ou Municipal"],"Parcerias com o município":v["Parcerias com o município"],"Diretoria de Ensino":v["Diretoria de Ensino"],"Ano de criação da escola":v["Ano de criação da escola"],"Povos indigenas":v["Povos indigenas"],"Linguas faladas":v["Linguas faladas"],"Modalidade de Ensino/turnos de funcionamento":v["Modalidade de Ensino/turnos de funcionamento"],"Numero de alunos":v["Numero de alunos"],turnos_funcionamento:v.turnos_funcionamento,"Espaço escolar e estrutura":v["Espaço escolar e estrutura"],"Acesso à água":v["Acesso à água"],"Tem coleta de lixo?":v["Tem coleta de lixo?"],"Acesso à internet":v["Acesso à internet"],"Equipamentos Tecs":v["Equipamentos Tecs"],"Modo de acesso à escola":v["Modo de acesso à escola"],"Gestão/Nome":v["Gestão/Nome"],"Outros funcionários":v["Outros funcionários"],"Quantidade de professores indígenas":v["Quantidade de professores indígenas"],"Quantidade de professores não indígenas":v["Quantidade de professores não indígenas"],"Professores falam a língua indígena?":v["Professores falam a língua indígena?"],"Formação dos professores":v["Formação dos professores"],"Formação continuada oferecida":v["Formação continuada oferecida"],"PPP elaborado com a comunidade?":v["PPP elaborado com a comunidade?"],"Material pedagógico não indígena":v["Material pedagógico não indígena"],"Material pedagógico indígena":v["Material pedagógico indígena"],"Práticas pedagógicas indígenas":v["Práticas pedagógicas indígenas"],"Formas de avaliação":v["Formas de avaliação"],"Projetos em andamento":v["Projetos em andamento"],"Parcerias com universidades?":v["Parcerias com universidades?"],"Ações com ONGs ou coletivos?":v["Ações com ONGs ou coletivos?"],"Desejos da comunidade para a escola":v["Desejos da comunidade para a escola"],"Escola utiliza redes sociais?":v["Escola utiliza redes sociais?"],"Links das redes sociais":v["Links das redes sociais"],historia_da_escola:v.historia_da_escola,Latitude:v.Latitude,Longitude:v.Longitude,link_para_videos:v.link_para_videos,logradouro:v.logradouro,numero:v.numero,complemento:v.complemento,bairro:v.bairro,cep:v.cep,estado:v.estado,diferenciada:v.diferenciada,imagem_header:v.imagem_header,cards_visibilidade:v.cards_visibilidade||null}).select();if(q)throw q;if(u(_[0]),k!==null)try{await mr.registrarVersaoDados({nomeTabela:"escolas_completa",chaveLinha:_[0].id.toString(),fonteId:k?.fonte_id||null,autor:k?.autor||null,observacoes:k?.observacoes||null})}catch(D){B.warn("Erro ao registrar versão de dados (não crítico):",D)}return{success:!0,data:_[0]}}}catch(_){return B.error("Erro ao salvar escola:",_),o(_.message),{success:!1,error:_.message}}},[m,u]),C=w.useCallback(async v=>{try{o(null);const{error:k}=await re.from("escolas_completa").delete().eq("id",v);if(k)throw k;return g(v),{success:!0}}catch(k){return B.error("Erro ao deletar escola:",k),o(k.message),{success:!1,error:k.message}}},[g]);return w.useEffect(()=>{f()},[f]),{escolas:r,loading:t,error:n,searchTerm:i,selectedType:d,setSearchTerm:l,setSelectedType:h,fetchEscolas:f,updateEscolaInList:m,addEscolaToList:u,removeEscolaFromList:g,saveEscola:A,deleteEscola:C,getEscolaById:y,getEscolaByName:x}},Gd=["Educação Infantil","Educação Infantil (Idade 0 a 6 anos)","Educação Infantil (Pré-escola I e II) – 1 sala multisseriada","Educação Infantil (Pré-escola I) – 1 sala regular","Educação Infantil + Ensino Fundamental – multisseriado","Educação Infantil + Ensino Fundamental – regular e multisseriado","Educação Infantil + Ensino Fundamental","Educação Infantil + Ensino Fundamental (Anos Iniciais e Anos Finais)","Educação Infantil + Ensino Fundamental (Anos Iniciais multisseriado + Anos Finais multisseriado)","Educação Infantil + Ensino Fundamental (1º ao 9º ano) – Salas multisseriadas","Educação Infantil + Ensino Fundamental (Pré I + 1º ao 4º ano) – 1 sala multisseriada","Educação Infantil + Ensino Fundamental com EJA – Multisseriado","Ensino Fundamental Anos Iniciais (1º ao 3º)","Ensino Fundamental Anos Iniciais (1º ao 5º ano) – 1 sala multisseriada","Ensino Fundamental Anos Iniciais (4º e 5º ano) – 1 sala multisseriada","Ensino Fundamental Anos Iniciais – EJA (1º ao 5º ano) – multisseriado","Ensino Fundamental Anos Finais (6º ao 9º ano) – 1 sala multisseriada","Ensino Fundamental Anos Finais – EJA (6º ao 9º ano) – multisseriado","Ensino Fundamental (Anos Iniciais e Finais) – regular e multisseriado","Ensino Fundamental – Atendimento temporário em escola não indígena","Ensino Médio (1º ao 3º ano) – regular","Ensino Médio (1º ao 3º ano) – multisseriado","Ensino Médio – EJA (1º ao 3º ano) – multisseriado","Ensino Médio – Não há atendimento"],Vf=[{id:"educacao-infantil",titulo:"1. Educação Infantil",indices:[0,1,2,3,4,5]},{id:"educacao-infantil-fundamental",titulo:"2. Educação Infantil + Ensino Fundamental",indices:[6,7,8,9,10,11,12]},{id:"ensino-fundamental",titulo:"3. Ensino Fundamental",indices:[13,14,15,16,17,18,19,20]},{id:"ensino-medio",titulo:"4. Ensino Médio",indices:[21,22,23,24]}],Kd=()=>{const[r,e]=w.useState([]),[t,s]=w.useState(""),n=w.useCallback(m=>{e(u=>u.includes(m)?u.filter(g=>g!==m):[...u,m])},[]),o=w.useCallback(m=>{s(m),e(u=>{const g=u.some(y=>y.startsWith("Outro:"));return m.trim()?g?u.map(y=>y.startsWith("Outro:")?`Outro: ${m}`:y):[...u,`Outro: ${m}`]:u.filter(y=>!y.startsWith("Outro:"))})},[]),i=w.useCallback(()=>r.join("; "),[r]),l=w.useCallback(m=>{if(!m){e([]),s("");return}const u=m.split(";").map(x=>x.trim()),g=[];let y="";u.forEach(x=>{x.startsWith("Outro:")?(y=x.replace("Outro:","").trim(),g.push(x)):Gd.includes(x)?g.push(x):x&&(y=x,g.push(`Outro: ${x}`))}),e(g),s(y)},[]),d=w.useCallback(()=>{e([]),s("")},[]),h=w.useCallback(()=>r.join("; ")||"Nenhuma modalidade selecionada",[r]),f=w.useCallback(()=>r.length>0,[r]);return{selectedModalidades:r,outroModalidade:t,handleModalidadeChange:n,handleOutroModalidadeChange:o,saveModalidades:i,loadExistingModalidades:l,clearModalidades:d,getModalidadesPreview:h,hasSelectedModalidades:f}},Gf=[{id:"dados-basicos",label:"Dados Básicos"},{id:"povos-linguas",label:"Povos"},{id:"modalidades",label:"Modalidades"},{id:"infraestrutura",label:"Infraestrutura"},{id:"gestao-professores",label:"Equipe"},{id:"funcionarios",label:"Funcionários"},{id:"material-pedagogico",label:"Material Pedagógico"},{id:"projetos-parcerias",label:"Projetos e Parcerias"},{id:"redes-sociais",label:"Redes Sociais"},{id:"video",label:"Vídeo"},{id:"historias",label:"Histórias"},{id:"historia-professores",label:"História dos Professores"},{id:"coordenadas",label:"Coordenadas"},{id:"imagens-escola",label:"Imagens da Escola"},{id:"imagens-professores",label:"Imagens dos Professores"},{id:"documentos",label:"Documentos"}],Wd={MOBILE_BREAKPOINT:Bh.mobile,SIDEBAR_TOP_OFFSET:72},Ds={DEFAULT_ACTIVE_TAB:"dados-basicos"},Kf=({isMobile:r,sidebarOpen:e,setSidebarOpen:t,editingLocation:s,onEscolaSelect:n,searchTerm:o,setSearchTerm:i,filteredEscolas:l})=>a.jsxs(a.Fragment,{children:[r&&e&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-30",onClick:()=>t(!1)}),r&&!e&&a.jsx("button",{className:"fixed top-4 left-4 z-50 bg-gray-900/90 backdrop-blur-sm rounded-full shadow-lg p-3 border border-gray-800/50 hover:bg-gray-800/90 transition-all duration-200",onClick:()=>t(!0),"aria-label":"Abrir menu lateral",children:a.jsx(zh,{className:"w-6 h-6 text-gray-200"})}),(!r||e)&&a.jsxs("aside",{className:`bg-gray-900/95 backdrop-blur-sm border-r border-gray-800/50 rounded-r-2xl shadow-2xl p-6 overflow-y-auto h-screen sticky top-0 z-40 transition-all duration-300 ${r?"fixed left-0 top-0 w-80 max-w-[85vw] shadow-2xl":"w-80"}`,style:{transform:r&&!e?"translateX(-100%)":"translateX(0)",top:r?0:Wd.SIDEBAR_TOP_OFFSET},children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 uppercase",children:"Escolas"}),a.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[l.length," escola",l.length!==1?"s":""]})]}),r&&a.jsx("button",{className:"text-gray-400 hover:text-gray-200 hover:bg-gray-800 rounded-lg p-2 transition-colors",onClick:()=>t(!1),"aria-label":"Fechar menu lateral",children:a.jsx(ze,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"relative",children:[a.jsx(Ko,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Buscar escola...",className:"w-full pl-10 pr-4 py-3 border border-gray-700/50 rounded-xl text-sm bg-gray-800/50 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all duration-200 backdrop-blur-sm",value:o,onChange:d=>i(d.target.value)})]})}),a.jsx("div",{className:"space-y-2",children:l.length>0?l.map(d=>a.jsx("button",{className:`w-full text-left p-4 rounded-xl hover:bg-gray-800/50 transition-all duration-200 border border-transparent hover:border-gray-700/50 ${s?.id===d.id?"bg-gradient-to-r from-green-600/20 to-green-700/20 border-green-500/50 text-white shadow-lg":"text-gray-200 hover:text-white"}`,onClick:()=>{n(d),r&&t(!1)},children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:`font-medium truncate ${s?.id===d.id?"text-green-300":"text-gray-200"}`,children:d.Escola}),d.Município&&a.jsx("p",{className:"text-sm text-gray-400 truncate mt-1",children:d.Município})]}),s?.id===d.id&&a.jsx("div",{className:"ml-2 flex-shrink-0",children:a.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"})})]})},d.id)):o?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-800/50 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(Ko,{className:"w-8 h-8 text-gray-400"})}),a.jsx("p",{className:"text-gray-400 text-sm",children:"Nenhuma escola encontrada"}),a.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Tente ajustar sua busca"})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-800/50 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),a.jsx("p",{className:"text-gray-400 text-sm",children:"Nenhuma escola disponível"})]})}),a.jsx("div",{className:"mt-auto pt-6 border-t border-gray-800/50",children:a.jsx("div",{className:"text-center",children:a.jsxs("p",{className:"text-gray-500 text-xs",children:["Opin - desenvolvido por ",a.jsx("a",{href:"https://hericmr.github.io/me/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-gray-400",children:"Heric mr"})]})})})]})]}),Wf=({searchTerm:r,setSearchTerm:e,selectedType:t,setSelectedType:s,onNovaEscola:n})=>null,Zf=({isOpen:r,onClose:e,onSuccess:t})=>{const[s,n]=w.useState(""),[o,i]=w.useState(!1),[l,d]=w.useState(!1),[h,f]=w.useState(""),[m,u]=w.useState(""),[g,y]=w.useState(0),[x,A]=w.useState(!1),[C,v]=w.useState(0),k=w.useRef(null);w.useEffect(()=>{r&&(n(""),f(""),u(""),i(!1),setTimeout(()=>{k.current&&k.current.focus()},100))},[r]),w.useEffect(()=>{if(x&&C>0){const F=setTimeout(()=>{v(T=>T-1)},1e3);return C===1&&(A(!1),v(0),y(0)),()=>clearTimeout(F)}},[x,C]);const _=async F=>{if(F.preventDefault(),!x){if(!s.trim()){f("Por favor, digite a senha");return}d(!0),f(""),u("");try{const T=await Us.authenticate(s);if(T.success)Us.setToken(T.token),u("Login realizado com sucesso!"),setTimeout(()=>{t(T.user),e()},1e3);else{const V=g+1;y(V),V>=3?(A(!0),v(30),f("Muitas tentativas. Aguarde 30 segundos.")):f(T.error||"Erro na autenticação")}}catch(T){console.error("Erro no login:",T),f("Erro interno. Tente novamente.")}finally{d(!1)}}},q=()=>{l||(n(""),f(""),u(""),i(!1),e())},D=F=>{F.key==="Escape"&&q()};return r?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",onClick:F=>F.target===F.currentTarget&&q(),onKeyDown:D,tabIndex:-1,children:a.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-2xl border border-gray-800 max-w-sm w-full",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-100",children:"Acesso Administrativo"}),a.jsx("button",{onClick:q,className:"p-1 hover:bg-gray-800 rounded transition-colors",disabled:l,children:a.jsx(ze,{className:"w-5 h-5 text-gray-400"})})]}),a.jsx("form",{onSubmit:_,className:"p-4",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Senha"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:k,type:o?"text":"password",value:s,onChange:F=>n(F.target.value),className:"w-full px-3 py-2 pr-10 bg-gray-800 border border-gray-600 rounded-md text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",placeholder:"Digite sua senha...",disabled:l||x,autoComplete:"current-password"}),a.jsx("button",{type:"button",onClick:()=>i(!o),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-700 rounded transition-colors",disabled:l||x,children:o?a.jsx(Hh,{className:"w-4 h-4 text-gray-400"}):a.jsx(Dd,{className:"w-4 h-4 text-gray-400"})})]}),s&&a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Caracteres:"}),a.jsx("div",{className:"flex gap-1",children:s.split("").map((F,T)=>a.jsx("span",{className:"text-lg font-mono text-gray-300",children:o?F:"•"},T))}),a.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:["(",s.length,")"]})]})]}),g>0&&g<3&&a.jsxs("div",{className:"text-sm text-orange-400",children:["Tentativas: ",g,"/3"]}),x&&a.jsxs("div",{className:"text-sm text-red-400",children:["Bloqueado por ",C," segundos"]}),h&&a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-red-900/30 border border-red-700 rounded text-sm",children:[a.jsx(xt,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),a.jsx("span",{className:"text-red-300",children:h})]}),m&&a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-900/30 border border-green-700 rounded text-sm",children:[a.jsx(ui,{className:"w-4 h-4 text-green-400 flex-shrink-0"}),a.jsx("span",{className:"text-green-300",children:m})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx("button",{type:"button",onClick:q,className:"flex-1 px-3 py-2 border border-gray-600 text-gray-300 rounded hover:bg-gray-800 transition-colors text-sm",disabled:l||x,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm flex items-center justify-center gap-2",disabled:l||x||!s.trim(),children:l?a.jsx(a.Fragment,{children:"Entrando..."}):"Entrar"})]})]})})]})}):null},Xf=({children:r})=>{const{isAuthenticated:e,loading:t}=Vh(),[s,n]=hi.useState(!1);return t?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx("div",{className:"text-center",children:a.jsx("p",{className:"text-gray-600",children:"Verificando autenticação..."})})}):e?r:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Acesso Restrito"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["Esta área é restrita a administradores autorizados.",a.jsx("br",{}),"Faça login para continuar."]})]}),a.jsx("button",{onClick:()=>n(!0),className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Fazer Login"})]})}),a.jsx(Zf,{isOpen:s,onClose:()=>n(!1),onSuccess:()=>{n(!1)}})]})},Yf=({escolas:r,onSave:e,loading:t=!1,error:s=null})=>{const[n,o]=w.useState(!1),i=w.useRef(null);w.useEffect(()=>{const k=()=>{if(i.current){const _=i.current.scrollWidth>i.current.clientWidth,q=i.current.scrollHeight>i.current.clientHeight;o(_||q)}};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[r]);const[l,d]=w.useState(null),[h,f]=w.useState(""),[m,u]=w.useState(""),g=w.useMemo(()=>[{key:"Escola",label:"Escola",width:"w-32"},{key:"Município",label:"Município",width:"w-28"},{key:"Endereço",label:"Endereço",width:"w-40"},{key:"Terra Indigena (TI)",label:"Terra Indígena",width:"w-32"},{key:"Parcerias com o município",label:"Parcerias",width:"w-32"},{key:"Diretoria de Ensino",label:"Diretoria",width:"w-32"},{key:"Ano de criação da escola",label:"Ano Criação",width:"w-24"},{key:"Povos indigenas",label:"Povos",width:"w-32"},{key:"Linguas faladas",label:"Línguas",width:"w-32"},{key:"Modalidade de Ensino/turnos de funcionamento",label:"Modalidade",width:"w-48"},{key:"Numero de alunos",label:"Alunos",width:"w-20"},{key:"turnos_funcionamento",label:"Turnos",width:"w-24"},{key:"Espaço escolar e estrutura",label:"Estrutura",width:"w-40"},{key:"Acesso à água",label:"Água",width:"w-24"},{key:"Tem coleta de lixo?",label:"Coleta Lixo",width:"w-24"},{key:"Acesso à internet",label:"Internet",width:"w-24"},{key:"Equipamentos Tecs",label:"Equipamentos",width:"w-32"},{key:"Modo de acesso à escola",label:"Acesso",width:"w-32"},{key:"Gestão/Nome",label:"Gestão",width:"w-32"},{key:"Outros funcionários",label:"Funcionários",width:"w-32"},{key:"Quantidade de professores indígenas",label:"Prof. Indígenas",width:"w-28"},{key:"Quantidade de professores não indígenas",label:"Prof. Não Indígenas",width:"w-32"},{key:"Professores falam a língua indígena?",label:"Falam Língua",width:"w-24"},{key:"Formação dos professores",label:"Formação",width:"w-32"},{key:"Formação continuada oferecida",label:"Formação Cont.",width:"w-32"},{key:"PPP elaborado com a comunidade?",label:"PPP Comunidade",width:"w-28"},{key:"Projetos em andamento",label:"Projetos",width:"w-32"},{key:"Parcerias com universidades?",label:"Parcerias Univ.",width:"w-28"},{key:"Ações com ONGs ou coletivos?",label:"ONGs",width:"w-24"},{key:"Desejos da comunidade para a escola",label:"Desejos",width:"w-40"},{key:"Escola utiliza redes sociais?",label:"Redes Sociais",width:"w-24"},{key:"Links das redes sociais",label:"Links Redes",width:"w-40"},{key:"historia_da_escola",label:"História",width:"w-40"},{key:"Latitude",label:"Latitude",width:"w-20"},{key:"Longitude",label:"Longitude",width:"w-20"},{key:"links",label:"Links",width:"w-32"},{key:"link_para_videos",label:"Vídeos",width:"w-32"},{key:"logradouro",label:"Logradouro",width:"w-32"},{key:"numero",label:"Número",width:"w-16"},{key:"complemento",label:"Complemento",width:"w-24"},{key:"bairro",label:"Bairro",width:"w-24"},{key:"cep",label:"CEP",width:"w-20"},{key:"estado",label:"Estado",width:"w-16"},{key:"nome_professor",label:"Nome Professor",width:"w-32"},{key:"professores_indigenas",label:"Prof. Indígenas (Det.)",width:"w-32"},{key:"professores_nao_indigenas",label:"Prof. Não Indígenas (Det.)",width:"w-32"},{key:"professores_falam_lingua_indigena",label:"Falam Língua (Det.)",width:"w-32"},{key:"formacao_professores",label:"Formação (Det.)",width:"w-32"},{key:"visitas_supervisores_formacao",label:"Visitas Supervisores",width:"w-32"},{key:"outros_funcionarios",label:"Outros Funcionários (Det.)",width:"w-32"},{key:"gestao",label:"Gestão (Det.)",width:"w-32"},{key:"merenda_diferenciada",label:"Merenda Diferenciada",width:"w-32"},{key:"diferenciada",label:"Diferenciada",width:"w-24"},{key:"actions",label:"Ações",width:"w-32"}],[]),y=w.useCallback((k,_,q)=>{d({rowIndex:k,columnKey:_}),f(q||""),u(q||"")},[]),x=w.useCallback(()=>{d(null),f(""),u("")},[]),A=w.useCallback(async()=>{if(!l)return;const{rowIndex:k,columnKey:_}=l,q=r[k];if(h!==m){const D={...q,[_]:h},F=g.find(O=>O.key===_),T=F?F.label:_;await e(D,{campo:_,valorAntigo:m,valorNovo:h,label:T})}x()},[l,h,m,r,e,x,g]),C=w.useCallback(k=>{k.key==="Enter"?(k.preventDefault(),A()):k.key==="Escape"&&(k.preventDefault(),x())},[A,x]),v=(k,_,q)=>{const D=l?.rowIndex===q&&l?.columnKey===_.key,F=k[_.key]||"";if(_.key==="actions")return a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("div",{className:"text-gray-500 text-xs",children:D?"Editando...":"Editar"})});if(D){let T="text",V={};return _.key==="Numero de alunos"?(T="number",V={min:0,step:1}):_.key==="Modalidade de Ensino/turnos de funcionamento"&&(T="textarea"),T==="textarea"?a.jsx("textarea",{value:h,onChange:O=>f(O.target.value),onKeyDown:C,onBlur:A,className:"w-full px-2 py-1 text-sm bg-gray-800 border border-blue-400 rounded text-gray-100 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:3,autoFocus:!0}):a.jsx("input",{type:T,value:h,onChange:O=>f(O.target.value),onKeyDown:C,onBlur:A,className:"w-full px-2 py-1 text-sm bg-gray-800 border border-blue-400 rounded text-gray-100 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0,...V})}return a.jsx("div",{className:"cursor-pointer hover:bg-gray-700/50 px-2 py-1.5 rounded transition-colors group relative",onClick:()=>y(q,_.key,F),title:"Clique para editar",children:a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-gray-300 group-hover:text-white text-xs flex-1 truncate",children:F&&F.length>30?`${F.substring(0,30)}...`:F||a.jsx("span",{className:"text-gray-500",children:"-"})}),a.jsx(Pf,{size:12,className:"text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"})]})})};return a.jsxs("div",{className:"h-full flex flex-col bg-gray-900",children:[(t||s)&&a.jsx("div",{className:"flex-shrink-0 bg-gray-800/50 px-4 py-2 border-b border-gray-700/50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[t&&a.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-yellow-400"}),a.jsx("span",{children:"Salvando alterações..."})]}),s&&a.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[a.jsx(xt,{size:14}),a.jsx("span",{children:s})]})]})}),a.jsx("div",{ref:i,className:`editable-table-scroll flex-1 relative ${n?"can-scroll":""}`,style:{overflow:"auto"},children:a.jsxs("table",{className:"w-full min-w-[3000px]",children:[a.jsx("thead",{className:"bg-gray-800/80 sticky top-0 z-10",children:a.jsx("tr",{children:g.map(k=>a.jsx("th",{className:`${k.width} px-3 py-3 text-left text-xs font-semibold text-gray-200 uppercase tracking-wider border-b border-gray-700`,children:a.jsx("div",{className:"truncate",title:k.label,children:k.label})},k.key))})}),a.jsx("tbody",{className:"bg-gray-900 divide-y divide-gray-800",children:r.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:g.length,className:"px-4 py-8 text-center text-gray-400",children:"Nenhuma escola encontrada"})}):r.map((k,_)=>a.jsx("tr",{className:"hover:bg-gray-800/50 transition-colors",children:g.map(q=>a.jsx("td",{className:"px-3 py-2.5 text-xs",children:v(k,q,_)},q.key))},k.id||_))})]})})]})},Qf=({setEditingLocation:r,onShowMetadadosModal:e})=>{const{escolas:t,loading:s,error:n,saveEscola:o}=Vd(),[i,l]=w.useState(!1),[d,h]=w.useState(null),[f,m]=w.useState(!1),[u,g]=w.useState(""),[y,x]=w.useState(()=>{const k=typeof window<"u"?localStorage.getItem("opin:textScale"):null;return k?parseFloat(k):1});w.useEffect(()=>{const k=Math.min(1.3,Math.max(.9,y));if(k!==y){x(k);return}const _=16;document.documentElement.style.fontSize=`${_*k}px`;try{localStorage.setItem("opin:textScale",String(k))}catch{}},[y]);const A=()=>{const _=[["Escola","Município","Endereço","Terra Indígena","Parcerias","Diretoria de Ensino","Ano Criação","Povos","Línguas","Modalidade","Alunos","Turnos","Estrutura","Água","Coleta Lixo","Internet","Equipamentos","Acesso","Gestão","Funcionários","Prof. Indígenas","Prof. Não Indígenas","Falam Língua","Formação","Formação Cont.","PPP Comunidade","Projetos","Parcerias Univ.","ONGs","Desejos","Redes Sociais","Links Redes","História","Latitude","Longitude","Links","Vídeos","Logradouro","Número","Complemento","Bairro","CEP","Estado","Nome Professor","Prof. Indígenas (Det.)","Prof. Não Indígenas (Det.)","Falam Língua (Det.)","Formação (Det.)","Visitas Supervisores","Outros Funcionários (Det.)","Gestão (Det.)","Merenda Diferenciada","Diferenciada"].join(","),...t.map(T=>[`"${T.nome_escola||""}"`,`"${T.municipio||""}"`,`"${T.endereco||""}"`,`"${T.terra_indigena||""}"`,`"${T.parcerias||""}"`,`"${T.diretoria_ensino||""}"`,`"${T.ano_criacao||""}"`,`"${T.povos||""}"`,`"${T.linguas||""}"`,`"${T.modalidade||""}"`,`"${T.numero_alunos||""}"`,`"${T.turnos||""}"`,`"${T.estrutura||""}"`,`"${T.agua||""}"`,`"${T.coleta_lixo||""}"`,`"${T.internet||""}"`,`"${T.equipamentos||""}"`,`"${T.acesso||""}"`,`"${T.gestao||""}"`,`"${T.funcionarios||""}"`,`"${T.professores_indigenas||""}"`,`"${T.professores_nao_indigenas||""}"`,`"${T.falam_lingua_indigena||""}"`,`"${T.formacao_professores||""}"`,`"${T.formacao_continuada||""}"`,`"${T.ppp_comunidade||""}"`,`"${T.projetos||""}"`,`"${T.parcerias_universidades||""}"`,`"${T.parcerias_ongs||""}"`,`"${T.desejos_comunidade||""}"`,`"${T.redes_sociais||""}"`,`"${T.links_redes_sociais||""}"`,`"${T.historia_escola||""}"`,`"${T.latitude||""}"`,`"${T.longitude||""}"`,`"${T.links_uteis||""}"`,`"${T.link_para_videos||""}"`,`"${T.logradouro||""}"`,`"${T.numero||""}"`,`"${T.complemento||""}"`,`"${T.bairro||""}"`,`"${T.cep||""}"`,`"${T.estado||""}"`,`"${T.nome_professor||""}"`,`"${T.professores_indigenas_detalhado||""}"`,`"${T.professores_nao_indigenas_detalhado||""}"`,`"${T.falam_lingua_indigena_detalhado||""}"`,`"${T.formacao_professores_detalhado||""}"`,`"${T.visitas_supervisores||""}"`,`"${T.outros_funcionarios_detalhado||""}"`,`"${T.gestao_detalhado||""}"`,`"${T.merenda_diferenciada||""}"`,`"${T.merenda_diferenciada_detalhado||""}"`].join(","))].join(`
`),q=new Blob([_],{type:"text/csv;charset=utf-8;"}),D=document.createElement("a"),F=URL.createObjectURL(q);D.setAttribute("href",F),D.setAttribute("download","escolas_indigenas.csv"),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D)},C=async(k,_)=>{try{l(!0),h(null);const q=await o(k,null);if(q.success){if(m(!0),setTimeout(()=>m(!1),3e3),e&&_){const D=[{campo:_.campo,valorAntigo:_.valorAntigo||"",valorNovo:_.valorNovo||"",label:_.label||_.campo}];e(k.id||q.data.id,k.Escola||"Escola",D)}}else h(q.error||"Erro ao salvar escola")}catch(q){B.error("Erro ao salvar escola:",q),h(q.message)}finally{l(!1)}},v=w.useMemo(()=>{if(!u.trim())return t;const k=u.toLowerCase();return t.filter(_=>_.Escola?.toLowerCase().includes(k)||_.Município?.toLowerCase().includes(k)||_.Endereço?.toLowerCase().includes(k)||_["Terra Indigena (TI)"]?.toLowerCase().includes(k))},[t,u]);return s?a.jsx("div",{className:"flex items-center justify-center h-full bg-gray-800",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto mb-2"}),a.jsx("span",{className:"text-gray-400",children:"Carregando escolas..."})]})}):a.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[a.jsx("div",{className:"flex-shrink-0 bg-gray-800 border-b-2 border-gray-600",children:a.jsx("div",{className:"px-4 py-4",children:a.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[a.jsxs("button",{onClick:()=>r(null),className:"flex items-center gap-1.5 px-3 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm font-medium",title:"Voltar ao painel principal",children:[a.jsx(Zh,{size:16}),a.jsx("span",{children:"Voltar"})]}),a.jsxs("div",{className:"flex-shrink-0",children:[a.jsx("h2",{className:"text-lg font-semibold text-white leading-normal",children:"Edição em Tabela"}),a.jsx("p",{className:"text-xs text-gray-400 leading-normal mt-0.5",children:"Clique em qualquer célula para editar"})]}),a.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-md",children:[a.jsx(Ko,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),a.jsx("input",{type:"text",placeholder:"Buscar escola, município...",value:u,onChange:k=>g(k.target.value),className:"w-full pl-8 pr-8 py-2.5 text-sm bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-transparent"}),u&&a.jsx("button",{onClick:()=>g(""),className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:a.jsx(ze,{size:14})})]}),u&&a.jsxs("div",{className:"text-xs text-gray-400 whitespace-nowrap",children:[v.length," de ",t.length]}),f&&a.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-2.5 bg-green-900/30 border border-green-700/50 rounded-lg text-green-400 text-xs whitespace-nowrap",children:[a.jsx("span",{children:"✓"}),a.jsx("span",{children:"Salvo"})]}),a.jsxs("button",{type:"button",onClick:()=>x(k=>k>=1.3?1:Math.round((k+.15)*100)/100),className:"flex items-center gap-1.5 px-2.5 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors","aria-label":"Ajustar tamanho do texto",title:`Tamanho do texto: ${Math.round(y*100)}%`,children:[a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[a.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.6117 5.00684C6.86862 5.02589 7.11696 5.11134 7.3324 5.25488C7.57862 5.41908 7.77125 5.65263 7.88514 5.92578L11.9232 15.6162C12.1352 16.1258 11.8947 16.7115 11.3851 16.9238C10.8755 17.1362 10.2901 16.8942 10.0775 16.3848L9.08338 14H3.91736L2.92322 16.3857C2.71049 16.8948 2.12502 17.1359 1.6156 16.9238C1.10605 16.7114 0.865522 16.1258 1.07752 15.6162L5.11658 5.92578L5.16248 5.8252C5.27895 5.59518 5.45376 5.39859 5.66932 5.25488L5.76307 5.19727C5.98766 5.07035 6.24213 5.00195 6.50135 5.00195L6.6117 5.00684ZM4.75135 12H8.25037L6.50037 7.80176L4.75135 12Z",fill:"#CDE8CF"}),a.jsx("path",{d:"M18.0209 6.00098C18.0385 6.00133 18.0561 6.00165 18.0736 6.00293C18.0913 6.00421 18.1089 6.00562 18.1263 6.00781C18.1434 6.00996 18.1602 6.01358 18.1771 6.0166C18.1869 6.01835 18.1968 6.01946 18.2064 6.02148C18.234 6.02726 18.2614 6.03388 18.2885 6.04199C18.2921 6.04309 18.2956 6.04476 18.2992 6.0459C18.317 6.05145 18.3344 6.05789 18.3519 6.06445C18.368 6.07049 18.3841 6.07618 18.3998 6.08301C18.5114 6.13159 18.6161 6.20168 18.7074 6.29297L22.7074 10.293C23.0977 10.6835 23.0979 11.3166 22.7074 11.707C22.3169 12.0975 21.6839 12.0973 21.2933 11.707L19.0004 9.41406V16C19.0004 16.5522 18.5526 16.9999 18.0004 17C17.4481 17 17.0004 16.5523 17.0004 16V9.41406L14.7074 11.707C14.3169 12.0975 13.6839 12.0973 13.2933 11.707C12.9028 11.3165 12.9028 10.6835 13.2933 10.293L17.2933 6.29297C17.3386 6.2477 17.3876 6.20587 17.4408 6.16992C17.4934 6.13439 17.5488 6.10452 17.6058 6.08008C17.6512 6.06059 17.6989 6.04587 17.7474 6.0332C17.7614 6.02955 17.7753 6.0255 17.7894 6.02246C17.8033 6.01948 17.8173 6.01704 17.8314 6.01465C17.847 6.01199 17.8626 6.00973 17.8783 6.00781C17.8961 6.00565 17.914 6.00415 17.932 6.00293C17.948 6.00184 17.9639 6.00131 17.9799 6.00098C17.9866 6.00084 17.9936 6 18.0004 6C18.0072 6 18.0141 6.00084 18.0209 6.00098Z",fill:"#CDE8CF"})]}),a.jsxs("span",{className:"text-xs text-gray-300 hidden sm:inline",children:[Math.round(y*100),"%"]})]}),a.jsxs("button",{onClick:A,className:"flex items-center gap-1.5 px-3 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium whitespace-nowrap",children:[a.jsx(Wo,{size:16}),a.jsx("span",{className:"hidden sm:inline",children:"Exportar CSV"}),a.jsx("span",{className:"sm:hidden",children:"CSV"})]})]})})}),a.jsx("div",{className:"flex-1 overflow-hidden",children:n?a.jsx("div",{className:"bg-red-900/20 border border-red-700/50 rounded-lg p-4 m-4",children:a.jsx("div",{className:"flex items-center gap-2 text-red-400",children:a.jsxs("span",{children:["Erro ao carregar escolas: ",n]})})}):a.jsx("div",{className:"h-full",children:a.jsx(Yf,{escolas:v,onSave:C,loading:i,error:d})})})]})},Jf=()=>{const[r,e]=w.useState(As()),[t,s]=w.useState(!0),[n,o]=w.useState(!1),[i,l]=w.useState(null),[d,h]=w.useState(!1);w.useEffect(()=>{f()},[]);const f=async()=>{try{s(!0);const x=await Hi.getGlobalCardsVisibility();if(x){const A=As();e({...A,...x})}else e(As())}catch(x){B.error("Erro ao carregar configuração global:",x),e(As())}finally{s(!1)}},m=x=>{e(A=>({...A,[x]:!A[x]})),l(null)},u=async()=>{try{o(!0),l(null);const x=await Hi.saveGlobalCardsVisibility(r);x.success?(l({type:"success",message:"Configuração salva!"}),setTimeout(()=>l(null),3e3)):l({type:"error",message:x.error||"Erro ao salvar"})}catch(x){B.error("Erro ao salvar configuração global:",x),l({type:"error",message:"Erro ao salvar configuração"})}finally{o(!1)}},g=Vi.filter(x=>x.category==="grid"),y=Vi.filter(x=>x.category==="standalone");return t?a.jsx("div",{className:"bg-gray-900/80 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800/50 p-6",children:a.jsx("div",{className:"text-center py-8",children:a.jsx("div",{className:"text-gray-400",children:"Carregando..."})})}):a.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800/50 p-6",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-200",children:"Visibilidade Global de Cards"}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),className:"text-gray-400 hover:text-gray-300 transition-colors","aria-label":"Informações",children:a.jsx(mi,{className:"w-4 h-4"})}),d&&a.jsxs("div",{className:"absolute left-0 top-6 w-80 bg-gray-800 border border-gray-700 rounded-lg p-4 shadow-xl z-50",children:[a.jsxs("p",{className:"text-sm text-gray-300 mb-2",children:[a.jsx("strong",{className:"text-gray-200",children:"Configuração Global:"})," Define o padrão para todas as escolas."]}),a.jsxs("p",{className:"text-sm text-gray-300 mb-2",children:[a.jsx("strong",{className:"text-gray-200",children:"Configuração Individual:"})," Cada escola pode ter suas próprias configurações que sobrescrevem a global."]}),a.jsxs("p",{className:"text-sm text-gray-300",children:[a.jsx("strong",{className:"text-gray-200",children:"Prioridade:"})," Individual → Global → Padrão (todos visíveis)"]})]})]})]}),a.jsxs("button",{onClick:u,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[a.jsx(Zs,{className:"w-4 h-4"}),n?"Salvando...":"Salvar"]})]}),a.jsx("p",{className:"text-sm text-gray-400",children:"Define os cards visíveis por padrão em todas as escolas."}),i&&a.jsxs("div",{className:`mt-4 p-3 rounded-lg border flex items-center gap-2 ${i.type==="success"?"bg-green-900/50 border-green-700/50 text-green-200":"bg-red-900/50 border-red-700/50 text-red-200"}`,children:[i.type==="success"?a.jsx(ui,{className:"w-4 h-4"}):a.jsx(xt,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:i.message})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("div",{className:"border-b border-gray-700/50 pb-2 mb-4",children:a.jsx("h4",{className:"text-base font-medium text-gray-300",children:"Grid Principal"})}),a.jsx("div",{className:"space-y-3",children:g.map(x=>a.jsx(Qi,{card:x,isVisible:r[x.id],onToggle:()=>m(x.id)},x.id))})]}),a.jsxs("div",{children:[a.jsx("div",{className:"border-b border-gray-700/50 pb-2 mb-4",children:a.jsx("h4",{className:"text-base font-medium text-gray-300",children:"Seções Adicionais"})}),a.jsx("div",{className:"space-y-3",children:y.map(x=>a.jsx(Qi,{card:x,isVisible:r[x.id],onToggle:()=>m(x.id)},x.id))})]})]})]})},Qi=({card:r,isVisible:e,onToggle:t})=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg border border-gray-700/30 hover:border-gray-600/50 transition-colors",children:[a.jsx("div",{className:"flex-1",children:a.jsx("h4",{className:"text-sm font-medium text-gray-200",children:r.label})}),a.jsx("button",{onClick:t,className:`
          relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900
          ${e?"bg-green-600":"bg-gray-600"}
        `,role:"switch","aria-checked":e,"aria-label":`${e?"Ocultar":"Mostrar"} ${r.label}`,children:a.jsx("span",{className:`
            inline-block h-4 w-4 transform rounded-full bg-white transition-transform
            ${e?"translate-x-6":"translate-x-1"}
          `})})]}),pi="opin:metadataMemory",Zd=()=>{try{const r=localStorage.getItem(pi);if(r)return JSON.parse(r)}catch{}return null},eg=r=>{try{const t={...Zd()||{}};r.fonte_id!==null&&r.fonte_id!==void 0&&(t.fonte_id=r.fonte_id||null),r.observacoes!==null&&r.observacoes!==void 0&&(t.observacoes=r.observacoes||null),t.fonte_id||t.observacoes?localStorage.setItem(pi,JSON.stringify(t)):Xd()}catch{}},Xd=()=>{try{localStorage.removeItem(pi)}catch{}},tg=({isOpen:r,onClose:e,onSave:t,escolaId:s,escolaNome:n,camposAlterados:o=[]})=>{const[i,l]=w.useState([]),[d,h]=w.useState(!0),[f,m]=w.useState(null),[u,g]=w.useState({fonte_id:"",observacoes:""}),[y,x]=w.useState(!1),[A,C]=w.useState(!1),[v,k]=w.useState(!1),[_,q]=w.useState(!1),D=w.useRef(null);w.useEffect(()=>{r?(async()=>{h(!0);const j=await mr.buscarFontesDados();j.success&&l(j.data),h(!1);const N=await mr.obterAutorAtual();m(N);const S=Zd();if(S){k(!0);const L={fonte_id:S.fonte_id||"",observacoes:S.observacoes||""};(L.fonte_id||L.observacoes)&&(g(L),C(!0))}else k(!1),C(!1)})():(g({fonte_id:"",observacoes:""}),C(!1))},[r]);const F=(p,j)=>{g(N=>({...N,[p]:j}))},T=async()=>{x(!0);try{const p=[];for(const N of o){const S=await mr.registrarVersaoDados({nomeTabela:"escolas_completa",chaveLinha:s.toString(),nomeCampo:N.campo,fonteId:u.fonte_id||null,autor:f,observacoes:u.observacoes.trim()||null});p.push(S)}if(p.every(N=>N.success))(u.fonte_id||u.observacoes.trim())&&eg({fonte_id:u.fonte_id||null,observacoes:u.observacoes.trim()||null}),t&&t(p),e();else{const N=p.filter(S=>!S.success).map(S=>S.error);B.error("Erro ao salvar alguns metadados:",N),alert("Alguns metadados não puderam ser salvos. Verifique o console para mais detalhes.")}}catch(p){B.error("Erro ao salvar metadados:",p),alert("Erro ao salvar metadados: "+p.message)}finally{x(!1)}},V=()=>{window.confirm("Deseja limpar a memória de metadados? Os valores salvos anteriormente não serão mais carregados automaticamente.")&&(Xd(),k(!1),C(!1),g({fonte_id:"",observacoes:""}))};w.useEffect(()=>{D.current&&(D.current.style.height="auto",D.current.style.height=`${D.current.scrollHeight}px`)},[u.observacoes]);const O=async()=>{x(!0);try{const p=[];for(const N of o){const S=await mr.registrarVersaoDados({nomeTabela:"escolas_completa",chaveLinha:s.toString(),nomeCampo:N.campo,fonteId:null,autor:f,observacoes:null});p.push(S)}if(p.every(N=>N.success))t&&t(p),e();else{const N=p.filter(S=>!S.success).map(S=>S.error);B.error("Erro ao salvar alguns metadados:",N),alert("Alguns metadados não puderam ser salvos. Verifique o console para mais detalhes.")}}catch(p){B.error("Erro ao salvar metadados:",p),alert("Erro ao salvar metadados: "+p.message)}finally{x(!1)}};return r?a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:p=>p.target===p.currentTarget&&!y&&O(),children:a.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800/50 w-full max-w-lg transform transition-all duration-300 scale-100",onClick:p=>p.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800/50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-500/20 text-blue-400 rounded-lg",children:a.jsx(mi,{className:"w-5 h-5"})}),a.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:"Registrar metadados da alteração"})]}),a.jsx("button",{onClick:O,disabled:y,className:"p-2 text-gray-400 hover:text-gray-200 hover:bg-gray-800 rounded-lg transition-colors disabled:opacity-50","aria-label":"Fechar modal",children:a.jsx(ze,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-4 max-h-[60vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800",children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("p",{className:"text-sm text-gray-300",children:["Metadados ajudam a registrar a origem e o contexto da alteração. Se preferir, você pode salvar sem preencher."," ",a.jsxs("button",{onClick:()=>q(!_),className:"text-blue-400 hover:text-blue-300 underline inline-flex items-center gap-1",children:["Saiba mais",a.jsx("svg",{className:`w-3 h-3 transition-transform ${_?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),_&&a.jsxs("div",{className:"mt-2 p-3 bg-blue-900/20 border border-blue-700/30 rounded-md",children:[a.jsx("p",{className:"text-xs text-gray-300 leading-relaxed mb-2",children:"Metadados são informações que descrevem a origem e o contexto dos dados que você está inserindo ou modificando."}),a.jsx("p",{className:"text-xs text-gray-300 leading-relaxed",children:"Eles ajudam a manter o site mais rigoroso, confiável e útil para quem for estudá-lo no futuro."})]})]}),o.length>0&&a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1.5",children:"Campos alterados:"}),a.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto border border-gray-800/50 rounded-md p-2 bg-gray-800/30 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800",children:o.map((p,j)=>a.jsxs("div",{className:"text-xs text-gray-300",children:[a.jsxs("span",{className:"font-medium",children:[p.label||p.campo,":"]})," ",a.jsxs("span",{className:"text-gray-400",children:[String(p.valorNovo).substring(0,60),String(p.valorNovo).length>60&&"..."]})]},j))})]}),A&&a.jsxs("div",{className:"mb-3 p-2 bg-green-900/30 border border-green-700/50 rounded-md flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Sf,{className:"w-3.5 h-3.5 text-green-400"}),a.jsx("span",{className:"text-xs text-green-300",children:"Valores carregados da memória anterior"})]}),v&&a.jsxs("button",{onClick:V,className:"text-xs text-gray-400 hover:text-gray-200 flex items-center gap-1 px-2 py-1 rounded hover:bg-gray-800/50 transition-colors",title:"Limpar memória",children:[a.jsx(Ws,{className:"w-3 h-3"}),"Limpar"]})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{htmlFor:"fonte_id",className:"block text-sm font-medium text-gray-300 mb-1",children:"Fonte dos dados"}),a.jsxs("select",{id:"fonte_id",value:u.fonte_id,onChange:p=>{F("fonte_id",p.target.value),C(!1)},className:"w-full px-3 py-2 text-sm border border-gray-700/50 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-800/50 text-gray-200",disabled:y,children:[a.jsx("option",{value:"",className:"bg-gray-800 text-gray-200",children:"Selecione a fonte dos dados"}),d?a.jsx("option",{disabled:!0,className:"bg-gray-800 text-gray-200",children:"Carregando fontes..."}):i.map(p=>a.jsxs("option",{value:p.id,className:"bg-gray-800 text-gray-200",children:[p.nome," ",p.descricao?`- ${p.descricao}`:""]},p.id))]})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{htmlFor:"observacoes",className:"block text-sm font-medium text-gray-300 mb-1",children:"Observações"}),a.jsx("textarea",{ref:D,id:"observacoes",value:u.observacoes,onChange:p=>{const j=p.target.value;j.length<=1e3&&(F("observacoes",j),C(!1))},rows:2,maxLength:1e3,placeholder:"Adicione observações sobre esta alteração...",className:"w-full px-3 py-2 text-sm border border-gray-700/50 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none bg-gray-800/50 text-gray-200 placeholder-gray-500 overflow-hidden",disabled:y,style:{minHeight:"2.5rem"}}),a.jsx("div",{className:"mt-1",children:a.jsxs("span",{className:"text-xs text-gray-400",children:[u.observacoes.length,"/1000 caracteres"]})})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 border-t border-gray-800/50 bg-gray-800/30 rounded-b-2xl",children:[a.jsx("button",{onClick:O,disabled:y,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-800/50 border border-gray-700/50 rounded-md hover:bg-gray-800 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Salvar sem metadados"}),a.jsx("button",{onClick:T,disabled:y,className:"px-5 py-2 text-sm font-medium text-white bg-gradient-to-r from-green-600 to-green-700 rounded-md hover:from-green-700 hover:to-green-800 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-lg",children:y?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvando..."]}):"Salvar e registrar metadados"})]})]})}):null},rg=()=>{const[r,e]=w.useState([]),[t,s]=w.useState(!0),[n,o]=w.useState(null),[i,l]=w.useState(null),[d,h]=w.useState([]),[f,m]=w.useState(!1),[u,g]=w.useState({}),[y,x]=w.useState(0),A=[{id:"escolas_completa",nome:"Escolas Completas",descricao:"Dados principais de todas as escolas indígenas",icone:$r,cor:"bg-blue-500",registros:0},{id:"historias_professor",nome:"Histórias dos Professores",descricao:"Depoimentos e histórias dos professores indígenas",icone:_s,cor:"bg-green-500",registros:0},{id:"documentos_escola",nome:"Documentos das Escolas",descricao:"PDFs e documentos das escolas",icone:Za,cor:"bg-purple-500",registros:0},{id:"titulos_videos",nome:"Vídeos das Escolas",descricao:"Links e títulos dos vídeos das escolas",icone:Hf,cor:"bg-red-500",registros:0},{id:"legendas_fotos",nome:"Legendas das Fotos",descricao:"Legendas e descrições das imagens",icone:Kr,cor:"bg-yellow-500",registros:0},{id:"imagens_professores",nome:"Imagens dos Professores",descricao:"Metadados das imagens dos professores",icone:_s,cor:"bg-teal-500",registros:0},{id:"imagens_escola",nome:"Imagens das Escolas",descricao:"Metadados das imagens das escolas",icone:Kr,cor:"bg-indigo-500",registros:0},{id:"fontes_dados",nome:"Fontes de Dados",descricao:"Fontes de dados utilizadas no sistema de versionamento",icone:Za,cor:"bg-cyan-500",registros:0},{id:"versoes_dados",nome:"Versões de Dados",descricao:"Histórico de versões e metadados das alterações",icone:Cs,cor:"bg-orange-500",registros:0}],C=[{id:"imagens-das-escolas",nome:"Imagens das Escolas",descricao:"Fotos das escolas indígenas",icone:Kr,cor:"bg-indigo-500",arquivos:0},{id:"imagens-professores",nome:"Imagens dos Professores",descricao:"Fotos dos professores indígenas",icone:_s,cor:"bg-teal-500",arquivos:0},{id:"pdfs",nome:"Documentos PDF",descricao:"Documentos das escolas em PDF",icone:Za,cor:"bg-orange-500",arquivos:0},{id:"historias-professor",nome:"Histórias dos Professores",descricao:"Imagens das histórias dos professores",icone:_s,cor:"bg-green-500",arquivos:0}],v=async()=>{g({status:"testando",message:"Testando buckets..."});const j=[];for(const I of C)try{B.debug(`Testando bucket: ${I.id}`);const{data:M,error:G}=await re.storage.from(I.id).list("",{limit:1e3});G?(B.error(`❌ Erro no bucket ${I.id}:`,G),j.push({bucket:I.id,status:"erro",mensagem:G.message})):(B.debug(`✅ Bucket ${I.id} OK - ${M?.length||0} arquivos encontrados`),M&&M.length>0&&B.debug(`📁 Arquivos no bucket ${I.id}:`,M.map(K=>K.name)),j.push({bucket:I.id,status:"ok",arquivos:M?.length||0}))}catch(M){B.error(`❌ Exceção no bucket ${I.id}:`,M),j.push({bucket:I.id,status:"excecao",mensagem:M.message})}const N=j.filter(I=>I.status==="ok").length,S=j.filter(I=>I.status==="erro"||I.status==="excecao").length,L=j.reduce((I,M)=>I+(M.arquivos||0),0);g(S===0?{status:"concluido",message:`✅ Todos os buckets estão funcionando! ${N} buckets testados, ${L} arquivos encontrados.`}:{status:"erro",message:`⚠️ ${S} bucket(s) com problema. Verifique o console para detalhes.`}),setTimeout(()=>{g({})},5e3)},k=async()=>{g({status:"testando",message:"Testando tabelas..."});const j=[];for(const L of A)try{B.debug(`Testando tabela: ${L.id}`);const{data:I,error:M}=await re.from(L.id).select("*").limit(5);M?(B.error(`❌ Erro na tabela ${L.id}:`,M),j.push({tabela:L.id,status:"erro",mensagem:M.message})):(B.debug(`✅ Tabela ${L.id} OK - ${I?.length||0} registros encontrados`),j.push({tabela:L.id,status:"ok",registros:I?.length||0}))}catch(I){B.error(`❌ Exceção na tabela ${L.id}:`,I),j.push({tabela:L.id,status:"excecao",mensagem:I.message})}const N=j.filter(L=>L.status==="ok").length,S=j.filter(L=>L.status==="erro"||L.status==="excecao").length;g(S===0?{status:"concluido",message:`✅ Todas as tabelas estão funcionando! ${N} tabelas testadas.`}:{status:"erro",message:`⚠️ ${S} tabela(s) com problema. Verifique o console para detalhes.`}),setTimeout(()=>{g({})},5e3)};w.useEffect(()=>{e(A),s(!1)},[]);const _=async j=>{try{m(!0),o(null);const{data:N,error:S}=await re.from(j).select("*").order("id",{ascending:!0});if(S)throw S;h(N||[]),l(j)}catch(N){B.error(`Erro ao carregar dados da tabela ${j}:`,N),o(`Erro ao carregar dados: ${N.message}`)}finally{m(!1)}},q=async(j,N)=>{try{const L=await(await fetch(j)).blob(),I=window.URL.createObjectURL(L),M=document.createElement("a");M.href=I,M.download=N,document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL(I)}catch(S){B.error(`Erro ao baixar ${N}:`,S)}},D=async(j,N)=>{try{B.debug("Iniciando criação do ZIP com",j.length,"arquivos");const S=(await Xr(async()=>{const{default:$}=await import("./jszip.min-AkjzMQrs.js").then(H=>H.j);return{default:$}},__vite__mapDeps([0,1,2]))).default,L=new S;let I=0;for(const $ of j)try{B.debug(`Baixando arquivo: ${$.name} de ${$.url}`);const H=await fetch($.url);if(!H.ok)throw new Error(`HTTP ${H.status}: ${H.statusText}`);const X=await H.blob();B.debug(`Arquivo ${$.name} baixado, tamanho: ${X.size} bytes`),L.file($.name,X),I++;const ee=I/j.length*100;x(ee)}catch(H){B.error(`Erro ao adicionar ${$.name} ao ZIP:`,H)}if(I===0)throw new Error("Nenhum arquivo foi adicionado ao ZIP");B.debug(`Gerando ZIP com ${I} arquivos...`);const M=await L.generateAsync({type:"blob"});B.debug(`ZIP gerado, tamanho: ${M.size} bytes`);const G=window.URL.createObjectURL(M),K=document.createElement("a");K.href=G,K.download=N,document.body.appendChild(K),K.click(),document.body.removeChild(K),window.URL.revokeObjectURL(G),B.debug("ZIP baixado com sucesso:",N)}catch(S){B.error("Erro ao criar ZIP:",S);for(const L of j)try{await q(L.url,L.name),await new Promise(I=>setTimeout(I,200))}catch(I){B.error(`Erro ao baixar ${L.name}:`,I)}}},F=async()=>{try{g({status:"iniciando",message:"Iniciando backup completo..."}),x(0),g({status:"tabelas",message:"Fazendo backup das tabelas..."}),x(10);const j={};for(const $ of A)try{const{data:H,error:X}=await re.from($.id).select("*");if(X)throw X;j[$.id]=H||[]}catch(H){B.error(`Erro ao fazer backup da tabela ${$.id}:`,H)}x(25),g({status:"buckets",message:"Preparando download das imagens..."}),x(30);const N={},S=[];for(const $ of C)try{B.debug(`Listando arquivos do bucket: ${$.id}`);const{data:H,error:X}=await re.storage.from($.id).list("",{limit:1e3});if(X)throw X;B.debug(`Bucket ${$.id}: ${H?.length||0} arquivos encontrados`),B.debug("Arquivos encontrados:",H);const ee=[];for(const te of H)try{B.debug(`Gerando URL para: ${te.name}`);const{data:W}=await re.storage.from($.id).createSignedUrl(te.name,3600);if(W?.signedUrl){const ne={...te,url:W.signedUrl,bucket:$.id,bucketNome:$.nome};ee.push(ne),S.push(ne),B.debug(`URL gerada para ${te.name}: ${W.signedUrl.substring(0,50)}...`)}else B.warn(`URL não gerada para ${te.name}`)}catch(W){B.error(`Erro ao gerar URL para ${te.name}:`,W)}B.debug(`Bucket ${$.id}: ${ee.length} URLs geradas`),N[$.id]=ee}catch(H){B.error(`Erro ao fazer backup do bucket ${$.id}:`,H)}x(75),g({status:"finalizando",message:"Criando arquivo de backup..."}),x(80);const L={metadata:{dataBackup:new Date().toISOString(),versao:"1.0",descricao:"Backup completo do sistema OPIN - Observatório dos Professores Indígenas",tabelas:A.map($=>({id:$.id,nome:$.nome})),buckets:C.map($=>({id:$.id,nome:$.nome})),totalRegistros:Object.values(j).reduce(($,H)=>$+(H?.length||0),0),totalArquivos:Object.values(N).reduce(($,H)=>$+(H?.length||0),0)},dados:j,arquivos:N};g({status:"download",message:"Preparando download..."}),x(90);const I=JSON.stringify(L,null,2),M=new Blob([I],{type:"application/json;charset=utf-8;"}),G=document.createElement("a"),K=URL.createObjectURL(M);G.setAttribute("href",K),G.setAttribute("download",`backup_completo_opin_${new Date().toISOString().split("T")[0]}.json`),G.style.visibility="hidden",document.body.appendChild(G),G.click(),document.body.removeChild(G),B.debug(`Total de arquivos para download: ${S.length}`),B.debug("Arquivos para download:",S),S.length>0?(g({status:"imagens",message:"Baixando imagens..."}),x(95),await D(S,`imagens_opin_${new Date().toISOString().split("T")[0]}.zip`)):(B.warn("Nenhuma imagem encontrada para backup"),g({status:"erro",message:"Nenhuma imagem encontrada para backup. Verifique se há arquivos nos buckets."})),x(100),g({status:"concluido",message:"Backup completo realizado com sucesso!",detalhes:{tabelas:Object.keys(j).length,registros:Object.values(j).reduce(($,H)=>$+(H?.length||0),0),arquivos:Object.values(N).reduce(($,H)=>$+(H?.length||0),0)}}),setTimeout(()=>{g({}),x(0)},5e3)}catch(j){B.error("Erro no backup completo:",j),g({status:"erro",message:`Erro no backup: ${j.message}`}),x(0)}},T=async()=>{try{g({status:"tabelas",message:"Fazendo backup das tabelas em CSV..."}),x(0);const j={};for(let $=0;$<A.length;$++){const H=A[$];try{const{data:X,error:ee}=await re.from(H.id).select("*");if(ee)throw ee;j[H.id]=X||[],x(($+1)/A.length*100)}catch(X){B.error(`Erro ao fazer backup da tabela ${H.id}:`,X)}}const N=new Date().toISOString().split("T")[0],S=(await Xr(async()=>{const{default:$}=await import("./jszip.min-AkjzMQrs.js").then(H=>H.j);return{default:$}},__vite__mapDeps([0,1,2]))).default,L=new S;for(const[$,H]of Object.entries(j))if(H&&H.length>0){const X=Object.keys(H[0]),ee=[X.join(","),...H.map(te=>X.map(W=>{const ne=te[W];return typeof ne=="string"&&(ne.includes(",")||ne.includes(`
`)||ne.includes('"'))?`"${ne.replace(/"/g,'""')}"`:ne||""}).join(","))].join(`
`);L.file(`${$}_${N}.csv`,ee)}const I={dataBackup:new Date().toISOString(),tipo:"backup_tabelas_csv",tabelas:Object.keys(j),totalRegistros:Object.values(j).reduce(($,H)=>$+(H?.length||0),0),formato:"CSV",descricao:"Backup das tabelas do sistema OPIN em formato CSV"};L.file(`metadata_${N}.json`,JSON.stringify(I,null,2));const M=await L.generateAsync({type:"blob"}),G=window.URL.createObjectURL(M),K=document.createElement("a");K.href=G,K.download=`backup_tabelas_csv_opin_${N}.zip`,K.style.visibility="hidden",document.body.appendChild(K),K.click(),document.body.removeChild(K),window.URL.revokeObjectURL(G),g({status:"concluido",message:"Backup das tabelas em CSV realizado com sucesso!"}),setTimeout(()=>{g({}),x(0)},3e3)}catch(j){B.error("Erro no backup das tabelas:",j),g({status:"erro",message:`Erro no backup: ${j.message}`}),x(0)}},V=async()=>{try{B.debug("Iniciando backup das imagens..."),g({status:"imagens",message:"Preparando backup das imagens..."}),x(0);const j=[];for(let N=0;N<C.length;N++){const S=C[N];try{B.debug(`Processando bucket: ${S.id} (${S.nome})`),g({status:"imagens",message:`Processando bucket: ${S.nome}...`});const{data:L,error:I}=await re.storage.from(S.id).list("",{limit:1e3});if(I)throw B.error(`Erro ao listar arquivos do bucket ${S.id}:`,I),I;if(B.debug(`Bucket ${S.id} tem ${L?.length||0} arquivos`),L&&L.length>0)for(const M of L)try{B.debug(`Gerando URL para: ${M.name}`);const{data:G,error:K}=await re.storage.from(S.id).createSignedUrl(M.name,3600);if(K){B.error(`Erro ao gerar URL para ${M.name}:`,K);continue}if(G?.signedUrl){const $={...M,url:G.signedUrl,bucket:S.id,bucketNome:S.nome};j.push($),B.debug(`URL gerada para ${M.name}: ${G.signedUrl.substring(0,50)}...`)}else B.warn(`URL não gerada para ${M.name}`)}catch(G){B.error(`Erro ao gerar URL para ${M.name}:`,G)}else B.debug(`Bucket ${S.id} está vazio`);x((N+1)/C.length*100)}catch(L){B.error(`Erro ao processar bucket ${S.id}:`,L)}}B.debug(`Total de arquivos encontrados: ${j.length}`),j.length>0?(g({status:"download",message:`Criando arquivo ZIP com ${j.length} imagens...`}),await D(j,`imagens_opin_${new Date().toISOString().split("T")[0]}.zip`),g({status:"concluido",message:`Backup das imagens realizado com sucesso! ${j.length} arquivos baixados.`})):g({status:"concluido",message:"Nenhuma imagem encontrada para backup."}),setTimeout(()=>{g({}),x(0)},3e3)}catch(j){B.error("Erro no backup das imagens:",j),g({status:"erro",message:`Erro no backup: ${j.message}`}),x(0)}},O=(j,N)=>{if(!N||N.length===0){alert("Nenhum dado para baixar");return}const S=Object.keys(N[0]),L=[S.join(","),...N.map(K=>S.map($=>{const H=K[$];return typeof H=="string"&&(H.includes(",")||H.includes(`
`)||H.includes('"'))?`"${H.replace(/"/g,'""')}"`:H||""}).join(","))].join(`
`),I=new Blob([L],{type:"text/csv;charset=utf-8;"}),M=document.createElement("a"),G=URL.createObjectURL(I);M.setAttribute("href",G),M.setAttribute("download",`${j}_${new Date().toISOString().split("T")[0]}.csv`),M.style.visibility="hidden",document.body.appendChild(M),M.click(),document.body.removeChild(M)},p=(j,N)=>{if(!N||N.length===0){alert("Nenhum dado para baixar");return}const S=JSON.stringify(N,null,2),L=new Blob([S],{type:"application/json;charset=utf-8;"}),I=document.createElement("a"),M=URL.createObjectURL(L);I.setAttribute("href",M),I.setAttribute("download",`${j}_${new Date().toISOString().split("T")[0]}.json`),I.style.visibility="hidden",document.body.appendChild(I),I.click(),document.body.removeChild(I)};return t?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"text-gray-400 text-lg",children:"Carregando tabelas..."})}):a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-6 border border-gray-700/30",children:[a.jsxs("h4",{className:"text-lg font-semibold text-gray-100 mb-6 flex items-center gap-2",children:[a.jsx(Cs,{className:"w-5 h-5 text-blue-400"}),"Backup Completo do Sistema"]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-blue-600/20 to-blue-700/20 rounded-xl p-6 border border-blue-500/30 hover:border-blue-400/50 transition-all duration-200",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"bg-blue-500 p-3 rounded-lg mr-3",children:a.jsx(Cs,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-100",children:"Backup Completo"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Sistema completo"})]})]}),a.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Inclui todas as tabelas, imagens dos buckets e tabelas de metadados (fontes_dados e versoes_dados)"}),a.jsxs("button",{onClick:F,disabled:u.status==="iniciando"||u.status==="tabelas"||u.status==="buckets"||u.status==="finalizando"||u.status==="download"||u.status==="imagens",className:"w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl",children:[a.jsx(Cs,{className:"w-4 h-4 inline mr-2"}),"Backup Completo"]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-green-600/20 to-green-700/20 rounded-xl p-6 border border-green-500/30 hover:border-green-400/50 transition-all duration-200",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"bg-green-500 p-3 rounded-lg mr-3",children:a.jsx($r,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-100",children:"Backup das Tabelas"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Apenas dados"})]})]}),a.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Apenas os dados das tabelas em formato CSV"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:T,disabled:u.status==="tabelas",className:"w-full px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl",children:[a.jsx($r,{className:"w-4 h-4 inline mr-2"}),"Backup Tabelas"]}),a.jsx("button",{onClick:k,className:"w-full px-3 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-600/50 transition-colors border border-gray-600/50 text-sm",children:"🔍 Testar Tabelas"})]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-purple-600/20 to-purple-700/20 rounded-xl p-6 border border-purple-500/30 hover:border-purple-400/50 transition-all duration-200",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"bg-purple-500 p-3 rounded-lg mr-3",children:a.jsx(Xi,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h5",{className:"font-semibold text-gray-100",children:"Backup das Imagens"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Apenas arquivos"})]})]}),a.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Apenas as imagens dos buckets em arquivo ZIP"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:V,disabled:u.status==="imagens"||u.status==="download",className:"w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl hover:from-purple-700 hover:to-purple-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl",children:[a.jsx(Xi,{className:"w-4 h-4 inline mr-2"}),"Backup Imagens"]}),a.jsx("button",{onClick:v,className:"w-full px-3 py-2 bg-gray-700/50 text-gray-300 rounded-lg hover:bg-gray-600/50 transition-colors border border-gray-600/50 text-sm",children:"🔍 Testar Buckets"})]})]})]}),u.status&&a.jsx("div",{className:`p-6 rounded-xl border backdrop-blur-sm ${u.status==="concluido"?"bg-green-900/50 border-green-700/50 text-green-200":u.status==="erro"?"bg-red-900/50 border-red-700/50 text-red-200":"bg-blue-900/50 border-blue-700/50 text-blue-200"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[u.status==="concluido"?a.jsx(ui,{className:"w-6 h-6 text-green-400"}):u.status==="erro"?a.jsx(xt,{className:"w-6 h-6 text-red-400"}):a.jsx("div",{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:u.message}),u.detalhes&&a.jsxs("p",{className:"text-sm mt-1 text-gray-300",children:["Tabelas: ",u.detalhes.tabelas," | Registros: ",u.detalhes.registros," | Arquivos: ",u.detalhes.arquivos]})]})]}),y>0&&y<100&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-32 bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-green-400 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),a.jsxs("span",{className:"text-sm font-medium",children:[Math.round(y),"%"]})]})]})})]}),a.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-6 border border-gray-700/30",children:[a.jsxs("h4",{className:"text-lg font-semibold text-gray-100 mb-6 flex items-center gap-2",children:[a.jsx($r,{className:"w-5 h-5 text-gray-400"}),"Tabelas do Sistema"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(j=>{const N=j.icone,S=i===j.id;return a.jsx("div",{className:`bg-gray-800/50 backdrop-blur-sm rounded-xl border-2 cursor-pointer transition-all duration-200 hover:shadow-lg ${S?"border-green-500/50 bg-green-600/20":"border-gray-700/50 hover:border-gray-600/50 hover:bg-gray-700/30"}`,onClick:()=>_(j.id),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:`${j.cor} p-3 rounded-lg mr-3 shadow-lg`,children:a.jsx(N,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-100",children:j.nome}),a.jsxs("p",{className:"text-sm text-gray-400",children:[j.registros," registros"]})]})]}),a.jsx("p",{className:"text-sm text-gray-300 mb-4",children:j.descricao}),a.jsx("div",{className:"flex space-x-2",children:a.jsxs("button",{className:"flex items-center px-3 py-2 text-xs bg-blue-600/20 text-blue-300 rounded-lg hover:bg-blue-600/30 transition-colors border border-blue-500/30",onClick:L=>{L.stopPropagation(),_(j.id)},children:[a.jsx(Dd,{className:"w-3 h-3 mr-1"}),"Visualizar"]})})]})},j.id)})})]}),i&&a.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-6 border border-gray-700/30",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"text-lg font-semibold text-gray-100",children:["Dados da Tabela: ",r.find(j=>j.id===i)?.nome]}),a.jsxs("p",{className:"text-sm text-gray-400",children:[d.length," registros encontrados"]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{onClick:()=>_(i),disabled:f,className:"flex items-center px-4 py-2 text-sm bg-gray-700/50 text-gray-200 rounded-lg hover:bg-gray-600/50 transition-colors disabled:opacity-50 border border-gray-600/50",children:[a.jsx(fi,{className:"w-4 h-4 mr-2"}),"Atualizar"]}),a.jsxs("button",{onClick:()=>O(i,d),disabled:f||d.length===0,className:"flex items-center px-4 py-2 text-sm bg-green-600/20 text-green-300 rounded-lg hover:bg-green-600/30 transition-colors disabled:opacity-50 border border-green-500/30",children:[a.jsx(Wo,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs("button",{onClick:()=>p(i,d),disabled:f||d.length===0,className:"flex items-center px-4 py-2 text-sm bg-purple-600/20 text-purple-300 rounded-lg hover:bg-purple-600/30 transition-colors disabled:opacity-50 border border-purple-500/30",children:[a.jsx(Wo,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n&&a.jsx("div",{className:"mb-6 p-4 bg-red-900/50 border border-red-700/50 text-red-200 rounded-xl backdrop-blur-sm",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(xt,{className:"w-5 h-5 text-red-400"}),a.jsx("span",{children:n})]})}),f?a.jsx("div",{className:"flex items-center justify-center h-32",children:a.jsx("span",{className:"ml-3 text-gray-400",children:"Carregando dados..."})}):a.jsxs("div",{className:"overflow-x-auto",children:[d.length>0?a.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[a.jsx("thead",{className:"bg-gray-700/30",children:a.jsx("tr",{children:Object.keys(d[0]).map(j=>a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:j},j))})}),a.jsx("tbody",{className:"bg-gray-800/20 divide-y divide-gray-700",children:d.slice(0,100).map((j,N)=>a.jsx("tr",{className:"hover:bg-gray-700/30 transition-colors",children:Object.values(j).map((S,L)=>a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-200 max-w-xs truncate",title:typeof S=="string"&&S.length>50?S:"",children:typeof S=="string"&&S.length>50?`${S.substring(0,50)}...`:S||"-"},L))},N))})]}):a.jsxs("div",{className:"text-center py-12 text-gray-400",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-700/30 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx($r,{className:"w-8 h-8 text-gray-500"})}),a.jsx("p",{children:"Nenhum dado encontrado nesta tabela"})]}),d.length>100&&a.jsxs("div",{className:"mt-6 text-center text-sm text-gray-400 bg-gray-700/20 p-4 rounded-lg",children:["Mostrando os primeiros 100 registros de ",d.length," total. Use os botões de download para acessar todos os dados."]})]})]})]})},sg=({isOpen:r,onClose:e})=>r?a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800/50 w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-800/50 flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"bg-blue-500 p-3 rounded-lg",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Backup dos Dados do Site"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Gerencie backups das tabelas e arquivos"})]})]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-200 hover:bg-gray-800 rounded-lg transition-colors",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a.jsx(rg,{})})]})}):null,ag=({isOpen:r,onClose:e,escolas:t,escolaToDelete:s,setEscolaToDelete:n,onConfirmDelete:o,isDeleting:i})=>r?a.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800/50 w-full max-w-md",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-800/50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"bg-red-500 p-3 rounded-lg",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Remover Escola"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Selecione uma escola para remover"})]})]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-200 hover:bg-gray-800 rounded-lg transition-colors",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsx("div",{className:"p-6",children:s?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-red-900/20 border border-red-700/50 rounded-xl p-4",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.jsx("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),a.jsx("h3",{className:"font-semibold text-red-200",children:"Confirmar Remoção"})]}),a.jsxs("p",{className:"text-red-300 text-sm",children:["Você está prestes a remover a escola ",a.jsxs("strong",{children:['"',s.Escola,'"']})," de ",a.jsxs("strong",{children:['"',s.Município,'"']}),"."]}),a.jsx("p",{className:"text-red-400 text-sm mt-2",children:"⚠️ Esta ação é irreversível e removerá todos os dados da escola do sistema."})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>n(null),className:"flex-1 px-4 py-3 bg-gray-700 text-gray-200 rounded-xl hover:bg-gray-600 transition-colors",children:"Cancelar"}),a.jsx("button",{onClick:o,disabled:i,className:"flex-1 px-4 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:i?a.jsx("div",{className:"flex items-center gap-2 justify-center",children:"Removendo..."}):a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Confirmar Remoção"]})})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-gray-300 mb-4",children:"Selecione uma escola da lista para remover:"}),a.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:t.map(l=>a.jsx("button",{onClick:()=>n(l),className:"w-full text-left p-4 rounded-xl hover:bg-gray-800/50 transition-all duration-200 border border-transparent hover:border-gray-700/50 text-gray-200 hover:text-white",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-medium truncate text-gray-200",children:l.Escola}),l.Município&&a.jsx("p",{className:"text-sm text-gray-400 truncate mt-1",children:l.Município})]}),a.jsx("div",{className:"ml-2 flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},l.id))})]})})]})}):null,et=({cardId:r,editingLocation:e,setEditingLocation:t,label:s})=>{const{globalVisibility:n}=Xh(),[o,i]=w.useState(!1),l=e?.cards_visibilidade||{},d=Yh(l,r,n),f=!(l&&l.hasOwnProperty(r))&&n,m=()=>{const y={...e?.cards_visibilidade||{}};f&&d?y[r]=!1:f&&!d?y[r]=!0:y[r]=!d,t({...e,cards_visibilidade:y})},u=s?.replace("Visibilidade do Card: ","")||"Card";return a.jsx("div",{className:"mb-4 p-3 bg-gray-800/30 rounded-lg border border-gray-700/30",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[a.jsx("span",{className:"text-sm font-medium text-gray-200",children:u}),f&&a.jsxs("div",{className:"relative",children:[a.jsx("button",{onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:"text-gray-500 hover:text-gray-400 transition-colors","aria-label":"Usando configuração global",children:a.jsx(mi,{className:"w-3 h-3"})}),o&&a.jsx("div",{className:"absolute left-0 top-5 w-64 bg-gray-800 border border-gray-700 rounded-lg p-3 shadow-xl z-50",children:a.jsx("p",{className:"text-xs text-gray-300",children:"Usando configuração global. Alterar aqui criará uma configuração individual para esta escola."})})]})]}),a.jsx("button",{onClick:m,className:`
            relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900
            ${d?"bg-green-600":"bg-gray-600"}
          `,role:"switch","aria-checked":d,"aria-label":`${d?"Ocultar":"Mostrar"} ${u}`,children:a.jsx("span",{className:`
              inline-block h-4 w-4 transform rounded-full bg-white transition-transform
              ${d?"translate-x-6":"translate-x-1"}
            `})})]})})},ng=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-4",children:[a.jsx(et,{cardId:"basicInfo",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Informações Básicas"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-sm font-semibold text-[#E9EDEF] mb-3 flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-[#00A884]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Informações Principais"]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-[#E9EDEF] mb-2",children:"Nome da Escola *"}),a.jsx("input",{type:"text",className:"w-full border border-[#2A3942] bg-[#111B21] rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#00A884] focus:border-[#00A884] text-[#E9EDEF] placeholder-[#8696A0] transition-all duration-200",value:r.Escola||"",onChange:t=>e({...r,Escola:t.target.value}),placeholder:"Digite o nome da escola"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#E9EDEF] mb-2",children:"Município"}),a.jsx("input",{type:"text",className:"w-full border border-[#2A3942] bg-[#111B21] rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#00A884] focus:border-[#00A884] text-[#E9EDEF] placeholder-[#8696A0] transition-all duration-200",value:r.Município||"",onChange:t=>e({...r,Município:t.target.value}),placeholder:"Digite o município"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#E9EDEF] mb-2",children:"Ano de Criação da Escola"}),a.jsx("input",{type:"text",className:"w-full border border-[#2A3942] bg-[#111B21] rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#00A884] focus:border-[#00A884] text-[#E9EDEF] placeholder-[#8696A0] transition-all duration-200",value:r["Ano de criação da escola"]||"",onChange:t=>e({...r,"Ano de criação da escola":t.target.value}),placeholder:"Ex: 1995"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#E9EDEF] mb-2",children:"Terra Indígena (TI)"}),a.jsx("input",{type:"text",className:"w-full border border-[#2A3942] bg-[#111B21] rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-[#00A884] focus:border-[#00A884] text-[#E9EDEF] placeholder-[#8696A0] transition-all duration-200",value:r["Terra Indigena (TI)"]||"",onChange:t=>e({...r,"Terra Indigena (TI)":t.target.value}),placeholder:"Digite o nome da Terra Indígena"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"Diretoria de Ensino"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 placeholder-gray-400 transition-all duration-200 backdrop-blur-sm",value:r["Diretoria de Ensino"]||"",onChange:t=>e({...r,"Diretoria de Ensino":t.target.value}),placeholder:"Digite a diretoria de ensino"})]}),a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"Parcerias com o Município"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 h-32 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 placeholder-gray-400 transition-all duration-200 backdrop-blur-sm resize-none",value:r["Parcerias com o município"]||"",onChange:t=>e({...r,"Parcerias com o município":t.target.value}),placeholder:"Descreva as parcerias com o município..."})]})]})]}),a.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-6 border border-gray-700/30",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-100 mb-6 flex items-center gap-2",children:[a.jsxs("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Endereço Completo"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"Logradouro"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 placeholder-gray-400 transition-all duration-200 backdrop-blur-sm",value:r.logradouro||"",onChange:t=>e({...r,logradouro:t.target.value}),placeholder:"Rua, Avenida, número, etc."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"Bairro"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 placeholder-gray-400 transition-all duration-200 backdrop-blur-sm",value:r.bairro||"",onChange:t=>e({...r,bairro:t.target.value}),placeholder:"Nome do bairro"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"CEP"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 placeholder-gray-400 transition-all duration-200 backdrop-blur-sm",value:r.cep||"",onChange:t=>e({...r,cep:t.target.value}),placeholder:"00000-000"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"Estado"}),a.jsxs("select",{className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 transition-all duration-200 backdrop-blur-sm",value:r.estado||"SP",onChange:t=>e({...r,estado:t.target.value}),children:[a.jsx("option",{value:"SP",children:"São Paulo"}),a.jsx("option",{value:"RJ",children:"Rio de Janeiro"}),a.jsx("option",{value:"MG",children:"Minas Gerais"}),a.jsx("option",{value:"ES",children:"Espírito Santo"})]})]})]})]}),a.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-6 border border-gray-700/30",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-100 mb-6 flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Endereço (Campo Legado)"]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-3",children:"Endereço Completo"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800/50 rounded-xl px-4 py-3 h-24 focus:ring-2 focus:ring-green-400 focus:border-green-400 text-gray-100 placeholder-gray-400 transition-all duration-200 backdrop-blur-sm resize-none",value:r.Endereço||"",onChange:t=>e({...r,Endereço:t.target.value}),placeholder:"Endereço completo da escola..."}),a.jsx("p",{className:"text-gray-500 text-xs mt-2",children:"Este campo é mantido para compatibilidade com dados existentes"})]})]})]}),og=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Povos Indígenas"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Povos indigenas"]||"",onChange:t=>e({...r,"Povos indigenas":t.target.value}),placeholder:"Descreva os povos indígenas atendidos pela escola..."}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Ex: Guarani, Kaingang, Terena, etc."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Línguas Faladas"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Linguas faladas"]||"",onChange:t=>e({...r,"Linguas faladas":t.target.value}),placeholder:"Descreva as línguas faladas na comunidade escolar..."}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Ex: Português, Guarani, Kaingang, etc."})]})]}),ig=({editingLocation:r,setEditingLocation:e})=>{const{selectedModalidades:t,outroModalidade:s,handleModalidadeChange:n,handleOutroModalidadeChange:o,saveModalidades:i,getModalidadesPreview:l,hasSelectedModalidades:d}=Kd(),h=()=>{const f=i();e(m=>({...m,"Modalidade de Ensino/turnos de funcionamento":f}))};return a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"modalidades",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Modalidades de Ensino"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Modalidades de Ensino (Edição Direta)"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base resize-y",rows:6,value:r["Modalidade de Ensino/turnos de funcionamento"]||"",onChange:f=>e({...r,"Modalidade de Ensino/turnos de funcionamento":f.target.value}),placeholder:"Digite ou edite o texto completo das modalidades de ensino..."}),a.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Você pode editar o texto completo diretamente aqui. Use Enter para quebras de linha."})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-4 text-base",children:"Modalidades de Ensino"}),a.jsxs("div",{className:"space-y-4",children:[Vf.map(f=>a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-green-400 mb-2 border-b border-gray-600 pb-1",children:f.titulo}),a.jsx("div",{className:"space-y-2 ml-2",children:f.indices.map(m=>{const u=Gd[m];return a.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer hover:bg-gray-700 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 text-green-600 bg-gray-700 border-gray-600 rounded focus:ring-green-500 focus:ring-2",checked:t.includes(u),onChange:()=>n(u)}),a.jsx("span",{className:"text-sm text-gray-200 leading-relaxed",children:u})]},m)})})]},f.id)),a.jsx("div",{className:"border-t border-gray-600 pt-3 mt-3",children:a.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer hover:bg-gray-700 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 text-green-600 bg-gray-700 border-gray-600 rounded focus:ring-green-500 focus:ring-2",checked:t.some(f=>f.startsWith("Outro:"))||s.trim()!=="",onChange:f=>{f.target.checked&&!s.trim()?o("Modalidade específica"):f.target.checked||o("")}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-sm text-gray-200",children:"Outro (especificar):"}),a.jsx("input",{type:"text",className:"mt-1 w-full px-3 py-2 border border-gray-600 rounded text-sm bg-gray-700 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Digite a modalidade específica...",value:s,onChange:f=>o(f.target.value)})]})]})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Número de Alunos"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 min-h-[44px] text-base",value:r["Numero de alunos"]||"",onChange:f=>e({...r,"Numero de alunos":f.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Turnos de Funcionamento"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 min-h-[44px] text-base",value:r.turnos_funcionamento||"",onChange:f=>e({...r,turnos_funcionamento:f.target.value}),placeholder:"Ex: Diurno, Noturno, Vespertino, etc."})]}),a.jsx("div",{className:"md:col-span-2",children:a.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors",children:"Salvar Modalidades Selecionadas"})}),d()&&a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Preview do Texto Final"}),a.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded px-3 py-2 text-gray-200 text-sm min-h-[60px]",children:l()})]})]})},lg=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"infraestrutura",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Infraestrutura"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Acesso à Água"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Acesso à água"]||"",onChange:t=>e({...r,"Acesso à água":t.target.value}),placeholder:"Descreva como é o acesso à água na escola..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Coleta de Lixo"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Tem coleta de lixo?"]||"",onChange:t=>e({...r,"Tem coleta de lixo?":t.target.value}),placeholder:"Descreva como é feita a coleta de lixo..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Acesso à Internet"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Acesso à internet"]||"",onChange:t=>e({...r,"Acesso à internet":t.target.value}),placeholder:"Descreva o acesso à internet na escola..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Equipamentos Tecnológicos"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Equipamentos Tecs"]||"",onChange:t=>e({...r,"Equipamentos Tecs":t.target.value}),placeholder:"Descreva os equipamentos tecnológicos disponíveis..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Modo de Acesso à Escola"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Modo de acesso à escola"]||"",onChange:t=>e({...r,"Modo de acesso à escola":t.target.value}),placeholder:"Descreva como é o acesso à escola..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Merenda Diferenciada"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r.diferenciada||"",onChange:t=>e({...r,diferenciada:t.target.value}),placeholder:"Descreva se há merenda diferenciada (cultural, religiosa, etc.)..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Merenda Diferenciada (Detalhes)"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r.merenda_diferenciada||"",onChange:t=>e({...r,merenda_diferenciada:t.target.value}),placeholder:"Descreva detalhes sobre a merenda diferenciada..."})]})]}),cg=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"gestaoProfessores",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Equipe"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Gestão/Nome"}),a.jsx("input",{type:"text",className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 min-h-[44px] text-base",value:r["Gestão/Nome"]||"",onChange:t=>e({...r,"Gestão/Nome":t.target.value}),placeholder:"Digite o nome do gestor/diretor"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Professores Indígenas"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Quantidade de professores indígenas"]||"",onChange:t=>e({...r,"Quantidade de professores indígenas":t.target.value}),placeholder:"Descreva os professores indígenas..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Professores Não Indígenas"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Quantidade de professores não indígenas"]||"",onChange:t=>e({...r,"Quantidade de professores não indígenas":t.target.value}),placeholder:"Descreva os professores não indígenas..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Professores Falam Língua Indígena?"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Professores falam a língua indígena?"]||"",onChange:t=>e({...r,"Professores falam a língua indígena?":t.target.value}),placeholder:"Descreva se os professores falam a língua indígena..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Formação dos Professores"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Formação dos professores"]||"",onChange:t=>e({...r,"Formação dos professores":t.target.value}),placeholder:"Descreva a formação dos professores..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Formação Continuada"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Formação continuada oferecida"]||"",onChange:t=>e({...r,"Formação continuada oferecida":t.target.value}),placeholder:"Descreva a formação continuada oferecida aos professores..."})]})]}),dg=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"gestaoProfessores",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Equipe"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Outros Funcionários"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base resize-y",rows:6,value:r["Outros funcionários"]||"",onChange:t=>e({...r,"Outros funcionários":t.target.value}),placeholder:"Descreva os outros funcionários da escola (ex: secretários, auxiliares, merendeiras, etc.)..."}),a.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Você pode editar o texto completo diretamente aqui. Use Enter para quebras de linha."})]})]}),ug=({editingLocation:r,setEditingLocation:e})=>a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"PPP elaborado com a comunidade?"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["PPP elaborado com a comunidade?"]||"",onChange:t=>e({...r,"PPP elaborado com a comunidade?":t.target.value}),placeholder:"Descreva se o PPP foi elaborado com a comunidade..."})]})}),hg=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"projetosParcerias",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Projetos e Parcerias"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Projetos em Andamento"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Projetos em andamento"]||"",onChange:t=>e({...r,"Projetos em andamento":t.target.value}),placeholder:"Descreva os projetos em andamento na escola..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Parcerias com Universidades"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Parcerias com universidades?"]||"",onChange:t=>e({...r,"Parcerias com universidades?":t.target.value}),placeholder:"Descreva as parcerias com universidades..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Ações com ONGs ou Coletivos"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Ações com ONGs ou coletivos?"]||"",onChange:t=>e({...r,"Ações com ONGs ou coletivos?":t.target.value}),placeholder:"Descreva as ações com ONGs ou coletivos..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Desejos da Comunidade"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Desejos da comunidade para a escola"]||"",onChange:t=>e({...r,"Desejos da comunidade para a escola":t.target.value}),placeholder:"Descreva os desejos da comunidade para a escola..."})]})]}),fg=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Escola utiliza redes sociais?"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-24 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Escola utiliza redes sociais?"]||"",onChange:t=>e({...r,"Escola utiliza redes sociais?":t.target.value}),placeholder:"Descreva se a escola utiliza redes sociais..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Links das Redes Sociais"}),a.jsx("textarea",{className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 h-32 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r["Links das redes sociais"]||"",onChange:t=>e({...r,"Links das redes sociais":t.target.value}),placeholder:"Cole aqui os links das redes sociais da escola (Facebook, Instagram, YouTube, etc.)..."})]})]}),gg=({escolaId:r})=>{const[e,t]=w.useState([]),[s,n]=w.useState(!0),[o,i]=w.useState(null),[l,d]=w.useState(""),[h,f]=w.useState(!1),[m,u]=w.useState(null),[g,y]=w.useState({titulo:"",video_url:"",descricao:"",plataforma:"youtube",categoria:"geral",ativo:!0}),x=w.useCallback(async()=>{try{n(!0),i(null);const _=await Qh(r);t(_)}catch(_){i(_.message)}finally{n(!1)}},[r]);w.useEffect(()=>{r&&x()},[r,x]);const A=()=>{y({titulo:"",video_url:"",descricao:"",plataforma:"youtube",categoria:"geral",ativo:!0}),u(null),f(!1)},C=async _=>{if(_.preventDefault(),!g.titulo.trim()||!g.video_url.trim()){i("Título e URL do vídeo são obrigatórios.");return}const q={escola_id:Number(r),...g,ativo:!!g.ativo};try{i(""),d(""),m?(await ef(m.id,q),d("Vídeo atualizado com sucesso!")):(await tf(q),d("Vídeo criado com sucesso!")),A(),x()}catch(D){i(D.message)}},v=_=>{u(_),y({titulo:_.titulo||"",video_url:_.video_url||"",descricao:_.descricao||"",plataforma:_.plataforma||"youtube",categoria:_.categoria||"geral",ativo:_.ativo}),f(!0)},k=async _=>{if(window.confirm("Tem certeza que deseja excluir este vídeo?"))try{await Jh(_),d("Vídeo excluído com sucesso!"),x()}catch(q){i(q.message)}};return s?a.jsx("div",{className:"p-6 text-center",children:"Carregando vídeos..."}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Vídeos da Escola"}),a.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[a.jsx($f,{className:"w-5 h-5"}),"Novo Vídeo"]})]}),o&&a.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:o}),l&&a.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-green-600",children:l}),a.jsx("div",{className:"space-y-4",children:e.length===0?a.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[a.jsx("p",{className:"text-gray-500",children:"Nenhum vídeo cadastrado."}),a.jsx("button",{onClick:()=>f(!0),className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Adicionar vídeo"})]}):e.map(_=>a.jsx("div",{className:`p-6 bg-white rounded-lg border ${_.ativo?"":"opacity-60"}`,children:a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:_.titulo}),!_.ativo&&a.jsx("span",{className:"flex items-center gap-1 text-orange-600 text-sm",children:"Inativo"})]}),a.jsx("p",{className:"text-gray-700 text-sm mb-2",children:_.descricao}),a.jsx("div",{className:"mb-2",children:a.jsx("iframe",{src:_.video_url,title:_.titulo,className:"w-full aspect-video rounded-lg border",allowFullScreen:!0})}),a.jsxs("div",{className:"text-xs text-gray-500",children:["Plataforma: ",_.plataforma," | Categoria: ",_.categoria]})]}),a.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[a.jsx("button",{onClick:()=>v(_),className:"p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg",title:"Editar",children:a.jsx(Rf,{className:"w-5 h-5"})}),a.jsx("button",{onClick:()=>k(_.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg",title:"Excluir",children:a.jsx(Ws,{className:"w-5 h-5"})})]})]})},_.id))}),h&&a.jsxs("div",{className:"p-6 bg-gray-50 rounded-lg border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"text-lg font-medium text-gray-900",children:m?"Editar Vídeo":"Novo Vídeo"}),a.jsxs("button",{onClick:A,className:"text-gray-400 hover:text-gray-600",children:[a.jsx("span",{className:"sr-only",children:"Fechar"}),"×"]})]}),a.jsxs("form",{onSubmit:C,className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),a.jsx("input",{type:"text",value:g.titulo,onChange:_=>y({...g,titulo:_.target.value}),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Título do vídeo",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL do Vídeo *"}),a.jsx("input",{type:"url",value:g.video_url,onChange:_=>y({...g,video_url:_.target.value}),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"https://www.youtube.com/embed/...",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),a.jsx("textarea",{value:g.descricao,onChange:_=>y({...g,descricao:_.target.value}),rows:3,className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Descrição do vídeo (opcional)"})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plataforma"}),a.jsx("input",{type:"text",value:g.plataforma,onChange:_=>y({...g,plataforma:_.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"youtube, vimeo..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),a.jsx("input",{type:"text",value:g.categoria,onChange:_=>y({...g,categoria:_.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"geral, institucional..."})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-6",children:[a.jsx("input",{type:"checkbox",checked:g.ativo,onChange:_=>y({...g,ativo:_.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Ativo"})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[a.jsx(Zs,{className:"w-5 h-5"}),m?"Atualizar":"Criar"]}),a.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})]})]})},mg=({editingLocation:r,setEditingLocation:e})=>{const t=r?.id||r?.escola_id;return a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"videos",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Vídeos"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-100",children:"Gerenciamento de Vídeos"}),a.jsx("p",{className:"text-gray-300 text-xs",children:"Aqui você pode adicionar, editar e gerenciar vídeos relacionados à escola. Os vídeos podem ser do YouTube, Vimeo ou outras plataformas."})]}),t?a.jsx(gg,{escolaId:t}):a.jsx("div",{className:"text-center py-4",children:a.jsx("p",{className:"text-gray-300 text-sm",children:"Selecione uma escola para gerenciar os vídeos."})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-100",children:"Como Adicionar Vídeos"}),a.jsxs("div",{className:"space-y-3 text-sm text-gray-300",children:[a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"YouTube:"}),a.jsx("p",{children:"Use o formato: https://www.youtube.com/embed/VIDEO_ID"}),a.jsx("p",{className:"text-xs text-gray-400",children:"Exemplo: https://www.youtube.com/embed/dQw4w9WgXcQ"})]}),a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"Vimeo:"}),a.jsx("p",{children:"Use o formato: https://player.vimeo.com/video/VIDEO_ID"}),a.jsx("p",{className:"text-xs text-gray-400",children:"Exemplo: https://player.vimeo.com/video/123456789"})]}),a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"Outras plataformas:"}),a.jsx("p",{children:"Use o URL de embed fornecido pela plataforma"})]})]})]})]})};var Qa,Ji;function pg(){if(Ji)return Qa;Ji=1;function r(){this.__data__=[],this.size=0}return Qa=r,Qa}var Ja,el;function Yd(){if(el)return Ja;el=1;function r(e,t){return e===t||e!==e&&t!==t}return Ja=r,Ja}var en,tl;function Ys(){if(tl)return en;tl=1;var r=Yd();function e(t,s){for(var n=t.length;n--;)if(r(t[n][0],s))return n;return-1}return en=e,en}var tn,rl;function bg(){if(rl)return tn;rl=1;var r=Ys(),e=Array.prototype,t=e.splice;function s(n){var o=this.__data__,i=r(o,n);if(i<0)return!1;var l=o.length-1;return i==l?o.pop():t.call(o,i,1),--this.size,!0}return tn=s,tn}var rn,sl;function xg(){if(sl)return rn;sl=1;var r=Ys();function e(t){var s=this.__data__,n=r(s,t);return n<0?void 0:s[n][1]}return rn=e,rn}var sn,al;function yg(){if(al)return sn;al=1;var r=Ys();function e(t){return r(this.__data__,t)>-1}return sn=e,sn}var an,nl;function vg(){if(nl)return an;nl=1;var r=Ys();function e(t,s){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,s])):n[o][1]=s,this}return an=e,an}var nn,ol;function Qs(){if(ol)return nn;ol=1;var r=pg(),e=bg(),t=xg(),s=yg(),n=vg();function o(i){var l=-1,d=i==null?0:i.length;for(this.clear();++l<d;){var h=i[l];this.set(h[0],h[1])}}return o.prototype.clear=r,o.prototype.delete=e,o.prototype.get=t,o.prototype.has=s,o.prototype.set=n,nn=o,nn}var on,il;function wg(){if(il)return on;il=1;var r=Qs();function e(){this.__data__=new r,this.size=0}return on=e,on}var ln,ll;function Ng(){if(ll)return ln;ll=1;function r(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}return ln=r,ln}var cn,cl;function jg(){if(cl)return cn;cl=1;function r(e){return this.__data__.get(e)}return cn=r,cn}var dn,dl;function Eg(){if(dl)return dn;dl=1;function r(e){return this.__data__.has(e)}return dn=r,dn}var un,ul;function Qd(){if(ul)return un;ul=1;var r=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;return un=r,un}var hn,hl;function wt(){if(hl)return hn;hl=1;var r=Qd(),e=typeof self=="object"&&self&&self.Object===Object&&self,t=r||e||Function("return this")();return hn=t,hn}var fn,fl;function bi(){if(fl)return fn;fl=1;var r=wt(),e=r.Symbol;return fn=e,fn}var gn,gl;function _g(){if(gl)return gn;gl=1;var r=bi(),e=Object.prototype,t=e.hasOwnProperty,s=e.toString,n=r?r.toStringTag:void 0;function o(i){var l=t.call(i,n),d=i[n];try{i[n]=void 0;var h=!0}catch{}var f=s.call(i);return h&&(l?i[n]=d:delete i[n]),f}return gn=o,gn}var mn,ml;function Ag(){if(ml)return mn;ml=1;var r=Object.prototype,e=r.toString;function t(s){return e.call(s)}return mn=t,mn}var pn,pl;function Js(){if(pl)return pn;pl=1;var r=bi(),e=_g(),t=Ag(),s="[object Null]",n="[object Undefined]",o=r?r.toStringTag:void 0;function i(l){return l==null?l===void 0?n:s:o&&o in Object(l)?e(l):t(l)}return pn=i,pn}var bn,bl;function Jd(){if(bl)return bn;bl=1;function r(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}return bn=r,bn}var xn,xl;function eu(){if(xl)return xn;xl=1;var r=Js(),e=Jd(),t="[object AsyncFunction]",s="[object Function]",n="[object GeneratorFunction]",o="[object Proxy]";function i(l){if(!e(l))return!1;var d=r(l);return d==s||d==n||d==t||d==o}return xn=i,xn}var yn,yl;function Cg(){if(yl)return yn;yl=1;var r=wt(),e=r["__core-js_shared__"];return yn=e,yn}var vn,vl;function Tg(){if(vl)return vn;vl=1;var r=Cg(),e=(function(){var s=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""})();function t(s){return!!e&&e in s}return vn=t,vn}var wn,wl;function tu(){if(wl)return wn;wl=1;var r=Function.prototype,e=r.toString;function t(s){if(s!=null){try{return e.call(s)}catch{}try{return s+""}catch{}}return""}return wn=t,wn}var Nn,Nl;function Sg(){if(Nl)return Nn;Nl=1;var r=eu(),e=Tg(),t=Jd(),s=tu(),n=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,i=Function.prototype,l=Object.prototype,d=i.toString,h=l.hasOwnProperty,f=RegExp("^"+d.call(h).replace(n,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function m(u){if(!t(u)||e(u))return!1;var g=r(u)?f:o;return g.test(s(u))}return Nn=m,Nn}var jn,jl;function kg(){if(jl)return jn;jl=1;function r(e,t){return e?.[t]}return jn=r,jn}var En,El;function Nr(){if(El)return En;El=1;var r=Sg(),e=kg();function t(s,n){var o=e(s,n);return r(o)?o:void 0}return En=t,En}var _n,_l;function xi(){if(_l)return _n;_l=1;var r=Nr(),e=wt(),t=r(e,"Map");return _n=t,_n}var An,Al;function ea(){if(Al)return An;Al=1;var r=Nr(),e=r(Object,"create");return An=e,An}var Cn,Cl;function qg(){if(Cl)return Cn;Cl=1;var r=ea();function e(){this.__data__=r?r(null):{},this.size=0}return Cn=e,Cn}var Tn,Tl;function Ig(){if(Tl)return Tn;Tl=1;function r(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}return Tn=r,Tn}var Sn,Sl;function Lg(){if(Sl)return Sn;Sl=1;var r=ea(),e="__lodash_hash_undefined__",t=Object.prototype,s=t.hasOwnProperty;function n(o){var i=this.__data__;if(r){var l=i[o];return l===e?void 0:l}return s.call(i,o)?i[o]:void 0}return Sn=n,Sn}var kn,kl;function Og(){if(kl)return kn;kl=1;var r=ea(),e=Object.prototype,t=e.hasOwnProperty;function s(n){var o=this.__data__;return r?o[n]!==void 0:t.call(o,n)}return kn=s,kn}var qn,ql;function Rg(){if(ql)return qn;ql=1;var r=ea(),e="__lodash_hash_undefined__";function t(s,n){var o=this.__data__;return this.size+=this.has(s)?0:1,o[s]=r&&n===void 0?e:n,this}return qn=t,qn}var In,Il;function Mg(){if(Il)return In;Il=1;var r=qg(),e=Ig(),t=Lg(),s=Og(),n=Rg();function o(i){var l=-1,d=i==null?0:i.length;for(this.clear();++l<d;){var h=i[l];this.set(h[0],h[1])}}return o.prototype.clear=r,o.prototype.delete=e,o.prototype.get=t,o.prototype.has=s,o.prototype.set=n,In=o,In}var Ln,Ll;function Pg(){if(Ll)return Ln;Ll=1;var r=Mg(),e=Qs(),t=xi();function s(){this.size=0,this.__data__={hash:new r,map:new(t||e),string:new r}}return Ln=s,Ln}var On,Ol;function Dg(){if(Ol)return On;Ol=1;function r(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}return On=r,On}var Rn,Rl;function ta(){if(Rl)return Rn;Rl=1;var r=Dg();function e(t,s){var n=t.__data__;return r(s)?n[typeof s=="string"?"string":"hash"]:n.map}return Rn=e,Rn}var Mn,Ml;function $g(){if(Ml)return Mn;Ml=1;var r=ta();function e(t){var s=r(this,t).delete(t);return this.size-=s?1:0,s}return Mn=e,Mn}var Pn,Pl;function Fg(){if(Pl)return Pn;Pl=1;var r=ta();function e(t){return r(this,t).get(t)}return Pn=e,Pn}var Dn,Dl;function Ug(){if(Dl)return Dn;Dl=1;var r=ta();function e(t){return r(this,t).has(t)}return Dn=e,Dn}var $n,$l;function Bg(){if($l)return $n;$l=1;var r=ta();function e(t,s){var n=r(this,t),o=n.size;return n.set(t,s),this.size+=n.size==o?0:1,this}return $n=e,$n}var Fn,Fl;function ru(){if(Fl)return Fn;Fl=1;var r=Pg(),e=$g(),t=Fg(),s=Ug(),n=Bg();function o(i){var l=-1,d=i==null?0:i.length;for(this.clear();++l<d;){var h=i[l];this.set(h[0],h[1])}}return o.prototype.clear=r,o.prototype.delete=e,o.prototype.get=t,o.prototype.has=s,o.prototype.set=n,Fn=o,Fn}var Un,Ul;function zg(){if(Ul)return Un;Ul=1;var r=Qs(),e=xi(),t=ru(),s=200;function n(o,i){var l=this.__data__;if(l instanceof r){var d=l.__data__;if(!e||d.length<s-1)return d.push([o,i]),this.size=++l.size,this;l=this.__data__=new t(d)}return l.set(o,i),this.size=l.size,this}return Un=n,Un}var Bn,Bl;function Hg(){if(Bl)return Bn;Bl=1;var r=Qs(),e=wg(),t=Ng(),s=jg(),n=Eg(),o=zg();function i(l){var d=this.__data__=new r(l);this.size=d.size}return i.prototype.clear=e,i.prototype.delete=t,i.prototype.get=s,i.prototype.has=n,i.prototype.set=o,Bn=i,Bn}var zn,zl;function Vg(){if(zl)return zn;zl=1;var r="__lodash_hash_undefined__";function e(t){return this.__data__.set(t,r),this}return zn=e,zn}var Hn,Hl;function Gg(){if(Hl)return Hn;Hl=1;function r(e){return this.__data__.has(e)}return Hn=r,Hn}var Vn,Vl;function Kg(){if(Vl)return Vn;Vl=1;var r=ru(),e=Vg(),t=Gg();function s(n){var o=-1,i=n==null?0:n.length;for(this.__data__=new r;++o<i;)this.add(n[o])}return s.prototype.add=s.prototype.push=e,s.prototype.has=t,Vn=s,Vn}var Gn,Gl;function Wg(){if(Gl)return Gn;Gl=1;function r(e,t){for(var s=-1,n=e==null?0:e.length;++s<n;)if(t(e[s],s,e))return!0;return!1}return Gn=r,Gn}var Kn,Kl;function Zg(){if(Kl)return Kn;Kl=1;function r(e,t){return e.has(t)}return Kn=r,Kn}var Wn,Wl;function su(){if(Wl)return Wn;Wl=1;var r=Kg(),e=Wg(),t=Zg(),s=1,n=2;function o(i,l,d,h,f,m){var u=d&s,g=i.length,y=l.length;if(g!=y&&!(u&&y>g))return!1;var x=m.get(i),A=m.get(l);if(x&&A)return x==l&&A==i;var C=-1,v=!0,k=d&n?new r:void 0;for(m.set(i,l),m.set(l,i);++C<g;){var _=i[C],q=l[C];if(h)var D=u?h(q,_,C,l,i,m):h(_,q,C,i,l,m);if(D!==void 0){if(D)continue;v=!1;break}if(k){if(!e(l,function(F,T){if(!t(k,T)&&(_===F||f(_,F,d,h,m)))return k.push(T)})){v=!1;break}}else if(!(_===q||f(_,q,d,h,m))){v=!1;break}}return m.delete(i),m.delete(l),v}return Wn=o,Wn}var Zn,Zl;function Xg(){if(Zl)return Zn;Zl=1;var r=wt(),e=r.Uint8Array;return Zn=e,Zn}var Xn,Xl;function Yg(){if(Xl)return Xn;Xl=1;function r(e){var t=-1,s=Array(e.size);return e.forEach(function(n,o){s[++t]=[o,n]}),s}return Xn=r,Xn}var Yn,Yl;function Qg(){if(Yl)return Yn;Yl=1;function r(e){var t=-1,s=Array(e.size);return e.forEach(function(n){s[++t]=n}),s}return Yn=r,Yn}var Qn,Ql;function Jg(){if(Ql)return Qn;Ql=1;var r=bi(),e=Xg(),t=Yd(),s=su(),n=Yg(),o=Qg(),i=1,l=2,d="[object Boolean]",h="[object Date]",f="[object Error]",m="[object Map]",u="[object Number]",g="[object RegExp]",y="[object Set]",x="[object String]",A="[object Symbol]",C="[object ArrayBuffer]",v="[object DataView]",k=r?r.prototype:void 0,_=k?k.valueOf:void 0;function q(D,F,T,V,O,p,j){switch(T){case v:if(D.byteLength!=F.byteLength||D.byteOffset!=F.byteOffset)return!1;D=D.buffer,F=F.buffer;case C:return!(D.byteLength!=F.byteLength||!p(new e(D),new e(F)));case d:case h:case u:return t(+D,+F);case f:return D.name==F.name&&D.message==F.message;case g:case x:return D==F+"";case m:var N=n;case y:var S=V&i;if(N||(N=o),D.size!=F.size&&!S)return!1;var L=j.get(D);if(L)return L==F;V|=l,j.set(D,F);var I=s(N(D),N(F),V,O,p,j);return j.delete(D),I;case A:if(_)return _.call(D)==_.call(F)}return!1}return Qn=q,Qn}var Jn,Jl;function em(){if(Jl)return Jn;Jl=1;function r(e,t){for(var s=-1,n=t.length,o=e.length;++s<n;)e[o+s]=t[s];return e}return Jn=r,Jn}var eo,ec;function yi(){if(ec)return eo;ec=1;var r=Array.isArray;return eo=r,eo}var to,tc;function tm(){if(tc)return to;tc=1;var r=em(),e=yi();function t(s,n,o){var i=n(s);return e(s)?i:r(i,o(s))}return to=t,to}var ro,rc;function rm(){if(rc)return ro;rc=1;function r(e,t){for(var s=-1,n=e==null?0:e.length,o=0,i=[];++s<n;){var l=e[s];t(l,s,e)&&(i[o++]=l)}return i}return ro=r,ro}var so,sc;function sm(){if(sc)return so;sc=1;function r(){return[]}return so=r,so}var ao,ac;function am(){if(ac)return ao;ac=1;var r=rm(),e=sm(),t=Object.prototype,s=t.propertyIsEnumerable,n=Object.getOwnPropertySymbols,o=n?function(i){return i==null?[]:(i=Object(i),r(n(i),function(l){return s.call(i,l)}))}:e;return ao=o,ao}var no,nc;function nm(){if(nc)return no;nc=1;function r(e,t){for(var s=-1,n=Array(e);++s<e;)n[s]=t(s);return n}return no=r,no}var oo,oc;function ra(){if(oc)return oo;oc=1;function r(e){return e!=null&&typeof e=="object"}return oo=r,oo}var io,ic;function om(){if(ic)return io;ic=1;var r=Js(),e=ra(),t="[object Arguments]";function s(n){return e(n)&&r(n)==t}return io=s,io}var lo,lc;function im(){if(lc)return lo;lc=1;var r=om(),e=ra(),t=Object.prototype,s=t.hasOwnProperty,n=t.propertyIsEnumerable,o=r((function(){return arguments})())?r:function(i){return e(i)&&s.call(i,"callee")&&!n.call(i,"callee")};return lo=o,lo}var Br={exports:{}},co,cc;function lm(){if(cc)return co;cc=1;function r(){return!1}return co=r,co}Br.exports;var dc;function au(){return dc||(dc=1,(function(r,e){var t=wt(),s=lm(),n=e&&!e.nodeType&&e,o=n&&!0&&r&&!r.nodeType&&r,i=o&&o.exports===n,l=i?t.Buffer:void 0,d=l?l.isBuffer:void 0,h=d||s;r.exports=h})(Br,Br.exports)),Br.exports}var uo,uc;function cm(){if(uc)return uo;uc=1;var r=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function t(s,n){var o=typeof s;return n=n??r,!!n&&(o=="number"||o!="symbol"&&e.test(s))&&s>-1&&s%1==0&&s<n}return uo=t,uo}var ho,hc;function nu(){if(hc)return ho;hc=1;var r=9007199254740991;function e(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=r}return ho=e,ho}var fo,fc;function dm(){if(fc)return fo;fc=1;var r=Js(),e=nu(),t=ra(),s="[object Arguments]",n="[object Array]",o="[object Boolean]",i="[object Date]",l="[object Error]",d="[object Function]",h="[object Map]",f="[object Number]",m="[object Object]",u="[object RegExp]",g="[object Set]",y="[object String]",x="[object WeakMap]",A="[object ArrayBuffer]",C="[object DataView]",v="[object Float32Array]",k="[object Float64Array]",_="[object Int8Array]",q="[object Int16Array]",D="[object Int32Array]",F="[object Uint8Array]",T="[object Uint8ClampedArray]",V="[object Uint16Array]",O="[object Uint32Array]",p={};p[v]=p[k]=p[_]=p[q]=p[D]=p[F]=p[T]=p[V]=p[O]=!0,p[s]=p[n]=p[A]=p[o]=p[C]=p[i]=p[l]=p[d]=p[h]=p[f]=p[m]=p[u]=p[g]=p[y]=p[x]=!1;function j(N){return t(N)&&e(N.length)&&!!p[r(N)]}return fo=j,fo}var go,gc;function um(){if(gc)return go;gc=1;function r(e){return function(t){return e(t)}}return go=r,go}var zr={exports:{}};zr.exports;var mc;function hm(){return mc||(mc=1,(function(r,e){var t=Qd(),s=e&&!e.nodeType&&e,n=s&&!0&&r&&!r.nodeType&&r,o=n&&n.exports===s,i=o&&t.process,l=(function(){try{var d=n&&n.require&&n.require("util").types;return d||i&&i.binding&&i.binding("util")}catch{}})();r.exports=l})(zr,zr.exports)),zr.exports}var mo,pc;function ou(){if(pc)return mo;pc=1;var r=dm(),e=um(),t=hm(),s=t&&t.isTypedArray,n=s?e(s):r;return mo=n,mo}var po,bc;function fm(){if(bc)return po;bc=1;var r=nm(),e=im(),t=yi(),s=au(),n=cm(),o=ou(),i=Object.prototype,l=i.hasOwnProperty;function d(h,f){var m=t(h),u=!m&&e(h),g=!m&&!u&&s(h),y=!m&&!u&&!g&&o(h),x=m||u||g||y,A=x?r(h.length,String):[],C=A.length;for(var v in h)(f||l.call(h,v))&&!(x&&(v=="length"||g&&(v=="offset"||v=="parent")||y&&(v=="buffer"||v=="byteLength"||v=="byteOffset")||n(v,C)))&&A.push(v);return A}return po=d,po}var bo,xc;function gm(){if(xc)return bo;xc=1;var r=Object.prototype;function e(t){var s=t&&t.constructor,n=typeof s=="function"&&s.prototype||r;return t===n}return bo=e,bo}var xo,yc;function mm(){if(yc)return xo;yc=1;function r(e,t){return function(s){return e(t(s))}}return xo=r,xo}var yo,vc;function pm(){if(vc)return yo;vc=1;var r=mm(),e=r(Object.keys,Object);return yo=e,yo}var vo,wc;function bm(){if(wc)return vo;wc=1;var r=gm(),e=pm(),t=Object.prototype,s=t.hasOwnProperty;function n(o){if(!r(o))return e(o);var i=[];for(var l in Object(o))s.call(o,l)&&l!="constructor"&&i.push(l);return i}return vo=n,vo}var wo,Nc;function xm(){if(Nc)return wo;Nc=1;var r=eu(),e=nu();function t(s){return s!=null&&e(s.length)&&!r(s)}return wo=t,wo}var No,jc;function ym(){if(jc)return No;jc=1;var r=fm(),e=bm(),t=xm();function s(n){return t(n)?r(n):e(n)}return No=s,No}var jo,Ec;function vm(){if(Ec)return jo;Ec=1;var r=tm(),e=am(),t=ym();function s(n){return r(n,t,e)}return jo=s,jo}var Eo,_c;function wm(){if(_c)return Eo;_c=1;var r=vm(),e=1,t=Object.prototype,s=t.hasOwnProperty;function n(o,i,l,d,h,f){var m=l&e,u=r(o),g=u.length,y=r(i),x=y.length;if(g!=x&&!m)return!1;for(var A=g;A--;){var C=u[A];if(!(m?C in i:s.call(i,C)))return!1}var v=f.get(o),k=f.get(i);if(v&&k)return v==i&&k==o;var _=!0;f.set(o,i),f.set(i,o);for(var q=m;++A<g;){C=u[A];var D=o[C],F=i[C];if(d)var T=m?d(F,D,C,i,o,f):d(D,F,C,o,i,f);if(!(T===void 0?D===F||h(D,F,l,d,f):T)){_=!1;break}q||(q=C=="constructor")}if(_&&!q){var V=o.constructor,O=i.constructor;V!=O&&"constructor"in o&&"constructor"in i&&!(typeof V=="function"&&V instanceof V&&typeof O=="function"&&O instanceof O)&&(_=!1)}return f.delete(o),f.delete(i),_}return Eo=n,Eo}var _o,Ac;function Nm(){if(Ac)return _o;Ac=1;var r=Nr(),e=wt(),t=r(e,"DataView");return _o=t,_o}var Ao,Cc;function jm(){if(Cc)return Ao;Cc=1;var r=Nr(),e=wt(),t=r(e,"Promise");return Ao=t,Ao}var Co,Tc;function Em(){if(Tc)return Co;Tc=1;var r=Nr(),e=wt(),t=r(e,"Set");return Co=t,Co}var To,Sc;function _m(){if(Sc)return To;Sc=1;var r=Nr(),e=wt(),t=r(e,"WeakMap");return To=t,To}var So,kc;function Am(){if(kc)return So;kc=1;var r=Nm(),e=xi(),t=jm(),s=Em(),n=_m(),o=Js(),i=tu(),l="[object Map]",d="[object Object]",h="[object Promise]",f="[object Set]",m="[object WeakMap]",u="[object DataView]",g=i(r),y=i(e),x=i(t),A=i(s),C=i(n),v=o;return(r&&v(new r(new ArrayBuffer(1)))!=u||e&&v(new e)!=l||t&&v(t.resolve())!=h||s&&v(new s)!=f||n&&v(new n)!=m)&&(v=function(k){var _=o(k),q=_==d?k.constructor:void 0,D=q?i(q):"";if(D)switch(D){case g:return u;case y:return l;case x:return h;case A:return f;case C:return m}return _}),So=v,So}var ko,qc;function Cm(){if(qc)return ko;qc=1;var r=Hg(),e=su(),t=Jg(),s=wm(),n=Am(),o=yi(),i=au(),l=ou(),d=1,h="[object Arguments]",f="[object Array]",m="[object Object]",u=Object.prototype,g=u.hasOwnProperty;function y(x,A,C,v,k,_){var q=o(x),D=o(A),F=q?f:n(x),T=D?f:n(A);F=F==h?m:F,T=T==h?m:T;var V=F==m,O=T==m,p=F==T;if(p&&i(x)){if(!i(A))return!1;q=!0,V=!1}if(p&&!V)return _||(_=new r),q||l(x)?e(x,A,C,v,k,_):t(x,A,F,C,v,k,_);if(!(C&d)){var j=V&&g.call(x,"__wrapped__"),N=O&&g.call(A,"__wrapped__");if(j||N){var S=j?x.value():x,L=N?A.value():A;return _||(_=new r),k(S,L,C,v,_)}}return p?(_||(_=new r),s(x,A,C,v,k,_)):!1}return ko=y,ko}var qo,Ic;function Tm(){if(Ic)return qo;Ic=1;var r=Cm(),e=ra();function t(s,n,o,i,l){return s===n?!0:s==null||n==null||!e(s)&&!e(n)?s!==s&&n!==n:r(s,n,o,i,t,l)}return qo=t,qo}var Io,Lc;function Sm(){if(Lc)return Io;Lc=1;var r=Tm();function e(t,s){return r(t,s)}return Io=e,Io}var iu=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,km=typeof self=="object"&&self&&self.Object===Object&&self,ht=iu||km||Function("return this")(),It=ht.Symbol,lu=Object.prototype,qm=lu.hasOwnProperty,Im=lu.toString,Fr=It?It.toStringTag:void 0;function Lm(r){var e=qm.call(r,Fr),t=r[Fr];try{r[Fr]=void 0;var s=!0}catch{}var n=Im.call(r);return s&&(e?r[Fr]=t:delete r[Fr]),n}var Om=Object.prototype,Rm=Om.toString;function Mm(r){return Rm.call(r)}var Pm="[object Null]",Dm="[object Undefined]",Oc=It?It.toStringTag:void 0;function jr(r){return r==null?r===void 0?Dm:Pm:Oc&&Oc in Object(r)?Lm(r):Mm(r)}function yt(r){return r!=null&&typeof r=="object"}var Vt=Array.isArray;function Ot(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function cu(r){return r}var $m="[object AsyncFunction]",Fm="[object Function]",Um="[object GeneratorFunction]",Bm="[object Proxy]";function vi(r){if(!Ot(r))return!1;var e=jr(r);return e==Fm||e==Um||e==$m||e==Bm}var Lo=ht["__core-js_shared__"],Rc=(function(){var r=/[^.]+$/.exec(Lo&&Lo.keys&&Lo.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""})();function zm(r){return!!Rc&&Rc in r}var Hm=Function.prototype,Vm=Hm.toString;function Wt(r){if(r!=null){try{return Vm.call(r)}catch{}try{return r+""}catch{}}return""}var Gm=/[\\^$.*+?()[\]{}|]/g,Km=/^\[object .+?Constructor\]$/,Wm=Function.prototype,Zm=Object.prototype,Xm=Wm.toString,Ym=Zm.hasOwnProperty,Qm=RegExp("^"+Xm.call(Ym).replace(Gm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Jm(r){if(!Ot(r)||zm(r))return!1;var e=vi(r)?Qm:Km;return e.test(Wt(r))}function e0(r,e){return r?.[e]}function Zt(r,e){var t=e0(r,e);return Jm(t)?t:void 0}var Zo=Zt(ht,"WeakMap"),Mc=Object.create,t0=(function(){function r(){}return function(e){if(!Ot(e))return{};if(Mc)return Mc(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}})();function r0(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function s0(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}var a0=800,n0=16,o0=Date.now;function i0(r){var e=0,t=0;return function(){var s=o0(),n=n0-(s-t);if(t=s,n>0){if(++e>=a0)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function l0(r){return function(){return r}}var Bs=(function(){try{var r=Zt(Object,"defineProperty");return r({},"",{}),r}catch{}})(),c0=Bs?function(r,e){return Bs(r,"toString",{configurable:!0,enumerable:!1,value:l0(e),writable:!0})}:cu,d0=i0(c0);function u0(r,e){for(var t=-1,s=r==null?0:r.length;++t<s&&e(r[t],t,r)!==!1;);return r}var h0=9007199254740991,f0=/^(?:0|[1-9]\d*)$/;function du(r,e){var t=typeof r;return e=e??h0,!!e&&(t=="number"||t!="symbol"&&f0.test(r))&&r>-1&&r%1==0&&r<e}function wi(r,e,t){e=="__proto__"&&Bs?Bs(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}function ss(r,e){return r===e||r!==r&&e!==e}var g0=Object.prototype,m0=g0.hasOwnProperty;function uu(r,e,t){var s=r[e];(!(m0.call(r,e)&&ss(s,t))||t===void 0&&!(e in r))&&wi(r,e,t)}function p0(r,e,t,s){var n=!t;t||(t={});for(var o=-1,i=e.length;++o<i;){var l=e[o],d=void 0;d===void 0&&(d=r[l]),n?wi(t,l,d):uu(t,l,d)}return t}var Pc=Math.max;function b0(r,e,t){return e=Pc(e===void 0?r.length-1:e,0),function(){for(var s=arguments,n=-1,o=Pc(s.length-e,0),i=Array(o);++n<o;)i[n]=s[e+n];n=-1;for(var l=Array(e+1);++n<e;)l[n]=s[n];return l[e]=t(i),r0(r,this,l)}}function x0(r,e){return d0(b0(r,e,cu),r+"")}var y0=9007199254740991;function hu(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=y0}function sa(r){return r!=null&&hu(r.length)&&!vi(r)}function v0(r,e,t){if(!Ot(t))return!1;var s=typeof e;return(s=="number"?sa(t)&&du(e,t.length):s=="string"&&e in t)?ss(t[e],r):!1}function w0(r){return x0(function(e,t){var s=-1,n=t.length,o=n>1?t[n-1]:void 0,i=n>2?t[2]:void 0;for(o=r.length>3&&typeof o=="function"?(n--,o):void 0,i&&v0(t[0],t[1],i)&&(o=n<3?void 0:o,n=1),e=Object(e);++s<n;){var l=t[s];l&&r(e,l,s,o)}return e})}var N0=Object.prototype;function Ni(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||N0;return r===t}function j0(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}var E0="[object Arguments]";function Dc(r){return yt(r)&&jr(r)==E0}var fu=Object.prototype,_0=fu.hasOwnProperty,A0=fu.propertyIsEnumerable,Xo=Dc((function(){return arguments})())?Dc:function(r){return yt(r)&&_0.call(r,"callee")&&!A0.call(r,"callee")};function C0(){return!1}var gu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$c=gu&&typeof module=="object"&&module&&!module.nodeType&&module,T0=$c&&$c.exports===gu,Fc=T0?ht.Buffer:void 0,S0=Fc?Fc.isBuffer:void 0,Yr=S0||C0,k0="[object Arguments]",q0="[object Array]",I0="[object Boolean]",L0="[object Date]",O0="[object Error]",R0="[object Function]",M0="[object Map]",P0="[object Number]",D0="[object Object]",$0="[object RegExp]",F0="[object Set]",U0="[object String]",B0="[object WeakMap]",z0="[object ArrayBuffer]",H0="[object DataView]",V0="[object Float32Array]",G0="[object Float64Array]",K0="[object Int8Array]",W0="[object Int16Array]",Z0="[object Int32Array]",X0="[object Uint8Array]",Y0="[object Uint8ClampedArray]",Q0="[object Uint16Array]",J0="[object Uint32Array]",pe={};pe[V0]=pe[G0]=pe[K0]=pe[W0]=pe[Z0]=pe[X0]=pe[Y0]=pe[Q0]=pe[J0]=!0;pe[k0]=pe[q0]=pe[z0]=pe[I0]=pe[H0]=pe[L0]=pe[O0]=pe[R0]=pe[M0]=pe[P0]=pe[D0]=pe[$0]=pe[F0]=pe[U0]=pe[B0]=!1;function ep(r){return yt(r)&&hu(r.length)&&!!pe[jr(r)]}function ji(r){return function(e){return r(e)}}var mu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Wr=mu&&typeof module=="object"&&module&&!module.nodeType&&module,tp=Wr&&Wr.exports===mu,Oo=tp&&iu.process,vr=(function(){try{var r=Wr&&Wr.require&&Wr.require("util").types;return r||Oo&&Oo.binding&&Oo.binding("util")}catch{}})(),Uc=vr&&vr.isTypedArray,Ei=Uc?ji(Uc):ep,rp=Object.prototype,sp=rp.hasOwnProperty;function pu(r,e){var t=Vt(r),s=!t&&Xo(r),n=!t&&!s&&Yr(r),o=!t&&!s&&!n&&Ei(r),i=t||s||n||o,l=i?j0(r.length,String):[],d=l.length;for(var h in r)(e||sp.call(r,h))&&!(i&&(h=="length"||n&&(h=="offset"||h=="parent")||o&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||du(h,d)))&&l.push(h);return l}function bu(r,e){return function(t){return r(e(t))}}var ap=bu(Object.keys,Object),np=Object.prototype,op=np.hasOwnProperty;function ip(r){if(!Ni(r))return ap(r);var e=[];for(var t in Object(r))op.call(r,t)&&t!="constructor"&&e.push(t);return e}function lp(r){return sa(r)?pu(r):ip(r)}function cp(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var dp=Object.prototype,up=dp.hasOwnProperty;function hp(r){if(!Ot(r))return cp(r);var e=Ni(r),t=[];for(var s in r)s=="constructor"&&(e||!up.call(r,s))||t.push(s);return t}function xu(r){return sa(r)?pu(r,!0):hp(r)}var Qr=Zt(Object,"create");function fp(){this.__data__=Qr?Qr(null):{},this.size=0}function gp(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var mp="__lodash_hash_undefined__",pp=Object.prototype,bp=pp.hasOwnProperty;function xp(r){var e=this.__data__;if(Qr){var t=e[r];return t===mp?void 0:t}return bp.call(e,r)?e[r]:void 0}var yp=Object.prototype,vp=yp.hasOwnProperty;function wp(r){var e=this.__data__;return Qr?e[r]!==void 0:vp.call(e,r)}var Np="__lodash_hash_undefined__";function jp(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Qr&&e===void 0?Np:e,this}function Gt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}Gt.prototype.clear=fp;Gt.prototype.delete=gp;Gt.prototype.get=xp;Gt.prototype.has=wp;Gt.prototype.set=jp;function Ep(){this.__data__=[],this.size=0}function aa(r,e){for(var t=r.length;t--;)if(ss(r[t][0],e))return t;return-1}var _p=Array.prototype,Ap=_p.splice;function Cp(r){var e=this.__data__,t=aa(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():Ap.call(e,t,1),--this.size,!0}function Tp(r){var e=this.__data__,t=aa(e,r);return t<0?void 0:e[t][1]}function Sp(r){return aa(this.__data__,r)>-1}function kp(r,e){var t=this.__data__,s=aa(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}function Nt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}Nt.prototype.clear=Ep;Nt.prototype.delete=Cp;Nt.prototype.get=Tp;Nt.prototype.has=Sp;Nt.prototype.set=kp;var Jr=Zt(ht,"Map");function qp(){this.size=0,this.__data__={hash:new Gt,map:new(Jr||Nt),string:new Gt}}function Ip(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function na(r,e){var t=r.__data__;return Ip(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Lp(r){var e=na(this,r).delete(r);return this.size-=e?1:0,e}function Op(r){return na(this,r).get(r)}function Rp(r){return na(this,r).has(r)}function Mp(r,e){var t=na(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}function Xt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}Xt.prototype.clear=qp;Xt.prototype.delete=Lp;Xt.prototype.get=Op;Xt.prototype.has=Rp;Xt.prototype.set=Mp;function Pp(r,e){for(var t=-1,s=e.length,n=r.length;++t<s;)r[n+t]=e[t];return r}var yu=bu(Object.getPrototypeOf,Object),Dp="[object Object]",$p=Function.prototype,Fp=Object.prototype,vu=$p.toString,Up=Fp.hasOwnProperty,Bp=vu.call(Object);function zp(r){if(!yt(r)||jr(r)!=Dp)return!1;var e=yu(r);if(e===null)return!0;var t=Up.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&vu.call(t)==Bp}function Hp(){this.__data__=new Nt,this.size=0}function Vp(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function Gp(r){return this.__data__.get(r)}function Kp(r){return this.__data__.has(r)}var Wp=200;function Zp(r,e){var t=this.__data__;if(t instanceof Nt){var s=t.__data__;if(!Jr||s.length<Wp-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new Xt(s)}return t.set(r,e),this.size=t.size,this}function dt(r){var e=this.__data__=new Nt(r);this.size=e.size}dt.prototype.clear=Hp;dt.prototype.delete=Vp;dt.prototype.get=Gp;dt.prototype.has=Kp;dt.prototype.set=Zp;var wu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Bc=wu&&typeof module=="object"&&module&&!module.nodeType&&module,Xp=Bc&&Bc.exports===wu,zc=Xp?ht.Buffer:void 0,Hc=zc?zc.allocUnsafe:void 0;function Nu(r,e){if(e)return r.slice();var t=r.length,s=Hc?Hc(t):new r.constructor(t);return r.copy(s),s}function Yp(r,e){for(var t=-1,s=r==null?0:r.length,n=0,o=[];++t<s;){var i=r[t];e(i,t,r)&&(o[n++]=i)}return o}function Qp(){return[]}var Jp=Object.prototype,eb=Jp.propertyIsEnumerable,Vc=Object.getOwnPropertySymbols,tb=Vc?function(r){return r==null?[]:(r=Object(r),Yp(Vc(r),function(e){return eb.call(r,e)}))}:Qp;function rb(r,e,t){var s=e(r);return Vt(r)?s:Pp(s,t(r))}function Yo(r){return rb(r,lp,tb)}var Qo=Zt(ht,"DataView"),Jo=Zt(ht,"Promise"),ei=Zt(ht,"Set"),Gc="[object Map]",sb="[object Object]",Kc="[object Promise]",Wc="[object Set]",Zc="[object WeakMap]",Xc="[object DataView]",ab=Wt(Qo),nb=Wt(Jr),ob=Wt(Jo),ib=Wt(ei),lb=Wt(Zo),Ze=jr;(Qo&&Ze(new Qo(new ArrayBuffer(1)))!=Xc||Jr&&Ze(new Jr)!=Gc||Jo&&Ze(Jo.resolve())!=Kc||ei&&Ze(new ei)!=Wc||Zo&&Ze(new Zo)!=Zc)&&(Ze=function(r){var e=jr(r),t=e==sb?r.constructor:void 0,s=t?Wt(t):"";if(s)switch(s){case ab:return Xc;case nb:return Gc;case ob:return Kc;case ib:return Wc;case lb:return Zc}return e});var cb=Object.prototype,db=cb.hasOwnProperty;function ub(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&db.call(r,"index")&&(t.index=r.index,t.input=r.input),t}var zs=ht.Uint8Array;function _i(r){var e=new r.constructor(r.byteLength);return new zs(e).set(new zs(r)),e}function hb(r,e){var t=_i(r.buffer);return new r.constructor(t,r.byteOffset,r.byteLength)}var fb=/\w*$/;function gb(r){var e=new r.constructor(r.source,fb.exec(r));return e.lastIndex=r.lastIndex,e}var Yc=It?It.prototype:void 0,Qc=Yc?Yc.valueOf:void 0;function mb(r){return Qc?Object(Qc.call(r)):{}}function ju(r,e){var t=e?_i(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var pb="[object Boolean]",bb="[object Date]",xb="[object Map]",yb="[object Number]",vb="[object RegExp]",wb="[object Set]",Nb="[object String]",jb="[object Symbol]",Eb="[object ArrayBuffer]",_b="[object DataView]",Ab="[object Float32Array]",Cb="[object Float64Array]",Tb="[object Int8Array]",Sb="[object Int16Array]",kb="[object Int32Array]",qb="[object Uint8Array]",Ib="[object Uint8ClampedArray]",Lb="[object Uint16Array]",Ob="[object Uint32Array]";function Rb(r,e,t){var s=r.constructor;switch(e){case Eb:return _i(r);case pb:case bb:return new s(+r);case _b:return hb(r);case Ab:case Cb:case Tb:case Sb:case kb:case qb:case Ib:case Lb:case Ob:return ju(r,t);case xb:return new s;case yb:case Nb:return new s(r);case vb:return gb(r);case wb:return new s;case jb:return mb(r)}}function Eu(r){return typeof r.constructor=="function"&&!Ni(r)?t0(yu(r)):{}}var Mb="[object Map]";function Pb(r){return yt(r)&&Ze(r)==Mb}var Jc=vr&&vr.isMap,Db=Jc?ji(Jc):Pb,$b="[object Set]";function Fb(r){return yt(r)&&Ze(r)==$b}var ed=vr&&vr.isSet,Ub=ed?ji(ed):Fb,Bb=1,_u="[object Arguments]",zb="[object Array]",Hb="[object Boolean]",Vb="[object Date]",Gb="[object Error]",Au="[object Function]",Kb="[object GeneratorFunction]",Wb="[object Map]",Zb="[object Number]",Cu="[object Object]",Xb="[object RegExp]",Yb="[object Set]",Qb="[object String]",Jb="[object Symbol]",ex="[object WeakMap]",tx="[object ArrayBuffer]",rx="[object DataView]",sx="[object Float32Array]",ax="[object Float64Array]",nx="[object Int8Array]",ox="[object Int16Array]",ix="[object Int32Array]",lx="[object Uint8Array]",cx="[object Uint8ClampedArray]",dx="[object Uint16Array]",ux="[object Uint32Array]",me={};me[_u]=me[zb]=me[tx]=me[rx]=me[Hb]=me[Vb]=me[sx]=me[ax]=me[nx]=me[ox]=me[ix]=me[Wb]=me[Zb]=me[Cu]=me[Xb]=me[Yb]=me[Qb]=me[Jb]=me[lx]=me[cx]=me[dx]=me[ux]=!0;me[Gb]=me[Au]=me[ex]=!1;function $s(r,e,t,s,n,o){var i,l=e&Bb;if(i!==void 0)return i;if(!Ot(r))return r;var d=Vt(r);if(d)i=ub(r);else{var h=Ze(r),f=h==Au||h==Kb;if(Yr(r))return Nu(r,l);if(h==Cu||h==_u||f&&!n)i=f?{}:Eu(r);else{if(!me[h])return n?r:{};i=Rb(r,h,l)}}o||(o=new dt);var m=o.get(r);if(m)return m;o.set(r,i),Ub(r)?r.forEach(function(y){i.add($s(y,e,t,y,r,o))}):Db(r)&&r.forEach(function(y,x){i.set(x,$s(y,e,t,x,r,o))});var u=Yo,g=d?void 0:u(r);return u0(g||r,function(y,x){g&&(x=y,y=r[x]),uu(i,x,$s(y,e,t,x,r,o))}),i}var hx=1,fx=4;function pr(r){return $s(r,hx|fx)}var gx="__lodash_hash_undefined__";function mx(r){return this.__data__.set(r,gx),this}function px(r){return this.__data__.has(r)}function Hs(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new Xt;++e<t;)this.add(r[e])}Hs.prototype.add=Hs.prototype.push=mx;Hs.prototype.has=px;function bx(r,e){for(var t=-1,s=r==null?0:r.length;++t<s;)if(e(r[t],t,r))return!0;return!1}function xx(r,e){return r.has(e)}var yx=1,vx=2;function Tu(r,e,t,s,n,o){var i=t&yx,l=r.length,d=e.length;if(l!=d&&!(i&&d>l))return!1;var h=o.get(r),f=o.get(e);if(h&&f)return h==e&&f==r;var m=-1,u=!0,g=t&vx?new Hs:void 0;for(o.set(r,e),o.set(e,r);++m<l;){var y=r[m],x=e[m];if(s)var A=i?s(x,y,m,e,r,o):s(y,x,m,r,e,o);if(A!==void 0){if(A)continue;u=!1;break}if(g){if(!bx(e,function(C,v){if(!xx(g,v)&&(y===C||n(y,C,t,s,o)))return g.push(v)})){u=!1;break}}else if(!(y===x||n(y,x,t,s,o))){u=!1;break}}return o.delete(r),o.delete(e),u}function wx(r){var e=-1,t=Array(r.size);return r.forEach(function(s,n){t[++e]=[n,s]}),t}function Nx(r){var e=-1,t=Array(r.size);return r.forEach(function(s){t[++e]=s}),t}var jx=1,Ex=2,_x="[object Boolean]",Ax="[object Date]",Cx="[object Error]",Tx="[object Map]",Sx="[object Number]",kx="[object RegExp]",qx="[object Set]",Ix="[object String]",Lx="[object Symbol]",Ox="[object ArrayBuffer]",Rx="[object DataView]",td=It?It.prototype:void 0,Ro=td?td.valueOf:void 0;function Mx(r,e,t,s,n,o,i){switch(t){case Rx:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case Ox:return!(r.byteLength!=e.byteLength||!o(new zs(r),new zs(e)));case _x:case Ax:case Sx:return ss(+r,+e);case Cx:return r.name==e.name&&r.message==e.message;case kx:case Ix:return r==e+"";case Tx:var l=wx;case qx:var d=s&jx;if(l||(l=Nx),r.size!=e.size&&!d)return!1;var h=i.get(r);if(h)return h==e;s|=Ex,i.set(r,e);var f=Tu(l(r),l(e),s,n,o,i);return i.delete(r),f;case Lx:if(Ro)return Ro.call(r)==Ro.call(e)}return!1}var Px=1,Dx=Object.prototype,$x=Dx.hasOwnProperty;function Fx(r,e,t,s,n,o){var i=t&Px,l=Yo(r),d=l.length,h=Yo(e),f=h.length;if(d!=f&&!i)return!1;for(var m=d;m--;){var u=l[m];if(!(i?u in e:$x.call(e,u)))return!1}var g=o.get(r),y=o.get(e);if(g&&y)return g==e&&y==r;var x=!0;o.set(r,e),o.set(e,r);for(var A=i;++m<d;){u=l[m];var C=r[u],v=e[u];if(s)var k=i?s(v,C,u,e,r,o):s(C,v,u,r,e,o);if(!(k===void 0?C===v||n(C,v,t,s,o):k)){x=!1;break}A||(A=u=="constructor")}if(x&&!A){var _=r.constructor,q=e.constructor;_!=q&&"constructor"in r&&"constructor"in e&&!(typeof _=="function"&&_ instanceof _&&typeof q=="function"&&q instanceof q)&&(x=!1)}return o.delete(r),o.delete(e),x}var Ux=1,rd="[object Arguments]",sd="[object Array]",Ts="[object Object]",Bx=Object.prototype,ad=Bx.hasOwnProperty;function zx(r,e,t,s,n,o){var i=Vt(r),l=Vt(e),d=i?sd:Ze(r),h=l?sd:Ze(e);d=d==rd?Ts:d,h=h==rd?Ts:h;var f=d==Ts,m=h==Ts,u=d==h;if(u&&Yr(r)){if(!Yr(e))return!1;i=!0,f=!1}if(u&&!f)return o||(o=new dt),i||Ei(r)?Tu(r,e,t,s,n,o):Mx(r,e,d,t,s,n,o);if(!(t&Ux)){var g=f&&ad.call(r,"__wrapped__"),y=m&&ad.call(e,"__wrapped__");if(g||y){var x=g?r.value():r,A=y?e.value():e;return o||(o=new dt),n(x,A,t,s,o)}}return u?(o||(o=new dt),Fx(r,e,t,s,n,o)):!1}function Su(r,e,t,s,n){return r===e?!0:r==null||e==null||!yt(r)&&!yt(e)?r!==r&&e!==e:zx(r,e,t,s,Su,n)}function Hx(r){return function(e,t,s){for(var n=-1,o=Object(e),i=s(e),l=i.length;l--;){var d=i[++n];if(t(o[d],d,o)===!1)break}return e}}var Vx=Hx();function ti(r,e,t){(t!==void 0&&!ss(r[e],t)||t===void 0&&!(e in r))&&wi(r,e,t)}function Gx(r){return yt(r)&&sa(r)}function ri(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}function Kx(r){return p0(r,xu(r))}function Wx(r,e,t,s,n,o,i){var l=ri(r,t),d=ri(e,t),h=i.get(d);if(h){ti(r,t,h);return}var f=o?o(l,d,t+"",r,e,i):void 0,m=f===void 0;if(m){var u=Vt(d),g=!u&&Yr(d),y=!u&&!g&&Ei(d);f=d,u||g||y?Vt(l)?f=l:Gx(l)?f=s0(l):g?(m=!1,f=Nu(d,!0)):y?(m=!1,f=ju(d,!0)):f=[]:zp(d)||Xo(d)?(f=l,Xo(l)?f=Kx(l):(!Ot(l)||vi(l))&&(f=Eu(d))):m=!1}m&&(i.set(d,f),n(f,d,s,o,i),i.delete(d)),ti(r,t,f)}function ku(r,e,t,s,n){r!==e&&Vx(e,function(o,i){if(n||(n=new dt),Ot(o))Wx(r,e,i,t,ku,s,n);else{var l=s?s(ri(r,i),o,i+"",r,e,n):void 0;l===void 0&&(l=o),ti(r,i,l)}},xu)}function Ai(r,e){return Su(r,e)}var kt=w0(function(r,e,t){ku(r,e,t)}),Q=(r=>(r[r.TYPE=3]="TYPE",r[r.LEVEL=12]="LEVEL",r[r.ATTRIBUTE=13]="ATTRIBUTE",r[r.BLOT=14]="BLOT",r[r.INLINE=7]="INLINE",r[r.BLOCK=11]="BLOCK",r[r.BLOCK_BLOT=10]="BLOCK_BLOT",r[r.INLINE_BLOT=6]="INLINE_BLOT",r[r.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",r[r.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",r[r.ANY=15]="ANY",r))(Q||{});class ut{constructor(e,t,s={}){this.attrName=e,this.keyName=t;const n=Q.TYPE&Q.ATTRIBUTE;this.scope=s.scope!=null?s.scope&Q.LEVEL|n:Q.ATTRIBUTE,s.whitelist!=null&&(this.whitelist=s.whitelist)}static keys(e){return Array.from(e.attributes).map(t=>t.name)}add(e,t){return this.canAdd(e,t)?(e.setAttribute(this.keyName,t),!0):!1}canAdd(e,t){return this.whitelist==null?!0:typeof t=="string"?this.whitelist.indexOf(t.replace(/["']/g,""))>-1:this.whitelist.indexOf(t)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const t=e.getAttribute(this.keyName);return this.canAdd(e,t)&&t?t:""}}class br extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const qu=class si{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,t=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(t){let s=null;try{s=e.parentNode}catch{return null}return this.find(s,t)}return null}create(e,t,s){const n=this.query(t);if(n==null)throw new br(`Unable to create ${t} blot`);const o=n,i=t instanceof Node||t.nodeType===Node.TEXT_NODE?t:o.create(s),l=new o(e,i,s);return si.blots.set(l.domNode,l),l}find(e,t=!1){return si.find(e,t)}query(e,t=Q.ANY){let s;return typeof e=="string"?s=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?s=this.types.text:typeof e=="number"?e&Q.LEVEL&Q.BLOCK?s=this.types.block:e&Q.LEVEL&Q.INLINE&&(s=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(n=>(s=this.classes[n],!!s)),s=s||this.tags[e.tagName]),s==null?null:"scope"in s&&t&Q.LEVEL&s.scope&&t&Q.TYPE&s.scope?s:null}register(...e){return e.map(t=>{const s="blotName"in t,n="attrName"in t;if(!s&&!n)throw new br("Invalid definition");if(s&&t.blotName==="abstract")throw new br("Cannot register abstract class");const o=s?t.blotName:n?t.attrName:void 0;return this.types[o]=t,n?typeof t.keyName=="string"&&(this.attributes[t.keyName]=t):s&&(t.className&&(this.classes[t.className]=t),t.tagName&&(Array.isArray(t.tagName)?t.tagName=t.tagName.map(i=>i.toUpperCase()):t.tagName=t.tagName.toUpperCase(),(Array.isArray(t.tagName)?t.tagName:[t.tagName]).forEach(i=>{(this.tags[i]==null||t.className==null)&&(this.tags[i]=t)}))),t})}};qu.blots=new WeakMap;let wr=qu;function nd(r,e){return(r.getAttribute("class")||"").split(/\s+/).filter(t=>t.indexOf(`${e}-`)===0)}class Zx extends ut{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(t=>t.split("-").slice(0,-1).join("-"))}add(e,t){return this.canAdd(e,t)?(this.remove(e),e.classList.add(`${this.keyName}-${t}`),!0):!1}remove(e){nd(e,this.keyName).forEach(t=>{e.classList.remove(t)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const t=(nd(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,t)?t:""}}const tt=Zx;function Mo(r){const e=r.split("-"),t=e.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("");return e[0]+t}class Xx extends ut{static keys(e){return(e.getAttribute("style")||"").split(";").map(t=>t.split(":")[0].trim())}add(e,t){return this.canAdd(e,t)?(e.style[Mo(this.keyName)]=t,!0):!1}remove(e){e.style[Mo(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const t=e.style[Mo(this.keyName)];return this.canAdd(e,t)?t:""}}const Rt=Xx;class Yx{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,t){t?e.add(this.domNode,t)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=wr.find(this.domNode);if(e==null)return;const t=ut.keys(this.domNode),s=tt.keys(this.domNode),n=Rt.keys(this.domNode);t.concat(s).concat(n).forEach(o=>{const i=e.scroll.query(o,Q.ATTRIBUTE);i instanceof ut&&(this.attributes[i.attrName]=i)})}copy(e){Object.keys(this.attributes).forEach(t=>{const s=this.attributes[t].value(this.domNode);e.format(t,s)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(t=>{this.attributes[t].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,t)=>(e[t]=this.attributes[t].value(this.domNode),e),{})}}const oa=Yx,Iu=class{constructor(e,t){this.scroll=e,this.domNode=t,wr.blots.set(t,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new br("Blot definition missing tagName");let t,s;return Array.isArray(this.tagName)?(typeof e=="string"?(s=e.toUpperCase(),parseInt(s,10).toString()===s&&(s=parseInt(s,10))):typeof e=="number"&&(s=e),typeof s=="number"?t=document.createElement(this.tagName[s-1]):s&&this.tagName.indexOf(s)>-1?t=document.createElement(s):t=document.createElement(this.tagName[0])):t=document.createElement(this.tagName),this.className&&t.classList.add(this.className),t}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),wr.blots.delete(this.domNode)}deleteAt(e,t){this.isolate(e,t).remove()}formatAt(e,t,s,n){const o=this.isolate(e,t);if(this.scroll.query(s,Q.BLOT)!=null&&n)o.wrap(s,n);else if(this.scroll.query(s,Q.ATTRIBUTE)!=null){const i=this.scroll.create(this.statics.scope);o.wrap(i),i.format(s,n)}}insertAt(e,t,s){const n=s==null?this.scroll.create("text",t):this.scroll.create(t,s),o=this.split(e);this.parent.insertBefore(n,o||void 0)}isolate(e,t){const s=this.split(e);if(s==null)throw new Error("Attempt to isolate at end");return s.split(t),s}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,t){const s=typeof e=="string"?this.scroll.create(e,t):e;return this.parent!=null&&(this.parent.insertBefore(s,this.next||void 0),this.remove()),s}split(e,t){return e===0?this:this.next}update(e,t){}wrap(e,t){const s=typeof e=="string"?this.scroll.create(e,t):e;if(this.parent!=null&&this.parent.insertBefore(s,this.next||void 0),typeof s.appendChild!="function")throw new br(`Cannot wrap ${e}`);return s.appendChild(this),s}};Iu.blotName="abstract";let Lu=Iu;const Ou=class extends Lu{static value(e){return!0}index(e,t){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(t,1):-1}position(e,t){let s=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(s+=1),[this.parent.domNode,s]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};Ou.scope=Q.INLINE_BLOT;let Qx=Ou;const ke=Qx;class Jx{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const t=e.slice(1);this.append(...t)}}at(e){const t=this.iterator();let s=t();for(;s&&e>0;)e-=1,s=t();return s}contains(e){const t=this.iterator();let s=t();for(;s;){if(s===e)return!0;s=t()}return!1}indexOf(e){const t=this.iterator();let s=t(),n=0;for(;s;){if(s===e)return n;n+=1,s=t()}return-1}insertBefore(e,t){e!=null&&(this.remove(e),e.next=t,t!=null?(e.prev=t.prev,t.prev!=null&&(t.prev.next=e),t.prev=e,t===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let t=0,s=this.head;for(;s!=null;){if(s===e)return t;t+=s.length(),s=s.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const t=e;return e!=null&&(e=e.next),t}}find(e,t=!1){const s=this.iterator();let n=s();for(;n;){const o=n.length();if(e<o||t&&e===o&&(n.next==null||n.next.length()!==0))return[n,e];e-=o,n=s()}return[null,0]}forEach(e){const t=this.iterator();let s=t();for(;s;)e(s),s=t()}forEachAt(e,t,s){if(t<=0)return;const[n,o]=this.find(e);let i=e-o;const l=this.iterator(n);let d=l();for(;d&&i<e+t;){const h=d.length();e>i?s(d,e-i,Math.min(t,i+h-e)):s(d,0,Math.min(h,e+t-i)),i+=h,d=l()}}map(e){return this.reduce((t,s)=>(t.push(e(s)),t),[])}reduce(e,t){const s=this.iterator();let n=s();for(;n;)t=e(t,n),n=s();return t}}function od(r,e){const t=e.find(r);if(t)return t;try{return e.create(r)}catch{const s=e.create(Q.INLINE);return Array.from(r.childNodes).forEach(n=>{s.domNode.appendChild(n)}),r.parentNode&&r.parentNode.replaceChild(s.domNode,r),s.attach(),s}}const Ru=class Tt extends Lu{constructor(e,t){super(e,t),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,Tt.uiClass&&this.uiNode.classList.add(Tt.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new Jx,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const t=od(e,this.scroll);this.insertBefore(t,this.children.head||void 0)}catch(t){if(t instanceof br)return;throw t}})}deleteAt(e,t){if(e===0&&t===this.length())return this.remove();this.children.forEachAt(e,t,(s,n,o)=>{s.deleteAt(n,o)})}descendant(e,t=0){const[s,n]=this.children.find(t);return e.blotName==null&&e(s)||e.blotName!=null&&s instanceof e?[s,n]:s instanceof Tt?s.descendant(e,n):[null,-1]}descendants(e,t=0,s=Number.MAX_VALUE){let n=[],o=s;return this.children.forEachAt(t,s,(i,l,d)=>{(e.blotName==null&&e(i)||e.blotName!=null&&i instanceof e)&&n.push(i),i instanceof Tt&&(n=n.concat(i.descendants(e,l,o))),o-=d}),n}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(t=>{e||this.statics.allowedChildren.some(s=>t instanceof s)||(t.statics.scope===Q.BLOCK_BLOT?(t.next!=null&&this.splitAfter(t),t.prev!=null&&this.splitAfter(t.prev),t.parent.unwrap(),e=!0):t instanceof Tt?t.unwrap():t.remove())})}formatAt(e,t,s,n){this.children.forEachAt(e,t,(o,i,l)=>{o.formatAt(i,l,s,n)})}insertAt(e,t,s){const[n,o]=this.children.find(e);if(n)n.insertAt(o,t,s);else{const i=s==null?this.scroll.create("text",t):this.scroll.create(t,s);this.appendChild(i)}}insertBefore(e,t){e.parent!=null&&e.parent.children.remove(e);let s=null;this.children.insertBefore(e,t||null),e.parent=this,t!=null&&(s=t.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==s)&&this.domNode.insertBefore(e.domNode,s),e.attach()}length(){return this.children.reduce((e,t)=>e+t.length(),0)}moveChildren(e,t){this.children.forEach(s=>{e.insertBefore(s,t)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const t=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(t)}else this.remove()}path(e,t=!1){const[s,n]=this.children.find(e,t),o=[[this,e]];return s instanceof Tt?o.concat(s.path(n,t)):(s!=null&&o.push([s,n]),o)}removeChild(e){this.children.remove(e)}replaceWith(e,t){const s=typeof e=="string"?this.scroll.create(e,t):e;return s instanceof Tt&&this.moveChildren(s),super.replaceWith(s)}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}const s=this.clone();return this.parent&&this.parent.insertBefore(s,this.next||void 0),this.children.forEachAt(e,this.length(),(n,o,i)=>{const l=n.split(o,t);l!=null&&s.appendChild(l)}),s}splitAfter(e){const t=this.clone();for(;e.next!=null;)t.appendChild(e.next);return this.parent&&this.parent.insertBefore(t,this.next||void 0),t}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,t){const s=[],n=[];e.forEach(o=>{o.target===this.domNode&&o.type==="childList"&&(s.push(...o.addedNodes),n.push(...o.removedNodes))}),n.forEach(o=>{if(o.parentNode!=null&&o.tagName!=="IFRAME"&&document.body.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const i=this.scroll.find(o);i!=null&&(i.domNode.parentNode==null||i.domNode.parentNode===this.domNode)&&i.detach()}),s.filter(o=>o.parentNode===this.domNode&&o!==this.uiNode).sort((o,i)=>o===i?0:o.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(o=>{let i=null;o.nextSibling!=null&&(i=this.scroll.find(o.nextSibling));const l=od(o,this.scroll);(l.next!==i||l.next==null)&&(l.parent!=null&&l.parent.removeChild(this),this.insertBefore(l,i||void 0))}),this.enforceAllowedChildren()}};Ru.uiClass="";let e1=Ru;const Qe=e1;function t1(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}const dr=class ur extends Qe{static create(e){return super.create(e)}static formats(e,t){const s=t.query(ur.blotName);if(!(s!=null&&e.tagName===s.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new oa(this.domNode)}format(e,t){if(e===this.statics.blotName&&!t)this.children.forEach(s=>{s instanceof ur||(s=s.wrap(ur.blotName,!0)),this.attributes.copy(s)}),this.unwrap();else{const s=this.scroll.query(e,Q.INLINE);if(s==null)return;s instanceof ut?this.attributes.attribute(s,t):t&&(e!==this.statics.blotName||this.formats()[e]!==t)&&this.replaceWith(e,t)}}formats(){const e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,s,n){this.formats()[s]!=null||this.scroll.query(s,Q.ATTRIBUTE)?this.isolate(e,t).format(s,n):super.formatAt(e,t,s,n)}optimize(e){super.optimize(e);const t=this.formats();if(Object.keys(t).length===0)return this.unwrap();const s=this.next;s instanceof ur&&s.prev===this&&t1(t,s.formats())&&(s.moveChildren(this),s.remove())}replaceWith(e,t){const s=super.replaceWith(e,t);return this.attributes.copy(s),s}update(e,t){super.update(e,t),e.some(s=>s.target===this.domNode&&s.type==="attributes")&&this.attributes.build()}wrap(e,t){const s=super.wrap(e,t);return s instanceof ur&&this.attributes.move(s),s}};dr.allowedChildren=[dr,ke],dr.blotName="inline",dr.scope=Q.INLINE_BLOT,dr.tagName="SPAN";let r1=dr;const Ci=r1,hr=class ai extends Qe{static create(e){return super.create(e)}static formats(e,t){const s=t.query(ai.blotName);if(!(s!=null&&e.tagName===s.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new oa(this.domNode)}format(e,t){const s=this.scroll.query(e,Q.BLOCK);s!=null&&(s instanceof ut?this.attributes.attribute(s,t):e===this.statics.blotName&&!t?this.replaceWith(ai.blotName):t&&(e!==this.statics.blotName||this.formats()[e]!==t)&&this.replaceWith(e,t))}formats(){const e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,s,n){this.scroll.query(s,Q.BLOCK)!=null?this.format(s,n):super.formatAt(e,t,s,n)}insertAt(e,t,s){if(s==null||this.scroll.query(t,Q.INLINE)!=null)super.insertAt(e,t,s);else{const n=this.split(e);if(n!=null){const o=this.scroll.create(t,s);n.parent.insertBefore(o,n)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,t){const s=super.replaceWith(e,t);return this.attributes.copy(s),s}update(e,t){super.update(e,t),e.some(s=>s.target===this.domNode&&s.type==="attributes")&&this.attributes.build()}};hr.blotName="block",hr.scope=Q.BLOCK_BLOT,hr.tagName="P",hr.allowedChildren=[Ci,hr,ke];let s1=hr;const es=s1,ni=class extends Qe{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,t){super.deleteAt(e,t),this.enforceAllowedChildren()}formatAt(e,t,s,n){super.formatAt(e,t,s,n),this.enforceAllowedChildren()}insertAt(e,t,s){super.insertAt(e,t,s),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};ni.blotName="container",ni.scope=Q.BLOCK_BLOT;let a1=ni;const ia=a1;class n1 extends ke{static formats(e,t){}format(e,t){super.formatAt(0,this.length(),e,t)}formatAt(e,t,s,n){e===0&&t===this.length()?this.format(s,n):super.formatAt(e,t,s,n)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const De=n1,o1={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},i1=100,fr=class extends Qe{constructor(e,t){super(null,t),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(s=>{this.update(s)}),this.observer.observe(this.domNode,o1),this.attach()}create(e,t){return this.registry.create(this,e,t)}find(e,t=!1){const s=this.registry.find(e,t);return s?s.scroll===this?s:t?this.find(s.scroll.domNode.parentNode,!0):null:null}query(e,t=Q.ANY){return this.registry.query(e,t)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,t){this.update(),e===0&&t===this.length()?this.children.forEach(s=>{s.remove()}):super.deleteAt(e,t)}formatAt(e,t,s,n){this.update(),super.formatAt(e,t,s,n)}insertAt(e,t,s){this.update(),super.insertAt(e,t,s)}optimize(e=[],t={}){super.optimize(t);const s=t.mutationsMap||new WeakMap;let n=Array.from(this.observer.takeRecords());for(;n.length>0;)e.push(n.pop());const o=(d,h=!0)=>{d==null||d===this||d.domNode.parentNode!=null&&(s.has(d.domNode)||s.set(d.domNode,[]),h&&o(d.parent))},i=d=>{s.has(d.domNode)&&(d instanceof Qe&&d.children.forEach(i),s.delete(d.domNode),d.optimize(t))};let l=e;for(let d=0;l.length>0;d+=1){if(d>=i1)throw new Error("[Parchment] Maximum optimize iterations reached");for(l.forEach(h=>{const f=this.find(h.target,!0);f!=null&&(f.domNode===h.target&&(h.type==="childList"?(o(this.find(h.previousSibling,!1)),Array.from(h.addedNodes).forEach(m=>{const u=this.find(m,!1);o(u,!1),u instanceof Qe&&u.children.forEach(g=>{o(g,!1)})})):h.type==="attributes"&&o(f.prev)),o(f))}),this.children.forEach(i),l=Array.from(this.observer.takeRecords()),n=l.slice();n.length>0;)e.push(n.pop())}}update(e,t={}){e=e||this.observer.takeRecords();const s=new WeakMap;e.map(n=>{const o=this.find(n.target,!0);return o==null?null:s.has(o.domNode)?(s.get(o.domNode).push(n),null):(s.set(o.domNode,[n]),o)}).forEach(n=>{n!=null&&n!==this&&s.has(n.domNode)&&n.update(s.get(n.domNode)||[],t)}),t.mutationsMap=s,s.has(this.domNode)&&super.update(s.get(this.domNode),t),this.optimize(e,t)}};fr.blotName="scroll",fr.defaultChild=es,fr.allowedChildren=[es,ia],fr.scope=Q.BLOCK_BLOT,fr.tagName="DIV";let l1=fr;const Ti=l1,oi=class Mu extends ke{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,t){super(e,t),this.text=this.statics.value(this.domNode)}deleteAt(e,t){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+t)}index(e,t){return this.domNode===e?t:-1}insertAt(e,t,s){s==null?(this.text=this.text.slice(0,e)+t+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,t,s)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof Mu&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,t=!1){return[this.domNode,e]}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}const s=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(s,this.next||void 0),this.text=this.statics.value(this.domNode),s}update(e,t){e.some(s=>s.type==="characterData"&&s.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};oi.blotName="text",oi.scope=Q.INLINE_BLOT;let c1=oi;const Vs=c1,Pu=Object.freeze(Object.defineProperty({__proto__:null,Attributor:ut,AttributorStore:oa,BlockBlot:es,ClassAttributor:tt,ContainerBlot:ia,EmbedBlot:De,InlineBlot:Ci,LeafBlot:ke,ParentBlot:Qe,Registry:wr,Scope:Q,ScrollBlot:Ti,StyleAttributor:Rt,TextBlot:Vs},Symbol.toStringTag,{value:"Module"}));var Ss={exports:{}},Po,id;function d1(){if(id)return Po;id=1;var r=-1,e=1,t=0;function s(p,j,N,S,L){if(p===j)return p?[[t,p]]:[];if(N!=null){var I=V(p,j,N);if(I)return I}var M=l(p,j),G=p.substring(0,M);p=p.substring(M),j=j.substring(M),M=h(p,j);var K=p.substring(p.length-M);p=p.substring(0,p.length-M),j=j.substring(0,j.length-M);var $=n(p,j);return G&&$.unshift([t,G]),K&&$.push([t,K]),v($,L),S&&m($),$}function n(p,j){var N;if(!p)return[[e,j]];if(!j)return[[r,p]];var S=p.length>j.length?p:j,L=p.length>j.length?j:p,I=S.indexOf(L);if(I!==-1)return N=[[e,S.substring(0,I)],[t,L],[e,S.substring(I+L.length)]],p.length>j.length&&(N[0][0]=N[2][0]=r),N;if(L.length===1)return[[r,p],[e,j]];var M=f(p,j);if(M){var G=M[0],K=M[1],$=M[2],H=M[3],X=M[4],ee=s(G,$),te=s(K,H);return ee.concat([[t,X]],te)}return o(p,j)}function o(p,j){for(var N=p.length,S=j.length,L=Math.ceil((N+S)/2),I=L,M=2*L,G=new Array(M),K=new Array(M),$=0;$<M;$++)G[$]=-1,K[$]=-1;G[I+1]=0,K[I+1]=0;for(var H=N-S,X=H%2!==0,ee=0,te=0,W=0,ne=0,ge=0;ge<L;ge++){for(var ae=-ge+ee;ae<=ge-te;ae+=2){var le=I+ae,oe;ae===-ge||ae!==ge&&G[le-1]<G[le+1]?oe=G[le+1]:oe=G[le-1]+1;for(var ce=oe-ae;oe<N&&ce<S&&p.charAt(oe)===j.charAt(ce);)oe++,ce++;if(G[le]=oe,oe>N)te+=2;else if(ce>S)ee+=2;else if(X){var ue=I+H-ae;if(ue>=0&&ue<M&&K[ue]!==-1){var he=N-K[ue];if(oe>=he)return i(p,j,oe,ce)}}}for(var be=-ge+W;be<=ge-ne;be+=2){var ue=I+be,he;be===-ge||be!==ge&&K[ue-1]<K[ue+1]?he=K[ue+1]:he=K[ue-1]+1;for(var z=he-be;he<N&&z<S&&p.charAt(N-he-1)===j.charAt(S-z-1);)he++,z++;if(K[ue]=he,he>N)ne+=2;else if(z>S)W+=2;else if(!X){var le=I+H-be;if(le>=0&&le<M&&G[le]!==-1){var oe=G[le],ce=I+oe-le;if(he=N-he,oe>=he)return i(p,j,oe,ce)}}}}return[[r,p],[e,j]]}function i(p,j,N,S){var L=p.substring(0,N),I=j.substring(0,S),M=p.substring(N),G=j.substring(S),K=s(L,I),$=s(M,G);return K.concat($)}function l(p,j){if(!p||!j||p.charAt(0)!==j.charAt(0))return 0;for(var N=0,S=Math.min(p.length,j.length),L=S,I=0;N<L;)p.substring(I,L)==j.substring(I,L)?(N=L,I=N):S=L,L=Math.floor((S-N)/2+N);return k(p.charCodeAt(L-1))&&L--,L}function d(p,j){var N=p.length,S=j.length;if(N==0||S==0)return 0;N>S?p=p.substring(N-S):N<S&&(j=j.substring(0,N));var L=Math.min(N,S);if(p==j)return L;for(var I=0,M=1;;){var G=p.substring(L-M),K=j.indexOf(G);if(K==-1)return I;M+=K,(K==0||p.substring(L-M)==j.substring(0,M))&&(I=M,M++)}}function h(p,j){if(!p||!j||p.slice(-1)!==j.slice(-1))return 0;for(var N=0,S=Math.min(p.length,j.length),L=S,I=0;N<L;)p.substring(p.length-L,p.length-I)==j.substring(j.length-L,j.length-I)?(N=L,I=N):S=L,L=Math.floor((S-N)/2+N);return _(p.charCodeAt(p.length-L))&&L--,L}function f(p,j){var N=p.length>j.length?p:j,S=p.length>j.length?j:p;if(N.length<4||S.length*2<N.length)return null;function L(te,W,ne){for(var ge=te.substring(ne,ne+Math.floor(te.length/4)),ae=-1,le="",oe,ce,ue,he;(ae=W.indexOf(ge,ae+1))!==-1;){var be=l(te.substring(ne),W.substring(ae)),z=h(te.substring(0,ne),W.substring(0,ae));le.length<z+be&&(le=W.substring(ae-z,ae)+W.substring(ae,ae+be),oe=te.substring(0,ne-z),ce=te.substring(ne+be),ue=W.substring(0,ae-z),he=W.substring(ae+be))}return le.length*2>=te.length?[oe,ce,ue,he,le]:null}var I=L(N,S,Math.ceil(N.length/4)),M=L(N,S,Math.ceil(N.length/2)),G;if(!I&&!M)return null;M?I?G=I[4].length>M[4].length?I:M:G=M:G=I;var K,$,H,X;p.length>j.length?(K=G[0],$=G[1],H=G[2],X=G[3]):(H=G[0],X=G[1],K=G[2],$=G[3]);var ee=G[4];return[K,$,H,X,ee]}function m(p){for(var j=!1,N=[],S=0,L=null,I=0,M=0,G=0,K=0,$=0;I<p.length;)p[I][0]==t?(N[S++]=I,M=K,G=$,K=0,$=0,L=p[I][1]):(p[I][0]==e?K+=p[I][1].length:$+=p[I][1].length,L&&L.length<=Math.max(M,G)&&L.length<=Math.max(K,$)&&(p.splice(N[S-1],0,[r,L]),p[N[S-1]+1][0]=e,S--,S--,I=S>0?N[S-1]:-1,M=0,G=0,K=0,$=0,L=null,j=!0)),I++;for(j&&v(p),C(p),I=1;I<p.length;){if(p[I-1][0]==r&&p[I][0]==e){var H=p[I-1][1],X=p[I][1],ee=d(H,X),te=d(X,H);ee>=te?(ee>=H.length/2||ee>=X.length/2)&&(p.splice(I,0,[t,X.substring(0,ee)]),p[I-1][1]=H.substring(0,H.length-ee),p[I+1][1]=X.substring(ee),I++):(te>=H.length/2||te>=X.length/2)&&(p.splice(I,0,[t,H.substring(0,te)]),p[I-1][0]=e,p[I-1][1]=X.substring(0,X.length-te),p[I+1][0]=r,p[I+1][1]=H.substring(te),I++),I++}I++}}var u=/[^a-zA-Z0-9]/,g=/\s/,y=/[\r\n]/,x=/\n\r?\n$/,A=/^\r?\n\r?\n/;function C(p){function j(te,W){if(!te||!W)return 6;var ne=te.charAt(te.length-1),ge=W.charAt(0),ae=ne.match(u),le=ge.match(u),oe=ae&&ne.match(g),ce=le&&ge.match(g),ue=oe&&ne.match(y),he=ce&&ge.match(y),be=ue&&te.match(x),z=he&&W.match(A);return be||z?5:ue||he?4:ae&&!oe&&ce?3:oe||ce?2:ae||le?1:0}for(var N=1;N<p.length-1;){if(p[N-1][0]==t&&p[N+1][0]==t){var S=p[N-1][1],L=p[N][1],I=p[N+1][1],M=h(S,L);if(M){var G=L.substring(L.length-M);S=S.substring(0,S.length-M),L=G+L.substring(0,L.length-M),I=G+I}for(var K=S,$=L,H=I,X=j(S,L)+j(L,I);L.charAt(0)===I.charAt(0);){S+=L.charAt(0),L=L.substring(1)+I.charAt(0),I=I.substring(1);var ee=j(S,L)+j(L,I);ee>=X&&(X=ee,K=S,$=L,H=I)}p[N-1][1]!=K&&(K?p[N-1][1]=K:(p.splice(N-1,1),N--),p[N][1]=$,H?p[N+1][1]=H:(p.splice(N+1,1),N--))}N++}}function v(p,j){p.push([t,""]);for(var N=0,S=0,L=0,I="",M="",G;N<p.length;){if(N<p.length-1&&!p[N][1]){p.splice(N,1);continue}switch(p[N][0]){case e:L++,M+=p[N][1],N++;break;case r:S++,I+=p[N][1],N++;break;case t:var K=N-L-S-1;if(j){if(K>=0&&D(p[K][1])){var $=p[K][1].slice(-1);if(p[K][1]=p[K][1].slice(0,-1),I=$+I,M=$+M,!p[K][1]){p.splice(K,1),N--;var H=K-1;p[H]&&p[H][0]===e&&(L++,M=p[H][1]+M,H--),p[H]&&p[H][0]===r&&(S++,I=p[H][1]+I,H--),K=H}}if(q(p[N][1])){var $=p[N][1].charAt(0);p[N][1]=p[N][1].slice(1),I+=$,M+=$}}if(N<p.length-1&&!p[N][1]){p.splice(N,1);break}if(I.length>0||M.length>0){I.length>0&&M.length>0&&(G=l(M,I),G!==0&&(K>=0?p[K][1]+=M.substring(0,G):(p.splice(0,0,[t,M.substring(0,G)]),N++),M=M.substring(G),I=I.substring(G)),G=h(M,I),G!==0&&(p[N][1]=M.substring(M.length-G)+p[N][1],M=M.substring(0,M.length-G),I=I.substring(0,I.length-G)));var X=L+S;I.length===0&&M.length===0?(p.splice(N-X,X),N=N-X):I.length===0?(p.splice(N-X,X,[e,M]),N=N-X+1):M.length===0?(p.splice(N-X,X,[r,I]),N=N-X+1):(p.splice(N-X,X,[r,I],[e,M]),N=N-X+2)}N!==0&&p[N-1][0]===t?(p[N-1][1]+=p[N][1],p.splice(N,1)):N++,L=0,S=0,I="",M="";break}}p[p.length-1][1]===""&&p.pop();var ee=!1;for(N=1;N<p.length-1;)p[N-1][0]===t&&p[N+1][0]===t&&(p[N][1].substring(p[N][1].length-p[N-1][1].length)===p[N-1][1]?(p[N][1]=p[N-1][1]+p[N][1].substring(0,p[N][1].length-p[N-1][1].length),p[N+1][1]=p[N-1][1]+p[N+1][1],p.splice(N-1,1),ee=!0):p[N][1].substring(0,p[N+1][1].length)==p[N+1][1]&&(p[N-1][1]+=p[N+1][1],p[N][1]=p[N][1].substring(p[N+1][1].length)+p[N+1][1],p.splice(N+1,1),ee=!0)),N++;ee&&v(p,j)}function k(p){return p>=55296&&p<=56319}function _(p){return p>=56320&&p<=57343}function q(p){return _(p.charCodeAt(0))}function D(p){return k(p.charCodeAt(p.length-1))}function F(p){for(var j=[],N=0;N<p.length;N++)p[N][1].length>0&&j.push(p[N]);return j}function T(p,j,N,S){return D(p)||q(S)?null:F([[t,p],[r,j],[e,N],[t,S]])}function V(p,j,N){var S=typeof N=="number"?{index:N,length:0}:N.oldRange,L=typeof N=="number"?null:N.newRange,I=p.length,M=j.length;if(S.length===0&&(L===null||L.length===0)){var G=S.index,K=p.slice(0,G),$=p.slice(G),H=L?L.index:null;e:{var X=G+M-I;if(H!==null&&H!==X||X<0||X>M)break e;var ee=j.slice(0,X),te=j.slice(X);if(te!==$)break e;var W=Math.min(G,X),ne=K.slice(0,W),ge=ee.slice(0,W);if(ne!==ge)break e;var ae=K.slice(W),le=ee.slice(W);return T(ne,ae,le,$)}e:{if(H!==null&&H!==G)break e;var oe=G,ee=j.slice(0,oe),te=j.slice(oe);if(ee!==K)break e;var ce=Math.min(I-oe,M-oe),ue=$.slice($.length-ce),he=te.slice(te.length-ce);if(ue!==he)break e;var ae=$.slice(0,$.length-ce),le=te.slice(0,te.length-ce);return T(K,ae,le,ue)}}if(S.length>0&&L&&L.length===0)e:{var ne=p.slice(0,S.index),ue=p.slice(S.index+S.length),W=ne.length,ce=ue.length;if(M<W+ce)break e;var ge=j.slice(0,W),he=j.slice(M-ce);if(ne!==ge||ue!==he)break e;var ae=p.slice(W,I-ce),le=j.slice(W,M-ce);return T(ne,ae,le,ue)}return null}function O(p,j,N,S){return s(p,j,N,S,!0)}return O.INSERT=e,O.DELETE=r,O.EQUAL=t,Po=O,Po}var Hr={exports:{}};Hr.exports;var ld;function Du(){return ld||(ld=1,(function(r,e){var t=200,s="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",i="[object Array]",l="[object Boolean]",d="[object Date]",h="[object Error]",f="[object Function]",m="[object GeneratorFunction]",u="[object Map]",g="[object Number]",y="[object Object]",x="[object Promise]",A="[object RegExp]",C="[object Set]",v="[object String]",k="[object Symbol]",_="[object WeakMap]",q="[object ArrayBuffer]",D="[object DataView]",F="[object Float32Array]",T="[object Float64Array]",V="[object Int8Array]",O="[object Int16Array]",p="[object Int32Array]",j="[object Uint8Array]",N="[object Uint8ClampedArray]",S="[object Uint16Array]",L="[object Uint32Array]",I=/[\\^$.*+?()[\]{}|]/g,M=/\w*$/,G=/^\[object .+?Constructor\]$/,K=/^(?:0|[1-9]\d*)$/,$={};$[o]=$[i]=$[q]=$[D]=$[l]=$[d]=$[F]=$[T]=$[V]=$[O]=$[p]=$[u]=$[g]=$[y]=$[A]=$[C]=$[v]=$[k]=$[j]=$[N]=$[S]=$[L]=!0,$[h]=$[f]=$[_]=!1;var H=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,X=typeof self=="object"&&self&&self.Object===Object&&self,ee=H||X||Function("return this")(),te=e&&!e.nodeType&&e,W=te&&!0&&r&&!r.nodeType&&r,ne=W&&W.exports===te;function ge(c,b){return c.set(b[0],b[1]),c}function ae(c,b){return c.add(b),c}function le(c,b){for(var E=-1,P=c?c.length:0;++E<P&&b(c[E],E,c)!==!1;);return c}function oe(c,b){for(var E=-1,P=b.length,se=c.length;++E<P;)c[se+E]=b[E];return c}function ce(c,b,E,P){for(var se=-1,J=c?c.length:0;++se<J;)E=b(E,c[se],se,c);return E}function ue(c,b){for(var E=-1,P=Array(c);++E<c;)P[E]=b(E);return P}function he(c,b){return c?.[b]}function be(c){var b=!1;if(c!=null&&typeof c.toString!="function")try{b=!!(c+"")}catch{}return b}function z(c){var b=-1,E=Array(c.size);return c.forEach(function(P,se){E[++b]=[se,P]}),E}function ye(c,b){return function(E){return c(b(E))}}function we(c){var b=-1,E=Array(c.size);return c.forEach(function(P){E[++b]=P}),E}var Et=Array.prototype,at=Function.prototype,Pe=Object.prototype,_t=ee["__core-js_shared__"],nt=(function(){var c=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""})(),He=at.toString,je=Pe.hasOwnProperty,ot=Pe.toString,er=RegExp("^"+He.call(je).replace(I,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mt=ne?ee.Buffer:void 0,tr=ee.Symbol,_r=ee.Uint8Array,$e=ye(Object.getPrototypeOf,Object),cs=Object.create,ds=Pe.propertyIsEnumerable,ua=Et.splice,Ar=Object.getOwnPropertySymbols,rr=Mt?Mt.isBuffer:void 0,us=ye(Object.keys,Object),sr=Ge(ee,"DataView"),Pt=Ge(ee,"Map"),Ve=Ge(ee,"Promise"),ar=Ge(ee,"Set"),Cr=Ge(ee,"WeakMap"),Dt=Ge(Object,"create"),Tr=qe(sr),$t=qe(Pt),Sr=qe(Ve),kr=qe(ar),qr=qe(Cr),At=tr?tr.prototype:void 0,hs=At?At.valueOf:void 0;function ft(c){var b=-1,E=c?c.length:0;for(this.clear();++b<E;){var P=c[b];this.set(P[0],P[1])}}function ha(){this.__data__=Dt?Dt(null):{}}function fa(c){return this.has(c)&&delete this.__data__[c]}function ga(c){var b=this.__data__;if(Dt){var E=b[c];return E===s?void 0:E}return je.call(b,c)?b[c]:void 0}function fs(c){var b=this.__data__;return Dt?b[c]!==void 0:je.call(b,c)}function Ir(c,b){var E=this.__data__;return E[c]=Dt&&b===void 0?s:b,this}ft.prototype.clear=ha,ft.prototype.delete=fa,ft.prototype.get=ga,ft.prototype.has=fs,ft.prototype.set=Ir;function Ee(c){var b=-1,E=c?c.length:0;for(this.clear();++b<E;){var P=c[b];this.set(P[0],P[1])}}function ma(){this.__data__=[]}function pa(c){var b=this.__data__,E=or(b,c);if(E<0)return!1;var P=b.length-1;return E==P?b.pop():ua.call(b,E,1),!0}function ba(c){var b=this.__data__,E=or(b,c);return E<0?void 0:b[E][1]}function xa(c){return or(this.__data__,c)>-1}function ya(c,b){var E=this.__data__,P=or(E,c);return P<0?E.push([c,b]):E[P][1]=b,this}Ee.prototype.clear=ma,Ee.prototype.delete=pa,Ee.prototype.get=ba,Ee.prototype.has=xa,Ee.prototype.set=ya;function Ce(c){var b=-1,E=c?c.length:0;for(this.clear();++b<E;){var P=c[b];this.set(P[0],P[1])}}function va(){this.__data__={hash:new ft,map:new(Pt||Ee),string:new ft}}function wa(c){return Ut(this,c).delete(c)}function Na(c){return Ut(this,c).get(c)}function ja(c){return Ut(this,c).has(c)}function Ea(c,b){return Ut(this,c).set(c,b),this}Ce.prototype.clear=va,Ce.prototype.delete=wa,Ce.prototype.get=Na,Ce.prototype.has=ja,Ce.prototype.set=Ea;function Re(c){this.__data__=new Ee(c)}function _a(){this.__data__=new Ee}function Aa(c){return this.__data__.delete(c)}function Ca(c){return this.__data__.get(c)}function Ta(c){return this.__data__.has(c)}function Sa(c,b){var E=this.__data__;if(E instanceof Ee){var P=E.__data__;if(!Pt||P.length<t-1)return P.push([c,b]),this;E=this.__data__=new Ce(P)}return E.set(c,b),this}Re.prototype.clear=_a,Re.prototype.delete=Aa,Re.prototype.get=Ca,Re.prototype.has=Ta,Re.prototype.set=Sa;function nr(c,b){var E=Mr(c)||lr(c)?ue(c.length,String):[],P=E.length,se=!!P;for(var J in c)je.call(c,J)&&!(se&&(J=="length"||za(J,P)))&&E.push(J);return E}function gs(c,b,E){var P=c[b];(!(je.call(c,b)&&ys(P,E))||E===void 0&&!(b in c))&&(c[b]=E)}function or(c,b){for(var E=c.length;E--;)if(ys(c[E][0],b))return E;return-1}function it(c,b){return c&&Rr(b,Dr(b),c)}function Lr(c,b,E,P,se,J,de){var ie;if(P&&(ie=J?P(c,se,J,de):P(c)),ie!==void 0)return ie;if(!ct(c))return c;var xe=Mr(c);if(xe){if(ie=Ua(c),!b)return Da(c,ie)}else{var fe=mt(c),Te=fe==f||fe==m;if(vs(c))return ir(c,b);if(fe==y||fe==o||Te&&!J){if(be(c))return J?c:{};if(ie=lt(Te?{}:c),!b)return $a(c,it(ie,c))}else{if(!$[fe])return J?c:{};ie=Ba(c,fe,Lr,b)}}de||(de=new Re);var Me=de.get(c);if(Me)return Me;if(de.set(c,ie),!xe)var ve=E?Fa(c):Dr(c);return le(ve||c,function(Se,_e){ve&&(_e=Se,Se=c[_e]),gs(ie,_e,Lr(Se,b,E,P,_e,c,de))}),ie}function ka(c){return ct(c)?cs(c):{}}function qa(c,b,E){var P=b(c);return Mr(c)?P:oe(P,E(c))}function Ia(c){return ot.call(c)}function La(c){if(!ct(c)||Va(c))return!1;var b=Pr(c)||be(c)?er:G;return b.test(qe(c))}function Oa(c){if(!bs(c))return us(c);var b=[];for(var E in Object(c))je.call(c,E)&&E!="constructor"&&b.push(E);return b}function ir(c,b){if(b)return c.slice();var E=new c.constructor(c.length);return c.copy(E),E}function Or(c){var b=new c.constructor(c.byteLength);return new _r(b).set(new _r(c)),b}function Ft(c,b){var E=b?Or(c.buffer):c.buffer;return new c.constructor(E,c.byteOffset,c.byteLength)}function ms(c,b,E){var P=b?E(z(c),!0):z(c);return ce(P,ge,new c.constructor)}function ps(c){var b=new c.constructor(c.source,M.exec(c));return b.lastIndex=c.lastIndex,b}function Ra(c,b,E){var P=b?E(we(c),!0):we(c);return ce(P,ae,new c.constructor)}function Ma(c){return hs?Object(hs.call(c)):{}}function Pa(c,b){var E=b?Or(c.buffer):c.buffer;return new c.constructor(E,c.byteOffset,c.length)}function Da(c,b){var E=-1,P=c.length;for(b||(b=Array(P));++E<P;)b[E]=c[E];return b}function Rr(c,b,E,P){E||(E={});for(var se=-1,J=b.length;++se<J;){var de=b[se],ie=void 0;gs(E,de,ie===void 0?c[de]:ie)}return E}function $a(c,b){return Rr(c,gt(c),b)}function Fa(c){return qa(c,Dr,gt)}function Ut(c,b){var E=c.__data__;return Ha(b)?E[typeof b=="string"?"string":"hash"]:E.map}function Ge(c,b){var E=he(c,b);return La(E)?E:void 0}var gt=Ar?ye(Ar,Object):Ka,mt=Ia;(sr&&mt(new sr(new ArrayBuffer(1)))!=D||Pt&&mt(new Pt)!=u||Ve&&mt(Ve.resolve())!=x||ar&&mt(new ar)!=C||Cr&&mt(new Cr)!=_)&&(mt=function(c){var b=ot.call(c),E=b==y?c.constructor:void 0,P=E?qe(E):void 0;if(P)switch(P){case Tr:return D;case $t:return u;case Sr:return x;case kr:return C;case qr:return _}return b});function Ua(c){var b=c.length,E=c.constructor(b);return b&&typeof c[0]=="string"&&je.call(c,"index")&&(E.index=c.index,E.input=c.input),E}function lt(c){return typeof c.constructor=="function"&&!bs(c)?ka($e(c)):{}}function Ba(c,b,E,P){var se=c.constructor;switch(b){case q:return Or(c);case l:case d:return new se(+c);case D:return Ft(c,P);case F:case T:case V:case O:case p:case j:case N:case S:case L:return Pa(c,P);case u:return ms(c,P,E);case g:case v:return new se(c);case A:return ps(c);case C:return Ra(c,P,E);case k:return Ma(c)}}function za(c,b){return b=b??n,!!b&&(typeof c=="number"||K.test(c))&&c>-1&&c%1==0&&c<b}function Ha(c){var b=typeof c;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?c!=="__proto__":c===null}function Va(c){return!!nt&&nt in c}function bs(c){var b=c&&c.constructor,E=typeof b=="function"&&b.prototype||Pe;return c===E}function qe(c){if(c!=null){try{return He.call(c)}catch{}try{return c+""}catch{}}return""}function xs(c){return Lr(c,!0,!0)}function ys(c,b){return c===b||c!==c&&b!==b}function lr(c){return Ga(c)&&je.call(c,"callee")&&(!ds.call(c,"callee")||ot.call(c)==o)}var Mr=Array.isArray;function cr(c){return c!=null&&ws(c.length)&&!Pr(c)}function Ga(c){return Ns(c)&&cr(c)}var vs=rr||Wa;function Pr(c){var b=ct(c)?ot.call(c):"";return b==f||b==m}function ws(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=n}function ct(c){var b=typeof c;return!!c&&(b=="object"||b=="function")}function Ns(c){return!!c&&typeof c=="object"}function Dr(c){return cr(c)?nr(c):Oa(c)}function Ka(){return[]}function Wa(){return!1}r.exports=xs})(Hr,Hr.exports)),Hr.exports}var Vr={exports:{}};Vr.exports;var cd;function $u(){return cd||(cd=1,(function(r,e){var t=200,s="__lodash_hash_undefined__",n=1,o=2,i=9007199254740991,l="[object Arguments]",d="[object Array]",h="[object AsyncFunction]",f="[object Boolean]",m="[object Date]",u="[object Error]",g="[object Function]",y="[object GeneratorFunction]",x="[object Map]",A="[object Number]",C="[object Null]",v="[object Object]",k="[object Promise]",_="[object Proxy]",q="[object RegExp]",D="[object Set]",F="[object String]",T="[object Symbol]",V="[object Undefined]",O="[object WeakMap]",p="[object ArrayBuffer]",j="[object DataView]",N="[object Float32Array]",S="[object Float64Array]",L="[object Int8Array]",I="[object Int16Array]",M="[object Int32Array]",G="[object Uint8Array]",K="[object Uint8ClampedArray]",$="[object Uint16Array]",H="[object Uint32Array]",X=/[\\^$.*+?()[\]{}|]/g,ee=/^\[object .+?Constructor\]$/,te=/^(?:0|[1-9]\d*)$/,W={};W[N]=W[S]=W[L]=W[I]=W[M]=W[G]=W[K]=W[$]=W[H]=!0,W[l]=W[d]=W[p]=W[f]=W[j]=W[m]=W[u]=W[g]=W[x]=W[A]=W[v]=W[q]=W[D]=W[F]=W[O]=!1;var ne=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,ge=typeof self=="object"&&self&&self.Object===Object&&self,ae=ne||ge||Function("return this")(),le=e&&!e.nodeType&&e,oe=le&&!0&&r&&!r.nodeType&&r,ce=oe&&oe.exports===le,ue=ce&&ne.process,he=(function(){try{return ue&&ue.binding&&ue.binding("util")}catch{}})(),be=he&&he.isTypedArray;function z(c,b){for(var E=-1,P=c==null?0:c.length,se=0,J=[];++E<P;){var de=c[E];b(de,E,c)&&(J[se++]=de)}return J}function ye(c,b){for(var E=-1,P=b.length,se=c.length;++E<P;)c[se+E]=b[E];return c}function we(c,b){for(var E=-1,P=c==null?0:c.length;++E<P;)if(b(c[E],E,c))return!0;return!1}function Et(c,b){for(var E=-1,P=Array(c);++E<c;)P[E]=b(E);return P}function at(c){return function(b){return c(b)}}function Pe(c,b){return c.has(b)}function _t(c,b){return c?.[b]}function nt(c){var b=-1,E=Array(c.size);return c.forEach(function(P,se){E[++b]=[se,P]}),E}function He(c,b){return function(E){return c(b(E))}}function je(c){var b=-1,E=Array(c.size);return c.forEach(function(P){E[++b]=P}),E}var ot=Array.prototype,er=Function.prototype,Mt=Object.prototype,tr=ae["__core-js_shared__"],_r=er.toString,$e=Mt.hasOwnProperty,cs=(function(){var c=/[^.]+$/.exec(tr&&tr.keys&&tr.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""})(),ds=Mt.toString,ua=RegExp("^"+_r.call($e).replace(X,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ar=ce?ae.Buffer:void 0,rr=ae.Symbol,us=ae.Uint8Array,sr=Mt.propertyIsEnumerable,Pt=ot.splice,Ve=rr?rr.toStringTag:void 0,ar=Object.getOwnPropertySymbols,Cr=Ar?Ar.isBuffer:void 0,Dt=He(Object.keys,Object),Tr=gt(ae,"DataView"),$t=gt(ae,"Map"),Sr=gt(ae,"Promise"),kr=gt(ae,"Set"),qr=gt(ae,"WeakMap"),At=gt(Object,"create"),hs=qe(Tr),ft=qe($t),ha=qe(Sr),fa=qe(kr),ga=qe(qr),fs=rr?rr.prototype:void 0,Ir=fs?fs.valueOf:void 0;function Ee(c){var b=-1,E=c==null?0:c.length;for(this.clear();++b<E;){var P=c[b];this.set(P[0],P[1])}}function ma(){this.__data__=At?At(null):{},this.size=0}function pa(c){var b=this.has(c)&&delete this.__data__[c];return this.size-=b?1:0,b}function ba(c){var b=this.__data__;if(At){var E=b[c];return E===s?void 0:E}return $e.call(b,c)?b[c]:void 0}function xa(c){var b=this.__data__;return At?b[c]!==void 0:$e.call(b,c)}function ya(c,b){var E=this.__data__;return this.size+=this.has(c)?0:1,E[c]=At&&b===void 0?s:b,this}Ee.prototype.clear=ma,Ee.prototype.delete=pa,Ee.prototype.get=ba,Ee.prototype.has=xa,Ee.prototype.set=ya;function Ce(c){var b=-1,E=c==null?0:c.length;for(this.clear();++b<E;){var P=c[b];this.set(P[0],P[1])}}function va(){this.__data__=[],this.size=0}function wa(c){var b=this.__data__,E=ir(b,c);if(E<0)return!1;var P=b.length-1;return E==P?b.pop():Pt.call(b,E,1),--this.size,!0}function Na(c){var b=this.__data__,E=ir(b,c);return E<0?void 0:b[E][1]}function ja(c){return ir(this.__data__,c)>-1}function Ea(c,b){var E=this.__data__,P=ir(E,c);return P<0?(++this.size,E.push([c,b])):E[P][1]=b,this}Ce.prototype.clear=va,Ce.prototype.delete=wa,Ce.prototype.get=Na,Ce.prototype.has=ja,Ce.prototype.set=Ea;function Re(c){var b=-1,E=c==null?0:c.length;for(this.clear();++b<E;){var P=c[b];this.set(P[0],P[1])}}function _a(){this.size=0,this.__data__={hash:new Ee,map:new($t||Ce),string:new Ee}}function Aa(c){var b=Ge(this,c).delete(c);return this.size-=b?1:0,b}function Ca(c){return Ge(this,c).get(c)}function Ta(c){return Ge(this,c).has(c)}function Sa(c,b){var E=Ge(this,c),P=E.size;return E.set(c,b),this.size+=E.size==P?0:1,this}Re.prototype.clear=_a,Re.prototype.delete=Aa,Re.prototype.get=Ca,Re.prototype.has=Ta,Re.prototype.set=Sa;function nr(c){var b=-1,E=c==null?0:c.length;for(this.__data__=new Re;++b<E;)this.add(c[b])}function gs(c){return this.__data__.set(c,s),this}function or(c){return this.__data__.has(c)}nr.prototype.add=nr.prototype.push=gs,nr.prototype.has=or;function it(c){var b=this.__data__=new Ce(c);this.size=b.size}function Lr(){this.__data__=new Ce,this.size=0}function ka(c){var b=this.__data__,E=b.delete(c);return this.size=b.size,E}function qa(c){return this.__data__.get(c)}function Ia(c){return this.__data__.has(c)}function La(c,b){var E=this.__data__;if(E instanceof Ce){var P=E.__data__;if(!$t||P.length<t-1)return P.push([c,b]),this.size=++E.size,this;E=this.__data__=new Re(P)}return E.set(c,b),this.size=E.size,this}it.prototype.clear=Lr,it.prototype.delete=ka,it.prototype.get=qa,it.prototype.has=Ia,it.prototype.set=La;function Oa(c,b){var E=lr(c),P=!E&&ys(c),se=!E&&!P&&cr(c),J=!E&&!P&&!se&&Ns(c),de=E||P||se||J,ie=de?Et(c.length,String):[],xe=ie.length;for(var fe in c)$e.call(c,fe)&&!(de&&(fe=="length"||se&&(fe=="offset"||fe=="parent")||J&&(fe=="buffer"||fe=="byteLength"||fe=="byteOffset")||Ba(fe,xe)))&&ie.push(fe);return ie}function ir(c,b){for(var E=c.length;E--;)if(xs(c[E][0],b))return E;return-1}function Or(c,b,E){var P=b(c);return lr(c)?P:ye(P,E(c))}function Ft(c){return c==null?c===void 0?V:C:Ve&&Ve in Object(c)?mt(c):bs(c)}function ms(c){return ct(c)&&Ft(c)==l}function ps(c,b,E,P,se){return c===b?!0:c==null||b==null||!ct(c)&&!ct(b)?c!==c&&b!==b:Ra(c,b,E,P,ps,se)}function Ra(c,b,E,P,se,J){var de=lr(c),ie=lr(b),xe=de?d:lt(c),fe=ie?d:lt(b);xe=xe==l?v:xe,fe=fe==l?v:fe;var Te=xe==v,Me=fe==v,ve=xe==fe;if(ve&&cr(c)){if(!cr(b))return!1;de=!0,Te=!1}if(ve&&!Te)return J||(J=new it),de||Ns(c)?Rr(c,b,E,P,se,J):$a(c,b,xe,E,P,se,J);if(!(E&n)){var Se=Te&&$e.call(c,"__wrapped__"),_e=Me&&$e.call(b,"__wrapped__");if(Se||_e){var Ct=Se?c.value():c,pt=_e?b.value():b;return J||(J=new it),se(Ct,pt,E,P,J)}}return ve?(J||(J=new it),Fa(c,b,E,P,se,J)):!1}function Ma(c){if(!ws(c)||Ha(c))return!1;var b=vs(c)?ua:ee;return b.test(qe(c))}function Pa(c){return ct(c)&&Pr(c.length)&&!!W[Ft(c)]}function Da(c){if(!Va(c))return Dt(c);var b=[];for(var E in Object(c))$e.call(c,E)&&E!="constructor"&&b.push(E);return b}function Rr(c,b,E,P,se,J){var de=E&n,ie=c.length,xe=b.length;if(ie!=xe&&!(de&&xe>ie))return!1;var fe=J.get(c);if(fe&&J.get(b))return fe==b;var Te=-1,Me=!0,ve=E&o?new nr:void 0;for(J.set(c,b),J.set(b,c);++Te<ie;){var Se=c[Te],_e=b[Te];if(P)var Ct=de?P(_e,Se,Te,b,c,J):P(Se,_e,Te,c,b,J);if(Ct!==void 0){if(Ct)continue;Me=!1;break}if(ve){if(!we(b,function(pt,Bt){if(!Pe(ve,Bt)&&(Se===pt||se(Se,pt,E,P,J)))return ve.push(Bt)})){Me=!1;break}}else if(!(Se===_e||se(Se,_e,E,P,J))){Me=!1;break}}return J.delete(c),J.delete(b),Me}function $a(c,b,E,P,se,J,de){switch(E){case j:if(c.byteLength!=b.byteLength||c.byteOffset!=b.byteOffset)return!1;c=c.buffer,b=b.buffer;case p:return!(c.byteLength!=b.byteLength||!J(new us(c),new us(b)));case f:case m:case A:return xs(+c,+b);case u:return c.name==b.name&&c.message==b.message;case q:case F:return c==b+"";case x:var ie=nt;case D:var xe=P&n;if(ie||(ie=je),c.size!=b.size&&!xe)return!1;var fe=de.get(c);if(fe)return fe==b;P|=o,de.set(c,b);var Te=Rr(ie(c),ie(b),P,se,J,de);return de.delete(c),Te;case T:if(Ir)return Ir.call(c)==Ir.call(b)}return!1}function Fa(c,b,E,P,se,J){var de=E&n,ie=Ut(c),xe=ie.length,fe=Ut(b),Te=fe.length;if(xe!=Te&&!de)return!1;for(var Me=xe;Me--;){var ve=ie[Me];if(!(de?ve in b:$e.call(b,ve)))return!1}var Se=J.get(c);if(Se&&J.get(b))return Se==b;var _e=!0;J.set(c,b),J.set(b,c);for(var Ct=de;++Me<xe;){ve=ie[Me];var pt=c[ve],Bt=b[ve];if(P)var zi=de?P(Bt,pt,ve,b,c,J):P(pt,Bt,ve,c,b,J);if(!(zi===void 0?pt===Bt||se(pt,Bt,E,P,J):zi)){_e=!1;break}Ct||(Ct=ve=="constructor")}if(_e&&!Ct){var js=c.constructor,Es=b.constructor;js!=Es&&"constructor"in c&&"constructor"in b&&!(typeof js=="function"&&js instanceof js&&typeof Es=="function"&&Es instanceof Es)&&(_e=!1)}return J.delete(c),J.delete(b),_e}function Ut(c){return Or(c,Dr,Ua)}function Ge(c,b){var E=c.__data__;return za(b)?E[typeof b=="string"?"string":"hash"]:E.map}function gt(c,b){var E=_t(c,b);return Ma(E)?E:void 0}function mt(c){var b=$e.call(c,Ve),E=c[Ve];try{c[Ve]=void 0;var P=!0}catch{}var se=ds.call(c);return P&&(b?c[Ve]=E:delete c[Ve]),se}var Ua=ar?function(c){return c==null?[]:(c=Object(c),z(ar(c),function(b){return sr.call(c,b)}))}:Ka,lt=Ft;(Tr&&lt(new Tr(new ArrayBuffer(1)))!=j||$t&&lt(new $t)!=x||Sr&&lt(Sr.resolve())!=k||kr&&lt(new kr)!=D||qr&&lt(new qr)!=O)&&(lt=function(c){var b=Ft(c),E=b==v?c.constructor:void 0,P=E?qe(E):"";if(P)switch(P){case hs:return j;case ft:return x;case ha:return k;case fa:return D;case ga:return O}return b});function Ba(c,b){return b=b??i,!!b&&(typeof c=="number"||te.test(c))&&c>-1&&c%1==0&&c<b}function za(c){var b=typeof c;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?c!=="__proto__":c===null}function Ha(c){return!!cs&&cs in c}function Va(c){var b=c&&c.constructor,E=typeof b=="function"&&b.prototype||Mt;return c===E}function bs(c){return ds.call(c)}function qe(c){if(c!=null){try{return _r.call(c)}catch{}try{return c+""}catch{}}return""}function xs(c,b){return c===b||c!==c&&b!==b}var ys=ms((function(){return arguments})())?ms:function(c){return ct(c)&&$e.call(c,"callee")&&!sr.call(c,"callee")},lr=Array.isArray;function Mr(c){return c!=null&&Pr(c.length)&&!vs(c)}var cr=Cr||Wa;function Ga(c,b){return ps(c,b)}function vs(c){if(!ws(c))return!1;var b=Ft(c);return b==g||b==y||b==h||b==_}function Pr(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=i}function ws(c){var b=typeof c;return c!=null&&(b=="object"||b=="function")}function ct(c){return c!=null&&typeof c=="object"}var Ns=be?at(be):Pa;function Dr(c){return Mr(c)?Oa(c):Da(c)}function Ka(){return[]}function Wa(){return!1}r.exports=Ga})(Vr,Vr.exports)),Vr.exports}var ks={},dd;function u1(){if(dd)return ks;dd=1,Object.defineProperty(ks,"__esModule",{value:!0});const r=Du(),e=$u();var t;return(function(s){function n(d={},h={},f=!1){typeof d!="object"&&(d={}),typeof h!="object"&&(h={});let m=r(h);f||(m=Object.keys(m).reduce((u,g)=>(m[g]!=null&&(u[g]=m[g]),u),{}));for(const u in d)d[u]!==void 0&&h[u]===void 0&&(m[u]=d[u]);return Object.keys(m).length>0?m:void 0}s.compose=n;function o(d={},h={}){typeof d!="object"&&(d={}),typeof h!="object"&&(h={});const f=Object.keys(d).concat(Object.keys(h)).reduce((m,u)=>(e(d[u],h[u])||(m[u]=h[u]===void 0?null:h[u]),m),{});return Object.keys(f).length>0?f:void 0}s.diff=o;function i(d={},h={}){d=d||{};const f=Object.keys(h).reduce((m,u)=>(h[u]!==d[u]&&d[u]!==void 0&&(m[u]=h[u]),m),{});return Object.keys(d).reduce((m,u)=>(d[u]!==h[u]&&h[u]===void 0&&(m[u]=null),m),f)}s.invert=i;function l(d,h,f=!1){if(typeof d!="object")return h;if(typeof h!="object")return;if(!f)return h;const m=Object.keys(h).reduce((u,g)=>(d[g]===void 0&&(u[g]=h[g]),u),{});return Object.keys(m).length>0?m:void 0}s.transform=l})(t||(t={})),ks.default=t,ks}var qs={},ud;function Fu(){if(ud)return qs;ud=1,Object.defineProperty(qs,"__esModule",{value:!0});var r;return(function(e){function t(s){return typeof s.delete=="number"?s.delete:typeof s.retain=="number"?s.retain:typeof s.retain=="object"&&s.retain!==null?1:typeof s.insert=="string"?s.insert.length:1}e.length=t})(r||(r={})),qs.default=r,qs}var Is={},hd;function h1(){if(hd)return Is;hd=1,Object.defineProperty(Is,"__esModule",{value:!0});const r=Fu();class e{constructor(s){this.ops=s,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(s){s||(s=1/0);const n=this.ops[this.index];if(n){const o=this.offset,i=r.default.length(n);if(s>=i-o?(s=i-o,this.index+=1,this.offset=0):this.offset+=s,typeof n.delete=="number")return{delete:s};{const l={};return n.attributes&&(l.attributes=n.attributes),typeof n.retain=="number"?l.retain=s:typeof n.retain=="object"&&n.retain!==null?l.retain=n.retain:typeof n.insert=="string"?l.insert=n.insert.substr(o,s):l.insert=n.insert,l}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?r.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const s=this.ops[this.index];return s?typeof s.delete=="number"?"delete":typeof s.retain=="number"||typeof s.retain=="object"&&s.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const s=this.offset,n=this.index,o=this.next(),i=this.ops.slice(this.index);return this.offset=s,this.index=n,[o].concat(i)}}else return[]}}return Is.default=e,Is}var fd;function f1(){return fd||(fd=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=d1(),s=Du(),n=$u(),o=u1();e.AttributeMap=o.default;const i=Fu();e.Op=i.default;const l=h1();e.OpIterator=l.default;const d="\0",h=(m,u)=>{if(typeof m!="object"||m===null)throw new Error(`cannot retain a ${typeof m}`);if(typeof u!="object"||u===null)throw new Error(`cannot retain a ${typeof u}`);const g=Object.keys(m)[0];if(!g||g!==Object.keys(u)[0])throw new Error(`embed types not matched: ${g} != ${Object.keys(u)[0]}`);return[g,m[g],u[g]]};class f{constructor(u){Array.isArray(u)?this.ops=u:u!=null&&Array.isArray(u.ops)?this.ops=u.ops:this.ops=[]}static registerEmbed(u,g){this.handlers[u]=g}static unregisterEmbed(u){delete this.handlers[u]}static getHandler(u){const g=this.handlers[u];if(!g)throw new Error(`no handlers for embed type "${u}"`);return g}insert(u,g){const y={};return typeof u=="string"&&u.length===0?this:(y.insert=u,g!=null&&typeof g=="object"&&Object.keys(g).length>0&&(y.attributes=g),this.push(y))}delete(u){return u<=0?this:this.push({delete:u})}retain(u,g){if(typeof u=="number"&&u<=0)return this;const y={retain:u};return g!=null&&typeof g=="object"&&Object.keys(g).length>0&&(y.attributes=g),this.push(y)}push(u){let g=this.ops.length,y=this.ops[g-1];if(u=s(u),typeof y=="object"){if(typeof u.delete=="number"&&typeof y.delete=="number")return this.ops[g-1]={delete:y.delete+u.delete},this;if(typeof y.delete=="number"&&u.insert!=null&&(g-=1,y=this.ops[g-1],typeof y!="object"))return this.ops.unshift(u),this;if(n(u.attributes,y.attributes)){if(typeof u.insert=="string"&&typeof y.insert=="string")return this.ops[g-1]={insert:y.insert+u.insert},typeof u.attributes=="object"&&(this.ops[g-1].attributes=u.attributes),this;if(typeof u.retain=="number"&&typeof y.retain=="number")return this.ops[g-1]={retain:y.retain+u.retain},typeof u.attributes=="object"&&(this.ops[g-1].attributes=u.attributes),this}}return g===this.ops.length?this.ops.push(u):this.ops.splice(g,0,u),this}chop(){const u=this.ops[this.ops.length-1];return u&&typeof u.retain=="number"&&!u.attributes&&this.ops.pop(),this}filter(u){return this.ops.filter(u)}forEach(u){this.ops.forEach(u)}map(u){return this.ops.map(u)}partition(u){const g=[],y=[];return this.forEach(x=>{(u(x)?g:y).push(x)}),[g,y]}reduce(u,g){return this.ops.reduce(u,g)}changeLength(){return this.reduce((u,g)=>g.insert?u+i.default.length(g):g.delete?u-g.delete:u,0)}length(){return this.reduce((u,g)=>u+i.default.length(g),0)}slice(u=0,g=1/0){const y=[],x=new l.default(this.ops);let A=0;for(;A<g&&x.hasNext();){let C;A<u?C=x.next(u-A):(C=x.next(g-A),y.push(C)),A+=i.default.length(C)}return new f(y)}compose(u){const g=new l.default(this.ops),y=new l.default(u.ops),x=[],A=y.peek();if(A!=null&&typeof A.retain=="number"&&A.attributes==null){let v=A.retain;for(;g.peekType()==="insert"&&g.peekLength()<=v;)v-=g.peekLength(),x.push(g.next());A.retain-v>0&&y.next(A.retain-v)}const C=new f(x);for(;g.hasNext()||y.hasNext();)if(y.peekType()==="insert")C.push(y.next());else if(g.peekType()==="delete")C.push(g.next());else{const v=Math.min(g.peekLength(),y.peekLength()),k=g.next(v),_=y.next(v);if(_.retain){const q={};if(typeof k.retain=="number")q.retain=typeof _.retain=="number"?v:_.retain;else if(typeof _.retain=="number")k.retain==null?q.insert=k.insert:q.retain=k.retain;else{const F=k.retain==null?"insert":"retain",[T,V,O]=h(k[F],_.retain),p=f.getHandler(T);q[F]={[T]:p.compose(V,O,F==="retain")}}const D=o.default.compose(k.attributes,_.attributes,typeof k.retain=="number");if(D&&(q.attributes=D),C.push(q),!y.hasNext()&&n(C.ops[C.ops.length-1],q)){const F=new f(g.rest());return C.concat(F).chop()}}else typeof _.delete=="number"&&(typeof k.retain=="number"||typeof k.retain=="object"&&k.retain!==null)&&C.push(_)}return C.chop()}concat(u){const g=new f(this.ops.slice());return u.ops.length>0&&(g.push(u.ops[0]),g.ops=g.ops.concat(u.ops.slice(1))),g}diff(u,g){if(this.ops===u.ops)return new f;const y=[this,u].map(k=>k.map(_=>{if(_.insert!=null)return typeof _.insert=="string"?_.insert:d;const q=k===u?"on":"with";throw new Error("diff() called "+q+" non-document")}).join("")),x=new f,A=t(y[0],y[1],g,!0),C=new l.default(this.ops),v=new l.default(u.ops);return A.forEach(k=>{let _=k[1].length;for(;_>0;){let q=0;switch(k[0]){case t.INSERT:q=Math.min(v.peekLength(),_),x.push(v.next(q));break;case t.DELETE:q=Math.min(_,C.peekLength()),C.next(q),x.delete(q);break;case t.EQUAL:q=Math.min(C.peekLength(),v.peekLength(),_);const D=C.next(q),F=v.next(q);n(D.insert,F.insert)?x.retain(q,o.default.diff(D.attributes,F.attributes)):x.push(F).delete(q);break}_-=q}}),x.chop()}eachLine(u,g=`
`){const y=new l.default(this.ops);let x=new f,A=0;for(;y.hasNext();){if(y.peekType()!=="insert")return;const C=y.peek(),v=i.default.length(C)-y.peekLength(),k=typeof C.insert=="string"?C.insert.indexOf(g,v)-v:-1;if(k<0)x.push(y.next());else if(k>0)x.push(y.next(k));else{if(u(x,y.next(1).attributes||{},A)===!1)return;A+=1,x=new f}}x.length()>0&&u(x,{},A)}invert(u){const g=new f;return this.reduce((y,x)=>{if(x.insert)g.delete(i.default.length(x));else{if(typeof x.retain=="number"&&x.attributes==null)return g.retain(x.retain),y+x.retain;if(x.delete||typeof x.retain=="number"){const A=x.delete||x.retain;return u.slice(y,y+A).forEach(v=>{x.delete?g.push(v):x.retain&&x.attributes&&g.retain(i.default.length(v),o.default.invert(x.attributes,v.attributes))}),y+A}else if(typeof x.retain=="object"&&x.retain!==null){const A=u.slice(y,y+1),C=new l.default(A.ops).next(),[v,k,_]=h(x.retain,C.insert),q=f.getHandler(v);return g.retain({[v]:q.invert(k,_)},o.default.invert(x.attributes,C.attributes)),y+1}}return y},0),g.chop()}transform(u,g=!1){if(g=!!g,typeof u=="number")return this.transformPosition(u,g);const y=u,x=new l.default(this.ops),A=new l.default(y.ops),C=new f;for(;x.hasNext()||A.hasNext();)if(x.peekType()==="insert"&&(g||A.peekType()!=="insert"))C.retain(i.default.length(x.next()));else if(A.peekType()==="insert")C.push(A.next());else{const v=Math.min(x.peekLength(),A.peekLength()),k=x.next(v),_=A.next(v);if(k.delete)continue;if(_.delete)C.push(_);else{const q=k.retain,D=_.retain;let F=typeof D=="object"&&D!==null?D:v;if(typeof q=="object"&&q!==null&&typeof D=="object"&&D!==null){const T=Object.keys(q)[0];if(T===Object.keys(D)[0]){const V=f.getHandler(T);V&&(F={[T]:V.transform(q[T],D[T],g)})}}C.retain(F,o.default.transform(k.attributes,_.attributes,g))}}return C.chop()}transformPosition(u,g=!1){g=!!g;const y=new l.default(this.ops);let x=0;for(;y.hasNext()&&x<=u;){const A=y.peekLength(),C=y.peekType();if(y.next(),C==="delete"){u-=Math.min(A,u-x);continue}else C==="insert"&&(x<u||!g)&&(u+=A);x+=A}return u}}f.Op=i.default,f.OpIterator=l.default,f.AttributeMap=o.default,f.handlers={},e.default=f,r.exports=f,r.exports.default=f})(Ss,Ss.exports)),Ss.exports}var Le=f1();const Y=$d(Le);class rt extends De{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}rt.blotName="break";rt.tagName="BR";let Je=class extends Vs{};const g1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function la(r){return r.replace(/[&<>"']/g,e=>g1[e])}class Ie extends Ci{static allowedChildren=[Ie,rt,De,Je];static order=["cursor","inline","link","underline","strike","italic","bold","script","code"];static compare(e,t){const s=Ie.order.indexOf(e),n=Ie.order.indexOf(t);return s>=0||n>=0?s-n:e===t?0:e<t?-1:1}formatAt(e,t,s,n){if(Ie.compare(this.statics.blotName,s)<0&&this.scroll.query(s,Q.BLOT)){const o=this.isolate(e,t);n&&o.wrap(s,n)}else super.formatAt(e,t,s,n)}optimize(e){if(super.optimize(e),this.parent instanceof Ie&&Ie.compare(this.statics.blotName,this.parent.statics.blotName)>0){const t=this.parent.isolate(this.offset(),this.length());this.moveChildren(t),t.wrap(this)}}}const gd=1;class Ae extends es{cache={};delta(){return this.cache.delta==null&&(this.cache.delta=Uu(this)),this.cache.delta}deleteAt(e,t){super.deleteAt(e,t),this.cache={}}formatAt(e,t,s,n){t<=0||(this.scroll.query(s,Q.BLOCK)?e+t===this.length()&&this.format(s,n):super.formatAt(e,Math.min(t,this.length()-e-1),s,n),this.cache={})}insertAt(e,t,s){if(s!=null){super.insertAt(e,t,s),this.cache={};return}if(t.length===0)return;const n=t.split(`
`),o=n.shift();o.length>0&&(e<this.length()-1||this.children.tail==null?super.insertAt(Math.min(e,this.length()-1),o):this.children.tail.insertAt(this.children.tail.length(),o),this.cache={});let i=this;n.reduce((l,d)=>(i=i.split(l,!0),i.insertAt(0,d),d.length),e+o.length)}insertBefore(e,t){const{head:s}=this.children;super.insertBefore(e,t),s instanceof rt&&s.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+gd),this.cache.length}moveChildren(e,t){super.moveChildren(e,t),this.cache={}}optimize(e){super.optimize(e),this.cache={}}path(e){return super.path(e,!0)}removeChild(e){super.removeChild(e),this.cache={}}split(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t&&(e===0||e>=this.length()-gd)){const n=this.clone();return e===0?(this.parent.insertBefore(n,this),this):(this.parent.insertBefore(n,this.next),n)}const s=super.split(e,t);return this.cache={},s}}Ae.blotName="block";Ae.tagName="P";Ae.defaultChild=rt;Ae.allowedChildren=[rt,Ie,De,Je];class Be extends De{attach(){super.attach(),this.attributes=new oa(this.domNode)}delta(){return new Y().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,t){const s=this.scroll.query(e,Q.BLOCK_ATTRIBUTE);s!=null&&this.attributes.attribute(s,t)}formatAt(e,t,s,n){this.format(s,n)}insertAt(e,t,s){if(s!=null){super.insertAt(e,t,s);return}const n=t.split(`
`),o=n.pop(),i=n.map(d=>{const h=this.scroll.create(Ae.blotName);return h.insertAt(0,d),h}),l=this.split(e);i.forEach(d=>{this.parent.insertBefore(d,l)}),o&&this.parent.insertBefore(this.scroll.create("text",o),l)}}Be.scope=Q.BLOCK_BLOT;function Uu(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r.descendants(ke).reduce((t,s)=>s.length()===0?t:t.insert(s.value(),Fe(s,{},e)),new Y).insert(`
`,Fe(r))}function Fe(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return r==null||("formats"in r&&typeof r.formats=="function"&&(e={...e,...r.formats()},t&&delete e["code-token"]),r.parent==null||r.parent.statics.blotName==="scroll"||r.parent.statics.scope!==r.statics.scope)?e:Fe(r.parent,e,t)}class Xe extends De{static blotName="cursor";static className="ql-cursor";static tagName="span";static CONTENTS="\uFEFF";static value(){}constructor(e,t,s){super(e,t),this.selection=s,this.textNode=document.createTextNode(Xe.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,t){if(this.savedLength!==0){super.format(e,t);return}let s=this,n=0;for(;s!=null&&s.statics.scope!==Q.BLOCK_BLOT;)n+=s.offset(s.parent),s=s.parent;s!=null&&(this.savedLength=Xe.CONTENTS.length,s.optimize(),s.formatAt(n,Xe.CONTENTS.length,e,t),this.savedLength=0)}index(e,t){return e===this.textNode?0:super.index(e,t)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const t=this.prev instanceof Je?this.prev:null,s=t?t.length():0,n=this.next instanceof Je?this.next:null,o=n?n.text:"",{textNode:i}=this,l=i.data.split(Xe.CONTENTS).join("");i.data=Xe.CONTENTS;let d;if(t)d=t,(l||n)&&(t.insertAt(t.length(),l+o),n&&n.remove());else if(n)d=n,n.insertAt(0,l);else{const h=document.createTextNode(l);d=this.scroll.create(h),this.parent.insertBefore(d,this)}if(this.remove(),e){const h=(u,g)=>t&&u===t.domNode?g:u===i?s+g-1:n&&u===n.domNode?s+l.length+g:null,f=h(e.start.node,e.start.offset),m=h(e.end.node,e.end.offset);if(f!==null&&m!==null)return{startNode:d.domNode,startOffset:f,endNode:d.domNode,endOffset:m}}return null}update(e,t){if(e.some(s=>s.type==="characterData"&&s.target===this.textNode)){const s=this.restore();s&&(t.range=s)}}optimize(e){super.optimize(e);let{parent:t}=this;for(;t;){if(t.domNode.tagName==="A"){this.savedLength=Xe.CONTENTS.length,t.isolate(this.offset(t),this.length()).unwrap(),this.savedLength=0;break}t=t.parent}}value(){return""}}const ii=new WeakMap,li=["error","warn","log","info"];let ci="warn";function Bu(r){if(ci&&li.indexOf(r)<=li.indexOf(ci)){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];console[r](...t)}}function jt(r){return li.reduce((e,t)=>(e[t]=Bu.bind(console,t,r),e),{})}jt.level=r=>{ci=r};Bu.level=jt.level;const Do=jt("quill:events"),m1=["selectionchange","mousedown","mouseup","click"];m1.forEach(r=>{document.addEventListener(r,function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];Array.from(document.querySelectorAll(".ql-container")).forEach(n=>{const o=ii.get(n);o&&o.emitter&&o.emitter.handleDOM(...t)})})});class Z extends bf{static events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"};static sources={API:"api",SILENT:"silent",USER:"user"};constructor(){super(),this.domListeners={},this.on("error",Do.error)}emit(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Do.log.call(Do,...t),super.emit(...t)}handleDOM(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];(this.domListeners[e.type]||[]).forEach(o=>{let{node:i,handler:l}=o;(e.target===i||i.contains(e.target))&&l(e,...s)})}listenDOM(e,t,s){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:t,handler:s})}}const $o=jt("quill:selection");class Lt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=t}}class p1{constructor(e,t){this.emitter=t,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new Lt(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,Z.sources.USER),1)}),this.emitter.on(Z.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const s=this.getNativeRange();s!=null&&s.start.node!==this.cursor.textNode&&this.emitter.once(Z.events.SCROLL_UPDATE,(n,o)=>{try{this.root.contains(s.start.node)&&this.root.contains(s.end.node)&&this.setNativeRange(s.start.node,s.start.offset,s.end.node,s.end.offset);const i=o.some(l=>l.type==="characterData"||l.type==="childList"||l.type==="attributes"&&l.target===this.root);this.update(i?Z.sources.SILENT:n)}catch{}})}),this.emitter.on(Z.events.SCROLL_OPTIMIZE,(s,n)=>{if(n.range){const{startNode:o,startOffset:i,endNode:l,endOffset:d}=n.range;this.setNativeRange(o,i,l,d),this.update(Z.sources.SILENT)}}),this.update(Z.sources.SILENT)}handleComposition(){this.emitter.on(Z.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(Z.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(Z.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,t){this.scroll.update();const s=this.getNativeRange();if(!(s==null||!s.native.collapsed||this.scroll.query(e,Q.BLOCK))){if(s.start.node!==this.cursor.textNode){const n=this.scroll.find(s.start.node,!1);if(n==null)return;if(n instanceof ke){const o=n.split(s.start.offset);n.parent.insertBefore(this.cursor,o)}else n.insertBefore(this.cursor,s.start.node);this.cursor.attach()}this.cursor.format(e,t),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const s=this.scroll.length();e=Math.min(e,s-1),t=Math.min(e+t,s-1)-e;let n,[o,i]=this.scroll.leaf(e);if(o==null)return null;if(t>0&&i===o.length()){const[f]=this.scroll.leaf(e+1);if(f){const[m]=this.scroll.line(e),[u]=this.scroll.line(e+1);m===u&&(o=f,i=0)}}[n,i]=o.position(i,!0);const l=document.createRange();if(t>0)return l.setStart(n,i),[o,i]=this.scroll.leaf(e+t),o==null?null:([n,i]=o.position(i,!0),l.setEnd(n,i),l.getBoundingClientRect());let d="left",h;if(n instanceof Text){if(!n.data.length)return null;i<n.data.length?(l.setStart(n,i),l.setEnd(n,i+1)):(l.setStart(n,i-1),l.setEnd(n,i),d="right"),h=l.getBoundingClientRect()}else{if(!(o.domNode instanceof Element))return null;h=o.domNode.getBoundingClientRect(),i>0&&(d="right")}return{bottom:h.top+h.height,height:h.height,left:h[d],right:h[d],top:h.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const t=e.getRangeAt(0);if(t==null)return null;const s=this.normalizeNative(t);return $o.info("getNativeRange",s),s}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const t=this.getNativeRange();return t==null?[null,null]:[this.normalizedToRange(t),t]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&Fo(this.root,document.activeElement)}normalizedToRange(e){const t=[[e.start.node,e.start.offset]];e.native.collapsed||t.push([e.end.node,e.end.offset]);const s=t.map(i=>{const[l,d]=i,h=this.scroll.find(l,!0),f=h.offset(this.scroll);return d===0?f:h instanceof ke?f+h.index(l,d):f+h.length()}),n=Math.min(Math.max(...s),this.scroll.length()-1),o=Math.min(n,...s);return new Lt(o,n-o)}normalizeNative(e){if(!Fo(this.root,e.startContainer)||!e.collapsed&&!Fo(this.root,e.endContainer))return null;const t={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[t.start,t.end].forEach(s=>{let{node:n,offset:o}=s;for(;!(n instanceof Text)&&n.childNodes.length>0;)if(n.childNodes.length>o)n=n.childNodes[o],o=0;else if(n.childNodes.length===o)n=n.lastChild,n instanceof Text?o=n.data.length:n.childNodes.length>0?o=n.childNodes.length:o=n.childNodes.length+1;else break;s.node=n,s.offset=o}),t}rangeToNative(e){const t=this.scroll.length(),s=(n,o)=>{n=Math.min(t-1,n);const[i,l]=this.scroll.leaf(n);return i?i.position(l,o):[null,-1]};return[...s(e.index,!1),...s(e.index+e.length,!0)]}setNativeRange(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:t,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if($o.info("setNativeRange",e,t,s,n),e!=null&&(this.root.parentNode==null||e.parentNode==null||s.parentNode==null))return;const i=document.getSelection();if(i!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:l}=this.getNativeRange()||{};if(l==null||o||e!==l.startContainer||t!==l.startOffset||s!==l.endContainer||n!==l.endOffset){e instanceof Element&&e.tagName==="BR"&&(t=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),s instanceof Element&&s.tagName==="BR"&&(n=Array.from(s.parentNode.childNodes).indexOf(s),s=s.parentNode);const d=document.createRange();d.setStart(e,t),d.setEnd(s,n),i.removeAllRanges(),i.addRange(d)}}else i.removeAllRanges(),this.root.blur()}setRange(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Z.sources.API;if(typeof t=="string"&&(s=t,t=!1),$o.info("setRange",e),e!=null){const n=this.rangeToNative(e);this.setNativeRange(...n,t)}else this.setNativeRange(null);this.update(s)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z.sources.USER;const t=this.lastRange,[s,n]=this.getRange();if(this.lastRange=s,this.lastNative=n,this.lastRange!=null&&(this.savedRange=this.lastRange),!Ai(t,this.lastRange)){if(!this.composing&&n!=null&&n.native.collapsed&&n.start.node!==this.cursor.textNode){const i=this.cursor.restore();i&&this.setNativeRange(i.startNode,i.startOffset,i.endNode,i.endOffset)}const o=[Z.events.SELECTION_CHANGE,pr(this.lastRange),pr(t),e];this.emitter.emit(Z.events.EDITOR_CHANGE,...o),e!==Z.sources.SILENT&&this.emitter.emit(...o)}}}function Fo(r,e){try{e.parentNode}catch{return!1}return r.contains(e)}const b1=/^[ -~]*$/;class x1{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let t=this.scroll.length();this.scroll.batchStart();const s=md(e),n=new Y;return v1(s.ops.slice()).reduce((i,l)=>{const d=Le.Op.length(l);let h=l.attributes||{},f=!1,m=!1;if(l.insert!=null){if(n.retain(d),typeof l.insert=="string"){const y=l.insert;m=!y.endsWith(`
`)&&(t<=i||!!this.scroll.descendant(Be,i)[0]),this.scroll.insertAt(i,y);const[x,A]=this.scroll.line(i);let C=kt({},Fe(x));if(x instanceof Ae){const[v]=x.descendant(ke,A);v&&(C=kt(C,Fe(v)))}h=Le.AttributeMap.diff(C,h)||{}}else if(typeof l.insert=="object"){const y=Object.keys(l.insert)[0];if(y==null)return i;const x=this.scroll.query(y,Q.INLINE)!=null;if(x)(t<=i||this.scroll.descendant(Be,i)[0])&&(m=!0);else if(i>0){const[A,C]=this.scroll.descendant(ke,i-1);A instanceof Je?A.value()[C]!==`
`&&(f=!0):A instanceof De&&A.statics.scope===Q.INLINE_BLOT&&(f=!0)}if(this.scroll.insertAt(i,y,l.insert[y]),x){const[A]=this.scroll.descendant(ke,i);if(A){const C=kt({},Fe(A));h=Le.AttributeMap.diff(C,h)||{}}}}t+=d}else if(n.push(l),l.retain!==null&&typeof l.retain=="object"){const y=Object.keys(l.retain)[0];if(y==null)return i;this.scroll.updateEmbedAt(i,y,l.retain[y])}Object.keys(h).forEach(y=>{this.scroll.formatAt(i,d,y,h[y])});const u=f?1:0,g=m?1:0;return t+=u+g,n.retain(u),n.delete(g),i+d+u+g},0),n.reduce((i,l)=>typeof l.delete=="number"?(this.scroll.deleteAt(i,l.delete),i):i+Le.Op.length(l),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(s)}deleteText(e,t){return this.scroll.deleteAt(e,t),this.update(new Y().retain(e).delete(t))}formatLine(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(s).forEach(o=>{this.scroll.lines(e,Math.max(t,1)).forEach(i=>{i.format(o,s[o])})}),this.scroll.optimize();const n=new Y().retain(e).retain(t,pr(s));return this.update(n)}formatText(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(s).forEach(o=>{this.scroll.formatAt(e,t,o,s[o])});const n=new Y().retain(e).retain(t,pr(s));return this.update(n)}getContents(e,t){return this.delta.slice(e,e+t)}getDelta(){return this.scroll.lines().reduce((e,t)=>e.concat(t.delta()),new Y)}getFormat(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=[],n=[];t===0?this.scroll.path(e).forEach(l=>{const[d]=l;d instanceof Ae?s.push(d):d instanceof ke&&n.push(d)}):(s=this.scroll.lines(e,t),n=this.scroll.descendants(ke,e,t));const[o,i]=[s,n].map(l=>{const d=l.shift();if(d==null)return{};let h=Fe(d);for(;Object.keys(h).length>0;){const f=l.shift();if(f==null)return h;h=y1(Fe(f),h)}return h});return{...o,...i}}getHTML(e,t){const[s,n]=this.scroll.line(e);if(s){const o=s.length();return s.length()>=n+t&&!(n===0&&t===o)?ts(s,n,t,!0):ts(this.scroll,e,t,!0)}return""}getText(e,t){return this.getContents(e,t).filter(s=>typeof s.insert=="string").map(s=>s.insert).join("")}insertContents(e,t){const s=md(t),n=new Y().retain(e).concat(s);return this.scroll.insertContents(e,s),this.update(n)}insertEmbed(e,t,s){return this.scroll.insertAt(e,t,s),this.update(new Y().retain(e).insert({[t]:s}))}insertText(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,t),Object.keys(s).forEach(n=>{this.scroll.formatAt(e,t.length,n,s[n])}),this.update(new Y().retain(e).insert(t,pr(s)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if(e?.statics.blotName!==Ae.blotName)return!1;const t=e;return t.children.length>1?!1:t.children.head instanceof rt}removeFormat(e,t){const s=this.getText(e,t),[n,o]=this.scroll.line(e+t);let i=0,l=new Y;n!=null&&(i=n.length()-o,l=n.delta().slice(o,o+i-1).insert(`
`));const h=this.getContents(e,t+i).diff(new Y().insert(s).concat(l)),f=new Y().retain(e).concat(h);return this.applyDelta(f)}update(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const n=this.delta;if(t.length===1&&t[0].type==="characterData"&&t[0].target.data.match(b1)&&this.scroll.find(t[0].target)){const o=this.scroll.find(t[0].target),i=Fe(o),l=o.offset(this.scroll),d=t[0].oldValue.replace(Xe.CONTENTS,""),h=new Y().insert(d),f=new Y().insert(o.value()),m=s&&{oldRange:pd(s.oldRange,-l),newRange:pd(s.newRange,-l)};e=new Y().retain(l).concat(h.diff(f,m)).reduce((g,y)=>y.insert?g.insert(y.insert,i):g.push(y),new Y),this.delta=n.compose(e)}else this.delta=this.getDelta(),(!e||!Ai(n.compose(e),this.delta))&&(e=n.diff(this.delta,s));return e}}function gr(r,e,t){if(r.length===0){const[g]=Uo(t.pop());return e<=0?`</li></${g}>`:`</li></${g}>${gr([],e-1,t)}`}const[{child:s,offset:n,length:o,indent:i,type:l},...d]=r,[h,f]=Uo(l);if(i>e)return t.push(l),i===e+1?`<${h}><li${f}>${ts(s,n,o)}${gr(d,i,t)}`:`<${h}><li>${gr(r,e+1,t)}`;const m=t[t.length-1];if(i===e&&l===m)return`</li><li${f}>${ts(s,n,o)}${gr(d,i,t)}`;const[u]=Uo(t.pop());return`</li></${u}>${gr(r,e-1,t)}`}function ts(r,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in r&&typeof r.html=="function")return r.html(e,t);if(r instanceof Je)return la(r.value().slice(e,e+t)).replaceAll(" ","&nbsp;");if(r instanceof Qe){if(r.statics.blotName==="list-container"){const h=[];return r.children.forEachAt(e,t,(f,m,u)=>{const g="formats"in f&&typeof f.formats=="function"?f.formats():{};h.push({child:f,offset:m,length:u,indent:g.indent||0,type:g.list})}),gr(h,-1,[])}const n=[];if(r.children.forEachAt(e,t,(h,f,m)=>{n.push(ts(h,f,m))}),s||r.statics.blotName==="list")return n.join("");const{outerHTML:o,innerHTML:i}=r.domNode,[l,d]=o.split(`>${i}<`);return l==="<table"?`<table style="border: 1px solid #000;">${n.join("")}<${d}`:`${l}>${n.join("")}<${d}`}return r.domNode instanceof Element?r.domNode.outerHTML:""}function y1(r,e){return Object.keys(e).reduce((t,s)=>{if(r[s]==null)return t;const n=e[s];return n===r[s]?t[s]=n:Array.isArray(n)?n.indexOf(r[s])<0?t[s]=n.concat([r[s]]):t[s]=n:t[s]=[n,r[s]],t},{})}function Uo(r){const e=r==="ordered"?"ol":"ul";switch(r){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function md(r){return r.reduce((e,t)=>{if(typeof t.insert=="string"){const s=t.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(s,t.attributes)}return e.push(t)},new Y)}function pd(r,e){let{index:t,length:s}=r;return new Lt(t+e,s)}function v1(r){const e=[];return r.forEach(t=>{typeof t.insert=="string"?t.insert.split(`
`).forEach((n,o)=>{o&&e.push({insert:`
`,attributes:t.attributes}),n&&e.push({insert:n,attributes:t.attributes})}):e.push(t)}),e}class st{static DEFAULTS={};constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=t}}const Ls="\uFEFF";class Si extends De{constructor(e,t){super(e,t),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(s=>{this.contentNode.appendChild(s)}),this.leftGuard=document.createTextNode(Ls),this.rightGuard=document.createTextNode(Ls),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,t){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,t)}restore(e){let t=null,s;const n=e.data.split(Ls).join("");if(e===this.leftGuard)if(this.prev instanceof Je){const o=this.prev.length();this.prev.insertAt(o,n),t={startNode:this.prev.domNode,startOffset:o+n.length}}else s=document.createTextNode(n),this.parent.insertBefore(this.scroll.create(s),this),t={startNode:s,startOffset:n.length};else e===this.rightGuard&&(this.next instanceof Je?(this.next.insertAt(0,n),t={startNode:this.next.domNode,startOffset:n.length}):(s=document.createTextNode(n),this.parent.insertBefore(this.scroll.create(s),this.next),t={startNode:s,startOffset:n.length}));return e.data=Ls,t}update(e,t){e.forEach(s=>{if(s.type==="characterData"&&(s.target===this.leftGuard||s.target===this.rightGuard)){const n=this.restore(s.target);n&&(t.range=n)}})}}class w1{isComposing=!1;constructor(e,t){this.scroll=e,this.emitter=t,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const t=e.target instanceof Node?this.scroll.find(e.target,!0):null;t&&!(t instanceof Si)&&(this.emitter.emit(Z.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(Z.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(Z.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(Z.events.COMPOSITION_END,e),this.isComposing=!1}}class Er{static DEFAULTS={modules:{}};static themes={default:Er};modules={};constructor(e,t){this.quill=e,this.options=t}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const t=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new t(this.quill,this.options.modules[e]||{}),this.modules[e]}}const N1=r=>r.parentElement||r.getRootNode().host||null,j1=r=>{const e=r.getBoundingClientRect(),t="offsetWidth"in r&&Math.abs(e.width)/r.offsetWidth||1,s="offsetHeight"in r&&Math.abs(e.height)/r.offsetHeight||1;return{top:e.top,right:e.left+r.clientWidth*t,bottom:e.top+r.clientHeight*s,left:e.left}},Os=r=>{const e=parseInt(r,10);return Number.isNaN(e)?0:e},bd=(r,e,t,s,n,o)=>r<t&&e>s?0:r<t?-(t-r+n):e>s?e-r>s-t?r+n-t:e-s+o:0,E1=(r,e)=>{const t=r.ownerDocument;let s=e,n=r;for(;n;){const o=n===t.body,i=o?{top:0,right:window.visualViewport?.width??t.documentElement.clientWidth,bottom:window.visualViewport?.height??t.documentElement.clientHeight,left:0}:j1(n),l=getComputedStyle(n),d=bd(s.left,s.right,i.left,i.right,Os(l.scrollPaddingLeft),Os(l.scrollPaddingRight)),h=bd(s.top,s.bottom,i.top,i.bottom,Os(l.scrollPaddingTop),Os(l.scrollPaddingBottom));if(d||h)if(o)t.defaultView?.scrollBy(d,h);else{const{scrollLeft:f,scrollTop:m}=n;h&&(n.scrollTop+=h),d&&(n.scrollLeft+=d);const u=n.scrollLeft-f,g=n.scrollTop-m;s={left:s.left-u,top:s.top-g,right:s.right-u,bottom:s.bottom-g}}n=o||l.position==="fixed"?null:N1(n)}},_1=100,A1=["block","break","cursor","inline","scroll","text"],C1=(r,e,t)=>{const s=new wr;return A1.forEach(n=>{const o=e.query(n);o&&s.register(o)}),r.forEach(n=>{let o=e.query(n);o||t.error(`Cannot register "${n}" specified in "formats" config. Are you sure it was registered?`);let i=0;for(;o;)if(s.register(o),o="blotName"in o?o.requiredContainer??null:null,i+=1,i>_1){t.error(`Cycle detected in registering blot requiredContainer: "${n}"`);break}}),s},xr=jt("quill"),Rs=new wr;Qe.uiClass="ql-ui";class U{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:Rs,theme:"default"};static events=Z.events;static sources=Z.sources;static version="2.0.3";static imports={delta:Y,parchment:Pu,"core/module":st,"core/theme":Er};static debug(e){e===!0&&(e="log"),jt.level(e)}static find(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return ii.get(e)||Rs.find(e,t)}static import(e){return this.imports[e]==null&&xr.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],t=!!(!(arguments.length<=1)&&arguments[1]),s="attrName"in e?e.attrName:e.blotName;typeof s=="string"?this.register(`formats/${s}`,e,t):Object.keys(e).forEach(n=>{this.register(n,e[n],t)})}else{const e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],s=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!s&&xr.warn(`Overwriting ${e} with`,t),this.imports[e]=t,(e.startsWith("blots/")||e.startsWith("formats/"))&&t&&typeof t!="boolean"&&t.blotName!=="abstract"&&Rs.register(t),typeof t.register=="function"&&t.register(Rs)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=T1(e,t),this.container=this.options.container,this.container==null){xr.error("Invalid Quill container",e);return}this.options.debug&&U.debug(this.options.debug);const s=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",ii.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new Z;const n=Ti.blotName,o=this.options.registry.query(n);if(!o||!("blotName"in o))throw new Error(`Cannot initialize Quill without "${n}" blot`);if(this.scroll=new o(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new x1(this.scroll),this.selection=new p1(this.scroll,this.emitter),this.composition=new w1(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(Z.events.EDITOR_CHANGE,i=>{i===Z.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(Z.events.SCROLL_UPDATE,(i,l)=>{const d=this.selection.lastRange,[h]=this.selection.getRange(),f=d&&h?{oldRange:d,newRange:h}:void 0;Ke.call(this,()=>this.editor.update(null,l,f),i)}),this.emitter.on(Z.events.SCROLL_EMBED_UPDATE,(i,l)=>{const d=this.selection.lastRange,[h]=this.selection.getRange(),f=d&&h?{oldRange:d,newRange:h}:void 0;Ke.call(this,()=>{const m=new Y().retain(i.offset(this)).retain({[i.statics.blotName]:l});return this.editor.update(m,[],f)},U.sources.USER)}),s){const i=this.clipboard.convert({html:`${s}<p><br></p>`,text:`
`});this.setContents(i)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const s=e;e=document.createElement("div"),e.classList.add(s)}return this.container.insertBefore(e,t),e}blur(){this.selection.setRange(null)}deleteText(e,t,s){return[e,t,,s]=bt(e,t,s),Ke.call(this,()=>this.editor.deleteText(e,t),s,e,-1*t)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const t=e();return this.allowReadOnlyEdits=!1,t}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Z.sources.API;return Ke.call(this,()=>{const n=this.getSelection(!0);let o=new Y;if(n==null)return o;if(this.scroll.query(e,Q.BLOCK))o=this.editor.formatLine(n.index,n.length,{[e]:t});else{if(n.length===0)return this.selection.format(e,t),o;o=this.editor.formatText(n.index,n.length,{[e]:t})}return this.setSelection(n,Z.sources.SILENT),o},s)}formatLine(e,t,s,n,o){let i;return[e,t,i,o]=bt(e,t,s,n,o),Ke.call(this,()=>this.editor.formatLine(e,t,i),o,e,0)}formatText(e,t,s,n,o){let i;return[e,t,i,o]=bt(e,t,s,n,o),Ke.call(this,()=>this.editor.formatText(e,t,i),o,e,0)}getBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=null;if(typeof e=="number"?s=this.selection.getBounds(e,t):s=this.selection.getBounds(e.index,e.length),!s)return null;const n=this.container.getBoundingClientRect();return{bottom:s.bottom-n.top,height:s.height,left:s.left-n.left,right:s.right-n.left,top:s.top-n.top,width:s.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,t]=bt(e,t),this.editor.getContents(e,t)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,t):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,t)}getModule(e){return this.theme.modules[e]}getSelection(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(t=t??this.getLength()-e),[e,t]=bt(e,t),this.editor.getHTML(e,t)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(t=t??this.getLength()-e),[e,t]=bt(e,t),this.editor.getText(e,t)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,t,s){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:U.sources.API;return Ke.call(this,()=>this.editor.insertEmbed(e,t,s),n,e)}insertText(e,t,s,n,o){let i;return[e,,i,o]=bt(e,0,s,n,o),Ke.call(this,()=>this.editor.insertText(e,t,i),o,e,t.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,t,s){return[e,t,,s]=bt(e,t,s),Ke.call(this,()=>this.editor.removeFormat(e,t),s,e)}scrollRectIntoView(e){E1(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,t=e&&this.selection.getBounds(e.index,e.length);t&&this.scrollRectIntoView(t)}setContents(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Z.sources.API;return Ke.call(this,()=>{e=new Y(e);const s=this.getLength(),n=this.editor.deleteText(0,s),o=this.editor.insertContents(0,e),i=this.editor.deleteText(this.getLength()-1,1);return n.compose(o).compose(i)},t)}setSelection(e,t,s){e==null?this.selection.setRange(null,t||U.sources.API):([e,t,,s]=bt(e,t,s),this.selection.setRange(new Lt(Math.max(0,e),t),s),s!==Z.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Z.sources.API;const s=new Y().insert(e);return this.setContents(s,t)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z.sources.USER;const t=this.scroll.update(e);return this.selection.update(e),t}updateContents(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Z.sources.API;return Ke.call(this,()=>(e=new Y(e),this.editor.applyDelta(e)),t,!0)}}function xd(r){return typeof r=="string"?document.querySelector(r):r}function Bo(r){return Object.entries(r??{}).reduce((e,t)=>{let[s,n]=t;return{...e,[s]:n===!0?{}:n}},{})}function yd(r){return Object.fromEntries(Object.entries(r).filter(e=>e[1]!==void 0))}function T1(r,e){const t=xd(r);if(!t)throw new Error("Invalid Quill container");const n=!e.theme||e.theme===U.DEFAULTS.theme?Er:U.import(`themes/${e.theme}`);if(!n)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:o,...i}=U.DEFAULTS,{modules:l,...d}=n.DEFAULTS;let h=Bo(e.modules);h!=null&&h.toolbar&&h.toolbar.constructor!==Object&&(h={...h,toolbar:{container:h.toolbar}});const f=kt({},Bo(o),Bo(l),h),m={...i,...yd(d),...yd(e)};let u=e.registry;return u?e.formats&&xr.warn('Ignoring "formats" option because "registry" is specified'):u=e.formats?C1(e.formats,m.registry,xr):m.registry,{...m,registry:u,container:t,theme:n,modules:Object.entries(f).reduce((g,y)=>{let[x,A]=y;if(!A)return g;const C=U.import(`modules/${x}`);return C==null?(xr.error(`Cannot load ${x} module. Are you sure you registered it?`),g):{...g,[x]:kt({},C.DEFAULTS||{},A)}},{}),bounds:xd(m.bounds)}}function Ke(r,e,t,s){if(!this.isEnabled()&&e===Z.sources.USER&&!this.allowReadOnlyEdits)return new Y;let n=t==null?null:this.getSelection();const o=this.editor.delta,i=r();if(n!=null&&(t===!0&&(t=n.index),s==null?n=vd(n,i,e):s!==0&&(n=vd(n,t,s,e)),this.setSelection(n,Z.sources.SILENT)),i.length()>0){const l=[Z.events.TEXT_CHANGE,i,o,e];this.emitter.emit(Z.events.EDITOR_CHANGE,...l),e!==Z.sources.SILENT&&this.emitter.emit(...l)}return i}function bt(r,e,t,s,n){let o={};return typeof r.index=="number"&&typeof r.length=="number"?typeof e!="number"?(n=s,s=t,t=e,e=r.length,r=r.index):(e=r.length,r=r.index):typeof e!="number"&&(n=s,s=t,t=e,e=0),typeof t=="object"?(o=t,n=s):typeof t=="string"&&(s!=null?o[t]=s:n=t),n=n||Z.sources.API,[r,e,o,n]}function vd(r,e,t,s){const n=typeof t=="number"?t:0;if(r==null)return null;let o,i;return e&&typeof e.transformPosition=="function"?[o,i]=[r.index,r.index+r.length].map(l=>e.transformPosition(l,s!==Z.sources.USER)):[o,i]=[r.index,r.index+r.length].map(l=>l<e||l===e&&s===Z.sources.USER?l:n>=0?l+n:Math.max(e,l+n)),new Lt(o,i-o)}class Yt extends ia{}function wd(r){return r instanceof Ae||r instanceof Be}function Nd(r){return typeof r.updateContent=="function"}class S1 extends Ti{static blotName="scroll";static className="ql-editor";static tagName="DIV";static defaultChild=Ae;static allowedChildren=[Ae,Be,Yt];constructor(e,t,s){let{emitter:n}=s;super(e,t),this.emitter=n,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",o=>this.handleDragStart(o))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(Z.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(Z.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,t){this.emitter.emit(Z.events.SCROLL_EMBED_UPDATE,e,t)}deleteAt(e,t){const[s,n]=this.line(e),[o]=this.line(e+t);if(super.deleteAt(e,t),o!=null&&s!==o&&n>0){if(s instanceof Be||o instanceof Be){this.optimize();return}const i=o.children.head instanceof rt?null:o.children.head;s.moveChildren(o,i),s.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,t,s,n){super.formatAt(e,t,s,n),this.optimize()}insertAt(e,t,s){if(e>=this.length())if(s==null||this.scroll.query(t,Q.BLOCK)==null){const n=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(n),s==null&&t.endsWith(`
`)?n.insertAt(0,t.slice(0,-1),s):n.insertAt(0,t,s)}else{const n=this.scroll.create(t,s);this.appendChild(n)}else super.insertAt(e,t,s);this.optimize()}insertBefore(e,t){if(e.statics.scope===Q.INLINE_BLOT){const s=this.scroll.create(this.statics.defaultChild.blotName);s.appendChild(e),super.insertBefore(s,t)}else super.insertBefore(e,t)}insertContents(e,t){const s=this.deltaToRenderBlocks(t.concat(new Y().insert(`
`))),n=s.pop();if(n==null)return;this.batchStart();const o=s.shift();if(o){const d=o.type==="block"&&(o.delta.length()===0||!this.descendant(Be,e)[0]&&e<this.length()),h=o.type==="block"?o.delta:new Y().insert({[o.key]:o.value});zo(this,e,h);const f=o.type==="block"?1:0,m=e+h.length()+f;d&&this.insertAt(m-1,`
`);const u=Fe(this.line(e)[0]),g=Le.AttributeMap.diff(u,o.attributes)||{};Object.keys(g).forEach(y=>{this.formatAt(m-1,1,y,g[y])}),e=m}let[i,l]=this.children.find(e);if(s.length&&(i&&(i=i.split(l),l=0),s.forEach(d=>{if(d.type==="block"){const h=this.createBlock(d.attributes,i||void 0);zo(h,0,d.delta)}else{const h=this.create(d.key,d.value);this.insertBefore(h,i||void 0),Object.keys(d.attributes).forEach(f=>{h.format(f,d.attributes[f])})}})),n.type==="block"&&n.delta.length()){const d=i?i.offset(i.scroll)+l:this.length();zo(this,d,n.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const t=this.path(e).pop();if(!t)return[null,-1];const[s,n]=t;return s instanceof ke?[s,n]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(wd,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const s=(n,o,i)=>{let l=[],d=i;return n.children.forEachAt(o,i,(h,f,m)=>{wd(h)?l.push(h):h instanceof ia&&(l=l.concat(s(h,f,d))),d-=m}),l};return s(this,e,t)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,t),e.length>0&&this.emitter.emit(Z.events.SCROLL_OPTIMIZE,e,t))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let t=Z.sources.USER;typeof e=="string"&&(t=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(s=>{let{target:n}=s;const o=this.find(n,!0);return o&&!Nd(o)}),e.length>0&&this.emitter.emit(Z.events.SCROLL_BEFORE_UPDATE,t,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(Z.events.SCROLL_UPDATE,t,e)}updateEmbedAt(e,t,s){const[n]=this.descendant(o=>o instanceof Be,e);n&&n.statics.blotName===t&&Nd(n)&&n.updateContent(s)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const t=[];let s=new Y;return e.forEach(n=>{const o=n?.insert;if(o)if(typeof o=="string"){const i=o.split(`
`);i.slice(0,-1).forEach(d=>{s.insert(d,n.attributes),t.push({type:"block",delta:s,attributes:n.attributes??{}}),s=new Y});const l=i[i.length-1];l&&s.insert(l,n.attributes)}else{const i=Object.keys(o)[0];if(!i)return;this.query(i,Q.INLINE)?s.push(n):(s.length()&&t.push({type:"block",delta:s,attributes:{}}),s=new Y,t.push({type:"blockEmbed",key:i,value:o[i],attributes:n.attributes??{}}))}}),s.length()&&t.push({type:"block",delta:s,attributes:{}}),t}createBlock(e,t){let s;const n={};Object.entries(e).forEach(l=>{let[d,h]=l;this.query(d,Q.BLOCK&Q.BLOT)!=null?s=d:n[d]=h});const o=this.create(s||this.statics.defaultChild.blotName,s?e[s]:void 0);this.insertBefore(o,t||void 0);const i=o.length();return Object.entries(n).forEach(l=>{let[d,h]=l;o.formatAt(0,i,d,h)}),o}}function zo(r,e,t){t.reduce((s,n)=>{const o=Le.Op.length(n);let i=n.attributes||{};if(n.insert!=null){if(typeof n.insert=="string"){const l=n.insert;r.insertAt(s,l);const[d]=r.descendant(ke,s),h=Fe(d);i=Le.AttributeMap.diff(h,i)||{}}else if(typeof n.insert=="object"){const l=Object.keys(n.insert)[0];if(l==null)return s;if(r.insertAt(s,l,n.insert[l]),r.scroll.query(l,Q.INLINE)!=null){const[h]=r.descendant(ke,s),f=Fe(h);i=Le.AttributeMap.diff(f,i)||{}}}}return Object.keys(i).forEach(l=>{r.formatAt(s,o,l,i[l])}),s+o},e)}const ki={scope:Q.BLOCK,whitelist:["right","center","justify"]},k1=new ut("align","align",ki),zu=new tt("align","ql-align",ki),Hu=new Rt("align","text-align",ki);class Vu extends Rt{value(e){let t=super.value(e);return t.startsWith("rgb(")?(t=t.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${t.split(",").map(n=>`00${parseInt(n,10).toString(16)}`.slice(-2)).join("")}`):t}}const q1=new tt("color","ql-color",{scope:Q.INLINE}),qi=new Vu("color","color",{scope:Q.INLINE}),I1=new tt("background","ql-bg",{scope:Q.INLINE}),Ii=new Vu("background","background-color",{scope:Q.INLINE});class Qt extends Yt{static create(e){const t=super.create(e);return t.setAttribute("spellcheck","false"),t}code(e,t){return this.children.map(s=>s.length()<=1?"":s.domNode.innerText).join(`
`).slice(e,e+t)}html(e,t){return`<pre>
${la(this.code(e,t))}
</pre>`}}class Oe extends Ae{static TAB="  ";static register(){U.register(Qt)}}class Li extends Ie{}Li.blotName="code";Li.tagName="CODE";Oe.blotName="code-block";Oe.className="ql-code-block";Oe.tagName="DIV";Qt.blotName="code-block-container";Qt.className="ql-code-block-container";Qt.tagName="DIV";Qt.allowedChildren=[Oe];Oe.allowedChildren=[Je,rt,Xe];Oe.requiredContainer=Qt;const Oi={scope:Q.BLOCK,whitelist:["rtl"]},Gu=new ut("direction","dir",Oi),Ku=new tt("direction","ql-direction",Oi),Wu=new Rt("direction","direction",Oi),Zu={scope:Q.INLINE,whitelist:["serif","monospace"]},Xu=new tt("font","ql-font",Zu);class L1 extends Rt{value(e){return super.value(e).replace(/["']/g,"")}}const Yu=new L1("font","font-family",Zu),Qu=new tt("size","ql-size",{scope:Q.INLINE,whitelist:["small","large","huge"]}),Ju=new Rt("size","font-size",{scope:Q.INLINE,whitelist:["10px","18px","32px"]}),O1=jt("quill:keyboard"),R1=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class ca extends st{static match(e,t){return["altKey","ctrlKey","metaKey","shiftKey"].some(s=>!!t[s]!==e[s]&&t[s]!==null)?!1:t.key===e.key||t.key===e.which}constructor(e,t){super(e,t),this.bindings={},Object.keys(this.options.bindings).forEach(s=>{this.options.bindings[s]&&this.addBinding(this.options.bindings[s])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=P1(e);if(n==null){O1.warn("Attempted to add invalid keyboard binding",n);return}typeof t=="function"&&(t={handler:t}),typeof s=="function"&&(s={handler:s}),(Array.isArray(n.key)?n.key:[n.key]).forEach(i=>{const l={...n,key:i,...t,...s};this.bindings[l.key]=this.bindings[l.key]||[],this.bindings[l.key].push(l)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const n=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(C=>ca.match(e,C));if(n.length===0)return;const o=U.find(e.target,!0);if(o&&o.scroll!==this.quill.scroll)return;const i=this.quill.getSelection();if(i==null||!this.quill.hasFocus())return;const[l,d]=this.quill.getLine(i.index),[h,f]=this.quill.getLeaf(i.index),[m,u]=i.length===0?[h,f]:this.quill.getLeaf(i.index+i.length),g=h instanceof Vs?h.value().slice(0,f):"",y=m instanceof Vs?m.value().slice(u):"",x={collapsed:i.length===0,empty:i.length===0&&l.length()<=1,format:this.quill.getFormat(i),line:l,offset:d,prefix:g,suffix:y,event:e};n.some(C=>{if(C.collapsed!=null&&C.collapsed!==x.collapsed||C.empty!=null&&C.empty!==x.empty||C.offset!=null&&C.offset!==x.offset)return!1;if(Array.isArray(C.format)){if(C.format.every(v=>x.format[v]==null))return!1}else if(typeof C.format=="object"&&!Object.keys(C.format).every(v=>C.format[v]===!0?x.format[v]!=null:C.format[v]===!1?x.format[v]==null:Ai(C.format[v],x.format[v])))return!1;return C.prefix!=null&&!C.prefix.test(x.prefix)||C.suffix!=null&&!C.suffix.test(x.suffix)?!1:C.handler.call(this,i,x,C)!==!0})&&e.preventDefault()})}handleBackspace(e,t){const s=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(t.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let n={};const[o]=this.quill.getLine(e.index);let i=new Y().retain(e.index-s).delete(s);if(t.offset===0){const[l]=this.quill.getLine(e.index-1);if(l&&!(l.statics.blotName==="block"&&l.length()<=1)){const h=o.formats(),f=this.quill.getFormat(e.index-1,1);if(n=Le.AttributeMap.diff(h,f)||{},Object.keys(n).length>0){const m=new Y().retain(e.index+o.length()-2).retain(1,n);i=i.compose(m)}}}this.quill.updateContents(i,U.sources.USER),this.quill.focus()}handleDelete(e,t){const s=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(t.suffix)?2:1;if(e.index>=this.quill.getLength()-s)return;let n={};const[o]=this.quill.getLine(e.index);let i=new Y().retain(e.index).delete(s);if(t.offset>=o.length()-1){const[l]=this.quill.getLine(e.index+1);if(l){const d=o.formats(),h=this.quill.getFormat(e.index,1);n=Le.AttributeMap.diff(d,h)||{},Object.keys(n).length>0&&(i=i.retain(l.length()-1).retain(1,n))}}this.quill.updateContents(i,U.sources.USER),this.quill.focus()}handleDeleteRange(e){Ri({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,t){const s=Object.keys(t.format).reduce((o,i)=>(this.quill.scroll.query(i,Q.BLOCK)&&!Array.isArray(t.format[i])&&(o[i]=t.format[i]),o),{}),n=new Y().retain(e.index).delete(e.length).insert(`
`,s);this.quill.updateContents(n,U.sources.USER),this.quill.setSelection(e.index+1,U.sources.SILENT),this.quill.focus()}}const M1={bindings:{bold:Ho("bold"),italic:Ho("italic"),underline:Ho("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(r,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",U.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(r,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",U.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(r,e){e.format.indent!=null?this.quill.format("indent","-1",U.sources.USER):e.format.list!=null&&this.quill.format("list",!1,U.sources.USER)}},"indent code-block":jd(!0),"outdent code-block":jd(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(r){this.quill.deleteText(r.index-1,1,U.sources.USER)}},tab:{key:"Tab",handler(r,e){if(e.format.table)return!0;this.quill.history.cutoff();const t=new Y().retain(r.index).delete(r.length).insert("	");return this.quill.updateContents(t,U.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(r.index+1,U.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,U.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(r,e){const t={list:!1};e.format.indent&&(t.indent=!1),this.quill.formatLine(r.index,r.length,t,U.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(r){const[e,t]=this.quill.getLine(r.index),s={...e.formats(),list:"checked"},n=new Y().retain(r.index).insert(`
`,s).retain(e.length()-t-1).retain(1,{list:"unchecked"});this.quill.updateContents(n,U.sources.USER),this.quill.setSelection(r.index+1,U.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(r,e){const[t,s]=this.quill.getLine(r.index),n=new Y().retain(r.index).insert(`
`,e.format).retain(t.length()-s-1).retain(1,{header:null});this.quill.updateContents(n,U.sources.USER),this.quill.setSelection(r.index+1,U.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(r){const e=this.quill.getModule("table");if(e){const[t,s,n,o]=e.getTable(r),i=D1(t,s,n,o);if(i==null)return;let l=t.offset();if(i<0){const d=new Y().retain(l).insert(`
`);this.quill.updateContents(d,U.sources.USER),this.quill.setSelection(r.index+1,r.length,U.sources.SILENT)}else if(i>0){l+=t.length();const d=new Y().retain(l).insert(`
`);this.quill.updateContents(d,U.sources.USER),this.quill.setSelection(l,U.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(r,e){const{event:t,line:s}=e,n=s.offset(this.quill.scroll);t.shiftKey?this.quill.setSelection(n-1,U.sources.USER):this.quill.setSelection(n+s.length(),U.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(r,e){if(this.quill.scroll.query("list")==null)return!0;const{length:t}=e.prefix,[s,n]=this.quill.getLine(r.index);if(n>t)return!0;let o;switch(e.prefix.trim()){case"[]":case"[ ]":o="unchecked";break;case"[x]":o="checked";break;case"-":case"*":o="bullet";break;default:o="ordered"}this.quill.insertText(r.index," ",U.sources.USER),this.quill.history.cutoff();const i=new Y().retain(r.index-n).delete(t+1).retain(s.length()-2-n).retain(1,{list:o});return this.quill.updateContents(i,U.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(r.index-t,U.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(r){const[e,t]=this.quill.getLine(r.index);let s=2,n=e;for(;n!=null&&n.length()<=1&&n.formats()["code-block"];)if(n=n.prev,s-=1,s<=0){const o=new Y().retain(r.index+e.length()-t-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(o,U.sources.USER),this.quill.setSelection(r.index-1,U.sources.SILENT),!1}return!0}},"embed left":Ms("ArrowLeft",!1),"embed left shift":Ms("ArrowLeft",!0),"embed right":Ms("ArrowRight",!1),"embed right shift":Ms("ArrowRight",!0),"table down":Ed(!1),"table up":Ed(!0)}};ca.DEFAULTS=M1;function jd(r){return{key:"Tab",shiftKey:!r,format:{"code-block":!0},handler(e,t){let{event:s}=t;const n=this.quill.scroll.query("code-block"),{TAB:o}=n;if(e.length===0&&!s.shiftKey){this.quill.insertText(e.index,o,U.sources.USER),this.quill.setSelection(e.index+o.length,U.sources.SILENT);return}const i=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:l,length:d}=e;i.forEach((h,f)=>{r?(h.insertAt(0,o),f===0?l+=o.length:d+=o.length):h.domNode.textContent.startsWith(o)&&(h.deleteAt(0,o.length),f===0?l-=o.length:d-=o.length)}),this.quill.update(U.sources.USER),this.quill.setSelection(l,d,U.sources.SILENT)}}}function Ms(r,e){return{key:r,shiftKey:e,altKey:null,[r==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(s){let{index:n}=s;r==="ArrowRight"&&(n+=s.length+1);const[o]=this.quill.getLeaf(n);return o instanceof De?(r==="ArrowLeft"?e?this.quill.setSelection(s.index-1,s.length+1,U.sources.USER):this.quill.setSelection(s.index-1,U.sources.USER):e?this.quill.setSelection(s.index,s.length+1,U.sources.USER):this.quill.setSelection(s.index+s.length+1,U.sources.USER),!1):!0}}}function Ho(r){return{key:r[0],shortKey:!0,handler(e,t){this.quill.format(r,!t.format[r],U.sources.USER)}}}function Ed(r){return{key:r?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,t){const s=r?"prev":"next",n=t.line,o=n.parent[s];if(o!=null){if(o.statics.blotName==="table-row"){let i=o.children.head,l=n;for(;l.prev!=null;)l=l.prev,i=i.next;const d=i.offset(this.quill.scroll)+Math.min(t.offset,i.length()-1);this.quill.setSelection(d,0,U.sources.USER)}}else{const i=n.table()[s];i!=null&&(r?this.quill.setSelection(i.offset(this.quill.scroll)+i.length()-1,0,U.sources.USER):this.quill.setSelection(i.offset(this.quill.scroll),0,U.sources.USER))}return!1}}}function P1(r){if(typeof r=="string"||typeof r=="number")r={key:r};else if(typeof r=="object")r=pr(r);else return null;return r.shortKey&&(r[R1]=r.shortKey,delete r.shortKey),r}function Ri(r){let{quill:e,range:t}=r;const s=e.getLines(t);let n={};if(s.length>1){const o=s[0].formats(),i=s[s.length-1].formats();n=Le.AttributeMap.diff(i,o)||{}}e.deleteText(t,U.sources.USER),Object.keys(n).length>0&&e.formatLine(t.index,1,n,U.sources.USER),e.setSelection(t.index,U.sources.SILENT)}function D1(r,e,t,s){return e.prev==null&&e.next==null?t.prev==null&&t.next==null?s===0?-1:1:t.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const $1=/font-weight:\s*normal/,F1=["P","OL","UL"],_d=r=>r&&F1.includes(r.tagName),U1=r=>{Array.from(r.querySelectorAll("br")).filter(e=>_d(e.previousElementSibling)&&_d(e.nextElementSibling)).forEach(e=>{e.parentNode?.removeChild(e)})},B1=r=>{Array.from(r.querySelectorAll('b[style*="font-weight"]')).filter(e=>e.getAttribute("style")?.match($1)).forEach(e=>{const t=r.createDocumentFragment();t.append(...e.childNodes),e.parentNode?.replaceChild(t,e)})};function z1(r){r.querySelector('[id^="docs-internal-guid-"]')&&(B1(r),U1(r))}const H1=/\bmso-list:[^;]*ignore/i,V1=/\bmso-list:[^;]*\bl(\d+)/i,G1=/\bmso-list:[^;]*\blevel(\d+)/i,K1=(r,e)=>{const t=r.getAttribute("style"),s=t?.match(V1);if(!s)return null;const n=Number(s[1]),o=t?.match(G1),i=o?Number(o[1]):1,l=new RegExp(`@list l${n}:level${i}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),d=e.match(l),h=d&&d[1]==="bullet"?"bullet":"ordered";return{id:n,indent:i,type:h,element:r}},W1=r=>{const e=Array.from(r.querySelectorAll("[style*=mso-list]")),t=[],s=[];e.forEach(i=>{(i.getAttribute("style")||"").match(H1)?t.push(i):s.push(i)}),t.forEach(i=>i.parentNode?.removeChild(i));const n=r.documentElement.innerHTML,o=s.map(i=>K1(i,n)).filter(i=>i);for(;o.length;){const i=[];let l=o.shift();for(;l;)i.push(l),l=o.length&&o[0]?.element===l.element.nextElementSibling&&o[0].id===l.id?o.shift():null;const d=document.createElement("ul");i.forEach(m=>{const u=document.createElement("li");u.setAttribute("data-list",m.type),m.indent>1&&u.setAttribute("class",`ql-indent-${m.indent-1}`),u.innerHTML=m.element.innerHTML,d.appendChild(u)});const h=i[0]?.element,{parentNode:f}=h??{};h&&f?.replaceChild(d,h),i.slice(1).forEach(m=>{let{element:u}=m;f?.removeChild(u)})}};function Z1(r){r.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&W1(r)}const X1=[Z1,z1],Y1=r=>{r.documentElement&&X1.forEach(e=>{e(r)})},Q1=jt("quill:clipboard"),J1=[[Node.TEXT_NODE,hy],[Node.TEXT_NODE,Cd],["br",ny],[Node.ELEMENT_NODE,Cd],[Node.ELEMENT_NODE,ay],[Node.ELEMENT_NODE,sy],[Node.ELEMENT_NODE,dy],["li",ly],["ol, ul",cy],["pre",oy],["tr",uy],["b",Vo("bold")],["i",Vo("italic")],["strike",Vo("strike")],["style",iy]],ey=[k1,Gu].reduce((r,e)=>(r[e.keyName]=e,r),{}),Ad=[Hu,Ii,qi,Wu,Yu,Ju].reduce((r,e)=>(r[e.keyName]=e,r),{});class ty extends st{static DEFAULTS={matchers:[]};constructor(e,t){super(e,t),this.quill.root.addEventListener("copy",s=>this.onCaptureCopy(s,!1)),this.quill.root.addEventListener("cut",s=>this.onCaptureCopy(s,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],J1.concat(this.options.matchers??[]).forEach(s=>{let[n,o]=s;this.addMatcher(n,o)})}addMatcher(e,t){this.matchers.push([e,t])}convert(e){let{html:t,text:s}=e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n[Oe.blotName])return new Y().insert(s||"",{[Oe.blotName]:n[Oe.blotName]});if(!t)return new Y().insert(s||"",n);const o=this.convertHTML(t);return as(o,`
`)&&(o.ops[o.ops.length-1].attributes==null||n.table)?o.compose(new Y().retain(o.length()-1).delete(1)):o}normalizeHTML(e){Y1(e)}convertHTML(e){const t=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(t);const s=t.body,n=new WeakMap,[o,i]=this.prepareMatching(s,n);return Mi(this.quill.scroll,s,o,i,n)}dangerouslyPasteHTML(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U.sources.API;if(typeof e=="string"){const n=this.convert({html:e,text:""});this.quill.setContents(n,t),this.quill.setSelection(0,U.sources.SILENT)}else{const n=this.convert({html:t,text:""});this.quill.updateContents(new Y().retain(e).concat(n),s),this.quill.setSelection(e+n.length(),U.sources.SILENT)}}onCaptureCopy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[s]=this.quill.selection.getRange();if(s==null)return;const{html:n,text:o}=this.onCopy(s,t);e.clipboardData?.setData("text/plain",o),e.clipboardData?.setData("text/html",n),t&&Ri({range:s,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(t=>t[0]!=="#").join(`
`)}onCapturePaste(e){if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const t=this.quill.getSelection(!0);if(t==null)return;const s=e.clipboardData?.getData("text/html");let n=e.clipboardData?.getData("text/plain");if(!s&&!n){const i=e.clipboardData?.getData("text/uri-list");i&&(n=this.normalizeURIList(i))}const o=Array.from(e.clipboardData?.files||[]);if(!s&&o.length>0){this.quill.uploader.upload(t,o);return}if(s&&o.length>0){const i=new DOMParser().parseFromString(s,"text/html");if(i.body.childElementCount===1&&i.body.firstElementChild?.tagName==="IMG"){this.quill.uploader.upload(t,o);return}}this.onPaste(t,{html:s,text:n})}onCopy(e){const t=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:t}}onPaste(e,t){let{text:s,html:n}=t;const o=this.quill.getFormat(e.index),i=this.convert({text:s,html:n},o);Q1.log("onPaste",i,{text:s,html:n});const l=new Y().retain(e.index).delete(e.length).concat(i);this.quill.updateContents(l,U.sources.USER),this.quill.setSelection(l.length()-e.length,U.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,t){const s=[],n=[];return this.matchers.forEach(o=>{const[i,l]=o;switch(i){case Node.TEXT_NODE:n.push(l);break;case Node.ELEMENT_NODE:s.push(l);break;default:Array.from(e.querySelectorAll(i)).forEach(d=>{t.has(d)?t.get(d)?.push(l):t.set(d,[l])});break}}),[s,n]}}function Jt(r,e,t,s){return s.query(e)?r.reduce((n,o)=>{if(!o.insert)return n;if(o.attributes&&o.attributes[e])return n.push(o);const i=t?{[e]:t}:{};return n.insert(o.insert,{...i,...o.attributes})},new Y):r}function as(r,e){let t="";for(let s=r.ops.length-1;s>=0&&t.length<e.length;--s){const n=r.ops[s];if(typeof n.insert!="string")break;t=n.insert+t}return t.slice(-1*e.length)===e}function St(r,e){if(!(r instanceof Element))return!1;const t=e.query(r);return t&&t.prototype instanceof De?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(r.tagName.toLowerCase())}function ry(r,e){return r.previousElementSibling&&r.nextElementSibling&&!St(r.previousElementSibling,e)&&!St(r.nextElementSibling,e)}const Ps=new WeakMap;function eh(r){return r==null?!1:(Ps.has(r)||(r.tagName==="PRE"?Ps.set(r,!0):Ps.set(r,eh(r.parentNode))),Ps.get(r))}function Mi(r,e,t,s,n){return e.nodeType===e.TEXT_NODE?s.reduce((o,i)=>i(e,o,r),new Y):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((o,i)=>{let l=Mi(r,i,t,s,n);return i.nodeType===e.ELEMENT_NODE&&(l=t.reduce((d,h)=>h(i,d,r),l),l=(n.get(i)||[]).reduce((d,h)=>h(i,d,r),l)),o.concat(l)},new Y):new Y}function Vo(r){return(e,t,s)=>Jt(t,r,!0,s)}function sy(r,e,t){const s=ut.keys(r),n=tt.keys(r),o=Rt.keys(r),i={};return s.concat(n).concat(o).forEach(l=>{let d=t.query(l,Q.ATTRIBUTE);d!=null&&(i[d.attrName]=d.value(r),i[d.attrName])||(d=ey[l],d!=null&&(d.attrName===l||d.keyName===l)&&(i[d.attrName]=d.value(r)||void 0),d=Ad[l],d!=null&&(d.attrName===l||d.keyName===l)&&(d=Ad[l],i[d.attrName]=d.value(r)||void 0))}),Object.entries(i).reduce((l,d)=>{let[h,f]=d;return Jt(l,h,f,t)},e)}function ay(r,e,t){const s=t.query(r);if(s==null)return e;if(s.prototype instanceof De){const n={},o=s.value(r);if(o!=null)return n[s.blotName]=o,new Y().insert(n,s.formats(r,t))}else if(s.prototype instanceof es&&!as(e,`
`)&&e.insert(`
`),"blotName"in s&&"formats"in s&&typeof s.formats=="function")return Jt(e,s.blotName,s.formats(r,t),t);return e}function ny(r,e){return as(e,`
`)||e.insert(`
`),e}function oy(r,e,t){const s=t.query("code-block"),n=s&&"formats"in s&&typeof s.formats=="function"?s.formats(r,t):!0;return Jt(e,"code-block",n,t)}function iy(){return new Y}function ly(r,e,t){const s=t.query(r);if(s==null||s.blotName!=="list"||!as(e,`
`))return e;let n=-1,o=r.parentNode;for(;o!=null;)["OL","UL"].includes(o.tagName)&&(n+=1),o=o.parentNode;return n<=0?e:e.reduce((i,l)=>l.insert?l.attributes&&typeof l.attributes.indent=="number"?i.push(l):i.insert(l.insert,{indent:n,...l.attributes||{}}):i,new Y)}function cy(r,e,t){const s=r;let n=s.tagName==="OL"?"ordered":"bullet";const o=s.getAttribute("data-checked");return o&&(n=o==="true"?"checked":"unchecked"),Jt(e,"list",n,t)}function Cd(r,e,t){if(!as(e,`
`)){if(St(r,t)&&(r.childNodes.length>0||r instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&r.nextSibling){let s=r.nextSibling;for(;s!=null;){if(St(s,t))return e.insert(`
`);const n=t.query(s);if(n&&n.prototype instanceof Be)return e.insert(`
`);s=s.firstChild}}}return e}function dy(r,e,t){const s={},n=r.style||{};return n.fontStyle==="italic"&&(s.italic=!0),n.textDecoration==="underline"&&(s.underline=!0),n.textDecoration==="line-through"&&(s.strike=!0),(n.fontWeight?.startsWith("bold")||parseInt(n.fontWeight,10)>=700)&&(s.bold=!0),e=Object.entries(s).reduce((o,i)=>{let[l,d]=i;return Jt(o,l,d,t)},e),parseFloat(n.textIndent||0)>0?new Y().insert("	").concat(e):e}function uy(r,e,t){const s=r.parentElement?.tagName==="TABLE"?r.parentElement:r.parentElement?.parentElement;if(s!=null){const o=Array.from(s.querySelectorAll("tr")).indexOf(r)+1;return Jt(e,"table",o,t)}return e}function hy(r,e,t){let s=r.data;if(r.parentElement?.tagName==="O:P")return e.insert(s.trim());if(!eh(r)){if(s.trim().length===0&&s.includes(`
`)&&!ry(r,t))return e;s=s.replace(/[^\S\u00a0]/g," "),s=s.replace(/ {2,}/g," "),(r.previousSibling==null&&r.parentElement!=null&&St(r.parentElement,t)||r.previousSibling instanceof Element&&St(r.previousSibling,t))&&(s=s.replace(/^ /,"")),(r.nextSibling==null&&r.parentElement!=null&&St(r.parentElement,t)||r.nextSibling instanceof Element&&St(r.nextSibling,t))&&(s=s.replace(/ $/,"")),s=s.replaceAll(" "," ")}return e.insert(s)}class fy extends st{static DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};lastRecorded=0;ignoreChange=!1;stack={undo:[],redo:[]};currentRange=null;constructor(e,t){super(e,t),this.quill.on(U.events.EDITOR_CHANGE,(s,n,o,i)=>{s===U.events.SELECTION_CHANGE?n&&i!==U.sources.SILENT&&(this.currentRange=n):s===U.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||i===U.sources.USER?this.record(n,o):this.transform(n)),this.currentRange=di(this.currentRange,n))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",s=>{s.inputType==="historyUndo"?(this.undo(),s.preventDefault()):s.inputType==="historyRedo"&&(this.redo(),s.preventDefault())})}change(e,t){if(this.stack[e].length===0)return;const s=this.stack[e].pop();if(!s)return;const n=this.quill.getContents(),o=s.delta.invert(n);this.stack[t].push({delta:o,range:di(s.range,o)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(s.delta,U.sources.USER),this.ignoreChange=!1,this.restoreSelection(s)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(e,t){if(e.ops.length===0)return;this.stack.redo=[];let s=e.invert(t),n=this.currentRange;const o=Date.now();if(this.lastRecorded+this.options.delay>o&&this.stack.undo.length>0){const i=this.stack.undo.pop();i&&(s=s.compose(i.delta),n=i.range)}else this.lastRecorded=o;s.length()!==0&&(this.stack.undo.push({delta:s,range:n}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(e){Td(this.stack.undo,e),Td(this.stack.redo,e)}undo(){this.change("undo","redo")}restoreSelection(e){if(e.range)this.quill.setSelection(e.range,U.sources.USER);else{const t=my(this.quill.scroll,e.delta);this.quill.setSelection(t,U.sources.USER)}}}function Td(r,e){let t=e;for(let s=r.length-1;s>=0;s-=1){const n=r[s];r[s]={delta:t.transform(n.delta,!0),range:n.range&&di(n.range,t)},t=n.delta.transform(t),r[s].delta.length()===0&&r.splice(s,1)}}function gy(r,e){const t=e.ops[e.ops.length-1];return t==null?!1:t.insert!=null?typeof t.insert=="string"&&t.insert.endsWith(`
`):t.attributes!=null?Object.keys(t.attributes).some(s=>r.query(s,Q.BLOCK)!=null):!1}function my(r,e){const t=e.reduce((n,o)=>n+(o.delete||0),0);let s=e.length()-t;return gy(r,e)&&(s-=1),s}function di(r,e){if(!r)return r;const t=e.transformPosition(r.index),s=e.transformPosition(r.index+r.length);return{index:t,length:s-t}}class th extends st{constructor(e,t){super(e,t),e.root.addEventListener("drop",s=>{s.preventDefault();let n=null;if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(s.clientX,s.clientY);else if(document.caretPositionFromPoint){const i=document.caretPositionFromPoint(s.clientX,s.clientY);n=document.createRange(),n.setStart(i.offsetNode,i.offset),n.setEnd(i.offsetNode,i.offset)}const o=n&&e.selection.normalizeNative(n);if(o){const i=e.selection.normalizedToRange(o);s.dataTransfer?.files&&this.upload(i,s.dataTransfer.files)}})}upload(e,t){const s=[];Array.from(t).forEach(n=>{n&&this.options.mimetypes?.includes(n.type)&&s.push(n)}),s.length>0&&this.options.handler.call(this,e,s)}}th.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(r,e){if(!this.quill.scroll.query("image"))return;const t=e.map(s=>new Promise(n=>{const o=new FileReader;o.onload=()=>{n(o.result)},o.readAsDataURL(s)}));Promise.all(t).then(s=>{const n=s.reduce((o,i)=>o.insert({image:i}),new Y().retain(r.index).delete(r.length));this.quill.updateContents(n,Z.sources.USER),this.quill.setSelection(r.index+s.length,Z.sources.SILENT)})}};const py=["insertText","insertReplacementText"];class by extends st{constructor(e,t){super(e,t),e.root.addEventListener("beforeinput",s=>{this.handleBeforeInput(s)}),/Android/i.test(navigator.userAgent)||e.on(U.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){Ri({range:e,quill:this.quill})}replaceText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(t){const s=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new Y().retain(e.index).insert(t,s),U.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+t.length,0,U.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!py.includes(e.inputType))return;const t=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!t||t.collapsed===!0)return;const s=xy(e);if(s==null)return;const n=this.quill.selection.normalizeNative(t),o=n?this.quill.selection.normalizedToRange(n):null;o&&this.replaceText(o,s)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function xy(r){return typeof r.data=="string"?r.data:r.dataTransfer?.types.includes("text/plain")?r.dataTransfer.getData("text/plain"):null}const yy=/Mac/i.test(navigator.platform),vy=100,wy=r=>!!(r.key==="ArrowLeft"||r.key==="ArrowRight"||r.key==="ArrowUp"||r.key==="ArrowDown"||r.key==="Home"||yy&&r.key==="a"&&r.ctrlKey===!0);class Ny extends st{isListening=!1;selectionChangeDeadline=0;constructor(e,t){super(e,t),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(e,t){let{line:s,event:n}=t;if(!(s instanceof Qe)||!s.uiNode)return!0;const o=getComputedStyle(s.domNode).direction==="rtl";return o&&n.key!=="ArrowRight"||!o&&n.key!=="ArrowLeft"?!0:(this.quill.setSelection(e.index-1,e.length+(n.shiftKey?1:0),U.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",e=>{!e.defaultPrevented&&wy(e)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+vy,this.isListening)return;this.isListening=!0;const e=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",e,{once:!0})}handleSelectionChange(){const e=document.getSelection();if(!e)return;const t=e.getRangeAt(0);if(t.collapsed!==!0||t.startOffset!==0)return;const s=this.quill.scroll.find(t.startContainer);if(!(s instanceof Qe)||!s.uiNode)return;const n=document.createRange();n.setStartAfter(s.uiNode),n.setEndAfter(s.uiNode),e.removeAllRanges(),e.addRange(n)}}U.register({"blots/block":Ae,"blots/block/embed":Be,"blots/break":rt,"blots/container":Yt,"blots/cursor":Xe,"blots/embed":Si,"blots/inline":Ie,"blots/scroll":S1,"blots/text":Je,"modules/clipboard":ty,"modules/history":fy,"modules/keyboard":ca,"modules/uploader":th,"modules/input":by,"modules/uiNode":Ny});class jy extends tt{add(e,t){let s=0;if(t==="+1"||t==="-1"){const n=this.value(e)||0;s=t==="+1"?n+1:n-1}else typeof t=="number"&&(s=t);return s===0?(this.remove(e),!0):super.add(e,s.toString())}canAdd(e,t){return super.canAdd(e,t)||super.canAdd(e,parseInt(t,10))}value(e){return parseInt(super.value(e),10)||void 0}}const Ey=new jy("indent","ql-indent",{scope:Q.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class _y extends Ae{static blotName="blockquote";static tagName="blockquote"}class Ay extends Ae{static blotName="header";static tagName=["H1","H2","H3","H4","H5","H6"];static formats(e){return this.tagName.indexOf(e.tagName)+1}}class ns extends Yt{}ns.blotName="list-container";ns.tagName="OL";class os extends Ae{static create(e){const t=super.create();return t.setAttribute("data-list",e),t}static formats(e){return e.getAttribute("data-list")||void 0}static register(){U.register(ns)}constructor(e,t){super(e,t);const s=t.ownerDocument.createElement("span"),n=o=>{if(!e.isEnabled())return;const i=this.statics.formats(t,e);i==="checked"?(this.format("list","unchecked"),o.preventDefault()):i==="unchecked"&&(this.format("list","checked"),o.preventDefault())};s.addEventListener("mousedown",n),s.addEventListener("touchstart",n),this.attachUI(s)}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("data-list",t):super.format(e,t)}}os.blotName="list";os.tagName="LI";ns.allowedChildren=[os];os.requiredContainer=ns;class Pi extends Ie{static blotName="bold";static tagName=["STRONG","B"];static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}class Cy extends Pi{static blotName="italic";static tagName=["EM","I"]}class Gs extends Ie{static blotName="link";static tagName="A";static SANITIZED_URL="about:blank";static PROTOCOL_WHITELIST=["http","https","mailto","tel","sms"];static create(e){const t=super.create(e);return t.setAttribute("href",this.sanitize(e)),t.setAttribute("rel","noopener noreferrer"),t.setAttribute("target","_blank"),t}static formats(e){return e.getAttribute("href")}static sanitize(e){return rh(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,t){e!==this.statics.blotName||!t?super.format(e,t):this.domNode.setAttribute("href",this.constructor.sanitize(t))}}function rh(r,e){const t=document.createElement("a");t.href=r;const s=t.href.slice(0,t.href.indexOf(":"));return e.indexOf(s)>-1}class Ty extends Ie{static blotName="script";static tagName=["SUB","SUP"];static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}class Sy extends Pi{static blotName="strike";static tagName=["S","STRIKE"]}class ky extends Ie{static blotName="underline";static tagName="U"}class qy extends Si{static blotName="formula";static className="ql-formula";static tagName="SPAN";static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const t=super.create(e);return typeof e=="string"&&(window.katex.render(e,t,{throwOnError:!1,errorColor:"#f00"}),t.setAttribute("data-value",e)),t}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}const Sd=["alt","height","width"];let Iy=class extends De{static blotName="image";static tagName="IMG";static create(e){const t=super.create(e);return typeof e=="string"&&t.setAttribute("src",this.sanitize(e)),t}static formats(e){return Sd.reduce((t,s)=>(e.hasAttribute(s)&&(t[s]=e.getAttribute(s)),t),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return rh(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,t){Sd.indexOf(e)>-1?t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):super.format(e,t)}};const kd=["height","width"];class Ly extends Be{static blotName="video";static className="ql-video";static tagName="IFRAME";static create(e){const t=super.create(e);return t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen","true"),t.setAttribute("src",this.sanitize(e)),t}static formats(e){return kd.reduce((t,s)=>(e.hasAttribute(s)&&(t[s]=e.getAttribute(s)),t),{})}static sanitize(e){return Gs.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,t){kd.indexOf(e)>-1?t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):super.format(e,t)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}const Gr=new tt("code-token","hljs",{scope:Q.INLINE});class vt extends Ie{static formats(e,t){for(;e!=null&&e!==t.domNode;){if(e.classList&&e.classList.contains(Oe.className))return super.formats(e,t);e=e.parentNode}}constructor(e,t,s){super(e,t,s),Gr.add(this.domNode,s)}format(e,t){e!==vt.blotName?super.format(e,t):t?Gr.add(this.domNode,t):(Gr.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),Gr.value(this.domNode)||this.unwrap()}}vt.blotName="code-token";vt.className="ql-token";class Ue extends Oe{static create(e){const t=super.create(e);return typeof e=="string"&&t.setAttribute("data-language",e),t}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("data-language",t):super.format(e,t)}replaceWith(e,t){return this.formatAt(0,this.length(),vt.blotName,!1),super.replaceWith(e,t)}}class Zr extends Qt{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,t){e===Ue.blotName&&(this.forceNext=!0,this.children.forEach(s=>{s.format(e,t)}))}formatAt(e,t,s,n){s===Ue.blotName&&(this.forceNext=!0),super.formatAt(e,t,s,n)}highlight(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const n=`${Array.from(this.domNode.childNodes).filter(i=>i!==this.uiNode).map(i=>i.textContent).join(`
`)}
`,o=Ue.formats(this.children.head.domNode);if(t||this.forceNext||this.cachedText!==n){if(n.trim().length>0||this.cachedText==null){const i=this.children.reduce((d,h)=>d.concat(Uu(h,!1)),new Y),l=e(n,o);i.diff(l).reduce((d,h)=>{let{retain:f,attributes:m}=h;return f?(m&&Object.keys(m).forEach(u=>{[Ue.blotName,vt.blotName].includes(u)&&this.formatAt(d,f,u,m[u])}),d+f):d},0)}this.cachedText=n,this.forceNext=!1}}html(e,t){const[s]=this.children.find(e);return`<pre data-language="${s?Ue.formats(s.domNode):"plain"}">
${la(this.code(e,t))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const t=Ue.formats(this.children.head.domNode);t!==this.uiNode.value&&(this.uiNode.value=t)}}}Zr.allowedChildren=[Ue];Ue.requiredContainer=Zr;Ue.allowedChildren=[vt,Xe,Je,rt];const Oy=(r,e,t)=>{if(typeof r.versionString=="string"){const s=r.versionString.split(".")[0];if(parseInt(s,10)>=11)return r.highlight(t,{language:e}).value}return r.highlight(e,t).value};class sh extends st{static register(){U.register(vt,!0),U.register(Ue,!0),U.register(Zr,!0)}constructor(e,t){if(super(e,t),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((s,n)=>{let{key:o}=n;return s[o]=!0,s},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(U.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof Zr))return;const t=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(s=>{let{key:n,label:o}=s;const i=t.ownerDocument.createElement("option");i.textContent=o,i.setAttribute("value",n),t.appendChild(i)}),t.addEventListener("change",()=>{e.format(Ue.blotName,t.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(t),e.children.head&&(t.value=Ue.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(U.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(U.sources.USER);const s=this.quill.getSelection();(e==null?this.quill.scroll.descendants(Zr):[e]).forEach(o=>{o.highlight(this.highlightBlot,t)}),this.quill.update(U.sources.SILENT),s!=null&&this.quill.setSelection(s,U.sources.SILENT)}highlightBlot(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(t=this.languages[t]?t:"plain",t==="plain")return la(e).split(`
`).reduce((n,o,i)=>(i!==0&&n.insert(`
`,{[Oe.blotName]:t}),n.insert(o)),new Y);const s=this.quill.root.ownerDocument.createElement("div");return s.classList.add(Oe.className),s.innerHTML=Oy(this.options.hljs,t,e),Mi(this.quill.scroll,s,[(n,o)=>{const i=Gr.value(n);return i?o.compose(new Y().retain(o.length(),{[vt.blotName]:i})):o}],[(n,o)=>n.data.split(`
`).reduce((i,l,d)=>(d!==0&&i.insert(`
`,{[Oe.blotName]:t}),i.insert(l)),o)],new WeakMap)}}sh.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};class Ye extends Ae{static blotName="table";static tagName="TD";static create(e){const t=super.create();return e?t.setAttribute("data-row",e):t.setAttribute("data-row",Di()),t}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,t){e===Ye.blotName&&t?this.domNode.setAttribute("data-row",t):super.format(e,t)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}class Kt extends Yt{static blotName="table-row";static tagName="TR";checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),t=this.children.tail.formats(),s=this.next.children.head.formats(),n=this.next.children.tail.formats();return e.table===t.table&&e.table===s.table&&e.table===n.table}return!1}optimize(e){super.optimize(e),this.children.forEach(t=>{if(t.next==null)return;const s=t.formats(),n=t.next.formats();if(s.table!==n.table){const o=this.splitAfter(t);o&&o.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}class qt extends Yt{static blotName="table-body";static tagName="TBODY"}class Ks extends Yt{static blotName="table-container";static tagName="TABLE";balanceCells(){const e=this.descendants(Kt),t=e.reduce((s,n)=>Math.max(n.children.length,s),0);e.forEach(s=>{new Array(t-s.children.length).fill(0).forEach(()=>{let n;s.children.head!=null&&(n=Ye.formats(s.children.head.domNode));const o=this.scroll.create(Ye.blotName,n);s.appendChild(o),o.optimize()})})}cells(e){return this.rows().map(t=>t.children.at(e))}deleteColumn(e){const[t]=this.descendant(qt);t==null||t.children.head==null||t.children.forEach(s=>{const n=s.children.at(e);n?.remove()})}insertColumn(e){const[t]=this.descendant(qt);t==null||t.children.head==null||t.children.forEach(s=>{const n=s.children.at(e),o=Ye.formats(s.children.head.domNode),i=this.scroll.create(Ye.blotName,o);s.insertBefore(i,n)})}insertRow(e){const[t]=this.descendant(qt);if(t==null||t.children.head==null)return;const s=Di(),n=this.scroll.create(Kt.blotName);t.children.head.children.forEach(()=>{const i=this.scroll.create(Ye.blotName,s);n.appendChild(i)});const o=t.children.at(e);t.insertBefore(n,o)}rows(){const e=this.children.head;return e==null?[]:e.children.map(t=>t)}}Ks.allowedChildren=[qt];qt.requiredContainer=Ks;qt.allowedChildren=[Kt];Kt.requiredContainer=qt;Kt.allowedChildren=[Ye];Ye.requiredContainer=Kt;function Di(){return`row-${Math.random().toString(36).slice(2,6)}`}class Ry extends st{static register(){U.register(Ye),U.register(Kt),U.register(qt),U.register(Ks)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(Ks).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,t]=this.getTable();t!=null&&(e.deleteColumn(t.cellOffset()),this.quill.update(U.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(U.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const t=e.offset();e.remove(),this.quill.update(U.sources.USER),this.quill.setSelection(t,U.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[t,s]=this.quill.getLine(e.index);if(t==null||t.statics.blotName!==Ye.blotName)return[null,null,null,-1];const n=t.parent;return[n.parent.parent,n,t,s]}insertColumn(e){const t=this.quill.getSelection();if(!t)return;const[s,n,o]=this.getTable(t);if(o==null)return;const i=o.cellOffset();s.insertColumn(i+e),this.quill.update(U.sources.USER);let l=n.rowOffset();e===0&&(l+=1),this.quill.setSelection(t.index+l,t.length,U.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const t=this.quill.getSelection();if(!t)return;const[s,n,o]=this.getTable(t);if(o==null)return;const i=n.rowOffset();s.insertRow(i+e),this.quill.update(U.sources.USER),e>0?this.quill.setSelection(t,U.sources.SILENT):this.quill.setSelection(t.index+n.children.length,t.length,U.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,t){const s=this.quill.getSelection();if(s==null)return;const n=new Array(e).fill(0).reduce(o=>{const i=new Array(t).fill(`
`).join("");return o.insert(i,{table:Di()})},new Y().retain(s.index));this.quill.updateContents(n,U.sources.USER),this.quill.setSelection(s.index,U.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(U.events.SCROLL_OPTIMIZE,e=>{e.some(t=>["TD","TR","TBODY","TABLE"].includes(t.target.tagName)?(this.quill.once(U.events.TEXT_CHANGE,(s,n,o)=>{o===U.sources.USER&&this.balanceTables()}),!0):!1)})}}const qd=jt("quill:toolbar");class $i extends st{constructor(e,t){if(super(e,t),Array.isArray(this.options.container)){const s=document.createElement("div");s.setAttribute("role","toolbar"),My(s,this.options.container),e.container?.parentNode?.insertBefore(s,e.container),this.container=s}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){qd.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(s=>{const n=this.options.handlers?.[s];n&&this.addHandler(s,n)}),Array.from(this.container.querySelectorAll("button, select")).forEach(s=>{this.attach(s)}),this.quill.on(U.events.EDITOR_CHANGE,()=>{const[s]=this.quill.selection.getRange();this.update(s)})}addHandler(e,t){this.handlers[e]=t}attach(e){let t=Array.from(e.classList).find(n=>n.indexOf("ql-")===0);if(!t)return;if(t=t.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[t]==null&&this.quill.scroll.query(t)==null){qd.warn("ignoring attaching to nonexistent format",t,e);return}const s=e.tagName==="SELECT"?"change":"click";e.addEventListener(s,n=>{let o;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const l=e.options[e.selectedIndex];l.hasAttribute("selected")?o=!1:o=l.value||!1}else e.classList.contains("ql-active")?o=!1:o=e.value||!e.hasAttribute("value"),n.preventDefault();this.quill.focus();const[i]=this.quill.selection.getRange();if(this.handlers[t]!=null)this.handlers[t].call(this,o);else if(this.quill.scroll.query(t).prototype instanceof De){if(o=prompt(`Enter ${t}`),!o)return;this.quill.updateContents(new Y().retain(i.index).delete(i.length).insert({[t]:o}),U.sources.USER)}else this.quill.format(t,o,U.sources.USER);this.update(i)}),this.controls.push([t,e])}update(e){const t=e==null?{}:this.quill.getFormat(e);this.controls.forEach(s=>{const[n,o]=s;if(o.tagName==="SELECT"){let i=null;if(e==null)i=null;else if(t[n]==null)i=o.querySelector("option[selected]");else if(!Array.isArray(t[n])){let l=t[n];typeof l=="string"&&(l=l.replace(/"/g,'\\"')),i=o.querySelector(`option[value="${l}"]`)}i==null?(o.value="",o.selectedIndex=-1):i.selected=!0}else if(e==null)o.classList.remove("ql-active"),o.setAttribute("aria-pressed","false");else if(o.hasAttribute("value")){const i=t[n],l=i===o.getAttribute("value")||i!=null&&i.toString()===o.getAttribute("value")||i==null&&!o.getAttribute("value");o.classList.toggle("ql-active",l),o.setAttribute("aria-pressed",l.toString())}else{const i=t[n]!=null;o.classList.toggle("ql-active",i),o.setAttribute("aria-pressed",i.toString())}})}}$i.DEFAULTS={};function Id(r,e,t){const s=document.createElement("button");s.setAttribute("type","button"),s.classList.add(`ql-${e}`),s.setAttribute("aria-pressed","false"),t!=null?(s.value=t,s.setAttribute("aria-label",`${e}: ${t}`)):s.setAttribute("aria-label",e),r.appendChild(s)}function My(r,e){Array.isArray(e[0])||(e=[e]),e.forEach(t=>{const s=document.createElement("span");s.classList.add("ql-formats"),t.forEach(n=>{if(typeof n=="string")Id(s,n);else{const o=Object.keys(n)[0],i=n[o];Array.isArray(i)?Py(s,o,i):Id(s,o,i)}}),r.appendChild(s)})}function Py(r,e,t){const s=document.createElement("select");s.classList.add(`ql-${e}`),t.forEach(n=>{const o=document.createElement("option");n!==!1?o.setAttribute("value",String(n)):o.setAttribute("selected","selected"),s.appendChild(o)}),r.appendChild(s)}$i.DEFAULTS={container:null,handlers:{clean(){const r=this.quill.getSelection();if(r!=null)if(r.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(t=>{this.quill.scroll.query(t,Q.INLINE)!=null&&this.quill.format(t,!1,U.sources.USER)})}else this.quill.removeFormat(r.index,r.length,U.sources.USER)},direction(r){const{align:e}=this.quill.getFormat();r==="rtl"&&e==null?this.quill.format("align","right",U.sources.USER):!r&&e==="right"&&this.quill.format("align",!1,U.sources.USER),this.quill.format("direction",r,U.sources.USER)},indent(r){const e=this.quill.getSelection(),t=this.quill.getFormat(e),s=parseInt(t.indent||0,10);if(r==="+1"||r==="-1"){let n=r==="+1"?1:-1;t.direction==="rtl"&&(n*=-1),this.quill.format("indent",s+n,U.sources.USER)}},link(r){r===!0&&(r=prompt("Enter link URL:")),this.quill.format("link",r,U.sources.USER)},list(r){const e=this.quill.getSelection(),t=this.quill.getFormat(e);r==="check"?t.list==="checked"||t.list==="unchecked"?this.quill.format("list",!1,U.sources.USER):this.quill.format("list","unchecked",U.sources.USER):this.quill.format("list",r,U.sources.USER)}}};const Dy='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',$y='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',Fy='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',Uy='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',By='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',zy='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',Hy='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',Vy='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',Ld='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',Gy='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',Ky='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',Wy='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',Zy='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',Xy='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',Yy='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Qy='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Jy='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',ev='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',tv='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',rv='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',sv='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',av='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',nv='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',ov='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',iv='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',lv='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',cv='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',dv='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',uv='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',hv='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',fv='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',gv='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',mv='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',rs={align:{"":Dy,center:$y,right:Fy,justify:Uy},background:By,blockquote:zy,bold:Hy,clean:Vy,code:Ld,"code-block":Ld,color:Gy,direction:{"":Ky,rtl:Wy},formula:Zy,header:{1:Xy,2:Yy,3:Qy,4:Jy,5:ev,6:tv},italic:rv,image:sv,indent:{"+1":av,"-1":nv},link:ov,list:{bullet:iv,check:lv,ordered:cv},script:{sub:dv,super:uv},strike:hv,table:fv,underline:gv,video:mv},pv='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let Od=0;function Rd(r,e){r.setAttribute(e,`${r.getAttribute(e)!=="true"}`)}class da{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",t=>{switch(t.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),t.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),Rd(this.label,"aria-expanded"),Rd(this.options,"aria-hidden")}buildItem(e){const t=document.createElement("span");t.tabIndex="0",t.setAttribute("role","button"),t.classList.add("ql-picker-item");const s=e.getAttribute("value");return s&&t.setAttribute("data-value",s),e.textContent&&t.setAttribute("data-label",e.textContent),t.addEventListener("click",()=>{this.selectItem(t,!0)}),t.addEventListener("keydown",n=>{switch(n.key){case"Enter":this.selectItem(t,!0),n.preventDefault();break;case"Escape":this.escape(),n.preventDefault();break}}),t}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=pv,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${Od}`,Od+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(t=>{const s=this.buildItem(t);e.appendChild(s),t.selected===!0&&this.selectItem(s)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const s=this.container.querySelector(".ql-selected");e!==s&&(s?.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),t&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const s=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(s)}else this.selectItem(null);const t=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",t)}}class ah extends da{constructor(e,t){super(e),this.label.innerHTML=t,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(s=>{s.classList.add("ql-primary")})}buildItem(e){const t=super.buildItem(e);return t.style.backgroundColor=e.getAttribute("value")||"",t}selectItem(e,t){super.selectItem(e,t);const s=this.label.querySelector(".ql-color-label"),n=e&&e.getAttribute("data-value")||"";s&&(s.tagName==="line"?s.style.stroke=n:s.style.fill=n)}}class nh extends da{constructor(e,t){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(s=>{s.innerHTML=t[s.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,t){super.selectItem(e,t);const s=e||this.defaultItem;if(s!=null){if(this.label.innerHTML===s.innerHTML)return;this.label.innerHTML=s.innerHTML}}}const bv=r=>{const{overflowY:e}=getComputedStyle(r,null);return e!=="visible"&&e!=="clip"};class oh{constructor(e,t){this.quill=e,this.boundsContainer=t||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,bv(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const t=e.left+e.width/2-this.root.offsetWidth/2,s=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${t}px`,this.root.style.top=`${s}px`,this.root.classList.remove("ql-flip");const n=this.boundsContainer.getBoundingClientRect(),o=this.root.getBoundingClientRect();let i=0;if(o.right>n.right&&(i=n.right-o.right,this.root.style.left=`${t+i}px`),o.left<n.left&&(i=n.left-o.left,this.root.style.left=`${t+i}px`),o.bottom>n.bottom){const l=o.bottom-o.top,d=e.bottom-e.top+l;this.root.style.top=`${s-d}px`,this.root.classList.add("ql-flip")}return i}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const xv=[!1,"center","right","justify"],yv=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],vv=[!1,"serif","monospace"],wv=["1","2","3",!1],Nv=["small",!1,"large","huge"];class is extends Er{constructor(e,t){super(e,t);const s=n=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",s);return}this.tooltip!=null&&!this.tooltip.root.contains(n.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(o=>{o.container.contains(n.target)||o.close()})};e.emitter.listenDOM("click",document.body,s)}addModule(e){const t=super.addModule(e);return e==="toolbar"&&this.extendToolbar(t),t}buildButtons(e,t){Array.from(e).forEach(s=>{(s.getAttribute("class")||"").split(/\s+/).forEach(o=>{if(o.startsWith("ql-")&&(o=o.slice(3),t[o]!=null))if(o==="direction")s.innerHTML=t[o][""]+t[o].rtl;else if(typeof t[o]=="string")s.innerHTML=t[o];else{const i=s.value||"";i!=null&&t[o][i]&&(s.innerHTML=t[o][i])}})})}buildPickers(e,t){this.pickers=Array.from(e).map(n=>{if(n.classList.contains("ql-align")&&(n.querySelector("option")==null&&Ur(n,xv),typeof t.align=="object"))return new nh(n,t.align);if(n.classList.contains("ql-background")||n.classList.contains("ql-color")){const o=n.classList.contains("ql-background")?"background":"color";return n.querySelector("option")==null&&Ur(n,yv,o==="background"?"#ffffff":"#000000"),new ah(n,t[o])}return n.querySelector("option")==null&&(n.classList.contains("ql-font")?Ur(n,vv):n.classList.contains("ql-header")?Ur(n,wv):n.classList.contains("ql-size")&&Ur(n,Nv)),new da(n)});const s=()=>{this.pickers.forEach(n=>{n.update()})};this.quill.on(Z.events.EDITOR_CHANGE,s)}}is.DEFAULTS=kt({},Er.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let r=this.container.querySelector("input.ql-image[type=file]");r==null&&(r=document.createElement("input"),r.setAttribute("type","file"),r.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),r.classList.add("ql-image"),r.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,r.files),r.value=""}),this.container.appendChild(r)),r.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class ih extends oh{constructor(e,t){super(e,t),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;t!=null?this.textbox.value=t:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const s=this.quill.getBounds(this.quill.selection.savedRange);s!=null&&this.position(s),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:t}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,Z.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,Z.sources.USER)),this.quill.root.scrollTop=t;break}case"video":e=jv(e);case"formula":{if(!e)break;const t=this.quill.getSelection(!0);if(t!=null){const s=t.index+t.length;this.quill.insertEmbed(s,this.root.getAttribute("data-mode"),e,Z.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(s+1," ",Z.sources.USER),this.quill.setSelection(s+2,Z.sources.USER)}break}}this.textbox.value="",this.hide()}}function jv(r){let e=r.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||r.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=r.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:r}function Ur(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(s=>{const n=document.createElement("option");s===t?n.setAttribute("selected","selected"):n.setAttribute("value",String(s)),r.appendChild(n)})}const Ev=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class _v extends ih{static TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");constructor(e,t){super(e,t),this.quill.on(Z.events.EDITOR_CHANGE,(s,n,o,i)=>{if(s===Z.events.SELECTION_CHANGE)if(n!=null&&n.length>0&&i===Z.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const l=this.quill.getLines(n.index,n.length);if(l.length===1){const d=this.quill.getBounds(n);d!=null&&this.position(d)}else{const d=l[l.length-1],h=this.quill.getIndex(d),f=Math.min(d.length()-1,n.index+n.length-h),m=this.quill.getBounds(new Lt(h,f));m!=null&&this.position(m)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(Z.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const t=this.quill.getBounds(e);t!=null&&this.position(t)}},1)})}cancel(){this.show()}position(e){const t=super.position(e),s=this.root.querySelector(".ql-tooltip-arrow");return s.style.marginLeft="",t!==0&&(s.style.marginLeft=`${-1*t-s.offsetWidth/2}px`),t}}class lh extends is{constructor(e,t){t.modules.toolbar!=null&&t.modules.toolbar.container==null&&(t.modules.toolbar.container=Ev),super(e,t),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new _v(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),rs),this.buildPickers(e.container.querySelectorAll("select"),rs))}}lh.DEFAULTS=kt({},is.DEFAULTS,{modules:{toolbar:{handlers:{link(r){r?this.quill.theme.tooltip.edit():this.quill.format("link",!1,U.sources.USER)}}}}});const Av=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class Cv extends ih{static TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");preview=this.root.querySelector("a.ql-preview");listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",e=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),e.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",e=>{if(this.linkRange!=null){const t=this.linkRange;this.restoreFocus(),this.quill.formatText(t,"link",!1,Z.sources.USER),delete this.linkRange}e.preventDefault(),this.hide()}),this.quill.on(Z.events.SELECTION_CHANGE,(e,t,s)=>{if(e!=null){if(e.length===0&&s===Z.sources.USER){const[n,o]=this.quill.scroll.descendant(Gs,e.index);if(n!=null){this.linkRange=new Lt(e.index-o,n.length());const i=Gs.formats(n.domNode);this.preview.textContent=i,this.preview.setAttribute("href",i),this.show();const l=this.quill.getBounds(this.linkRange);l!=null&&this.position(l);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}class ch extends is{constructor(e,t){t.modules.toolbar!=null&&t.modules.toolbar.container==null&&(t.modules.toolbar.container=Av),super(e,t),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),rs),this.buildPickers(e.container.querySelectorAll("select"),rs),this.tooltip=new Cv(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(t,s)=>{e.handlers.link.call(e,!s.format.link)}))}}ch.DEFAULTS=kt({},is.DEFAULTS,{modules:{toolbar:{handlers:{link(r){if(r){const e=this.quill.getSelection();if(e==null||e.length===0)return;let t=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(t)&&t.indexOf("mailto:")!==0&&(t=`mailto:${t}`);const{tooltip:s}=this.quill.theme;s.edit("link",t)}else this.quill.format("link",!1,U.sources.USER)}}}}});U.register({"attributors/attribute/direction":Gu,"attributors/class/align":zu,"attributors/class/background":I1,"attributors/class/color":q1,"attributors/class/direction":Ku,"attributors/class/font":Xu,"attributors/class/size":Qu,"attributors/style/align":Hu,"attributors/style/background":Ii,"attributors/style/color":qi,"attributors/style/direction":Wu,"attributors/style/font":Yu,"attributors/style/size":Ju},!0);U.register({"formats/align":zu,"formats/direction":Ku,"formats/indent":Ey,"formats/background":Ii,"formats/color":qi,"formats/font":Xu,"formats/size":Qu,"formats/blockquote":_y,"formats/code-block":Oe,"formats/header":Ay,"formats/list":os,"formats/bold":Pi,"formats/code":Li,"formats/italic":Cy,"formats/link":Gs,"formats/script":Ty,"formats/strike":Sy,"formats/underline":ky,"formats/formula":qy,"formats/image":Iy,"formats/video":Ly,"modules/syntax":sh,"modules/table":Ry,"modules/toolbar":$i,"themes/bubble":lh,"themes/snow":ch,"ui/icons":rs,"ui/picker":da,"ui/icon-picker":nh,"ui/color-picker":ah,"ui/tooltip":oh},!0);const Tv=Object.freeze(Object.defineProperty({__proto__:null,AttributeMap:Le.AttributeMap,Delta:Y,Module:st,Op:Le.Op,OpIterator:Le.OpIterator,Parchment:Pu,Range:Lt,default:U},Symbol.toStringTag,{value:"Module"})),Sv=Gh(Tv);var We,Md;function kv(){if(Md)return We;Md=1;var r=We&&We.__extends||(function(){var f=function(m,u){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,y){g.__proto__=y}||function(g,y){for(var x in y)y.hasOwnProperty(x)&&(g[x]=y[x])},f(m,u)};return function(m,u){f(m,u);function g(){this.constructor=m}m.prototype=u===null?Object.create(u):(g.prototype=u.prototype,new g)}})(),e=We&&We.__assign||function(){return e=Object.assign||function(f){for(var m,u=1,g=arguments.length;u<g;u++){m=arguments[u];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(f[y]=m[y])}return f},e.apply(this,arguments)},t=We&&We.__spreadArrays||function(){for(var f=0,m=0,u=arguments.length;m<u;m++)f+=arguments[m].length;for(var g=Array(f),y=0,m=0;m<u;m++)for(var x=arguments[m],A=0,C=x.length;A<C;A++,y++)g[y]=x[A];return g},s=We&&We.__importDefault||function(f){return f&&f.__esModule?f:{default:f}},n=s(Kh()),o=s(Wh()),i=s(Sm()),l=s(Sv),d=(function(f){r(m,f);function m(u){var g=f.call(this,u)||this;g.dirtyProps=["modules","formats","bounds","theme","children"],g.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],g.state={generation:0},g.selection=null,g.onEditorChange=function(x,A,C,v){var k,_,q,D;x==="text-change"?(_=(k=g).onEditorChangeText)===null||_===void 0||_.call(k,g.editor.root.innerHTML,A,v,g.unprivilegedEditor):x==="selection-change"&&((D=(q=g).onEditorChangeSelection)===null||D===void 0||D.call(q,A,v,g.unprivilegedEditor))};var y=g.isControlled()?u.value:u.defaultValue;return g.value=y??"",g}return m.prototype.validateProps=function(u){var g;if(n.default.Children.count(u.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(n.default.Children.count(u.children)){var y=n.default.Children.only(u.children);if(((g=y)===null||g===void 0?void 0:g.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&u.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},m.prototype.shouldComponentUpdate=function(u,g){var y=this,x;if(this.validateProps(u),!this.editor||this.state.generation!==g.generation)return!0;if("value"in u){var A=this.getEditorContents(),C=(x=u.value,x??"");this.isEqualValue(C,A)||this.setEditorContents(this.editor,C)}return u.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,u.readOnly),t(this.cleanProps,this.dirtyProps).some(function(v){return!i.default(u[v],y.props[v])})},m.prototype.shouldComponentRegenerate=function(u){var g=this;return this.dirtyProps.some(function(y){return!i.default(u[y],g.props[y])})},m.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},m.prototype.componentWillUnmount=function(){this.destroyEditor()},m.prototype.componentDidUpdate=function(u,g){var y=this;if(this.editor&&this.shouldComponentRegenerate(u)){var x=this.editor.getContents(),A=this.editor.getSelection();this.regenerationSnapshot={delta:x,selection:A},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==g.generation){var C=this.regenerationSnapshot,x=C.delta,v=C.selection;delete this.regenerationSnapshot,this.instantiateEditor();var k=this.editor;k.setContents(x),h(function(){return y.setEditorSelection(k,v)})}},m.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},m.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},m.prototype.isControlled=function(){return"value"in this.props},m.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},m.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},m.prototype.createEditor=function(u,g){var y=new l.default(u,g);return g.tabIndex!=null&&this.setEditorTabIndex(y,g.tabIndex),this.hookEditor(y),y},m.prototype.hookEditor=function(u){this.unprivilegedEditor=this.makeUnprivilegedEditor(u),u.on("editor-change",this.onEditorChange)},m.prototype.unhookEditor=function(u){u.off("editor-change",this.onEditorChange)},m.prototype.getEditorContents=function(){return this.value},m.prototype.getEditorSelection=function(){return this.selection},m.prototype.isDelta=function(u){return u&&u.ops},m.prototype.isEqualValue=function(u,g){return this.isDelta(u)&&this.isDelta(g)?i.default(u.ops,g.ops):i.default(u,g)},m.prototype.setEditorContents=function(u,g){var y=this;this.value=g;var x=this.getEditorSelection();typeof g=="string"?u.setContents(u.clipboard.convert(g)):u.setContents(g),h(function(){return y.setEditorSelection(u,x)})},m.prototype.setEditorSelection=function(u,g){if(this.selection=g,g){var y=u.getLength();g.index=Math.max(0,Math.min(g.index,y-1)),g.length=Math.max(0,Math.min(g.length,y-1-g.index)),u.setSelection(g)}},m.prototype.setEditorTabIndex=function(u,g){var y,x;!((x=(y=u)===null||y===void 0?void 0:y.scroll)===null||x===void 0)&&x.domNode&&(u.scroll.domNode.tabIndex=g)},m.prototype.setEditorReadOnly=function(u,g){g?u.disable():u.enable()},m.prototype.makeUnprivilegedEditor=function(u){var g=u;return{getHTML:function(){return g.root.innerHTML},getLength:g.getLength.bind(g),getText:g.getText.bind(g),getContents:g.getContents.bind(g),getSelection:g.getSelection.bind(g),getBounds:g.getBounds.bind(g)}},m.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var u=o.default.findDOMNode(this.editingArea);if(!u)throw new Error("Cannot find element for editing area");if(u.nodeType===3)throw new Error("Editing area cannot be a text node");return u},m.prototype.renderEditingArea=function(){var u=this,g=this.props,y=g.children,x=g.preserveWhitespace,A=this.state.generation,C={key:A,ref:function(v){u.editingArea=v}};return n.default.Children.count(y)?n.default.cloneElement(n.default.Children.only(y),C):x?n.default.createElement("pre",e({},C)):n.default.createElement("div",e({},C))},m.prototype.render=function(){var u;return n.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(u=this.props.className,u??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},m.prototype.onEditorChangeText=function(u,g,y,x){var A,C;if(this.editor){var v=this.isDelta(this.value)?x.getContents():x.getHTML();v!==this.getEditorContents()&&(this.lastDeltaChangeSet=g,this.value=v,(C=(A=this.props).onChange)===null||C===void 0||C.call(A,u,g,y,x))}},m.prototype.onEditorChangeSelection=function(u,g,y){var x,A,C,v,k,_;if(this.editor){var q=this.getEditorSelection(),D=!q&&u,F=q&&!u;i.default(u,q)||(this.selection=u,(A=(x=this.props).onChangeSelection)===null||A===void 0||A.call(x,u,g,y),D?(v=(C=this.props).onFocus)===null||v===void 0||v.call(C,u,g,y):F&&((_=(k=this.props).onBlur)===null||_===void 0||_.call(k,q,g,y)))}},m.prototype.focus=function(){this.editor&&this.editor.focus()},m.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},m.displayName="React Quill",m.Quill=l.default,m.defaultProps={theme:"snow",modules:{},readOnly:!1},m})(n.default.Component);function h(f){Promise.resolve().then(f)}return We=d,We}var qv=kv();const Iv=$d(qv),Fi={PDFS:"pdfs",MEDIA:"media"},zt={PDF:{MAX_SIZE:10*1024*1024,ALLOWED_TYPES:["application/pdf"],MAX_FILES:1/0},IMAGE:{MAX_SIZE:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/png","image/jpg"],MAX_FILES:10},AUDIO:{MAX_SIZE:20*1024*1024,ALLOWED_TYPES:["audio/wav","audio/mpeg","audio/mp3"],MAX_FILES:1}},Lv={PDF:"documents",IMAGE:"images",AUDIO:"audio"},Ov=r=>zt.PDF.ALLOWED_TYPES.includes(r.type)?"PDF":zt.IMAGE.ALLOWED_TYPES.includes(r.type)?"IMAGE":zt.AUDIO.ALLOWED_TYPES.includes(r.type)?"AUDIO":null,Rv=(r,e)=>{const t=zt[e];return t?t.ALLOWED_TYPES.includes(r.type)?r.size>t.MAX_SIZE?{isValid:!1,error:`Arquivo muito grande. Tamanho máximo: ${t.MAX_SIZE/(1024*1024)}MB`}:{isValid:!0}:{isValid:!1,error:`Tipo de arquivo não permitido. Use apenas ${e==="PDF"?"PDF":e==="IMAGE"?"JPG/PNG":"WAV/MP3"}`}:{isValid:!1,error:"Tipo de arquivo não suportado"}},Mv=(r,e="")=>{const t=Date.now(),s=Math.random().toString(36).substring(2,8),n=r.name.split(".").pop();return`${e}${t}_${s}.${n}`},dh=async(r,e=Fi.PDFS)=>{try{const t=Ov(r);if(!t)throw new Error("Tipo de arquivo não suportado");const s=Rv(r,t);if(!s.isValid)throw new Error(s.error);const n=Mv(r,`${t.toLowerCase()}_`),o=`${Lv[t]}/${n}`,{error:i}=await re.storage.from(e).upload(o,r,{cacheControl:"3600",upsert:!1});if(i)throw i;const{data:{publicUrl:l}}=re.storage.from(e).getPublicUrl(o);return l}catch(t){throw B.error("Erro ao fazer upload:",t),t}},Pv=async r=>dh(r,Fi.PDFS),Dv=async r=>dh(r,Fi.MEDIA),$v=({value:r,onChange:e,placeholder:t,label:s,style:n={}})=>{const o=w.useRef(null),i=w.useRef(null),l=w.useRef(!1),d=w.useCallback(g=>{if(g){o.current=g;const y=g.getEditor();y&&(i.current=y)}},[]);w.useEffect(()=>{if(o.current){const g=o.current.getEditor();g&&!i.current&&(i.current=g)}});const h=w.useCallback(async()=>{const g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("accept","image/*"),g.click(),g.onchange=async()=>{const y=g.files[0],x=i.current;if(y&&x)try{const A=x.getSelection();x.insertEmbed(A.index,"image","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");const C=await Dv(y);x.deleteText(A.index,1),x.insertEmbed(A.index,"image",C),x.setSelection(A.index+1)}catch(A){console.error("Erro ao fazer upload da imagem:",A),alert("Erro ao fazer upload da imagem. Tente novamente.")}}},[]),f=hi.useMemo(()=>({toolbar:{container:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["image"],["clean"]],handlers:{image:h}}}),[h]),m=["header","bold","italic","underline","strike","color","background","list","bullet","align","link","image"],u=w.useCallback((g,y,x,A)=>{l.current=!0,e&&e(g,y,x,A),setTimeout(()=>{l.current=!1},0)},[e]);return w.useEffect(()=>{const g=setTimeout(()=>{let y=i.current;if(!y&&o.current&&(y=o.current.getEditor(),y&&(i.current=y)),y&&!l.current){const x=y.root.innerHTML.trim(),A=(r||"").trim();if(x!==A&&!((x===""||x==="<p><br></p>"||x==="<p></p>")&&(A===""||A==="<p><br></p>"||A==="<p></p>")))try{const k=y.clipboard.convert({html:A});y.setContents(k,"silent")}catch(k){console.warn("Erro ao atualizar editor com setContents, usando fallback:",k),y.root.innerHTML=A}}},50);return()=>clearTimeout(g)},[r]),a.jsxs("div",{className:"rich-text-editor",children:[s&&a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:s}),a.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg",children:a.jsx(Iv,{ref:d,theme:"snow",value:r||"",onChange:u,modules:f,formats:m,placeholder:t,style:{height:"300px",backgroundColor:"#1f2937",color:"#f3f4f6",...n}})})]})},uh=({value:r,onChange:e,placeholder:t,label:s})=>a.jsx($v,{value:r,onChange:e,placeholder:t,label:s}),Fv=({editingLocation:r,setEditingLocation:e})=>a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"historiaEscola",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: História da Escola"}),a.jsx(uh,{label:"História da Escola",value:r.historia_da_escola||"",onChange:t=>e({...r,historia_da_escola:t}),placeholder:"Digite a história da escola..."})]});class Uv{static async uploadFotoProfessor(e,t,s){try{if(!e)throw new Error("Arquivo não fornecido");if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type))throw new Error("Tipo de arquivo não permitido. Use JPEG, PNG ou WebP.");const o=5*1024*1024;if(e.size>o)throw new Error("Arquivo muito grande. Tamanho máximo: 5MB");const i=Date.now(),l=e.name.split(".").pop().toLowerCase(),d=t.toLowerCase().replace(/[áàâãä]/g,"a").replace(/[éèêë]/g,"e").replace(/[íìîï]/g,"i").replace(/[óòôõö]/g,"o").replace(/[úùûü]/g,"u").replace(/[ç]/g,"c").replace(/[ñ]/g,"n").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,50),h=`${d}_${i}.${l}`,f=`${s}/${h}`;if(!h||h.length===0)throw new Error("Nome do arquivo inválido gerado");B.debug("Upload da foto:",{nomeOriginal:e.name,nomeSanitizado:d,nomeArquivo:h,caminhoArquivo:f,escolaId:s,nomeProfessor:t});const{error:m}=await re.storage.from("avatar").upload(f,e,{cacheControl:"3600",upsert:!1});if(m)throw new Error(`Erro no upload: ${m.message}`);const{data:{publicUrl:u}}=re.storage.from("avatar").getPublicUrl(f);return{success:!0,url:u,caminho:f}}catch(n){return B.error("Erro no upload da foto:",n),{success:!1,error:n.message}}}static async atualizarFotoProfessor(e,t){try{const{error:s}=await re.from("historias_professor").update({foto_rosto:t}).eq("id",e);if(s)throw new Error(`Erro ao atualizar foto: ${s.message}`);return{success:!0}}catch(s){return B.error("Erro ao atualizar foto do professor:",s),{success:!1,error:s.message}}}static async removerFotoProfessor(e,t){try{const{error:s}=await re.storage.from("avatar").remove([e]);s&&B.warn("Erro ao remover arquivo do storage:",s);const{error:n}=await re.from("historias_professor").update({foto_rosto:null}).eq("id",t);if(n)throw new Error(`Erro ao atualizar banco de dados: ${n.message}`);return{success:!0}}catch(s){return B.error("Erro ao remover foto do professor:",s),{success:!1,error:s.message}}}static async buscarFotoProfessor(e){try{return e?e.startsWith("http")||e.startsWith("data:")?{success:!0,url:e}:{success:!1,error:"URL da foto inválida"}:{success:!1,error:"URL da foto não fornecida"}}catch(t){return B.error("Erro ao buscar foto do professor:",t),{success:!1,error:t.message}}}static async listarFotosProfessores(e){try{const{data:t,error:s}=await re.storage.from("avatar").list(`${e}/`);if(s)throw new Error(`Erro ao listar fotos: ${s.message}`);return{success:!0,fotos:t.map(o=>{const{data:{publicUrl:i}}=re.storage.from("avatar").getPublicUrl(`${e}/${o.name}`);return{nome:o.name,url:i,tamanho:o.metadata?.size||0,criadoEm:o.created_at}})}}catch(t){return B.error("Erro ao listar fotos dos professores:",t),{success:!1,error:t.message}}}static async validarImagem(e){return new Promise(t=>{if(!e){t(!1);return}const s=new Image;s.onload=()=>t(!0),s.onerror=()=>t(!1),s.src=e})}}const Bv=({editingLocation:r,setEditingLocation:e})=>{const[t,s]=w.useState([]),[n,o]=w.useState(!1),[i,l]=w.useState(null),[d,h]=w.useState(!1),[f,m]=w.useState(!1),[u,g]=w.useState(""),[y,x]=w.useState(""),[A,C]=w.useState(0),v=w.useCallback(async()=>{if(r?.id){o(!0);try{const O=await rf(r.id);s(O||[])}catch(O){B.error("Erro ao carregar histórias:",O)}finally{o(!1)}}},[r?.id]);w.useEffect(()=>{r?.id&&v()},[r?.id,v]);const k=async O=>{if(r?.id)try{i?.id?await sf(i.id,O):await af({...O,escola_id:r.id}),await v(),l(null),h(!1)}catch(p){B.error("Erro ao salvar história:",p),alert("Erro ao salvar história: "+p.message)}},_=async O=>{if(window.confirm("Tem certeza que deseja excluir esta história?"))try{await nf(O),await v()}catch(p){B.error("Erro ao deletar história:",p),alert("Erro ao deletar história: "+p.message)}},q=O=>{l({...O,historia:O.historia||""}),h(!1),setTimeout(()=>{const p=document.querySelector("[data-edit-form]");p&&p.scrollIntoView({behavior:"smooth",block:"start"})},100)},D=()=>{l({nome_professor:"",historia:""}),h(!0),C(O=>O+1)},F=()=>{l(null),h(!1),g(""),x("")},T=async O=>{const p=O.target.files[0];if(!p)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(p.type)){g("Tipo de arquivo não permitido. Use JPEG, PNG ou WebP.");return}const N=5*1024*1024;if(p.size>N){g("Arquivo muito grande. Tamanho máximo: 5MB");return}try{m(!0),g(""),x(""),B.debug("=== HistoriaProfessoresTab.handlePhotoUpload ==="),B.debug("Arquivo:",p.name),B.debug("Nome Professor:",i?.nome_professor||"professor"),B.debug("Escola ID:",r.id);const S=await Uv.uploadFotoProfessor(p,i?.nome_professor||"professor",r.id);if(B.debug("Resultado do upload:",S),S.success){B.debug("Atualizando editingHistoria com URL:",S.url),B.debug("Estado atual editingHistoria:",i);const L={...i,foto_rosto:S.url};B.debug("Novo estado que será definido:",L),l(L),x("Foto carregada com sucesso!"),setTimeout(()=>{B.debug("Estado após atualização (deve mostrar foto_rosto):",i)},100),setTimeout(()=>x(""),3e3)}else g(S.error||"Erro ao fazer upload da foto")}catch(S){B.error("Erro no upload da foto:",S),g("Erro inesperado ao fazer upload da foto")}finally{m(!1)}},V=()=>{l({...i,foto_rosto:""}),g(""),x("")};return n?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando histórias..."})}):a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"historiaProfessor",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: História dos Professores"}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Depoimentos dos Professores"}),a.jsx("button",{onClick:D,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"+ Nova História"})]}),i&&a.jsxs("div",{className:"space-y-4","data-edit-form":!0,children:[a.jsx("h4",{className:"text-sm font-medium text-gray-200 mb-3",children:d?"Nova História do Professor":"Editar História do Professor"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Nome do Professor"}),a.jsx("input",{type:"text",value:i.nome_professor||"",onChange:O=>l({...i,nome_professor:O.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Nome do professor (opcional)"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:["Foto de Rosto do Professor ",a.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),i.foto_rosto&&a.jsx("div",{className:"mb-4 p-4 border border-gray-600 rounded-lg bg-gray-700",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:i.foto_rosto,alt:"Foto do professor",className:"w-20 h-20 object-cover rounded-full border-2 border-green-400 shadow-sm"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-gray-300 mb-1",children:"Foto de rosto atual:"}),a.jsx("p",{className:"text-xs text-gray-400 break-all",children:i.foto_rosto})]}),a.jsx("button",{type:"button",onClick:V,className:"px-3 py-1 text-sm text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded-md transition-colors",disabled:f,children:a.jsx(ze,{className:"w-4 h-4"})})]})}),u&&a.jsxs("div",{className:"mb-4 p-3 bg-red-900/20 border border-red-600 rounded-lg flex items-center gap-2",children:[a.jsx(xt,{className:"w-4 h-4 text-red-400"}),a.jsx("span",{className:"text-sm text-red-400",children:u})]}),y&&a.jsxs("div",{className:"mb-4 p-3 bg-green-900/20 border border-green-600 rounded-lg flex items-center gap-2",children:[a.jsx(gi,{className:"w-4 h-4 text-green-400"}),a.jsx("span",{className:"text-sm text-green-400",children:y})]}),a.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${f?"border-blue-400 bg-blue-900/20":"border-gray-600 hover:border-green-400"}`,children:[a.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:T,disabled:f,className:"hidden",id:"foto-rosto-input"}),a.jsx("label",{htmlFor:"foto-rosto-input",className:`cursor-pointer block ${f?"cursor-not-allowed":""}`,children:a.jsx("div",{className:"flex flex-col items-center gap-2",children:f?a.jsx(a.Fragment,{children:a.jsx("span",{className:"text-sm text-blue-400",children:"Enviando foto..."})}):a.jsxs(a.Fragment,{children:[a.jsx(Xs,{className:"w-8 h-8 text-gray-400"}),a.jsx("span",{className:"text-sm text-gray-300",children:i.foto_rosto?"Alterar foto de rosto":"Adicionar foto de rosto"}),a.jsx("span",{className:"text-xs text-gray-500",children:"JPEG, PNG ou WebP (máx. 5MB)"})]})})})]}),a.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[a.jsx("p",{children:"• A foto de rosto será exibida junto com o depoimento do professor"}),a.jsx("p",{children:"• Recomendado: foto quadrada ou retrato, boa qualidade"}),a.jsx("p",{children:"• A foto será salva no bucket 'avatar' e vinculada ao depoimento"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2",children:"Depoimento/História"}),a.jsx(uh,{value:i.historia||"",onChange:O=>l({...i,historia:O}),placeholder:"Digite o depoimento ou história do professor..."},i?.id||`new-${A}`)]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{onClick:()=>k(i),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:d?"Criar":"Salvar"}),a.jsx("button",{onClick:F,className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-lg hover:bg-gray-700 transition-colors",children:"Cancelar"})]})]})]}),t.length>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-200",children:"Histórias Existentes"}),t.map(O=>a.jsx("div",{className:"space-y-2 pb-3 border-b border-gray-700",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[O.nome_professor&&a.jsx("h5",{className:"font-medium text-green-400 mb-2",children:O.nome_professor}),a.jsx("div",{className:"text-gray-300 prose prose-invert max-w-none",dangerouslySetInnerHTML:{__html:O.historia}})]}),a.jsxs("div",{className:"flex gap-2 ml-4",children:[a.jsx("button",{onClick:()=>q(O),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Editar"}),a.jsx("button",{onClick:()=>_(O.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"Excluir"})]})]})},O.id))]}),t.length===0&&!i&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{children:"Nenhuma história de professor cadastrada ainda."}),a.jsx("p",{className:"text-sm mt-2",children:'Clique em "Nova História" para começar.'})]})]})},zv="/opin//map-marker.svg",Hv=({editingLocation:r,setEditingLocation:e})=>{const t=w.useRef(null),s=w.useRef(null),n=w.useRef(null),o=(l,d)=>{if(!s.current)return;const h=s.current.getView();if(l&&d&&!isNaN(l)&&!isNaN(d)){const f=Ki([parseFloat(d),parseFloat(l)]);h.setCenter(f),h.setZoom(15);const m=s.current.getLayers().getArray().find(u=>u instanceof Gi)?.getSource();if(m){n.current&&m.removeFeature(n.current);const u=new ff({geometry:new gf(f)});u.setStyle(new mf({image:new pf({src:zv,scale:.6,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",color:"#fbbf24"})})),m.addFeature(u),n.current=u}}},i=w.useCallback(l=>{const d=of(l.coordinate),[h,f]=d;e({...r,latitude:f.toFixed(6),longitude:h.toFixed(6)})},[r]);return w.useEffect(()=>{if(!t.current)return;const l=new lf({target:t.current,layers:[new df({source:new uf({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}),new Gi({source:new hf})],view:new cf({center:Ki([-46.6388,-23.5489]),zoom:8})});s.current=l,l.on("click",i);const d=r.Latitude,h=r.Longitude;return d&&h&&o(d,h),()=>{s.current&&s.current.setTarget(void 0)}},[i]),w.useEffect(()=>{const l=r.Latitude,d=r.Longitude;o(l,d)},[r.Latitude,r.Longitude]),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Latitude"}),a.jsx("input",{type:"number",step:"any",className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r.Latitude||"",onChange:l=>e({...r,Latitude:l.target.value}),placeholder:"Ex: -23.5489"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Valor entre -90 e 90 (ex: -23.5489 para São Paulo)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Longitude"}),a.jsx("input",{type:"number",step:"any",className:"w-full border border-gray-700 bg-gray-800 rounded px-3 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 text-gray-100 placeholder-gray-400 text-base",value:r.Longitude||"",onChange:l=>e({...r,Longitude:l.target.value}),placeholder:"Ex: -46.6388"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Valor entre -180 e 180 (ex: -46.6388 para São Paulo)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-2 text-base",children:"Mapa - Clique para definir a localização"}),a.jsx("div",{ref:t,className:"w-full h-64 border border-gray-700 rounded-lg bg-gray-800",style:{minHeight:"256px"}}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Clique no mapa para definir as coordenadas automaticamente"})]}),a.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-4 border-b border-gray-600 pb-2",children:"Como Usar as Coordenadas"}),a.jsxs("div",{className:"space-y-3 text-sm text-gray-300",children:[a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"Método 1 - Digite manualmente:"}),a.jsx("p",{children:"Digite as coordenadas nos campos acima. Use ponto decimal (ex: -23.5489)."})]}),a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"Método 2 - Clique no mapa:"}),a.jsx("p",{children:"Clique no mapa para definir automaticamente as coordenadas da localização."})]}),a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"Formato das coordenadas:"}),a.jsx("p",{children:"Latitude: -90 a +90 | Longitude: -180 a +180"})]}),a.jsxs("div",{children:[a.jsx("strong",{className:"text-amber-400",children:"Exemplos para São Paulo:"}),a.jsx("p",{children:"Latitude: -23.5489 | Longitude: -46.6388"})]})]})]})]})},Fs={BUCKET_NAME:"imagens-das-escolas",MAX_FILE_SIZE:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_SCHOOL:1/0,MIN_DIMENSIONS:{width:200,height:200}},yr={BUCKET_NAME:"imagens-professores",MAX_FILE_SIZE:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_SCHOOL:1/0,MIN_DIMENSIONS:{width:200,height:200}},Ui=(r,e)=>{if(!e.ALLOWED_TYPES.includes(r.type))return{isValid:!1,error:`Tipo de arquivo não suportado. Use apenas: ${e.ALLOWED_TYPES.map(n=>n.split("/")[1].toUpperCase()).join(", ")}`};if(r.size>e.MAX_FILE_SIZE)return{isValid:!1,error:`Arquivo muito grande. Tamanho máximo: ${e.MAX_FILE_SIZE/(1024*1024)}MB`};const t=r.name.split(".").pop().toLowerCase(),s=e.ALLOWED_TYPES.map(n=>n.split("/")[1]);return s.includes(t)?{isValid:!0}:{isValid:!1,error:`Extensão não permitida. Use apenas: ${s.join(", ")}`}},hh=(r,e)=>{const t=Date.now(),s=Math.random().toString(36).substring(2,8),n=r.name.split(".").pop().toLowerCase();return`${e}_${t}_${s}.${n}`},fh=(r,e,t)=>{const s=Date.now(),n=Math.random().toString(36).substring(2,8),o=r.name.split(".").pop().toLowerCase();return`${t}_${e}_${s}_${n}.${o}`},Vv=async(r,e,t="")=>{try{const s=Ui(r,Fs);if(!s.isValid)throw new Error(s.error);const n=hh(r,e),o=`${e}/${n}`,{error:i}=await re.storage.from(Fs.BUCKET_NAME).upload(o,r,{cacheControl:"3600",upsert:!1});if(i)throw new Error(`Erro no upload: ${i.message}`);const{data:{publicUrl:l}}=re.storage.from(Fs.BUCKET_NAME).getPublicUrl(o);return{id:Date.now(),url:o,publicUrl:l,descricao:t.trim()||`Imagem da escola ${e}`,created_at:new Date().toISOString()}}catch(s){throw B.error("Erro no upload da imagem da escola:",s),s}},Gv=async(r,e,t="",s="professor")=>{try{const n=Ui(r,yr);if(!n.isValid)throw new Error(n.error);const o=fh(r,e,s),i=`${e}/${o}`,{error:l}=await re.storage.from(yr.BUCKET_NAME).upload(i,r,{cacheControl:"3600",upsert:!1});if(l)throw B.error("Erro detalhado do upload:",l),new Error(`Erro no upload: ${l.message}`);const{data:{publicUrl:d}}=re.storage.from(yr.BUCKET_NAME).getPublicUrl(i);return{id:Date.now(),url:i,publicUrl:d,descricao:t.trim()||`Imagem do ${s} da escola ${e}`,genero:s,created_at:new Date().toISOString()}}catch(n){throw B.error("Erro no upload da imagem do professor:",n),n}},Kv=async(r,e,t)=>{try{const{error:s}=await re.storage.from(t).remove([e]);if(s)throw new Error(`Erro ao deletar arquivo: ${s.message}`);const n=e.includes("/")?e.split("/")[0]+"/":"",{data:o,error:i}=await re.storage.from(t).list(n);if(i)B.warn("Aviso: falha ao listar após deleção:",i);else if(o&&o.some(l=>`${n}${l.name}`===e))throw new Error("Arquivo ainda presente no bucket após tentativa de exclusão. Verifique permissões do bucket.");return!0}catch(s){throw B.error("Erro ao deletar imagem:",s),s}},gh=async(r,e,t,s,n="",o={})=>{try{const{transferLegend:i=!0,tipoFoto:l="escola"}=o,d=s===yr.BUCKET_NAME?yr:Fs,h=Ui(r,d);if(!h.isValid)throw new Error(h.error);const f=s===yr.BUCKET_NAME?fh(r,t,"professor"):hh(r,t),m=`${t}/${f}`,{error:u}=await re.storage.from(s).upload(m,r,{cacheControl:"3600",upsert:!1});if(u)throw new Error(`Erro no upload da nova imagem: ${u.message}`);const{data:{publicUrl:g}}=re.storage.from(s).getPublicUrl(m);if(i)try{const{transferLegendaToNewUrl:x}=await Xr(async()=>{const{transferLegendaToNewUrl:A}=await import("./legendasService-DUcmGvtQ.js");return{transferLegendaToNewUrl:A}},__vite__mapDeps([3,1,2]));await x(e,m,t,l)}catch(x){B.warn("Erro ao transferir legenda (não crítico):",x)}const{error:y}=await re.storage.from(s).remove([e]);return y&&B.warn("Erro ao deletar imagem antiga:",y),{id:Date.now(),url:m,publicUrl:g,descricao:n.trim()||`Imagem da escola ${t}`,created_at:new Date().toISOString()}}catch(i){throw B.error("Erro ao substituir imagem:",i),i}},Wv=async(r,e,t)=>{const s=[];for(let n=0;n<r.length;n++){const o=r[n],i=(n+1)/r.length*100;t&&t(i);const l=await Vv(o,e);s.push(l)}return s},Zv=async(r,e,t,s,n="",o={})=>{const i=o.tipoFoto||(s==="imagens-professores"?"professor":"escola");return await gh(r,e,t,s,n,{transferLegend:!0,tipoFoto:i})},Xv={MAX_FILE_SIZE:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],ALLOWED_EXTENSIONS:["jpeg","jpg","png","webp","gif"]},Yv=(r,e={})=>{const t={...Xv,...e};if(!t.ALLOWED_TYPES.includes(r.type))return{isValid:!1,error:`Arquivo "${r.name}" não é uma imagem válida. Use apenas JPG, PNG, WEBP ou GIF.`};if(r.size>t.MAX_FILE_SIZE)return{isValid:!1,error:`Arquivo "${r.name}" é muito grande. Tamanho máximo: ${t.MAX_FILE_SIZE/(1024*1024)}MB.`};const s=r.name.split(".").pop()?.toLowerCase();return!s||!t.ALLOWED_EXTENSIONS.includes(s)?{isValid:!1,error:`Extensão não permitida para "${r.name}". Use apenas: ${t.ALLOWED_EXTENSIONS.join(", ")}`}:{isValid:!0}},mh=(r,e={})=>{const t=[],s=[];return r.forEach(n=>{const o=Yv(n,e);o.isValid?t.push(n):s.push(o.error)}),{validFiles:t,errors:s}},Qv=r=>{const[e,t]=w.useState(!1),[s,n]=w.useState(0),[o,i]=w.useState(null),l=w.useCallback(async h=>{if(!h||h.length===0)return[];t(!0),n(0),i(null);try{const{validFiles:f,errors:m}=mh(h);if(m.length>0)return i(m[0]),t(!1),[];if(f.length===0)return t(!1),[];const u=await Wv(f,r,g=>n(g));return n(100),t(!1),u}catch(f){return console.error("Erro no upload:",f),i(f.message||"Erro ao fazer upload"),t(!1),n(0),[]}},[r]),d=w.useCallback(()=>{t(!1),n(0),i(null)},[]);return{uploadFiles:l,uploading:e,progress:s,error:o,reset:d}},Jv=(r,e,t)=>!r||r.length===0?[]:r.map(s=>{const n=`${e}/${s.name}`,{data:{publicUrl:o}}=re.storage.from(t).getPublicUrl(n);return console.log(`[transformFilesToImages] File: ${s.name}`,{filePath:n,publicUrl:o,fileProperties:Object.keys(s),hasMetadata:!!s.metadata}),{id:`${e}-${s.name}`,url:n,publicURL:o,publicUrl:o,filePath:n,descricao:"Imagem",created_at:s.created_at||new Date().toISOString()}}),e2=(r,e)=>r.map(t=>{const s=e.get(t.url);if(!s&&t.legendaData)return t;const n=s?{legenda:s.legenda||"",descricao_detalhada:s.descricao_detalhada||"",autor_foto:s.autor_foto||"",data_foto:s.data_foto||"",categoria:s.categoria||"geral"}:t.legendaData||{legenda:"",descricao_detalhada:"",autor_foto:"",data_foto:"",categoria:"geral"};return{...t,publicURL:t.publicURL,publicUrl:t.publicURL||t.publicUrl,legendaData:n}}),t2=async(r,e,t="escola")=>{if(!e||!r||r.length===0)return r;try{const{data:s,error:n}=await re.from("legendas_fotos").select("imagem_url, ordem").eq("escola_id",e).eq("tipo_foto",t).eq("ativo",!0);if(n)return console.warn("Erro ao buscar ordem das imagens:",n),r;if(!s||s.length===0)return r;const o=new Map;s.forEach(d=>{d.ordem!==null&&d.ordem!==void 0&&o.set(d.imagem_url,d.ordem)});const i=r.map(d=>({...d,publicURL:d.publicURL||d.publicUrl,publicUrl:d.publicURL||d.publicUrl})).sort((d,h)=>{const f=o.get(d.url)??1/0,m=o.get(h.url)??1/0;return f-m}),l=i.filter(d=>!d.publicURL&&!d.publicUrl);return l.length>0&&(console.warn("[imageOrderService] ⚠️ publicURL perdido após ordenação:",l.length,"imagens"),l.forEach(d=>{if(d.url){const h=d.url.includes("professores")?"imagens-professores":"imagens-das-escolas",{data:{publicUrl:f}}=re.storage.from(h).getPublicUrl(d.url);d.publicURL=f,d.publicUrl=f}})),i}catch(s){return console.warn("Erro ao carregar ordem das imagens:",s),r}},r2=async(r,e)=>{if(!(!e||!r||r.length===0))try{const t=r.map((s,n)=>({imageUrl:s.url,ordem:n+1}));await xf(t,e)}catch(t){throw console.error("Erro ao salvar ordem das imagens no banco:",t),new Error("Erro ao salvar ordem das imagens. Tente novamente.")}},s2=(r,e="escola")=>{const t=w.useCallback(async n=>await t2(n,r,e),[r,e]),s=w.useCallback(async n=>await r2(n,r),[r]);return{loadOrder:t,saveOrder:s}},Bi=(r,e="escola")=>{const[t,s]=w.useState(!1),n=w.useCallback(async i=>{if(!i||i.length===0||!r)return new Map;s(!0);const l=new Map;try{for(const d of i){const h=await Zi(d,r,{tipo_foto:e});h&&l.set(d,h)}}catch(d){console.error("Erro ao buscar legendas:",d)}finally{s(!1)}return l},[r,e]),o=w.useCallback(async(i,l)=>{if(!r||!i)throw new Error("ID da escola ou URL da imagem não encontrado");const d=["legenda","descricao_detalhada","autor_foto","data_foto","categoria"],h={};d.forEach(f=>{const m=l?.[f];if(m!=null&&m!=="")if(f==="data_foto")try{const u=new Date(m);isNaN(u.getTime())||(h[f]=u.toISOString().split("T")[0])}catch{}else{const u=String(m).trim();u!==""&&(h[f]=u)}});try{let f=await Zi(i,r,{tipo_foto:e});f?await yf(f.id,{...h,updated_at:new Date().toISOString()}):await vf({escola_id:r,imagem_url:i,...h,ativo:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tipo_foto:e})}catch(f){throw console.error("Erro ao salvar legenda:",f),f}},[r,e]);return{loading:t,fetchLegends:n,saveLegend:o}},ph=(r,e="imagens-das-escolas",t="escola")=>{const[s,n]=w.useState([]),[o,i]=w.useState(!0),[l,d]=w.useState(null),h=w.useRef(!1),f=w.useRef(null),m=w.useRef(null),u=w.useRef(!1),{loadOrder:g,saveOrder:y}=s2(r,t),{fetchLegends:x}=Bi(r,t),A=w.useCallback(async(D=!0)=>{if(r){if(h.current){console.log("[useImageManagement] Fetch já em progresso, ignorando...");return}if(u.current&&f.current===r&&m.current===e){console.log("[useImageManagement] Já carregado para este escolaId/bucket, ignorando re-execução...");return}h.current=!0,f.current=r,m.current=e;try{D&&i(!0),d(null);const{data:F,error:T}=await re.storage.from(e).list(`${r}/`);if(T)throw T;if(!F||F.length===0){n([]),u.current=!0,D&&i(!1);return}const V=Jv(F,r,e);console.log("[useImageManagement] Images after transform:",V.map(S=>({id:S.id,url:S.url,publicURL:S.publicURL||"MISSING",hasPublicURL:!!S.publicURL})));const O=await g(V);console.log("[useImageManagement] Images after ordering:",O.map(S=>({id:S.id,url:S.url,publicURL:S.publicURL||"MISSING",hasPublicURL:!!S.publicURL})));const p=O.map(S=>S.url),j=await x(p),N=e2(O,j);console.log("[useImageManagement] Final images:",N.map(S=>({id:S.id,url:S.url,publicURL:S.publicURL||"MISSING",hasPublicURL:!!S.publicURL}))),n(S=>{if(u.current&&S.length>0){const L=new Set(S.map(M=>M.id)),I=new Set(N.map(M=>M.id));if(L.size===I.size&&[...L].every(M=>I.has(M)))return console.log("[useImageManagement] Imagens já carregadas, preservando estado anterior"),S}return u.current=!0,N})}catch(F){console.error("Erro ao buscar imagens:",F),d("Erro ao carregar imagens existentes")}finally{h.current=!1,D&&i(!1)}}},[r,e,g,x]);w.useEffect(()=>{(f.current!==r||m.current!==e)&&(u.current=!1,h.current=!1),A(!0)},[r,e]);const C=w.useCallback(async(D,F)=>{try{await Kv(D,F,e),await A()}catch(T){throw console.error("Erro ao deletar imagem:",T),T}},[e,A]),v=w.useCallback(async D=>{n(F=>{const T=[...F,...D];return y(T).catch(V=>{console.error("Erro ao salvar ordem:",V)}),T})},[y]),k=w.useCallback(async D=>{try{await y(D),n(D)}catch(F){throw console.error("Erro ao atualizar imagens:",F),F}},[y]),_=w.useCallback((D,F)=>{n(T=>T.map(V=>{if(V.id===D){const O=F(V);return{...O,publicURL:O.publicURL||V.publicURL,publicUrl:O.publicURL||O.publicUrl||V.publicURL||V.publicUrl}}return V}))},[]),q=w.useCallback((D=!1)=>(u.current=!1,h.current=!1,A(D)),[A]);return{images:s,loading:o,error:l,refresh:q,deleteImage:C,addImages:v,updateImages:k,updateImageLocal:_}},bh=r=>{const[e,t]=w.useState(null),[s,n]=w.useState(null),o=w.useCallback((f,m)=>{t(m),f.dataTransfer.effectAllowed="move",f.dataTransfer.setData("text/html",f.target)},[]),i=w.useCallback((f,m)=>{f.preventDefault(),f.dataTransfer.dropEffect="move",n(m)},[]),l=w.useCallback(()=>{n(null)},[]),d=w.useCallback((f,m,u)=>{if(f.preventDefault(),f.stopPropagation(),e===null||e===m){t(null),n(null);return}[...u],t(null),n(null)},[e,r]),h=w.useCallback(()=>{t(null),n(null)},[]);return{draggedIndex:e,dragOverIndex:s,handleDragStart:o,handleDragOver:i,handleDragLeave:l,handleDrop:d,handleDragEnd:h}};class Go{static async getImagemHeader(e){try{const{data:t,error:s}=await re.from("escolas_completa").select("imagem_header").eq("id",e).single();if(s)throw s;return t?.imagem_header||null}catch(t){throw B.error("Erro ao buscar imagem do header:",t),t}}static async setImagemHeader(e,t){try{const{error:s}=await re.from("escolas_completa").update({imagem_header:t}).eq("id",e);if(s)throw s}catch(s){throw B.error("Erro ao definir imagem do header:",s),s}}static async removeImagemHeader(e){try{const{error:t}=await re.from("escolas_completa").update({imagem_header:null}).eq("id",e);if(t)throw t}catch(t){throw B.error("Erro ao remover imagem do header:",t),t}}}const a2=r=>{const[e,t]=w.useState(null),[s,n]=w.useState(!1),o=w.useCallback(async()=>{if(r)try{const d=await Go.getImagemHeader(r);t(d)}catch(d){console.error("Erro ao buscar imagem do header:",d)}},[r]);w.useEffect(()=>{o()},[o]);const i=w.useCallback(async d=>{if(r)try{n(!0),await Go.setImagemHeader(r,d),t(d)}catch(h){throw console.error("Erro ao definir imagem do header:",h),h}finally{n(!1)}},[r]),l=w.useCallback(async()=>{if(r)try{n(!0),await Go.removeImagemHeader(r),t(null)}catch(d){throw console.error("Erro ao remover imagem do header:",d),d}finally{n(!1)}},[r]);return{headerImageUrl:e,loading:s,setHeaderImage:i,removeHeaderImage:l,refresh:o}},n2=r=>{const[e,t]=w.useState([]),[s,n]=w.useState(!1),o=w.useCallback(async()=>{if(r)try{const h=await Xa.getDrawingsImages(r);t(h)}catch(h){console.error("Erro ao buscar imagens de desenhos:",h)}},[r]);w.useEffect(()=>{o()},[o]);const i=w.useCallback(async h=>{if(r)try{n(!0),await Xa.addDrawingImage(r,h),t(f=>f.includes(h)?f:[...f,h])}catch(f){throw console.error("Erro ao adicionar imagem aos desenhos:",f),f}finally{n(!1)}},[r]),l=w.useCallback(async h=>{if(r)try{n(!0),await Xa.removeDrawingImage(r,h),t(f=>f.filter(m=>m!==h))}catch(f){throw console.error("Erro ao remover imagem dos desenhos:",f),f}finally{n(!1)}},[r]),d=w.useCallback(h=>e.includes(h),[e]);return{drawingsImageUrls:e,loading:s,addDrawingImage:i,removeDrawingImage:l,isDrawingImage:d,refresh:o}},o2=(r,e="imagens-das-escolas")=>{const[t,s]=w.useState(null),[n,o]=w.useState(null),[i,l]=w.useState(!1),d=w.useCallback(u=>{s(u),o(null)},[]),h=w.useCallback(()=>{s(null),o(null)},[]),f=w.useCallback(u=>{o(u)},[]),m=w.useCallback(async(u,g,y="")=>{if(!n)throw new Error("Selecione uma nova imagem para substituir");try{l(!0);const A=await Zv(n,g,r,e,y,{tipoFoto:e==="imagens-professores"?"professor":"escola"});return s(null),o(null),l(!1),A}catch(x){throw console.error("Erro ao substituir imagem:",x),l(!1),x}},[n,r,e]);return{replacingImageId:t,replacementFile:n,uploading:i,startReplace:d,cancelReplace:h,selectReplacementFile:f,replaceImage:m}},xh=({onFilesSelected:r,onDrop:e,disabled:t=!1,accept:s="image/jpeg,image/jpg,image/png,image/webp,image/gif",maxSize:n=5*1024*1024})=>{const o=w.useCallback(d=>{const h=Array.from(d.target.files);h.length>0&&r&&r(h),d.target.value=""},[r]),i=w.useCallback(d=>{d.preventDefault();const h=Array.from(d.dataTransfer.files);if(h.length>0&&e){const f=h.filter(m=>m.type.startsWith("image/"));f.length>0&&e(f)}},[e]),l=w.useCallback(d=>{d.preventDefault()},[]);return a.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${t?"border-gray-600 bg-gray-800/50":"border-gray-600 bg-gray-800/50 hover:border-blue-400 hover:bg-gray-700/50"}`,onDrop:i,onDragOver:l,children:[a.jsx(Xs,{className:"w-8 h-8 text-blue-400 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-300 mb-2",children:"Arraste imagens aqui ou clique para selecionar"}),a.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["JPG, PNG, WEBP, GIF • Máximo ",n/(1024*1024),"MB por arquivo"]}),a.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors",children:[a.jsx("input",{type:"file",multiple:!0,accept:s,onChange:o,className:"hidden",disabled:t}),"Selecionar Arquivos"]})]})};xh.propTypes={onFilesSelected:R.func.isRequired,onDrop:R.func.isRequired,disabled:R.bool,accept:R.string,maxSize:R.number};const yh=({progress:r,uploading:e,message:t})=>e?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[a.jsx("span",{children:t||"Fazendo upload..."}),a.jsxs("span",{children:[Math.round(r),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${r}%`}})})]}):null;yh.propTypes={progress:R.number.isRequired,uploading:R.bool.isRequired,message:R.string};const i2=r=>{const[e,t]=w.useState(null),s=w.useRef(null),n=w.useRef(null);return w.useEffect(()=>{if(!r){s.current&&(URL.revokeObjectURL(s.current),s.current=null,t(null)),n.current=null;return}if(n.current!==r){s.current&&URL.revokeObjectURL(s.current);const o=URL.createObjectURL(r);s.current=o,n.current=r,t(o)}return()=>{s.current&&(URL.revokeObjectURL(s.current),s.current=null)}},[r]),e},ls=({file:r,alt:e,className:t="",...s})=>{const n=i2(r);return!r||!n?a.jsx("div",{className:`bg-gray-100 flex items-center justify-center ${t}`,children:a.jsx("span",{className:"text-xs text-gray-400",children:"Sem preview"})}):a.jsx("img",{src:n,alt:e||r.name||"Preview",className:t,...s})};ls.propTypes={file:R.instanceOf(File),alt:R.string,className:R.string};const vh=({files:r,onRemove:e,onUpload:t,uploading:s})=>!r||r.length===0?null:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h4",{className:"font-medium text-gray-100",children:["Arquivos selecionados (",r.length,")"]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:r.map((n,o)=>a.jsxs("div",{className:"relative group",children:[a.jsx(ls,{file:n,alt:n.name,className:"w-full h-24 object-cover rounded-lg border"}),a.jsx("button",{onClick:()=>e(o),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",type:"button",children:a.jsx(ze,{className:"w-3 h-3"})}),a.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:n.name})]},o))}),a.jsx("button",{onClick:t,disabled:s,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",type:"button",children:s?"Fazendo Upload...":"Fazer Upload"})]});vh.propTypes={files:R.arrayOf(R.instanceOf(File)).isRequired,onRemove:R.func.isRequired,onUpload:R.func.isRequired,uploading:R.bool.isRequired};const wh=({image:r,isHeader:e,isDrawing:t,onDelete:s,onReplace:n,onSetHeader:o,onRemoveHeader:i,onAddDrawing:l,onRemoveDrawing:d,loading:h=!1})=>a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center pointer-events-none group-hover:pointer-events-auto",style:{willChange:"opacity",zIndex:0},"aria-hidden":"true",children:a.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",style:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",pointerEvents:"auto"},children:[!e&&o&&a.jsx("button",{onClick:f=>{f.stopPropagation(),o(r.publicURL)},disabled:h,className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 transition-colors shadow-lg",title:"Usar como imagem do header",type:"button",children:a.jsx(Ht,{className:"w-5 h-5"})}),e&&i&&a.jsx("button",{onClick:f=>{f.stopPropagation(),i()},disabled:h,className:"p-2 bg-yellow-500 text-white rounded-full hover:bg-yellow-700 disabled:opacity-50 transition-colors shadow-lg",title:"Remover do header",type:"button",children:a.jsx(ze,{className:"w-5 h-5"})}),!t&&l&&a.jsx("button",{onClick:f=>{f.stopPropagation(),l(r.publicURL)},disabled:h,className:"p-2 bg-purple-500 text-white rounded-full hover:bg-purple-700 disabled:opacity-50 transition-colors shadow-lg",title:"Adicionar aos Desenhos",type:"button",children:a.jsx(Lf,{className:"w-5 h-5"})}),t&&d&&a.jsx("button",{onClick:f=>{f.stopPropagation(),d(r.publicURL)},disabled:h,className:"p-2 bg-purple-600 text-white rounded-full hover:bg-purple-800 disabled:opacity-50 transition-colors shadow-lg",title:"Remover dos Desenhos",type:"button",children:a.jsx(ze,{className:"w-5 h-5"})}),n&&a.jsx("button",{onClick:n,className:"p-2 bg-orange-500 text-white rounded-full hover:bg-orange-700",title:"Trocar imagem",type:"button",children:a.jsx(fi,{className:"w-5 h-5"})}),s&&a.jsx("button",{onClick:()=>s(r.id,r.url),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-700",title:"Excluir imagem",type:"button",children:a.jsx(Ws,{className:"w-5 h-5"})})]})});wh.propTypes={image:R.object.isRequired,isHeader:R.bool.isRequired,isDrawing:R.bool,onDelete:R.func,onReplace:R.func,onSetHeader:R.func,onRemoveHeader:R.func,onAddDrawing:R.func,onRemoveDrawing:R.func,loading:R.bool};const Nh=({value:r,onChange:e,className:t="",placeholder:s="DD/MM/AAAA",...n})=>{const[o,i]=w.useState(()=>Ya(r));w.useEffect(()=>{i(Ya(r))},[r]);const l=h=>{const f=h.target.value;if(f===""){i(""),e({target:{value:""}});return}let m=f.replace(/[^\d/]/g,"");if(m.length>2&&!m.includes("/")&&(m=m.substring(0,2)+"/"+m.substring(2)),m.length>5&&m.split("/").length===2&&(m=m.substring(0,5)+"/"+m.substring(5,9)),m.length>10&&(m=m.substring(0,10)),i(m),m.length===10&&m.includes("/")){const u=Wi(m);u&&e({target:{value:u}})}else m.length<10},d=()=>{if(o&&o.length>0){const h=Wi(o);h?(i(Ya(h)),e({target:{value:h}})):o.length===10&&(i(""),e({target:{value:""}}))}};return a.jsx("input",{type:"text",value:o,onChange:l,onBlur:d,placeholder:s,className:t,maxLength:10,...n})},jh=({legendData:r,onChange:e})=>a.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Descrição Detalhada"}),a.jsx("textarea",{className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:r?.descricao_detalhada||"",onChange:t=>e("descricao_detalhada",t.target.value),placeholder:"Descrição detalhada da imagem...",rows:3}),a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Autor da Foto"}),a.jsx("input",{type:"text",className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:r?.autor_foto||"",onChange:t=>e("autor_foto",t.target.value),placeholder:"Nome do fotógrafo"}),a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Data da Foto"}),a.jsx(Nh,{value:r?.data_foto||"",onChange:t=>e("data_foto",t.target.value),className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",placeholder:"DD/MM/AAAA"}),a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Categoria"}),a.jsx("input",{type:"text",className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:r?.categoria||"",onChange:t=>e("categoria",t.target.value),placeholder:"Digite a categoria da imagem..."})]});jh.propTypes={legendData:R.object,onChange:R.func.isRequired};const Eh=({image:r,legendData:e,onChange:t,onSave:s,expanded:n,onToggleExpand:o})=>a.jsxs("div",{className:"p-4 space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Legenda"}),a.jsx("button",{onClick:o,className:"p-1.5 text-gray-400 hover:text-gray-200 hover:bg-gray-700 rounded transition-colors",title:n?"Ocultar campos detalhados":"Mostrar campos detalhados",type:"button",children:n?a.jsx(Bd,{className:"w-4 h-4"}):a.jsx(Hd,{className:"w-4 h-4"})})]}),a.jsx("input",{type:"text",className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:e?.legenda||"",onChange:i=>t("legenda",i.target.value),placeholder:"Digite a legenda da imagem..."}),n&&a.jsx(jh,{legendData:e,onChange:t}),a.jsx("div",{className:"flex gap-2 pt-2",children:a.jsxs("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",type:"button",children:[a.jsx(Zs,{className:"w-4 h-4"})," Salvar"]})})]});Eh.propTypes={image:R.object.isRequired,legendData:R.object,onChange:R.func.isRequired,onSave:R.func.isRequired,expanded:R.bool.isRequired,onToggleExpand:R.func.isRequired};const _h=({image:r,isHeader:e,isDrawing:t,onDelete:s,onReplace:n,onSetHeader:o,onRemoveHeader:i,onAddDrawing:l,onRemoveDrawing:d,onLegendSave:h,onLegendChange:f,dragHandlers:m,index:u,escolaId:g})=>{const[y,x]=w.useState(!1),{isImagePreloaded:A}=Fd(g,!0),C=()=>{x(T=>!T)},v=(T,V)=>{f&&f(r.id,T,V)},k=()=>{h&&h(r)},_=()=>{n&&n(r.id)},q=m?.draggedIndex===u,D=m?.dragOverIndex===u,F=(()=>{const T=r.publicURL||r.publicUrl;if(!T)return"";if(T.startsWith("http://")||T.startsWith("https://"))return T;const V="/opin/",O=T.startsWith("/")?T:`/${T}`;return`${V.replace(/\/$/,"")}${O}`})();return!F&&r.id&&console.warn("[ImageCard] Missing URL for image:",{id:r.id,url:r.url,publicURL:r.publicURL,publicUrl:r.publicUrl,image:r}),a.jsxs("div",{draggable:!0,onDragStart:T=>m?.handleDragStart(T,u),onDragOver:T=>m?.handleDragOver(T,u),onDragLeave:m?.handleDragLeave,onDrop:T=>m?.handleDrop(T,u),onDragEnd:m?.handleDragEnd,className:`relative bg-gray-800/50 border border-gray-700/50 rounded-lg overflow-hidden shadow-sm transition-all cursor-move group ${e?"ring-2 ring-blue-400":""} ${q?"opacity-50 scale-95":""} ${D?"ring-2 ring-blue-500 scale-105":""}`,children:[a.jsxs("div",{className:"relative w-full aspect-[4/3] bg-gray-100 overflow-hidden",style:{position:"relative",width:"100%",minHeight:"200px",display:"block"},children:[F?a.jsx("img",{src:F,alt:r.descricao||r.legendaData?.legenda||"Imagem da escola",className:"absolute inset-0 w-full h-full object-cover object-center",loading:A(F)?"eager":"lazy",style:{display:"block",visibility:"visible",opacity:1,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1,pointerEvents:"auto"},onError:T=>{console.error("[ImageCard] Error loading image:",{src:F,imageId:r.id,publicURL:r.publicURL,publicUrl:r.publicUrl,url:r.url}),T.target.style.opacity="0.5"},onLoad:T=>{console.log("[ImageCard] Image loaded successfully:",{imageUrl:F,naturalWidth:T.target.naturalWidth,naturalHeight:T.target.naturalHeight}),T.target.style.opacity="1",T.target.style.display="block"}}):a.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 bg-gray-800 z-0",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm",children:"Sem URL da imagem"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",r.id]})]})}),a.jsx("div",{className:"absolute top-2 right-2 z-30 bg-gray-900/80 p-1 rounded cursor-grab active:cursor-grabbing",children:a.jsx(zd,{className:"w-4 h-4 text-gray-400"})}),e&&a.jsxs("div",{className:"absolute top-2 left-2 z-20 bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1",children:[a.jsx(Ht,{className:"w-3 h-3"}),"Header"]}),t&&a.jsxs("div",{className:"absolute top-2 left-2 z-20 bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1",children:[a.jsx(Ht,{className:"w-3 h-3"}),"Desenho"]}),a.jsx(wh,{image:r,isHeader:e,isDrawing:t,onDelete:s,onReplace:_,onSetHeader:o,onRemoveHeader:i,onAddDrawing:l,onRemoveDrawing:d})]}),(r.legendaData?.legenda||r.descricao)&&a.jsx("div",{className:"px-4 pb-2 pt-1",children:a.jsx("p",{className:"text-sm font-medium text-gray-200 line-clamp-2",children:r.legendaData?.legenda||r.descricao})}),a.jsx(Eh,{image:r,legendData:r.legendaData,onChange:v,onSave:k,expanded:y,onToggleExpand:C})]},r.id)};_h.propTypes={image:R.object.isRequired,isHeader:R.bool.isRequired,isDrawing:R.bool,onDelete:R.func,onReplace:R.func,onSetHeader:R.func,onRemoveHeader:R.func,onAddDrawing:R.func,onRemoveDrawing:R.func,onLegendSave:R.func.isRequired,onLegendChange:R.func.isRequired,dragHandlers:R.object.isRequired,index:R.number.isRequired,escolaId:R.oneOfType([R.string,R.number]).isRequired};const Ah=({images:r,onImageReorder:e,dragHandlers:t,escolaId:s,headerImage:n,drawingsImage:o,onDelete:i,onReplace:l,onLegendSave:d,onLegendChange:h})=>a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h4",{className:"font-medium text-gray-100",children:["Imagens da Escola (",r.length,")"]}),a.jsx("p",{className:"text-sm text-gray-400",children:"Arraste as imagens para reordenar"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((f,m)=>a.jsx(_h,{image:f,isHeader:n?.headerImageUrl===f.publicURL,isDrawing:o?.isDrawingImage(f.publicURL),onDelete:i,onReplace:l,onSetHeader:n?.setHeaderImage,onRemoveHeader:n?.removeHeaderImage,onAddDrawing:o?.addDrawingImage,onRemoveDrawing:o?.removeDrawingImage,onLegendSave:d,onLegendChange:h,dragHandlers:t,index:m,escolaId:s},f.id))})]});Ah.propTypes={images:R.arrayOf(R.object).isRequired,onImageReorder:R.func.isRequired,dragHandlers:R.object.isRequired,escolaId:R.oneOfType([R.string,R.number]).isRequired,headerImage:R.object,drawingsImage:R.object,onDelete:R.func,onReplace:R.func,onLegendSave:R.func.isRequired,onLegendChange:R.func.isRequired};const Ch=({isOpen:r,currentImage:e,onClose:t,onReplace:s,uploading:n})=>{const[o,i]=w.useState(null),l=w.useCallback(f=>{const m=f.target.files[0];m&&i(m)},[]),d=w.useCallback(async()=>{o&&s&&(await s(o),i(null))},[o,s]),h=w.useCallback(()=>{i(null),t()},[t]);return r?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Trocar Imagem"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Selecione a nova imagem"}),a.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:l,className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100"})]}),o&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Pré-visualização"}),a.jsx(ls,{file:o,alt:"Nova imagem",className:"w-full h-32 object-cover rounded-lg border border-gray-600"})]})]}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:h,className:"flex-1 px-4 py-2 border border-gray-600 text-gray-300 rounded-lg hover:bg-gray-700",type:"button",children:"Cancelar"}),a.jsx("button",{onClick:d,disabled:!o||n,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",type:"button",children:n?"Trocando...":"Trocar Imagem"})]})]})}):null};Ch.propTypes={isOpen:R.bool.isRequired,currentImage:R.object.isRequired,onClose:R.func.isRequired,onReplace:R.func.isRequired,uploading:R.bool.isRequired};const Th=({message:r,icon:e})=>a.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e||a.jsx(Kr,{className:"w-12 h-12 mx-auto mb-2 text-gray-500"}),a.jsx("p",{children:r||"Nenhuma imagem adicionada ainda."}),a.jsx("p",{className:"text-sm",children:"Adicione imagens para mostrar a escola."})]});Th.propTypes={message:R.string,icon:R.node};const Sh=({escolaId:r,onImagesUpdate:e})=>{const[t,s]=w.useState([]),[n,o]=w.useState(""),[i,l]=w.useState(""),d=Qv(r),h=ph(r,"imagens-das-escolas","escola"),f=a2(r),m=n2(r),u=o2(r,"imagens-das-escolas"),{saveLegend:g}=Bi(r,"escola"),y=bh();w.useEffect(()=>{r&&Ud()},[r]),w.useEffect(()=>{if(n||i){const O=setTimeout(()=>{o(""),l("")},5e3);return()=>clearTimeout(O)}},[n,i]);const x=w.useCallback(O=>{s(p=>[...p,...O]),o("")},[]),A=w.useCallback(O=>{s(p=>[...p,...O]),o("")},[]),C=w.useCallback(O=>{s(p=>p.filter((j,N)=>N!==O))},[]),v=w.useCallback(async()=>{if(t.length!==0)try{const O=await d.uploadFiles(t);O.length>0?(await h.addImages(O),s([]),l(`${O.length} imagem(ns) carregada(s) com sucesso!`),e&&e()):d.error&&o(d.error)}catch(O){console.error("Erro no upload:",O),o(O.message||"Erro ao fazer upload")}},[t,d,h,e]),k=w.useCallback(async(O,p)=>{if(window.confirm("Tem certeza que deseja excluir esta imagem?"))try{const j=h.images.find(N=>N.id===O);if(j){if(j.publicURL===f.headerImageUrl)try{await f.removeHeaderImage()}catch{}if(m.isDrawingImage(j.publicURL))try{await m.removeDrawingImage(j.publicURL)}catch{}}await h.deleteImage(O,p),l("Imagem excluída com sucesso!"),e&&e()}catch(j){console.error("Erro ao deletar imagem:",j),o(j.message||"Erro ao excluir imagem")}},[h,f,m,e]),_=w.useCallback(async O=>{if(!u.replacingImageId)return;const p=h.images.find(j=>j.id===u.replacingImageId);if(p)try{const j=p.legendaData||{},N=p.url,S=await u.replaceImage(u.replacingImageId,p.url,p.descricao||"");h.updateImageLocal(u.replacingImageId,L=>({...L,url:S.url,publicURL:S.publicUrl,publicUrl:S.publicUrl,legendaData:j})),h.refresh(!1).catch(L=>{console.warn("Erro ao atualizar lista de imagens (não crítico):",L)}),l("Imagem substituída com sucesso! A legenda foi preservada."),e&&e()}catch(j){console.error("Erro ao substituir imagem:",j),o(j.message||"Erro ao substituir imagem")}},[h,u,e]);w.useCallback(async O=>{try{await f.setHeaderImage(O),l("Imagem definida como header com sucesso!"),e&&e()}catch(p){console.error("Erro ao definir imagem do header:",p),o(p.message||"Erro ao definir imagem do header")}},[f,e]),w.useCallback(async()=>{try{await f.removeHeaderImage(),l("Imagem removida do header com sucesso!"),e&&e()}catch(O){console.error("Erro ao remover imagem do header:",O),o(O.message||"Erro ao remover imagem do header")}},[f,e]),w.useCallback(async O=>{try{await m.addDrawingImage(O),l("Imagem adicionada aos Desenhos com sucesso!"),e&&e()}catch(p){console.error("Erro ao adicionar imagem aos desenhos:",p),o(p.message||"Erro ao adicionar imagem aos desenhos")}},[m,e]),w.useCallback(async O=>{try{await m.removeDrawingImage(O),l("Imagem removida dos Desenhos com sucesso!"),e&&e()}catch(p){console.error("Erro ao remover imagem dos desenhos:",p),o(p.message||"Erro ao remover imagem dos desenhos")}},[m,e]);const q=w.useCallback(async O=>{try{await h.updateImages(O),l("Ordem das imagens atualizada!"),setTimeout(()=>l(""),3e3)}catch(p){console.error("Erro ao reordenar imagens:",p),o("Erro ao salvar ordem das imagens")}},[h]),D={...y,handleDrop:(O,p)=>{if(y.draggedIndex===null||y.draggedIndex===p){y.handleDragEnd();return}const j=[...h.images],N=j[y.draggedIndex];j.splice(y.draggedIndex,1),j.splice(p,0,N),y.handleDragEnd(),q(j)}},F=w.useCallback((O,p,j)=>{h.updateImageLocal(O,N=>({...N,legendaData:{...N.legendaData||{},[p]:j}}))},[h]),T=w.useCallback(async O=>{try{await g(O.url,O.legendaData),l("Legenda salva com sucesso!"),h.refresh(!1).catch(p=>{console.warn("Erro ao atualizar lista de imagens (não crítico):",p)}),e&&e()}catch(p){console.error("Erro ao salvar legenda:",p),o(p.message||"Erro ao salvar legenda")}},[g,h,e]),V=u.replacingImageId?h.images.find(O=>O.id===u.replacingImageId):null;return h.loading?a.jsx("div",{className:"p-6 bg-gray-800/30 rounded-lg",children:a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("span",{className:"ml-2 text-gray-400",children:"Carregando imagens..."})})}):a.jsxs("div",{className:"space-y-6 ImageUploadSection",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Kr,{className:"w-5 h-5 text-blue-400"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:"Imagens da Escola"})]}),a.jsxs("div",{className:"text-sm text-gray-400",children:[h.images.length," imagens"]})]}),n&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-900/50 border-red-700/50 rounded-xl",children:[a.jsx(xt,{className:"w-5 h-5 text-red-400"}),a.jsx("span",{className:"text-red-300",children:n})]}),i&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-900/50 border-green-700/50 rounded-xl",children:[a.jsx(Ht,{className:"w-5 h-5 text-green-400"}),a.jsx("span",{className:"text-green-300",children:i})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(xh,{onFilesSelected:x,onDrop:A,disabled:d.uploading}),a.jsx(yh,{progress:d.progress,uploading:d.uploading}),a.jsx(vh,{files:t,onRemove:C,onUpload:v,uploading:d.uploading})]}),h.images.length>0&&a.jsx(Ah,{images:h.images,onImageReorder:q,dragHandlers:D,escolaId:r,headerImage:f,drawingsImage:m,onDelete:k,onReplace:O=>u.startReplace(O),onLegendSave:T,onLegendChange:F}),V&&a.jsx(Ch,{isOpen:!!u.replacingImageId,currentImage:V,onClose:u.cancelReplace,onReplace:async O=>{u.selectReplacementFile(O),await _(O)},uploading:u.uploading}),h.images.length===0&&!d.uploading&&a.jsx(Th,{})]})};Sh.propTypes={escolaId:R.oneOfType([R.string,R.number]).isRequired,onImagesUpdate:R.func};const l2=({editingLocation:r,setEditingLocation:e})=>{const t=r?.id;return t?a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"imagensEscola",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Imagens da Escola"}),a.jsx(Sh,{escolaId:t,onImagesUpdate:()=>{}})]}):a.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:a.jsx("p",{children:"Selecione uma escola para gerenciar suas imagens"})})},c2=async r=>{const{data:e,error:t}=await re.from("imagens_professores").insert([r]).select().single();if(t)throw t;return e},d2=async(r,e)=>{const{data:t,error:s}=await re.from("imagens_professores").update(e).eq("id",r).select().single();if(s)throw s;return t},u2=async(r,e)=>{const{data:t,error:s}=await re.from("imagens_professores").select("*").eq("imagem_url",r).eq("escola_id",e).eq("ativo",!0).single();if(s&&s.code!=="PGRST116")throw s;return t||null},h2=async(r,e,t)=>{const s=[];for(let n=0;n<r.length;n++){const o=r[n],i=(n+1)/r.length*100;t&&t(i);const l=await Gv(o,e,"","professor");await c2({escola_id:e,imagem_url:l.url,nome_arquivo:o.name,autor:"",ativo:!0}),s.push(l)}return s},f2=async(r,e,t,s="")=>await gh(r,e,t,"imagens-professores",s,{transferLegend:!0,tipoFoto:"professor"}),g2=r=>{const[e,t]=w.useState(!1),[s,n]=w.useState(0),[o,i]=w.useState(null),l=w.useCallback(async h=>{if(!h||h.length===0)return[];t(!0),n(0),i(null);try{const{validFiles:f,errors:m}=mh(h);if(m.length>0)return i(m[0]),t(!1),[];if(f.length===0)return t(!1),[];const u=await h2(f,r,g=>n(g));return n(100),t(!1),u}catch(f){return console.error("Erro no upload:",f),i(f.message||"Erro ao fazer upload"),t(!1),n(0),[]}},[r]),d=w.useCallback(()=>{t(!1),n(0),i(null)},[]);return{uploadFiles:l,uploading:e,progress:s,error:o,reset:d}},m2=r=>{const[e,t]=w.useState(null),[s,n]=w.useState(null),[o,i]=w.useState(!1),l=w.useCallback(m=>{t(m),n(null)},[]),d=w.useCallback(()=>{t(null),n(null)},[]),h=w.useCallback(m=>{n(m)},[]),f=w.useCallback(async(m,u,g="")=>{if(!s)throw new Error("Selecione uma nova imagem para substituir");try{i(!0);const y=await f2(s,u,r,g);return t(null),n(null),i(!1),y}catch(y){throw console.error("Erro ao substituir imagem:",y),i(!1),y}},[s,r]);return{replacingImageId:e,replacementFile:s,uploading:o,startReplace:l,cancelReplace:d,selectReplacementFile:h,replaceImage:f}},kh=({onFilesSelected:r,onDrop:e,disabled:t=!1,accept:s="image/jpeg,image/jpg,image/png,image/webp,image/gif",maxSize:n=5*1024*1024})=>{const o=w.useCallback(d=>{const h=Array.from(d.target.files);h.length>0&&r&&r(h),d.target.value=""},[r]),i=w.useCallback(d=>{d.preventDefault();const h=Array.from(d.dataTransfer.files);if(h.length>0&&e){const f=h.filter(m=>m.type.startsWith("image/"));f.length>0&&e(f)}},[e]),l=w.useCallback(d=>{d.preventDefault()},[]);return a.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${t?"border-gray-600 bg-gray-800/50":"border-gray-600 bg-gray-800/50 hover:border-green-400 hover:bg-gray-700/50"}`,onDrop:i,onDragOver:l,children:[a.jsx(Xs,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-300 mb-2",children:"Arraste imagens dos professores aqui ou clique para selecionar"}),a.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["JPG, PNG, WEBP, GIF • Máximo ",n/(1024*1024),"MB por arquivo • Máximo 5 imagens"]}),a.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer transition-colors",children:[a.jsx("input",{type:"file",multiple:!0,accept:s,onChange:o,className:"hidden",disabled:t}),"Selecionar Arquivos"]})]})};kh.propTypes={onFilesSelected:R.func.isRequired,onDrop:R.func.isRequired,disabled:R.bool,accept:R.string,maxSize:R.number};const qh=({progress:r,uploading:e,message:t})=>e?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[a.jsx("span",{children:t||"Fazendo upload..."}),a.jsxs("span",{children:[Math.round(r),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${r}%`}})})]}):null;qh.propTypes={progress:R.number.isRequired,uploading:R.bool.isRequired,message:R.string};const Ih=({files:r,onRemove:e,onUpload:t,uploading:s})=>!r||r.length===0?null:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h4",{className:"font-medium text-gray-100",children:["Arquivos selecionados (",r.length,")"]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:r.map((n,o)=>a.jsxs("div",{className:"relative group",children:[a.jsx(ls,{file:n,alt:n.name,className:"w-full h-24 object-cover rounded-lg border"}),a.jsx("button",{onClick:()=>e(o),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",type:"button",children:a.jsx(ze,{className:"w-3 h-3"})}),a.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:n.name})]},o))}),a.jsx("button",{onClick:t,disabled:s,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",type:"button",children:s?"Fazendo Upload...":"Fazer Upload"})]});Ih.propTypes={files:R.arrayOf(R.instanceOf(File)).isRequired,onRemove:R.func.isRequired,onUpload:R.func.isRequired,uploading:R.bool.isRequired};const Lh=({image:r,isHeader:e,onDelete:t,onReplace:s,onSetHeader:n,onRemoveHeader:o,loading:i=!1})=>a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center pointer-events-none group-hover:pointer-events-auto",style:{willChange:"opacity",zIndex:0},"aria-hidden":"true",children:a.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",style:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",pointerEvents:"auto"},children:[!e&&n&&a.jsx("button",{onClick:()=>n(r.publicURL),disabled:i,className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-700 disabled:opacity-50",title:"Usar como imagem do header",type:"button",children:a.jsx(Ht,{className:"w-5 h-5"})}),e&&o&&a.jsx("button",{onClick:o,disabled:i,className:"p-2 bg-yellow-500 text-white rounded-full hover:bg-yellow-700 disabled:opacity-50",title:"Remover do header",type:"button",children:a.jsx(ze,{className:"w-5 h-5"})}),s&&a.jsx("button",{onClick:s,className:"p-2 bg-orange-500 text-white rounded-full hover:bg-orange-700",title:"Trocar imagem",type:"button",children:a.jsx(fi,{className:"w-5 h-5"})}),t&&a.jsx("button",{onClick:()=>t(r.id,r.url),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-700",title:"Excluir imagem",type:"button",children:a.jsx(Ws,{className:"w-5 h-5"})})]})});Lh.propTypes={image:R.object.isRequired,isHeader:R.bool.isRequired,onDelete:R.func,onReplace:R.func,onSetHeader:R.func,onRemoveHeader:R.func,loading:R.bool};const Oh=({legendData:r,onChange:e})=>a.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Descrição Detalhada"}),a.jsx("textarea",{className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:r?.descricao_detalhada||"",onChange:t=>e("descricao_detalhada",t.target.value),placeholder:"Descrição detalhada da imagem...",rows:3}),a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Autor da Foto"}),a.jsx("input",{type:"text",className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:r?.autor_foto||"",onChange:t=>e("autor_foto",t.target.value),placeholder:"Nome do fotógrafo"}),a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Data da Foto"}),a.jsx(Nh,{value:r?.data_foto||"",onChange:t=>e("data_foto",t.target.value),className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",placeholder:"DD/MM/AAAA"}),a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Categoria"}),a.jsx("input",{type:"text",className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:r?.categoria||"",onChange:t=>e("categoria",t.target.value),placeholder:"Digite a categoria da imagem..."})]});Oh.propTypes={legendData:R.object,onChange:R.func.isRequired};const Rh=({image:r,legendData:e,onChange:t,onSave:s,expanded:n,onToggleExpand:o})=>a.jsxs("div",{className:"p-4 space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Legenda"}),a.jsx("button",{onClick:o,className:"p-1.5 text-gray-400 hover:text-gray-200 hover:bg-gray-700 rounded transition-colors",title:n?"Ocultar campos detalhados":"Mostrar campos detalhados",type:"button",children:n?a.jsx(Bd,{className:"w-4 h-4"}):a.jsx(Hd,{className:"w-4 h-4"})})]}),a.jsx("input",{type:"text",className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100",value:e?.legenda||"",onChange:i=>t("legenda",i.target.value),placeholder:"Digite a legenda da imagem..."}),n&&a.jsx(Oh,{legendData:e,onChange:t}),a.jsx("div",{className:"flex gap-2 pt-2",children:a.jsxs("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",type:"button",children:[a.jsx(Zs,{className:"w-4 h-4"})," Salvar"]})})]});Rh.propTypes={image:R.object.isRequired,legendData:R.object,onChange:R.func.isRequired,onSave:R.func.isRequired,expanded:R.bool.isRequired,onToggleExpand:R.func.isRequired};const Mh=({image:r,isHeader:e,onDelete:t,onReplace:s,onSetHeader:n,onRemoveHeader:o,onLegendSave:i,onLegendChange:l,dragHandlers:d,index:h,escolaId:f})=>{const[m,u]=w.useState(!1),{isImagePreloaded:g}=Fd(f,!0),y=()=>{u(q=>!q)},x=(q,D)=>{l&&l(r.id,q,D)},A=()=>{i&&i(r)},C=()=>{s&&s(r.id)},v=d?.draggedIndex===h,k=d?.dragOverIndex===h,_=(()=>{const q=r.publicURL||r.publicUrl;if(!q)return"";if(q.startsWith("http://")||q.startsWith("https://"))return q;const D="/opin/",F=q.startsWith("/")?q:`/${q}`;return`${D.replace(/\/$/,"")}${F}`})();return!_&&r.id&&console.warn("[ImageCard] Missing URL for image:",{id:r.id,url:r.url,publicURL:r.publicURL,publicUrl:r.publicUrl,image:r}),a.jsxs("div",{draggable:!0,onDragStart:q=>d?.handleDragStart(q,h),onDragOver:q=>d?.handleDragOver(q,h),onDragLeave:d?.handleDragLeave,onDrop:q=>d?.handleDrop(q,h),onDragEnd:d?.handleDragEnd,className:`relative bg-gray-800/50 border border-gray-700/50 rounded-lg overflow-hidden shadow-sm transition-all cursor-move group ${e?"ring-2 ring-blue-400":""} ${v?"opacity-50 scale-95":""} ${k?"ring-2 ring-blue-500 scale-105":""}`,children:[a.jsxs("div",{className:"relative w-full aspect-[4/3] bg-gray-100 overflow-hidden",style:{position:"relative",width:"100%",minHeight:"200px",display:"block"},children:[_?a.jsx("img",{src:_,alt:r.descricao||r.legendaData?.legenda||"Imagem do professor",className:"absolute inset-0 w-full h-full object-cover object-center",loading:g(_)?"eager":"lazy",style:{display:"block",visibility:"visible",opacity:1,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1,pointerEvents:"auto"},onError:q=>{console.error("[ImageCard] Error loading image:",{src:_,imageId:r.id,publicURL:r.publicURL,publicUrl:r.publicUrl,url:r.url}),q.target.style.opacity="0.5"},onLoad:q=>{console.log("[ImageCard] Image loaded successfully:",{imageUrl:_,naturalWidth:q.target.naturalWidth,naturalHeight:q.target.naturalHeight}),q.target.style.opacity="1",q.target.style.display="block"}}):a.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 bg-gray-800 z-0",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm",children:"Sem URL da imagem"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",r.id]})]})}),a.jsx("div",{className:"absolute top-2 right-2 z-30 bg-gray-900/80 p-1 rounded cursor-grab active:cursor-grabbing",children:a.jsx(zd,{className:"w-4 h-4 text-gray-400"})}),e&&a.jsxs("div",{className:"absolute top-2 left-2 z-20 bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1",children:[a.jsx(Ht,{className:"w-3 h-3"}),"Header"]}),a.jsx(Lh,{image:r,isHeader:e,onDelete:t,onReplace:C,onSetHeader:n,onRemoveHeader:o})]}),(r.legendaData?.legenda||r.descricao)&&a.jsx("div",{className:"px-4 pb-2 pt-1",children:a.jsx("p",{className:"text-sm font-medium text-gray-200 line-clamp-2",children:r.legendaData?.legenda||r.descricao})}),a.jsx(Rh,{image:r,legendData:r.legendaData,onChange:x,onSave:A,expanded:m,onToggleExpand:y})]},r.id)};Mh.propTypes={image:R.object.isRequired,isHeader:R.bool.isRequired,onDelete:R.func,onReplace:R.func,onSetHeader:R.func,onRemoveHeader:R.func,onLegendSave:R.func.isRequired,onLegendChange:R.func.isRequired,dragHandlers:R.object.isRequired,index:R.number.isRequired,escolaId:R.oneOfType([R.string,R.number]).isRequired};const Ph=({images:r,onImageReorder:e,dragHandlers:t,escolaId:s,headerImage:n,onDelete:o,onReplace:i,onLegendSave:l,onLegendChange:d})=>a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h4",{className:"font-medium text-gray-100",children:["Imagens dos Professores (",r.length,")"]}),a.jsx("p",{className:"text-sm text-gray-400",children:"Arraste as imagens para reordenar"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((h,f)=>a.jsx(Mh,{image:h,isHeader:n?.headerImageUrl===h.publicURL,onDelete:o,onReplace:i,onSetHeader:n?.setHeaderImage,onRemoveHeader:n?.removeHeaderImage,onLegendSave:l,onLegendChange:d,dragHandlers:t,index:f,escolaId:s},h.id))})]});Ph.propTypes={images:R.arrayOf(R.object).isRequired,onImageReorder:R.func.isRequired,dragHandlers:R.object.isRequired,escolaId:R.oneOfType([R.string,R.number]).isRequired,headerImage:R.object,onDelete:R.func,onReplace:R.func,onLegendSave:R.func.isRequired,onLegendChange:R.func.isRequired};const Dh=({isOpen:r,currentImage:e,onClose:t,onReplace:s,uploading:n})=>{const[o,i]=w.useState(null),l=w.useCallback(f=>{const m=f.target.files[0];m&&i(m)},[]),d=w.useCallback(async()=>{o&&s&&(await s(o),i(null))},[o,s]),h=w.useCallback(()=>{i(null),t()},[t]);return r?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Trocar Imagem"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Selecione a nova imagem"}),a.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:l,className:"w-full bg-gray-700 border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-gray-100"})]}),o&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Pré-visualização"}),a.jsx(ls,{file:o,alt:"Nova imagem",className:"w-full h-32 object-cover rounded-lg border border-gray-600"})]})]}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:h,className:"flex-1 px-4 py-2 border border-gray-600 text-gray-300 rounded-lg hover:bg-gray-700",type:"button",children:"Cancelar"}),a.jsx("button",{onClick:d,disabled:!o||n,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",type:"button",children:n?"Trocando...":"Trocar Imagem"})]})]})}):null};Dh.propTypes={isOpen:R.bool.isRequired,currentImage:R.object.isRequired,onClose:R.func.isRequired,onReplace:R.func.isRequired,uploading:R.bool.isRequired};const $h=({message:r,icon:e})=>a.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e||a.jsx(gi,{className:"w-12 h-12 mx-auto mb-2 text-gray-500"}),a.jsx("p",{children:r||"Nenhuma imagem dos professores adicionada ainda."}),a.jsx("p",{className:"text-sm",children:"Adicione imagens para mostrar os professores da escola."})]});$h.propTypes={message:R.string,icon:R.node};const Fh=({escolaId:r,onImagesUpdate:e})=>{const[t,s]=w.useState([]),[n,o]=w.useState(""),[i,l]=w.useState(""),d=g2(r),h=ph(r,"imagens-professores","professor"),f=m2(r),{saveLegend:m}=Bi(r,"professor"),u=bh();w.useEffect(()=>{r&&Ud()},[r]),w.useEffect(()=>{if(n||i){const T=setTimeout(()=>{o(""),l("")},5e3);return()=>clearTimeout(T)}},[n,i]);const g=w.useCallback(T=>{s(V=>[...V,...T]),o("")},[]),y=w.useCallback(T=>{s(V=>[...V,...T]),o("")},[]),x=w.useCallback(T=>{s(V=>V.filter((O,p)=>p!==T))},[]),A=w.useCallback(async()=>{if(t.length!==0)try{const T=await d.uploadFiles(t);T.length>0?(await h.addImages(T),s([]),l(`${T.length} imagem(ns) do(s) professor(es) carregada(s) com sucesso!`),e&&e()):d.error&&o(d.error)}catch(T){console.error("Erro no upload:",T),o(T.message||"Erro ao fazer upload")}},[t,d,h,e]),C=w.useCallback(async(T,V)=>{if(window.confirm("Tem certeza que deseja excluir esta imagem do professor?"))try{await h.deleteImage(T,V),l("Imagem do professor excluída com sucesso!"),e&&e()}catch(O){console.error("Erro ao deletar imagem:",O),o(O.message||"Erro ao excluir imagem")}},[h,e]),v=w.useCallback(async T=>{if(!f.replacingImageId)return;const V=h.images.find(O=>O.id===f.replacingImageId);if(V)try{const O=V.legendaData||{},p=await f.replaceImage(f.replacingImageId,V.url,V.descricao||"");h.updateImageLocal(f.replacingImageId,j=>({...j,url:p.url,publicURL:p.publicUrl,publicUrl:p.publicUrl,legendaData:O})),h.refresh(!1).catch(j=>{console.warn("Erro ao atualizar lista de imagens (não crítico):",j)}),l("Imagem do professor substituída com sucesso! A legenda foi preservada."),e&&e()}catch(O){console.error("Erro ao substituir imagem:",O),o(O.message||"Erro ao substituir imagem")}},[h,f,e]),k=w.useCallback(async T=>{try{await h.updateImages(T),l("Ordem das imagens atualizada!"),setTimeout(()=>l(""),3e3)}catch(V){console.error("Erro ao reordenar imagens:",V),o("Erro ao salvar ordem das imagens")}},[h]),_={...u,handleDrop:(T,V)=>{if(u.draggedIndex===null||u.draggedIndex===V){u.handleDragEnd();return}const O=[...h.images],p=O[u.draggedIndex];O.splice(u.draggedIndex,1),O.splice(V,0,p),u.handleDragEnd(),k(O)}},q=w.useCallback((T,V,O)=>{h.updateImageLocal(T,p=>({...p,legendaData:{...p.legendaData||{},[V]:O}}))},[h]),D=w.useCallback(async T=>{try{await m(T.url,T.legendaData);const V=T.publicURL||T.publicUrl;if(V&&T.legendaData?.autor_foto)try{const O=await u2(V,r);O&&await d2(O.id,{autor:T.legendaData.autor_foto,updated_at:new Date().toISOString()})}catch(O){console.warn("Erro ao atualizar meta do professor:",O)}l("Legenda salva com sucesso!"),await h.refresh(),e&&e()}catch(V){console.error("Erro ao salvar legenda:",V),o(V.message||"Erro ao salvar legenda")}},[m,h,r,e]),F=f.replacingImageId?h.images.find(T=>T.id===f.replacingImageId):null;return h.loading?a.jsx("div",{className:"p-6 bg-gray-800/30 rounded-lg",children:a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("span",{className:"ml-2 text-gray-400",children:"Carregando imagens dos professores..."})})}):a.jsxs("div",{className:"space-y-6 ProfessorImageUploadSection",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(gi,{className:"w-5 h-5 text-green-400"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-100",children:"Imagens dos Professores"})]}),a.jsxs("div",{className:"text-sm text-gray-400",children:[h.images.length," imagens"]})]}),n&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-900/50 border-red-700/50 rounded-xl",children:[a.jsx(xt,{className:"w-5 h-5 text-red-400"}),a.jsx("span",{className:"text-red-300",children:n})]}),i&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-900/50 border-green-700/50 rounded-xl",children:[a.jsx(Ht,{className:"w-5 h-5 text-green-400"}),a.jsx("span",{className:"text-green-300",children:i})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(kh,{onFilesSelected:g,onDrop:y,disabled:d.uploading}),a.jsx(qh,{progress:d.progress,uploading:d.uploading}),a.jsx(Ih,{files:t,onRemove:x,onUpload:A,uploading:d.uploading})]}),h.images.length>0&&a.jsx(Ph,{images:h.images,onImageReorder:k,dragHandlers:_,escolaId:r,headerImage:null,onDelete:C,onReplace:T=>f.startReplace(T),onLegendSave:D,onLegendChange:q}),F&&a.jsx(Dh,{isOpen:!!f.replacingImageId,currentImage:F,onClose:f.cancelReplace,onReplace:async T=>{f.selectReplacementFile(T),await v(T)},uploading:f.uploading}),h.images.length===0&&!d.uploading&&a.jsx($h,{})]})};Fh.propTypes={escolaId:R.oneOfType([R.string,R.number]).isRequired,onImagesUpdate:R.func};const p2=({editingLocation:r,setEditingLocation:e})=>{const t=r?.id;return t?a.jsx("div",{className:"space-y-6",children:a.jsx(Fh,{escolaId:t,onImagesUpdate:()=>{}})}):a.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:a.jsx("p",{children:"Selecione uma escola para gerenciar as imagens dos professores"})})},Uh=({onUploadComplete:r,onRemove:e,existingUrls:t=[]})=>{const[s,n]=w.useState(!1),[o,i]=w.useState(null),[l,d]=w.useState([]),[h,f]=w.useState(t),m=async y=>{const x=Array.from(y.target.files);if(x.length===0)return;const A=x.filter(C=>{const v=zt.PDF.ALLOWED_TYPES.includes(C.type),k=C.size<=zt.PDF.MAX_SIZE;return v&&k});A.length!==x.length&&i("Alguns arquivos foram ignorados. Use apenas PDFs até 10MB."),d(C=>[...C,...A])},u=async()=>{if(l.length===0)return;n(!0),i(null);const y=[];try{for(const A of l){const C=await Pv(A);y.push(C)}const x=[...h,...y];f(x),r(x),d([])}catch(x){i("Erro ao fazer upload dos arquivos. Tente novamente."),console.error("Erro no upload:",x)}finally{n(!1)}},g=y=>{const x=h.filter((A,C)=>C!==y);f(x),e(x)};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block font-medium text-gray-800",children:["Documentos PDF",a.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(Máx. ",zt.PDF.MAX_SIZE/(1024*1024),"MB cada arquivo)"]})]}),o&&a.jsxs("div",{className:"flex items-center text-red-500 text-sm",children:[a.jsx(xt,{size:16,className:"mr-1"}),o]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[a.jsxs("label",{className:"cursor-pointer",children:[a.jsx("input",{type:"file",accept:".pdf",multiple:!0,onChange:m,className:"hidden",disabled:s}),a.jsxs("div",{className:`flex items-center justify-center gap-2 border-2 border-dashed rounded-lg p-4 
            ${s?"border-gray-300 bg-gray-50":"border-blue-300 hover:border-blue-400 bg-blue-50"}`,children:[a.jsx(Xs,{size:20,className:s?"text-gray-400":"text-blue-500"}),a.jsx("span",{className:s?"text-gray-500":"text-blue-600",children:s?"Fazendo upload...":"Selecionar PDFs"})]})]}),l.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-medium text-sm text-gray-700",children:"Arquivos selecionados:"}),a.jsx("div",{className:"grid grid-cols-1 gap-2",children:l.map((y,x)=>a.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Yi,{size:16,className:"text-gray-500"}),a.jsx("span",{className:"text-sm text-gray-700",children:y.name})]}),a.jsx("button",{type:"button",onClick:()=>d(A=>A.filter((C,v)=>v!==x)),className:"text-gray-500 hover:text-red-500",children:a.jsx(ze,{size:16})})]},x))}),a.jsx("button",{type:"button",onClick:u,disabled:s,className:`w-full py-2 px-4 rounded-lg text-white font-medium
                ${s?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"}`,children:s?"Enviando...":"Fazer Upload"})]}),h.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-medium text-sm text-gray-700",children:"Documentos enviados:"}),a.jsx("div",{className:"grid grid-cols-1 gap-2",children:h.map((y,x)=>a.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Yi,{size:16,className:"text-gray-500"}),a.jsxs("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:["Documento ",x+1]})]}),a.jsx("button",{type:"button",onClick:()=>g(x),className:"text-gray-500 hover:text-red-500",children:a.jsx(ze,{size:16})})]},x))})]})]})]})};Uh.propTypes={onUploadComplete:R.func.isRequired,onRemove:R.func.isRequired,existingUrls:R.arrayOf(R.string)};const b2=({editingLocation:r,setEditingLocation:e})=>{const t=r?.id,[s,n]=w.useState(r?.documentos||[]);if(!t)return a.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:a.jsx("p",{children:"Selecione uma escola para gerenciar seus documentos"})});const o=l=>{n(l)},i=l=>{n(l)};return a.jsxs("div",{className:"space-y-6",children:[a.jsx(et,{cardId:"documentos",editingLocation:r,setEditingLocation:e,label:"Visibilidade do Card: Documentos"}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Documentos da Escola"}),a.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Faça upload de documentos da escola em formato PDF. Não há limite no número de documentos."}),a.jsx(Uh,{onUploadComplete:o,onRemove:i,existingUrls:s})]})]})},x2=(r,e)=>{const t=r?.activeTab||Ds.DEFAULT_ACTIVE_TAB;switch(t){case"dados-basicos":return a.jsx(ng,{editingLocation:r,setEditingLocation:e});case"povos-linguas":return a.jsx(og,{editingLocation:r,setEditingLocation:e});case"modalidades":return a.jsx(ig,{editingLocation:r,setEditingLocation:e});case"infraestrutura":return a.jsx(lg,{editingLocation:r,setEditingLocation:e});case"gestao-professores":return a.jsx(cg,{editingLocation:r,setEditingLocation:e});case"funcionarios":return a.jsx(dg,{editingLocation:r,setEditingLocation:e});case"material-pedagogico":return a.jsx(ug,{editingLocation:r,setEditingLocation:e});case"projetos-parcerias":return a.jsx(hg,{editingLocation:r,setEditingLocation:e});case"redes-sociais":return a.jsx(fg,{editingLocation:r,setEditingLocation:e});case"video":return a.jsx(mg,{editingLocation:r,setEditingLocation:e});case"historias":return a.jsx(Fv,{editingLocation:r,setEditingLocation:e});case"historia-professores":return a.jsx(Bv,{editingLocation:r,setEditingLocation:e});case"coordenadas":return a.jsx(Hv,{editingLocation:r,setEditingLocation:e});case"historias-professor":return a.jsx("div",{className:"text-center py-16",children:a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-200 mb-2",children:"Tabela de Histórias dos Professores"}),a.jsx("p",{className:"text-gray-400 mb-8",children:"Funcionalidade em desenvolvimento..."})]})});case"documentos-escola":return a.jsx("div",{className:"text-center py-16",children:a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-200 mb-2",children:"Tabela de Documentos das Escolas"}),a.jsx("p",{className:"text-gray-400 mb-8",children:"Funcionalidade em desenvolvimento..."})]})});case"imagens-escola":return a.jsx(l2,{editingLocation:r,setEditingLocation:e});case"imagens-professores":return a.jsx(p2,{editingLocation:r,setEditingLocation:e});case"documentos":return a.jsx(b2,{editingLocation:r,setEditingLocation:e});default:return a.jsxs("div",{className:"text-gray-400 text-center py-8",children:['Aba "',t,'" em desenvolvimento...']})}},Pd=r=>r==null?"":typeof r=="string"?r.trim():String(r),y2=(r,e)=>{if(!r||!e)return[];const t=[],s=new Set([...Object.keys(r),...Object.keys(e)]),n=["id","created_at","updated_at","activeTab","imagem_header"];return s.forEach(o=>{if(n.includes(o))return;const i=Pd(r[o]),l=Pd(e[o]);i!==l&&t.push({campo:o,valorAntigo:r[o]||"",valorNovo:e[o]||"",label:v2(o)})}),t},v2=r=>({Escola:"Nome da Escola",Município:"Município",Endereço:"Endereço","Terra Indigena (TI)":"Terra Indígena","Escola Estadual ou Municipal":"Tipo de Escola","Parcerias com o município":"Parcerias com Município","Diretoria de Ensino":"Diretoria de Ensino","Ano de criação da escola":"Ano de Criação","Povos indigenas":"Povos Indígenas","Linguas faladas":"Línguas Faladas","Modalidade de Ensino/turnos de funcionamento":"Modalidade de Ensino","Numero de alunos":"Número de Alunos",turnos_funcionamento:"Turnos de Funcionamento","Espaço escolar e estrutura":"Espaço Escolar","Acesso à água":"Acesso à Água","Tem coleta de lixo?":"Coleta de Lixo","Acesso à internet":"Acesso à Internet","Equipamentos Tecs":"Equipamentos Técnicos","Modo de acesso à escola":"Modo de Acesso","Gestão/Nome":"Gestão","Outros funcionários":"Outros Funcionários","Quantidade de professores indígenas":"Professores Indígenas","Quantidade de professores não indígenas":"Professores Não Indígenas","Professores falam a língua indígena?":"Professores Falam Língua Indígena","Formação dos professores":"Formação dos Professores","Formação continuada oferecida":"Formação Continuada","PPP elaborado com a comunidade?":"PPP com Comunidade","Material pedagógico não indígena":"Material Não Indígena","Material pedagógico indígena":"Material Indígena","Práticas pedagógicas indígenas":"Práticas Pedagógicas Indígenas","Formas de avaliação":"Formas de Avaliação","Projetos em andamento":"Projetos em Andamento","Parcerias com universidades?":"Parcerias com Universidades","Ações com ONGs ou coletivos?":"Ações com ONGs","Desejos da comunidade para a escola":"Desejos da Comunidade","Escola utiliza redes sociais?":"Uso de Redes Sociais","Links das redes sociais":"Links Redes Sociais",historia_da_escola:"História da Escola",Latitude:"Latitude",Longitude:"Longitude",link_para_videos:"Links de Vídeos",logradouro:"Logradouro",numero:"Número",complemento:"Complemento",bairro:"Bairro",cep:"CEP",estado:"Estado",diferenciada:"Diferenciada"})[r]||r,w2=({saveEscola:r,editingLocation:e,setEditingLocation:t,setEscolaSalvaId:s,setEscolaSalvaNome:n,setCamposAlterados:o,setShowMetadadosModal:i,dadosOriginais:l,setDadosOriginais:d})=>{const[h,f]=w.useState(!1),[m,u]=w.useState(null),[g,y]=w.useState(!1),x=w.useCallback(async()=>{if(e)try{f(!0),u(null),y(!1);let A=[];e.id&&l?A=y2(l,e):A=Object.keys(e).filter(v=>!["id","created_at","updated_at","activeTab","imagem_header"].includes(v)&&e[v]).map(v=>({campo:v,valorAntigo:"",valorNovo:e[v],label:v}));const C=await r(e,null);C.success?(y(!0),t(C.data),s(C.data.id),n(C.data.Escola||"Escola"),o(A),A.length>0&&i(!0),setTimeout(()=>{y(!1)},3e3)):u(C.error)}catch(A){B.error("Erro ao salvar escola:",A),u(A.message)}finally{f(!1)}},[e,l,r,t,s,n,o,i]);return{isSaving:h,saveError:m,saveSuccess:g,setSaveError:u,setSaveSuccess:y,handleSaveEscola:x}},N2=(r=[],e="",t="todos")=>{const s=w.useMemo(()=>{if(!r||r.length===0)return[];let l=[...r];if(e.trim()){const d=e.toLowerCase();l=l.filter(h=>h.Escola?.toLowerCase().includes(d)||h.Município?.toLowerCase().includes(d))}return l},[r,e,t]),n=w.useMemo(()=>r.length,[r]),o=w.useMemo(()=>s.length,[s]),i=w.useMemo(()=>e.trim()!==""||t&&t!=="todos",[e,t]);return{filteredEscolas:s,totalEscolas:n,totalFiltered:o,hasActiveFilters:i}},j2=hi.lazy(()=>Xr(()=>import("./CompletenessDashboard-oByofA09.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,3]))),E2=()=>{const[r,e]=w.useState(null),[t,s]=w.useState(!1),[n,o]=w.useState(!1),[i,l]=w.useState(!1),[d,h]=w.useState(null),[f,m]=w.useState(!1),[u,g]=w.useState(!1),[y,x]=w.useState(!1),[A,C]=w.useState(!1),[v,k]=w.useState(null),[_,q]=w.useState(null),[D,F]=w.useState([]),[T,V]=w.useState(null),O=typeof window<"u"&&window.innerWidth<=Wd.MOBILE_BREAKPOINT,{escolas:p,loading:j,error:N,searchTerm:S,setSearchTerm:L,selectedType:I,setSelectedType:M,saveEscola:G,deleteEscola:K}=Vd(),{filteredEscolas:$}=N2(p,S,I),{loadExistingModalidades:H,clearModalidades:X}=Kd(),{isSaving:ee,saveError:te,saveSuccess:W,handleSaveEscola:ne}=w2({saveEscola:G,editingLocation:r,setEditingLocation:e,setEscolaSalvaId:k,setEscolaSalvaNome:q,setCamposAlterados:F,setShowMetadadosModal:C,dadosOriginais:T,setDadosOriginais:V}),ge=z=>{H(z["Modalidade de Ensino/turnos de funcionamento"]);const ye={id:z.id,Escola:z.Escola,Município:z.Município,Endereço:z.Endereço,"Terra Indigena (TI)":z["Terra Indigena (TI)"],"Parcerias com o município":z["Parcerias com o município"],"Diretoria de Ensino":z["Diretoria de Ensino"],"Ano de criação da escola":z["Ano de criação da escola"],"Povos indigenas":z["Povos indigenas"],"Linguas faladas":z["Linguas faladas"],"Modalidade de Ensino/turnos de funcionamento":z["Modalidade de Ensino/turnos de funcionamento"],"Numero de alunos":z["Numero de alunos"],turnos_funcionamento:z.turnos_funcionamento||"","Espaço escolar e estrutura":z["Espaço escolar e estrutura"],"Acesso à água":z["Acesso à água"],"Tem coleta de lixo?":z["Tem coleta de lixo?"],"Acesso à internet":z["Acesso à internet"],"Equipamentos Tecs":z["Equipamentos Tecs"],"Modo de acesso à escola":z["Modo de acesso à escola"],"Gestão/Nome":z["Gestão/Nome"],"Outros funcionários":z["Outros funcionários"],"Quantidade de professores indígenas":z["Quantidade de professores indígenas"],"Quantidade de professores não indígenas":z["Quantidade de professores não indígenas"],"Professores falam a língua indígena?":z["Professores falam a língua indígena?"],"Formação dos professores":z["Formação dos professores"],"Formação continuada oferecida":z["Formação continuada oferecida"],"PPP elaborado com a comunidade?":z["PPP elaborado com a comunidade?"],"Projetos em andamento":z["Projetos em andamento"],"Parcerias com universidades?":z["Parcerias com universidades?"],"Ações com ONGs ou coletivos?":z["Ações com ONGs ou coletivos?"],"Desejos da comunidade para a escola":z["Desejos da comunidade para a escola"],"Escola utiliza redes sociais?":z["Escola utiliza redes sociais?"],"Links das redes sociais":z["Links das redes sociais"],historia_da_escola:z.historia_da_escola,Latitude:z.Latitude,Longitude:z.Longitude,links:z.links,link_para_videos:z.link_para_videos,logradouro:z.logradouro,numero:z.numero,complemento:z.complemento,bairro:z.bairro,cep:z.cep,estado:z.estado,nome_professor:z.nome_professor,professores_indigenas:z.professores_indigenas,professores_nao_indigenas:z.professores_nao_indigenas,professores_falam_lingua_indigena:z.professores_falam_lingua_indigena,formacao_professores:z.formacao_professores,visitas_supervisores_formacao:z.visitas_supervisores_formacao,outros_funcionarios:z.outros_funcionarios,gestao:z.gestao,merenda_diferenciada:z.merenda_diferenciada,diferenciada:z.diferenciada,activeTab:Ds.DEFAULT_ACTIVE_TAB};V({...ye}),e(ye)},ae=()=>{e({id:"tabela-editavel",Escola:"Tabela Editável",activeTab:"tabela-editavel"})},le=()=>(X(),{Escola:"",Município:"",Endereço:"","Terra Indigena (TI)":"","Parcerias com o município":"","Diretoria de Ensino":"","Ano de criação da escola":null,"Povos indigenas":"","Linguas faladas":"","Modalidade de Ensino/turnos de funcionamento":"","Numero de alunos":null,turnos_funcionamento:"","Espaço escolar e estrutura":"","Acesso à água":"","Tem coleta de lixo?":"","Acesso à internet":"","Equipamentos Tecs":"","Modo de acesso à escola":"","Gestão/Nome":"","Outros funcionários":"","Quantidade de professores indígenas":null,"Quantidade de professores não indígenas":null,"Professores falam a língua indígena?":"","Formação dos professores":"","Formação continuada oferecida":"","PPP elaborado com a comunidade?":"","Projetos em andamento":"","Parcerias com universidades?":"","Ações com ONGs ou coletivos?":"","Desejos da comunidade para a escola":"","Escola utiliza redes sociais?":"","Links das redes sociais":"",historia_da_escola:"",Latitude:null,Longitude:null,links:"",link_para_videos:"",logradouro:"",numero:"",complemento:"",bairro:"",cep:"",estado:"SP",nome_professor:"",professores_indigenas:"",professores_nao_indigenas:"",professores_falam_lingua_indigena:"",formacao_professores:"",visitas_supervisores_formacao:"",outros_funcionarios:"",gestao:"",merenda_diferenciada:"",diferenciada:"",activeTab:Ds.DEFAULT_ACTIVE_TAB}),oe=()=>{e(le())},ce=(z,ye)=>ye?({"dados-basicos":["Escola","Município","Endereço","Terra Indigena (TI)","Diretoria de Ensino"],"povos-linguas":["Povos indigenas","Linguas faladas"],modalidades:["Modalidade de Ensino/turnos de funcionamento","Numero de alunos"],infraestrutura:["Espaço escolar e estrutura","Acesso à água","Acesso à internet"],"gestao-professores":["Gestão/Nome","Quantidade de professores indígenas","Quantidade de professores não indígenas"],funcionarios:["Outros funcionários"],"material-pedagogico":["Material pedagógico indígena"],"projetos-parcerias":["Projetos em andamento","Parcerias com universidades?"],"redes-sociais":["Escola utiliza redes sociais?","Links das redes sociais"],video:["link_para_videos"],historias:["historia_da_escola"],"historia-professores":["nome_professor"],coordenadas:["Latitude","Longitude"],"imagens-escola":["imagem_header"],"imagens-professores":[],documentos:[]}[z]||[]).some(at=>{const Pe=ye[at];return Pe==null||Pe===""||Pe==="null"}):!1,ue=async()=>{try{const z=(await Xr(async()=>{const{default:He}=await import("./jszip.min-AkjzMQrs.js").then(je=>je.j);return{default:He}},__vite__mapDeps([0,1,2]))).default,ye=new z,{data:we,error:Et}=await re.storage.from("imagens").list("",{limit:1e3,offset:0});if(Et){B.error("Erro ao buscar imagens:",Et),alert("Erro ao buscar imagens: "+Et.message);return}if(!we||we.length===0){alert("Nenhuma imagem encontrada no bucket.");return}const at=document.createElement("div");at.innerHTML=`
        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                    background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 10px; 
                    z-index: 9999; text-align: center;">
          <div style="margin-bottom: 10px;">Preparando download...</div>
          <div style="font-size: 12px;">Encontradas ${we.length} imagens</div>
        </div>
      `,document.body.appendChild(at);for(let He=0;He<we.length;He++){const je=we[He];try{const{data:ot,error:er}=await re.storage.from("imagens").download(je.name);if(er){B.error(`Erro ao baixar ${je.name}:`,er);continue}ye.file(je.name,ot),at.innerHTML=`
            <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                        background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 10px; 
                        z-index: 9999; text-align: center;">
              <div style="margin-bottom: 10px;">Preparando download...</div>
              <div style="font-size: 12px;">${He+1} de ${we.length} imagens processadas</div>
            </div>
          `}catch(ot){B.error(`Erro ao processar ${je.name}:`,ot)}}const Pe=await ye.generateAsync({type:"blob"}),_t=URL.createObjectURL(Pe),nt=document.createElement("a");nt.href=_t,nt.download=`backup-imagens-escolas-${new Date().toISOString().split("T")[0]}.zip`,document.body.appendChild(nt),nt.click(),document.body.removeChild(nt),URL.revokeObjectURL(_t),document.body.removeChild(at),alert(`Download concluído! ${we.length} imagens foram baixadas em um arquivo ZIP.`)}catch(z){B.error("Erro ao fazer download das imagens:",z),alert("Erro ao fazer download das imagens: "+z.message)}},he=async()=>{if(d){m(!0);try{const z=await K(d.id);z.success?(l(!1),h(null),r?.id===d.id&&e(null)):B.error("Erro ao remover escola:",z.error)}catch(z){B.error("Erro ao remover escola:",z)}finally{m(!1)}}},be=z=>{};return a.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950",children:[a.jsx(Kf,{isMobile:O,sidebarOpen:t,setSidebarOpen:s,editingLocation:r,onEscolaSelect:ge,searchTerm:S,setSearchTerm:L,filteredEscolas:$}),a.jsxs("main",{className:"flex-1 p-4 lg:p-8 overflow-y-auto h-screen",children:[a.jsx("div",{className:"mb-8",children:a.jsx("h1",{className:"text-3xl lg:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 mb-2",children:"Painel de Administração"})}),a.jsx(Wf,{searchTerm:S,setSearchTerm:L,selectedType:I,setSelectedType:M,onNovaEscola:oe}),j&&a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"text-center",children:a.jsx("div",{className:"text-gray-400 text-lg",children:"Carregando escolas..."})})}),N&&a.jsx("div",{className:"bg-red-900/50 border border-red-700/50 text-red-200 px-6 py-4 rounded-xl mb-6 backdrop-blur-sm",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Erro ao carregar escolas"}),a.jsx("p",{className:"text-red-300",children:N})]})]})}),r&&r.activeTab==="tabela-editavel"&&a.jsx("div",{className:"fixed inset-0 bg-gray-900 z-40 overflow-hidden",style:{top:"72px"},children:a.jsx(Qf,{setEditingLocation:e,onShowMetadadosModal:(z,ye,we)=>{k(z),q(ye),F(we),C(!0)}})}),r&&typeof r=="object"&&r.Escola!==void 0&&r.activeTab!=="tabela-editavel"&&a.jsxs("div",{className:"bg-[#0B141A] rounded-lg shadow-lg flex flex-col border border-[#202C33]",children:[a.jsxs("div",{className:"bg-[#202C33] px-4 py-3 flex justify-between items-center flex-shrink-0 border-b border-[#2A3942]",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-semibold text-[#E9EDEF]",children:r.id?"Editar Escola":"Nova Escola"}),r.Escola&&a.jsx("p",{className:"text-[#8696A0] text-xs",children:r.Escola})]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:ne,disabled:ee,className:"px-4 py-2 bg-[#075E54] hover:bg-[#0C7A6B] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[#075E54]/50 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-xs font-medium",children:ee?a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Salvando..."]}):a.jsxs(a.Fragment,{children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Salvar"]})}),a.jsx("button",{onClick:()=>e(null),className:"p-2 text-[#8696A0] hover:text-[#E9EDEF] hover:bg-[#2A3942] rounded-full transition-colors","aria-label":"Fechar",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),a.jsxs("div",{className:"px-4 pt-3 flex-shrink-0",children:[W&&a.jsx("div",{className:"mb-4 p-3 bg-[#1C2B32] rounded-lg border-l-4 border-[#00A884]",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-[#00A884]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),a.jsx("span",{className:"font-medium text-[#E9EDEF] text-sm",children:"Escola salva com sucesso!"})]})}),te&&a.jsx("div",{className:"mb-4 p-3 bg-[#2A1F1F] rounded-lg border-l-4 border-[#F15C6D]",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-[#F15C6D]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-[#F15C6D] text-sm",children:"Erro ao salvar:"}),a.jsx("p",{className:"text-[#E9EDEF] text-xs mt-1",children:te})]})]})})]}),a.jsx("div",{className:"bg-[#111B21] border-b border-[#2A3942] flex-shrink-0",children:a.jsx("nav",{className:"flex flex-wrap gap-1 px-3 py-2",children:Gf.map(z=>{const ye=(r.activeTab||Ds.DEFAULT_ACTIVE_TAB)===z.id,we=ce(z.id,r);return a.jsx("button",{type:"button",onClick:()=>e({...r,activeTab:z.id}),className:`whitespace-nowrap py-1.5 px-3 rounded text-xs font-medium transition-all duration-200 ${ye?"bg-[#00A884] text-white":we?"bg-orange-500/20 text-orange-400 hover:bg-orange-500/30":"bg-[#202C33] text-[#8696A0] hover:bg-[#2A3942] hover:text-[#E9EDEF]"}`,children:a.jsxs("span",{className:"flex items-center gap-1.5",children:[z.label,we&&!ye&&a.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full"})]})},z.id)})})}),a.jsx("div",{className:"flex-grow bg-[#0B141A] p-4",children:x2(r,e)})]}),a.jsx(tg,{isOpen:A,onClose:()=>{C(!1),k(null),q(null),F([]),V(null)},onSave:be,escolaId:v,escolaNome:_,camposAlterados:D}),!r&&!j&&a.jsxs("div",{className:"space-y-8",children:[u&&a.jsx(w.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center p-8 bg-gray-900/80 backdrop-blur-sm rounded-2xl",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-300",children:"Carregando dashboard de completude..."})]})}),children:a.jsx(j2,{})}),y&&a.jsx(Jf,{}),a.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800/50 p-6",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("img",{src:"/opin//logo_index.png",alt:"OPIN - Observatório dos Professores Indígenas",className:"w-32 h-32 mx-auto mb-6 object-contain"}),a.jsx("h3",{className:"text-xl font-semibold text-gray-200 mb-2",children:"Painel de Administração"}),a.jsx("p",{className:"text-gray-400 mb-8 max-w-xl mx-auto text-sm",children:"Gerencie escolas indígenas, dados e configurações do sistema."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h4",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Ações Principais"]}),a.jsx("button",{onClick:oe,className:"w-full px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 shadow-lg hover:shadow-xl text-sm",children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Criar Nova Escola"]})}),a.jsx("button",{onClick:ae,className:"w-full px-4 py-3 bg-gray-800 text-gray-100 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 border border-gray-600 text-sm",children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Editar em Tabela"]})}),a.jsx("button",{onClick:()=>g(!u),className:`w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 border text-sm ${u?"bg-green-800 text-green-100 border-green-600 hover:bg-green-700":"bg-gray-800 text-gray-100 border-gray-600 hover:bg-gray-700"}`,children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Ver Dashboard"]})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h4",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Mídia e Backup"]}),a.jsx("button",{onClick:ue,className:"w-full px-4 py-3 bg-gray-800 text-gray-100 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 border border-gray-600 text-sm",children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Download de Imagens"]})}),a.jsx("button",{onClick:()=>o(!0),className:"w-full px-4 py-3 bg-gray-800 text-gray-100 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 border border-gray-600 text-sm",children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Backup dos Dados"]})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h4",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[a.jsxs("svg",{className:"w-4 h-4 text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Administração"]}),a.jsx("button",{onClick:()=>x(!y),className:`w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 border text-sm ${y?"bg-blue-800 text-blue-100 border-blue-600 hover:bg-blue-700":"bg-gray-800 text-gray-100 border-gray-600 hover:bg-gray-700"}`,children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Visibilidade dos Cards"]})}),a.jsx("button",{onClick:()=>l(!0),className:"w-full px-4 py-3 bg-red-800 text-red-100 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-200 border border-red-600 text-sm",children:a.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remover Escola"]})})]})]})]})]}),a.jsx(sg,{isOpen:n,onClose:()=>o(!1)}),a.jsx(ag,{isOpen:i,onClose:()=>{l(!1),h(null)},escolas:$,escolaToDelete:d,setEscolaToDelete:h,onConfirmDelete:he,isDeleting:f})]})]})},_2=()=>a.jsx(Xf,{children:a.jsx(E2,{})}),P2=Object.freeze(Object.defineProperty({__proto__:null,default:_2},Symbol.toStringTag,{value:"Module"}));export{Sf as H,Kr as I,P2 as i};
