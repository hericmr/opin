import{d as v,r as d,j as e,X as S,c as w,U as P,C as I,s as B,l as D,B as $}from"./index-BZ9NA7Kv.js";import{I as H,H as O}from"./index-Bq895A8m.js";import{H as R,G as A}from"./house-BtqxaRpM.js";import"./arrow-left-DOD5M2gm.js";import"./videoService-C3QBa_vF.js";import"./index-BuKXYYmB.js";const F=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],T=v("circle",F);const z=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],q=v("clipboard-list",z);const G=[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]],V=v("handshake",G);const Q=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],U=v("languages",Q);const W=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],X=v("share-2",W),j={"Dados Básicos":["Escola","Município","Endereço","Terra Indigena (TI)","Escola Estadual ou Municipal","Parcerias com o município","Diretoria de Ensino","Ano de criação da escola"],"Povos e Línguas":["Povos indigenas","Linguas faladas"],"Modalidades e Alunos":["Modalidade de Ensino/turnos de funcionamento","Numero de alunos","turnos_funcionamento"],Infraestrutura:["Espaço escolar e estrutura","Acesso à água","Tem coleta de lixo?","Acesso à internet","Equipamentos Tecs","Modo de acesso à escola","diferenciada"],Equipe:["Gestão/Nome","Outros funcionários","Quantidade de professores indígenas","Quantidade de professores não indígenas","Professores falam a língua indígena?","Formação dos professores","Formação continuada oferecida"],"Material Pedagógico":["PPP elaborado com a comunidade?","Material pedagógico não indígena","Material pedagógico indígena","Práticas pedagógicas indígenas","Formas de avaliação"],"Projetos e Parcerias":["Projetos em andamento","Parcerias com universidades?","Ações com ONGs ou coletivos?","Desejos da comunidade para a escola"],"Redes Sociais e Mídia":["Escola utiliza redes sociais?","Links das redes sociais","link_para_videos"],Histórias:["historia_da_escola"],Localização:["Latitude","Longitude","logradouro","numero","complemento","bairro","cep","estado"],Mídia:["imagem_header"]},J=(s=[])=>{const c=r=>{if(!s||s.length===0)return 0;const o=s.length,a=s.filter(t=>{const n=t[r];return n!=null&&n!==""&&n!=="null"}).length;return Math.round(a/o*100)},u=r=>{if(!s||s.length===0)return 0;const o=r.map(a=>c(a));return Math.round(o.reduce((a,t)=>a+t,0)/r.length)},m=r=>r>85?"text-emerald-300 bg-emerald-500/10 border border-emerald-400/20":r>=60?"text-amber-300 bg-amber-500/10 border border-amber-400/20":"text-rose-300 bg-rose-500/10 border border-rose-400/20",l=r=>r>85?"bg-gradient-to-r from-emerald-500 to-emerald-400":r>=60?"bg-gradient-to-r from-amber-500 to-amber-400":"bg-gradient-to-r from-rose-500 to-rose-400",h=r=>r>85?"bg-emerald-500":r>=60?"bg-amber-500":"bg-rose-500",f=r=>!s||s.length===0?[]:s.filter(o=>r.some(a=>{const t=o[a];return t==null||t===""||t==="null"})).map(o=>{const a=r.filter(t=>{const n=o[t];return n==null||n===""||n==="null"});return{...o,missingFields:a}}),g=d.useMemo(()=>{if(!s||s.length===0){const o={};return Object.keys(j).forEach(a=>{o[a]=0}),o}const r={};return Object.keys(j).forEach(o=>{const a=j[o],t=a.map(n=>{const b=s.length,x=s.filter(k=>{const y=k[n];return y!=null&&y!==""&&y!=="null"}).length;return Math.round(x/b*100)});r[o]=Math.round(t.reduce((n,b)=>n+b,0)/a.length)}),r},[s]),N=d.useMemo(()=>{if(!s||s.length===0)return 0;const r=Object.values(j).flat(),o=r.map(a=>{const t=s.length,n=s.filter(b=>{const x=b[a];return x!=null&&x!==""&&x!=="null"}).length;return Math.round(n/t*100)});return Math.round(o.reduce((a,t)=>a+t,0)/r.length)},[s]);return{calculateFieldCompleteness:c,calculateCategoryCompleteness:u,getCompletenessColor:m,getProgressBarColor:l,getSimpleProgressBarColor:h,findIncompleteSchools:f,categoryCompleteness:g,overallCompleteness:N}},K=s=>Number.isNaN(Number(s))?0:Math.max(0,Math.min(100,Number(s))),Y=({title:s,percentage:c,itemCount:u,Icon:m,onViewPending:l,badgeClassName:h,progressBarClassName:f})=>{const g=K(c);return e.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-gray-700/50 bg-gray-800/50 p-5 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-gray-700/60 text-gray-100",children:m?e.jsx(m,{className:"h-5 w-5","aria-hidden":"true"}):null}),e.jsx("h4",{className:"text-lg font-semibold text-gray-100",children:s})]}),e.jsxs("span",{className:`px-3 py-1.5 text-sm font-medium rounded-full ${h}`,children:[g,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-full overflow-hidden rounded-full bg-gray-700/70 h-2.5",children:e.jsx("div",{className:`h-full transition-all duration-500 ${f}`,style:{width:`${g}%`},"aria-hidden":"true"})}),e.jsxs("p",{className:"mt-2 text-sm text-gray-400",children:[g,"% completo — ",u," itens"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:l,className:"px-3 py-1.5 text-xs font-medium text-gray-200 border border-gray-600/70 rounded-md transition-colors hover:bg-gray-700/80 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/60",children:"Ver pendências"})})]})},Z=d.memo(Y),ee=({overallCompleteness:s,getCompletenessColor:c,getProgressBarColor:u})=>e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Progresso Geral"}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${c(s)}`,children:[s,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${u(s)}`,style:{width:`${s}%`}})})]}),se=({isOpen:s,onClose:c,selectedCategory:u,incompleteSchools:m=[]})=>s?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-100",children:["Escolas sem informação - ",u]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[m.length," escola(s) com dados incompletos nesta categoria"]})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5 text-gray-400"})})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-green-400 text-4xl mb-4",children:"✅"}),e.jsx("p",{className:"text-gray-300 text-lg",children:"Todas as escolas têm informações completas nesta categoria!"})]}):e.jsx("div",{className:"space-y-4",children:m.map((l,h)=>e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-100 mb-1",children:l.Escola||"Nome não informado"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[l.Município&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4"}),l.Município]}),l["Terra Indigena (TI)"]&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),l["Terra Indigena (TI)"]]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"bg-red-500/20 text-red-400 px-2 py-1 rounded-full text-xs font-medium",children:[l.missingFields.length," campo(s) faltando"]})})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Campos sem informação:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.missingFields.map((f,g)=>e.jsx("span",{className:"bg-orange-500/20 text-orange-300 px-2 py-1 rounded text-xs",children:f},g))})]})]},h))})}),e.jsx("div",{className:"bg-gray-800/50 px-6 py-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Clique em uma escola para editar suas informações"}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-lg transition-colors",children:"Fechar"})]})})]})}):null,ie=()=>{const[s,c]=d.useState(null),[u,m]=d.useState(!0),[l,h]=d.useState(null),[f,g]=d.useState(null),[N,r]=d.useState([]),[o,a]=d.useState(!1),{getCompletenessColor:t,getProgressBarColor:n,getSimpleProgressBarColor:b,findIncompleteSchools:x,categoryCompleteness:k,overallCompleteness:y}=J(s?.rawData||[]),E=d.useCallback(i=>{const p=j[i],M=x(p);g(i),r(M),a(!0)},[x]),C=d.useCallback(async()=>{try{m(!0),h(null);const{data:i,error:p}=await B.from("escolas_completa").select("*");if(p)throw p;c({totalRecords:i.length,rawData:i})}catch(i){D.error("Erro ao buscar dados de completude:",i),h(i.message)}finally{m(!1)}},[]);if(d.useEffect(()=>{C()},[C]),u)return e.jsx("div",{className:"flex items-center justify-center py-12 text-gray-400",children:"Carregando completude..."});if(l)return e.jsx("div",{className:"bg-red-900/50 border border-red-700/50 text-red-200 px-6 py-4 rounded-xl mb-6 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Erro ao carregar dashboard"}),e.jsx("p",{className:"text-red-300",children:l})]})]})});if(!s)return e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Sem dados para calcular completude."});const _={"Dados Básicos":q,"Povos e Línguas":U,"Modalidades e Alunos":A,Infraestrutura:R,Equipe:P,"Material Pedagógico":$,"Projetos e Parcerias":V,"Redes Sociais e Mídia":X,Histórias:O,Localização:w,Mídia:H};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-800/50 to-gray-900/50 backdrop-blur-sm rounded-2xl border border-gray-700/50 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300",children:"Dashboard de Completude"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Visão rápida da tabela `escolas_completa`"})]}),e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Atualizar"]})]})}),e.jsx(ee,{overallCompleteness:y,getCompletenessColor:t,getProgressBarColor:n}),e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-[repeat(auto-fit,_minmax(280px,_1fr))]",children:Object.entries(k).map(([i,p])=>{const M=()=>E(i),L=_[i]||T;return e.jsx(Z,{title:i,percentage:p,itemCount:j[i].length,onViewPending:M,badgeClassName:t(p),progressBarClassName:b(p),Icon:L},i)})}),e.jsx(se,{isOpen:o,onClose:()=>a(!1),selectedCategory:f,incompleteSchools:N})]})};export{ie as default};
