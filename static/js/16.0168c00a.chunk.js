"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[16],{16:(e,o,a)=>{a.r(o),a.d(o,{default:()=>l});var t=a(5043),s=a(237),r=a(579);const l=()=>{const[e,o]=(0,t.useState)([]),[a,l]=(0,t.useState)(!1),n=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const t=(new Date).toLocaleTimeString();o((o=>[...o,{timestamp:t,message:e,type:a}]))};return(0,r.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-4xl mx-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Teste de Funcionalidade de Legendas"}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("button",{onClick:async()=>{l(!0),o([]);try{n("=== INICIANDO TESTES DE LEGENDAS ===","header"),n("Teste 1: Verificando estrutura da tabela..."),await(0,s.iy)(),n("\u2705 Teste da estrutura da tabela conclu\xeddo"),n("Teste 2: Criando legenda de teste...");const e={escola_id:1,imagem_url:"test/test-image.jpg",legenda:"Legenda de teste",descricao_detalhada:"Descri\xe7\xe3o detalhada de teste",autor_foto:"Teste Autor",data_foto:"2024-01-01",categoria:"teste",ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},o=await(0,s.eP)(e);n("\u2705 Legenda criada com ID: ".concat(o.id)),n("Teste 3: Buscando legenda criada...");const a=await(0,s.qP)("test/test-image.jpg",1);a?n("\u2705 Legenda encontrada: ".concat(a.legenda)):n("\u274c Legenda n\xe3o encontrada","error"),n("Teste 4: Atualizando legenda...");const t={legenda:"Legenda atualizada",updated_at:(new Date).toISOString()},r=await(0,s.w_)(o.id,t);n("\u2705 Legenda atualizada: ".concat(r.legenda)),n("Teste 5: Verificando se a atualiza\xe7\xe3o foi salva...");const l=await(0,s.qP)("test/test-image.jpg",1);l&&"Legenda atualizada"===l.legenda?n("\u2705 Atualiza\xe7\xe3o salva corretamente"):n("\u274c Atualiza\xe7\xe3o n\xe3o foi salva corretamente","error"),n("=== TESTES CONCLU\xcdDOS COM SUCESSO ===","success")}catch(e){n("\u274c ERRO NOS TESTES: ".concat(e.message),"error"),console.error("Erro nos testes:",e)}finally{l(!1)}},disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 mr-4",children:a?"Executando Testes...":"Executar Testes"}),(0,r.jsx)("button",{onClick:()=>{o([])},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Limpar Logs"})]}),(0,r.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4 max-h-96 overflow-y-auto",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Logs dos Testes:"}),0===e.length?(0,r.jsx)("p",{className:"text-gray-500",children:"Nenhum teste executado ainda."}):(0,r.jsx)("div",{className:"space-y-1",children:e.map(((e,o)=>(0,r.jsxs)("div",{className:"text-sm font-mono ".concat("error"===e.type?"text-red-600":"success"===e.type?"text-green-600":"header"===e.type?"text-blue-600 font-bold":"text-gray-800"),children:["[",e.timestamp,"] ",e.message]},o)))})]}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Instru\xe7\xf5es:"}),(0,r.jsxs)("ol",{className:"text-sm text-yellow-700 space-y-1 list-decimal list-inside",children:[(0,r.jsx)("li",{children:'Clique em "Executar Testes" para verificar se a funcionalidade de legendas est\xe1 funcionando'}),(0,r.jsx)("li",{children:"Verifique os logs para identificar poss\xedveis problemas"}),(0,r.jsx)("li",{children:"Se houver erros, execute o script SQL no Supabase para corrigir a estrutura da tabela"}),(0,r.jsx)("li",{children:"Teste novamente ap\xf3s corrigir problemas no banco de dados"})]})]})]})}},237:(e,o,a)=>{a.d(o,{eP:()=>r,iy:()=>c,jW:()=>i,qP:()=>n,w_:()=>l});var t=a(9379),s=a(2880);const r=async e=>{try{console.log("=== DEBUG: addLegendaFoto ==="),console.log("Dados recebidos:",e);const a=(0,t.A)({},e);console.log("Dados iniciais:",a);try{console.log("Verificando se a coluna tipo_foto existe...");const{data:e,error:o}=await s.N.from("legendas_fotos").select("tipo_foto").limit(1);console.log("Teste da coluna tipo_foto:",{testData:e,testError:o}),o&&"42703"===o.code&&(console.warn("Coluna tipo_foto n\xe3o encontrada. Removendo do objeto de inser\xe7\xe3o."),delete a.tipo_foto)}catch(o){console.warn("Coluna tipo_foto n\xe3o encontrada. Removendo do objeto de inser\xe7\xe3o."),delete a.tipo_foto}console.log("Dados finais para inser\xe7\xe3o:",a);const{data:r,error:l}=await s.N.from("legendas_fotos").insert([a]).select().single();if(console.log("Resposta do Supabase:",{data:r,error:l}),l)throw console.error("Erro do Supabase:",l),l;return console.log("Legenda criada com sucesso:",r),r}catch(a){throw console.error("Erro ao adicionar legenda de foto:",a),a}},l=async(e,o)=>{try{console.log("=== DEBUG: updateLegendaFoto ==="),console.log("ID da legenda:",e),console.log("Dados para atualiza\xe7\xe3o:",o);const{data:a,error:t}=await s.N.from("legendas_fotos").update(o).eq("id",e).select().single();if(console.log("Resposta do Supabase:",{data:a,error:t}),t)throw console.error("Erro do Supabase ao atualizar:",t),t;return console.log("Legenda atualizada com sucesso:",a),a}catch(a){throw console.error("Erro ao atualizar legenda de foto:",a),a}},n=async function(e,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("getLegendaByImageUrl chamada com:",{imagemUrl:e,escolaId:o,tipoFoto:a});let r=s.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).eq("ativo",!0);if(a)try{r=r.eq("tipo_foto",a)}catch(t){console.warn("Coluna tipo_foto n\xe3o encontrada. Ignorando filtro por tipo.")}let{data:l,error:n}=await r.single();if(console.log("Busca exata resultou em:",{data:l,error:n}),n&&"PGRST116"===n.code||!l){console.log("Tentando busca por finaliza\xe7\xe3o...");const r=e.split("/").slice(-2).join("/");console.log("Caminho relativo extra\xeddo:",r);let l=s.N.from("legendas_fotos").select("*").ilike("imagem_url","%/".concat(r)).eq("escola_id",o).eq("ativo",!0);if(a)try{l=l.eq("tipo_foto",a)}catch(t){}const{data:n,error:i}=await l.single();if(console.log("Busca por finaliza\xe7\xe3o resultou em:",{data2:n,error2:i}),!i&&n)return n}if(n&&"PGRST116"!==n.code)throw n;return l||null}catch(r){return console.error("Erro ao buscar legenda por URL:",r),null}},i=async(e,o)=>{try{const{data:a,error:t}=await s.N.from("titulos_videos").select("*").eq("video_url",e).eq("escola_id",o).eq("ativo",!0).single();if(t&&"PGRST116"!==t.code)throw t;return a||null}catch(a){return console.error("Erro ao buscar t\xedtulo por URL:",a),null}},c=async()=>{try{console.log("=== TESTE: Verificando estrutura da tabela legendas_fotos ===");const{data:a,error:t}=await s.N.from("legendas_fotos").select("*").limit(1);if(console.log("Teste 1 - Tabela existe:",{tableData:a,tableError:t}),t)return void console.error("\u274c ERRO: Tabela legendas_fotos n\xe3o existe ou n\xe3o est\xe1 acess\xedvel:",t);const{data:r,error:l}=await s.N.from("legendas_fotos").select("id, escola_id, imagem_url, legenda, descricao_detalhada, autor_foto, data_foto, categoria, ativo, created_at, updated_at").limit(1);console.log("Teste 2 - Estrutura da tabela:",{structureData:r,structureError:l}),l?console.error("\u274c ERRO: Problema com estrutura da tabela:",l):console.log("\u2705 Estrutura b\xe1sica da tabela est\xe1 OK");try{const{data:e,error:o}=await s.N.from("legendas_fotos").select("tipo_foto").limit(1);console.log("Teste 3 - Coluna tipo_foto:",{tipoData:e,tipoError:o}),o&&"42703"===o.code?console.log("\u26a0\ufe0f AVISO: Coluna tipo_foto n\xe3o existe na tabela"):o?console.error("\u274c ERRO: Problema com coluna tipo_foto:",o):console.log("\u2705 Coluna tipo_foto existe")}catch(e){console.log("\u26a0\ufe0f AVISO: Coluna tipo_foto n\xe3o existe na tabela")}console.log("Teste 4 - Testando inser\xe7\xe3o...");const n={escola_id:999999,imagem_url:"test/test.jpg",legenda:"Teste de legenda",descricao_detalhada:"Descri\xe7\xe3o de teste",autor_foto:"Teste",data_foto:"2024-01-01",categoria:"teste",ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};try{const{data:e,error:o}=await s.N.from("legendas_fotos").insert([n]).select().single();if(console.log("Teste 4 - Inser\xe7\xe3o de teste:",{insertData:e,insertError:o}),o)console.error("\u274c ERRO: Problema com inser\xe7\xe3o:",o);else{console.log("\u2705 Inser\xe7\xe3o funcionando - removendo registro de teste...");const{error:o}=await s.N.from("legendas_fotos").delete().eq("id",e.id);o?console.error("\u26a0\ufe0f AVISO: N\xe3o foi poss\xedvel remover registro de teste:",o):console.log("\u2705 Registro de teste removido com sucesso")}}catch(o){console.error("\u274c ERRO: Falha na inser\xe7\xe3o de teste:",o)}console.log("=== FIM DO TESTE ===")}catch(a){console.error("\u274c ERRO GERAL no teste da tabela:",a)}}}}]);
//# sourceMappingURL=16.0168c00a.chunk.js.map