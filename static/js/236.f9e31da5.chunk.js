"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[236],{40237:(e,a,r)=>{r.d(a,{eP:()=>l,iy:()=>s,jW:()=>d,qP:()=>i,s7:()=>g,t$:()=>n,w_:()=>c});var o=r(52480),t=r(5452);const s=async()=>{try{const{error:e}=await o.N.from("legendas_fotos").select("count").limit(1);return e?(t.A.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(t.A.debug("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return t.A.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},i=async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let s=o.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a);!1!==r.ativo&&(s=s.eq("ativo",!0)),r.categoria&&(s=s.eq("categoria",r.categoria)),r.tipo_foto&&(s=s.eq("tipo_foto",r.tipo_foto));const{data:i,error:n}=await s.order("created_at",{ascending:!1});return n?(t.A.warn("Erro ao buscar legenda:",n.message),null):i&&i.length>0?i[0]:null}catch(s){return t.A.warn("Erro ao buscar legenda:",s.message),null}},n=async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(t.A.debug("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(a,")")),r.categoria||r.tipo_foto){t.A.debug("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const o=await i(e,a,r);if(o)return t.A.debug("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),o}t.A.debug("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:s,error:n}=await o.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(n)t.A.warn("  \u274c Erro na busca por URL e escola:",n.message);else if(s&&s.length>0)return t.A.debug("  \u2705 Encontrada por URL e escola"),s[0];t.A.debug("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:l,error:c}=await o.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).order("created_at",{ascending:!1});if(c)t.A.warn("  \u274c Erro na busca incluindo inativas:",c.message);else if(l&&l.length>0)return t.A.debug("  \u2705 Encontrada incluindo legendas inativas"),l[0];const d=e.split("/").pop();t.A.debug("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(d));const{data:u,error:g}=await o.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(d)).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(g)t.A.warn("  \u274c Erro na busca por nome do arquivo:",g.message);else if(u&&u.length>0)return t.A.debug("  \u2705 Encontrada por nome do arquivo"),u[0];return t.A.debug("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(s){return t.A.warn("Erro ao buscar legenda flex\xedvel:",s.message),null}},l=async e=>{try{const{data:a,error:r}=await o.N.from("legendas_fotos").insert([e]).select().single();if(r)throw r;return a}catch(a){throw t.A.error("Erro ao adicionar legenda:",a),a}},c=async(e,a)=>{try{const{data:r,error:t}=await o.N.from("legendas_fotos").update(a).eq("id",e).select().single();if(t)throw t;return r}catch(r){throw t.A.error("Erro ao atualizar legenda:",r),r}},d=async(e,a)=>{try{const{data:r,error:t}=await o.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("categoria","video").single();if(t){if("PGRST116"===t.code)return null;throw t}return r}catch(r){return t.A.warn("Erro ao buscar t\xedtulo do v\xeddeo:",r.message),null}},u=async(e,a,r)=>{try{const t=await i(e,a,{ativo:!1});if(t){const{data:e,error:a}=await o.N.from("legendas_fotos").update({ordem:r,updated_at:(new Date).toISOString()}).eq("id",t.id).select().single();if(a)throw a;return e}{const t=(e.split("/").pop()||"Imagem").replace(/\.[^/.]+$/,"").replace(/[_-]/g," ")||"Imagem",{data:s,error:i}=await o.N.from("legendas_fotos").insert([{escola_id:a,imagem_url:e,legenda:t,ordem:r,ativo:!0,tipo_foto:"escola",categoria:"geral",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(i)throw i;return s}}catch(s){throw t.A.error("Erro ao atualizar ordem da imagem:",s),s}},g=async(e,a)=>{try{return await Promise.all(e.map(e=>{let{imageUrl:r,ordem:o}=e;return u(r,a,o)}))}catch(r){throw t.A.error("Erro ao atualizar ordens das imagens:",r),r}}},57367:(e,a,r)=>{r.d(a,{LQ:()=>o,Rf:()=>s,gD:()=>t});const o=[{id:"basicInfo",label:"Informa\xe7\xf5es B\xe1sicas",description:"Nome, munic\xedpio, endere\xe7o, terra ind\xedgena",defaultVisible:!0,category:"grid"},{id:"modalidades",label:"Modalidades de Ensino",description:"Modalidades e turnos de funcionamento",defaultVisible:!0,category:"grid"},{id:"infraestrutura",label:"Infraestrutura",description:"Estrutura f\xedsica, \xe1gua, internet, equipamentos",defaultVisible:!0,category:"grid"},{id:"gestaoProfessores",label:"Equipe",description:"Dire\xe7\xe3o, professores, forma\xe7\xe3o profissional",defaultVisible:!0,category:"grid"},{id:"projetosParcerias",label:"Projetos e Parcerias",description:"Projetos, parcerias, ONGs, desejos da comunidade",defaultVisible:!0,category:"grid"},{id:"historiaEscola",label:"Hist\xf3ria da Escola",description:"Hist\xf3ria e contexto da escola",defaultVisible:!0,category:"standalone"},{id:"imagensEscola",label:"Imagens da Escola",description:"Galeria de fotos da escola",defaultVisible:!0,category:"standalone"},{id:"historiaProfessor",label:"Hist\xf3ria dos Professores",description:"Depoimentos e hist\xf3rias dos professores",defaultVisible:!0,category:"standalone"},{id:"documentos",label:"Documentos",description:"PDFs e documentos da escola",defaultVisible:!0,category:"standalone"},{id:"videos",label:"V\xeddeos",description:"V\xeddeos e produ\xe7\xf5es audiovisuais",defaultVisible:!0,category:"standalone"}],t=()=>o.reduce((e,a)=>(e[a.id]=a.defaultVisible,e),{}),s=function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e&&e.hasOwnProperty(a)?!1!==e[a]:!r||!r.hasOwnProperty(a)||!1!==r[a]}},82006:(e,a,r)=>{r.d(a,{Y8:()=>n,e0:()=>c,g2:()=>d,lz:()=>l});var o=r(89379),t=r(52480),s=r(5452);const i={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},n=async e=>{try{const{data:a,error:r}=await t.N.from("historias_professor").select("*").eq("escola_id",e).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(r)throw r;if(!a||0===a.length)return[];return a.map(e=>{if(e.imagem_url)try{const{data:{publicUrl:a}}=t.N.storage.from(i.BUCKET_NAME).getPublicUrl(e.imagem_url);return(0,o.A)((0,o.A)({},e),{},{imagem_public_url:a})}catch(a){return(0,o.A)((0,o.A)({},e),{},{imagem_public_url:null,urlError:a.message})}return e})}catch(a){throw s.A.error("Erro ao buscar hist\xf3rias do professor:",a),a}},l=async e=>{try{const{data:a,error:r}=await t.N.from("historias_professor").insert([{escola_id:e.escola_id,nome_professor:e.nome_professor||null,historia:e.historia,ordem:e.ordem||1,ativo:!1!==e.ativo,foto_rosto:e.foto_rosto||null}]).select().single();if(r)throw r;return a}catch(a){throw s.A.error("Erro ao criar hist\xf3ria do professor:",a),a}},c=async(e,a)=>{try{const{data:r,error:o}=await t.N.from("historias_professor").update({nome_professor:a.nome_professor,historia:a.historia,ordem:a.ordem,ativo:a.ativo,foto_rosto:a.foto_rosto||null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(o)throw o;return r}catch(r){throw s.A.error("Erro ao atualizar hist\xf3ria do professor:",r),r}},d=async e=>{try{const{error:a}=await t.N.from("historias_professor").delete().eq("id",e);if(a)throw a}catch(a){throw s.A.error("Erro ao deletar hist\xf3ria do professor:",a),a}}},85759:(e,a,r)=>{r.d(a,{MK:()=>i,Sv:()=>t,Y5:()=>n,dq:()=>s});var o=r(52480);async function t(e){const{data:a,error:r}=await o.N.from("titulos_videos").select("*").eq("escola_id",e).eq("ativo",!0).order("created_at",{ascending:!1});if(r)throw r;return a}async function s(e){const{data:a,error:r}=await o.N.from("titulos_videos").insert([e]).select();if(r)throw r;return null===a||void 0===a?void 0:a[0]}async function i(e,a){const{data:r,error:t}=await o.N.from("titulos_videos").update(a).eq("id",e).select();if(t)throw t;return null===r||void 0===r?void 0:r[0]}async function n(e){const{error:a}=await o.N.from("titulos_videos").delete().eq("id",e);if(a)throw a;return!0}},94309:(e,a,r)=>{r.d(a,{B:()=>s});var o=r(52480),t=r(5452);class s{static async getGlobalCardsVisibility(){try{const{data:e,error:a}=await o.N.from("configuracao_global").select("valor").eq("chave","cards_visibilidade_global").single();if(a){if("PGRST116"===a.code)return null;throw a}return(null===e||void 0===e?void 0:e.valor)||null}catch(e){return t.A.error("Erro ao buscar configura\xe7\xe3o global de visibilidade:",e),null}}static async saveGlobalCardsVisibility(e){try{const{data:a,error:r}=await o.N.from("configuracao_global").upsert({chave:"cards_visibilidade_global",valor:e,descricao:"Configura\xe7\xe3o padr\xe3o de visibilidade de cards para todas as escolas",updated_at:(new Date).toISOString()},{onConflict:"chave"}).select().single();if(r)throw r;return{success:!0,data:a}}catch(a){return t.A.error("Erro ao salvar configura\xe7\xe3o global de visibilidade:",a),{success:!1,error:a.message||"Erro ao salvar configura\xe7\xe3o global"}}}}},98137:(e,a,r)=>{r.d(a,{V:()=>s});var o=r(65043),t=r(94309);const s=()=>{const[e,a]=(0,o.useState)(null),[r,s]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{(async()=>{try{s(!0);const e=await t.B.getGlobalCardsVisibility();a(e)}catch(e){console.error("Erro ao carregar configura\xe7\xe3o global:",e),a(null)}finally{s(!1)}})()},[]),{globalVisibility:e,loading:r}}}}]);
//# sourceMappingURL=236.f9e31da5.chunk.js.map