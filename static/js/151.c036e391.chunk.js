"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[151],{4669:(e,t,o)=>{o.r(t),o.d(t,{default:()=>L});var n=o(5043),r=o(154),a=o(5351),l=o(6528),s=o(5366),c=o(495),i=o(6644),d=o(9468),u=o(2463),f=o(3241),g=o(3104),h=o(1060),m=o(2861),p=o(3908),x=o(9333),y=o(9826);o(3976);const w={center:[-48.4129,-22.3794],zoom:7.63,maxZoom:18,minZoom:4,mobile:{center:[-48.5935,-21.9212],zoom:5.7},clusterDistance:30,proximityThreshold:5e-5,disableClusteringAtZoom:12,tooltipOffset:10};var b=o(9845),v=o(9379),C=o(579);const k=n.forwardRef(((e,t)=>(0,C.jsx)("div",(0,v.A)({id:"map",className:"w-full h-full",ref:t},e))));var F=o(5921),N=o(1247),E=o(7790);function S(e){const t="Regularizada"===e.getProperties().fase_ti;return new F.Ay({fill:new N.A({color:t?"rgba(220, 20, 60, 0.3)":"rgba(139, 0, 0, 0.25)"}),stroke:new E.A({color:"#B22222",width:2,lineDash:[3,3]})})}function P(){return new F.Ay({fill:new N.A({color:"rgba(0, 0, 0, 0.3)"}),stroke:new E.A({color:"#000000",width:2})})}var j=o(5263),A=o(3361);function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{borderColor:n=null,showShadow:r=!0,showGradient:a=!0,showGlow:l=!1,isNearbyPair:s=!1}=o,c=e,i=n||c,d=t/2,u=t/24,f=3*u,g=2*u,h="M".concat(d," ").concat(2*u,"C").concat(d-3.87*u," ").concat(2*u," ").concat(d-7*u," ").concat(5.13*u," ").concat(d-7*u," ").concat(9*u,"c0 ").concat(5.25*u," ").concat(7*u," ").concat(13*u," ").concat(7*u," ").concat(13*u,"s").concat(7*u," -").concat(7.75*u," ").concat(7*u," -").concat(13*u,"c0 -").concat(3.87*u," -").concat(3.13*u," -").concat(7*u," -").concat(7*u," -").concat(7*u,"z");return'\n    <svg width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'" xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        ').concat(r?'\n        <filter id="shadow-'.concat(t,'" x="-50%" y="-50%" width="200%" height="200%">\n          <feDropShadow dx="0" dy="').concat(2*u,'" stdDeviation="').concat(3*u,'" flood-color="rgba(0,0,0,0.3)"/>\n        </filter>\n        '):"","\n        ").concat(a?'\n        <linearGradient id="gradient-'.concat(t,'" x1="0%" y1="0%" x2="100%" y2="100%">\n          <stop offset="0%" style="stop-color:').concat(c,';stop-opacity:1" />\n          <stop offset="100%" style="stop-color:').concat(i,';stop-opacity:1" />\n        </linearGradient>\n        '):"","\n        ").concat(l?'\n        <filter id="glow-'.concat(t,'" x="-50%" y="-50%" width="200%" height="200%">\n          <feGaussianBlur stdDeviation="').concat(1*u,'" result="coloredBlur"/>\n          <feMerge> \n            <feMergeNode in="coloredBlur"/>\n            <feMergeNode in="SourceGraphic"/>\n          </feMerge>\n        </filter>\n        '):"","\n      </defs>\n      \n      \x3c!-- Brilho sutil de fundo --\x3e\n      ").concat(l?'\n      <circle cx="'.concat(d-2*u,'" cy="').concat(d-2*u,'" r="').concat(g,'" fill="white" opacity="0.2"/>\n      '):"",'\n      \n      \x3c!-- Marcador principal (gota invertida) --\x3e\n      <path d="').concat(h,'" \n            fill="').concat(a?"url(#gradient-".concat(t,")"):c,'" \n            ').concat(r?'filter="url(#shadow-'.concat(t,')"'):"","\n            ").concat(l?'filter="url(#glow-'.concat(t,')"'):"",'/>\n      \n      \x3c!-- C\xedrculo interno branco (bolinha) --\x3e\n      <circle cx="').concat(d,'" cy="').concat(9*u,'" r="').concat(f,'" fill="white" opacity="0.9"/>\n      \n      \x3c!-- Brilho sutil no c\xedrculo --\x3e\n      <circle cx="').concat(d-2*u,'" cy="').concat(7*u,'" r="').concat(.6*f,'" fill="white" opacity="0.4"/>\n      \n      \x3c!-- Indicador de par pr\xf3ximo (se aplic\xe1vel) --\x3e\n      ').concat(s?'\n      <circle cx="'.concat(t-4*u,'" cy="').concat(4*u,'" r="').concat(3*u,'" fill="#FF6B6B" opacity="0.8"/>\n      <text x="').concat(t-4*u,'" y="').concat(6*u,'" text-anchor="middle" font-size="').concat(8*u,'" fill="white" font-weight="bold">P</text>\n      '):"","\n    </svg>\n  ")}function I(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const o=e.get("schoolData");if(!o)return null;const n="#3B82F6",r="#1E40AF",a=e.get("isNearbyPair"),l=z(n,24,{borderColor:r,showShadow:!0,showGradient:!0,showGlow:!1,isNearbyPair:a}),s="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(l),c=new F.Ay({image:new j.A({src:s,scale:a?1.1:1,anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction"})});return t&&c.setText(new A.A({text:o.titulo||"Escola",font:"bold 10px Arial",fill:new N.A({color:"#FFFFFF"}),stroke:new E.A({color:"#000000",width:2}),offsetY:a?-35:-30,textAlign:"center",textBaseline:"middle"})),c}catch(o){return null}}function M(e,t){try{const o=e.get("features");if(!o||0===o.length)return null;const n=o.length;if(1===n){const e=o[0];return e?t(e):null}let r="#3B82F6",a=32;n>100?(r="#1E40AF",a=40):n>50?(r="#2563EB",a=36):n>20?(r="#3B82F6",a=34):n>10&&(r="#60A5FA",a=33);const l=Math.min(1+.015*n,1.8),s=Math.round(a*l),c=z(r,s,{borderColor:r,showShadow:!0,showGradient:!0,showGlow:n>20,isNearbyPair:!1}),i="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(c);let d="12px",u="bold";return n>100?d="14px":n>50?d="13px":n>20&&(d="12px"),new F.Ay({image:new j.A({src:i,scale:1,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),text:new A.A({text:n.toString(),font:"".concat(u," ").concat(d," Arial"),fill:new N.A({color:"#FFFFFF"}),stroke:new E.A({color:"#000000",width:2}),offsetY:.6*s})})}catch(o){return null}}y.A.defs("EPSG:4674","+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"),(0,x.kz)(y.A);const _=e=>{let{dataPoints:t=[],onPainelOpen:o,center:x=w.center,zoom:y=w.zoom,className:v="h-screen w-full",terrasIndigenasData:F=null,estadoSPData:N=null,showTerrasIndigenas:E=!0,showEstadoSP:j=!0,showMarcadores:A=!0,showNomesEscolas:z=!1}=e;const _=(0,n.useRef)(null),D=(0,n.useRef)(null),R=(0,n.useRef)(null),G=(0,n.useRef)(null),T=(0,n.useRef)(null),B=(0,n.useRef)(null),[O,L]=(0,n.useState)({lng:x[0],lat:x[1],zoom:y}),Z=(0,n.useRef)(null),U=(0,n.useRef)(null),W=(0,n.useCallback)(((e,t)=>{const n=e.get("schoolData");n&&((0,b.Fr)()&&console.log("[MOBILE] Marcador de escola clicado:",n),null===o||void 0===o||o(n))}),[o]),J=(0,n.useCallback)((()=>({satelliteLayer:new l.A({source:new d.A({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:'\xa9 <a href="https://www.esri.com/">Esri</a>',maxZoom:19,wrapX:!1,tilePixelRatio:1,tileSize:256}),preload:1,useInterimTilesOnError:!1})})),[]),V=(0,n.useCallback)((e=>e.titulo||"Escola Ind\xedgena"),[]);return(0,n.useEffect)((()=>{if(D.current)return;const e=(0,b.Fr)(),t=e?w.mobile.center:x,o=e?w.mobile.zoom:y;R.current=new c.A,G.current=new i.A({distance:z?15:5,source:R.current,geometryFunction:e=>{const t=e.getGeometry();return"Point"===t.getType()?t:null}}),T.current=new s.A({source:G.current,style:e=>M(e,(e=>I(e,z))),zIndex:15});const{satelliteLayer:n}=J();B.current=n,D.current=new r.A({target:_.current,layers:[B.current,T.current],view:new a.Ay({center:(0,u.Rb)(t),zoom:o,maxZoom:18,minZoom:4,enableRotation:!1}),controls:(0,h.N)(),interactions:(0,m.N)({dragRotate:!1,pinchRotate:!1})}),D.current.on("moveend",(()=>{const e=D.current.getView(),t=(0,u.WP)(e.getCenter()),o={lng:t[0].toFixed(4),lat:t[1].toFixed(4),zoom:e.getZoom().toFixed(2)};L(o)})),D.current.on("moveend",(()=>{T.current&&T.current.changed()})),D.current.on("click",(e=>{const t=D.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(t)if(t.get("features")){const o=t.get("features");if(1===o.length)console.log("[CLUSTER] Clique em cluster com 1 marcador",o[0].get("schoolData")),W(o[0],e);else if(o.length>1){console.log("[CLUSTER] Clique em cluster com",o.length,"marcadores. Fazendo zoom.");const e=t.getGeometry().getExtent(),n=D.current.getView().getZoom();let r=12;r=o.length>20?10:o.length>10?11:o.length>5?12:13,r=Math.max(r,n+1),D.current.getView().fit(e,{duration:800,padding:[80,80,80,80],maxZoom:r})}}else console.log("[MARCADOR] Clique em marcador individual",t.get("schoolData")),W(t,e)}));let l=null;D.current.on("pointermove",(e=>{if((0,b.Fr)())return;l&&(l.remove(),l=null);const t=D.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(t)if(t.get("features")){const o=t.get("features");if(1===o.length){const t=o[0].get("schoolData");t&&(l=d(e,t))}else l=f(e,o.length)}else{const o=t.get("schoolData");o&&(l=d(e,o))}}));const d=(e,t)=>{const o=document.createElement("div");o.className="ol-tooltip",o.textContent=V(t),o.style.position="absolute",o.style.backgroundColor="rgba(255, 255, 255, 0.95)",o.style.color="#374151",o.style.padding="8px 12px",o.style.borderRadius="8px",o.style.fontSize="13px",o.style.fontFamily="Arial, sans-serif",o.style.fontWeight="500",o.style.maxWidth="200px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.zIndex="1000",o.style.pointerEvents="none",o.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",o.style.border="1px solid rgba(0, 0, 0, 0.1)",o.style.backdropFilter="blur(4px)";const n=e.coordinate,r=D.current.getPixelFromCoordinate(n);return o.style.left=r[0]+-100+"px",o.style.top=r[1]+-40+"px",_.current.appendChild(o),o},f=(e,t)=>{const o=document.createElement("div");o.className="ol-tooltip",o.textContent="".concat(t," escolas ind\xedgenas"),o.style.position="absolute",o.style.backgroundColor="rgba(255, 255, 255, 0.95)",o.style.color="#374151",o.style.padding="8px 12px",o.style.borderRadius="8px",o.style.fontSize="13px",o.style.fontFamily="Arial, sans-serif",o.style.fontWeight="500",o.style.maxWidth="200px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.zIndex="1000",o.style.pointerEvents="none",o.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",o.style.border="1px solid rgba(0, 0, 0, 0.1)",o.style.backdropFilter="blur(4px)";const n=e.coordinate,r=D.current.getPixelFromCoordinate(n);return o.style.left=r[0]+-100+"px",o.style.top=r[1]+-40+"px",_.current.appendChild(o),o};return D.current.on("dblclick",(e=>{const t=D.current.forEachFeatureAtPixel(e.pixel,(e=>e));t&&(!t.get("features")||t.get("features")&&1===t.get("features").length)&&(e.preventDefault(),e.stopPropagation(),console.log("[DBLCLICK] Zoom desabilitado em marcador individual ou cluster de 1 escola"))})),()=>{D.current&&(D.current.setTarget(void 0),D.current=null)}}),[x,y,J,M,V,o,W]),(0,n.useEffect)((()=>{if(!D.current)return;const e=(0,b.Fr)(),t=e?w.mobile.center:x,o=e?w.mobile.zoom:y,n=D.current.getView(),r=(0,u.WP)(n.getCenter()),a=n.getZoom();r[0]===t[0]&&r[1]===t[1]&&a===o||(n.setCenter((0,u.Rb)(t)),n.setZoom(o))}),[x,y,z]),(0,n.useEffect)((()=>{if(!R.current||!t||!A)return;R.current.clear();const e=t.filter((e=>{if(!e.latitude||!e.longitude)return!1;const t=parseFloat(e.latitude),o=parseFloat(e.longitude);return!isNaN(t)&&!isNaN(o)&&t>=-90&&t<=90&&o>=-180&&o<=180})),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e-5;const o=[],n=new Set;for(let r=0;r<e.length;r++)if(!n.has(r))for(let a=r+1;a<e.length;a++){if(n.has(a))continue;const l=e[r],s=e[a],c=Math.abs(parseFloat(l.latitude)-parseFloat(s.latitude)),i=Math.abs(parseFloat(l.longitude)-parseFloat(s.longitude));if(c<t&&i<t){o.push([r,a]),n.add(r),n.add(a);break}}return o}(e);new Set(o.flat());e.forEach(((e,t)=>{if(e.latitude&&e.longitude){const n=new g.A({geometry:new f.A((0,u.Rb)([e.longitude,e.latitude]))});n.set("schoolData",e);-1!==o.findIndex((e=>e.includes(t)))&&n.set("isNearbyPair",!0),R.current.addFeature(n)}}))}),[t,A]),(0,n.useEffect)((()=>{T.current&&T.current.setStyle((e=>M(e,(e=>I(e,z)))))}),[z,M]),(0,n.useEffect)((()=>{T.current&&(T.current.setStyle((e=>M(e,(e=>I(e,z))))),T.current.changed())}),[z,M]),(0,n.useEffect)((()=>{D.current&&R.current&&(T.current&&D.current.removeLayer(T.current),G.current=new i.A({distance:z?15:10,source:R.current,geometryFunction:e=>{const t=e.getGeometry();return"Point"===t.getType()?t:null}}),T.current=new s.A({source:G.current,style:e=>M(e,(e=>I(e,z))),zIndex:15}),D.current.addLayer(T.current))}),[z,M]),(0,n.useEffect)((()=>{if(D.current){if(Z.current&&(D.current.removeLayer(Z.current),Z.current=null),U.current&&(D.current.removeLayer(U.current),U.current=null),E&&F){if(!F.features||0===F.features.length)return;try{const e=new p.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).readFeatures(F);if(e.length>0){e[0].getGeometry()}const t=new s.A({source:new c.A({features:e}),style:S,zIndex:10});t.getSource().getFeatures().forEach((e=>{const t=e.getProperties();e.set("terraIndigenaInfo",{titulo:t.terrai_nom,tipo:"terra_indigena",etnia:t.etnia_nome,municipio:t.municipio_,uf:t.uf_sigla,superficie:t.superficie,fase:t.fase_ti,modalidade:t.modalidade,reestudo:t.reestudo_t,cr:t.cr,faixa_fron:t.faixa_fron,undadm_nom:t.undadm_nom,undadm_sig:t.undadm_sig,dominio_un:t.dominio_un,data_atual:t.data_atual,terrai_cod:t.terrai_cod,undadm_cod:t.undadm_cod})})),D.current.addLayer(t),Z.current=t}catch(e){}}if(j&&N){if(!N.features||0===N.features.length)return;try{const e=new p.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).readFeatures(N);if(e.length>0){e[0].getGeometry()}const t=new s.A({source:new c.A({features:e}),style:P,zIndex:5,interactive:!1});D.current.addLayer(t),U.current=t}catch(e){}}}}),[E,j,F,N]),(0,n.useEffect)((()=>{if(!D.current)return;const e=e=>{const t=D.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(t){const e=t.get("terraIndigenaInfo");e&&o&&o(e)}};return D.current.on("click",e),()=>{D.current&&D.current.un("click",e)}}),[o]),(0,C.jsx)(k,{ref:_,children:(0,C.jsxs)("div",{className:"absolute bottom-20 sm:bottom-4 left-4 z-10 bg-white bg-opacity-95 rounded-lg shadow-lg p-3",children:[(0,C.jsxs)("div",{className:"text-xs text-gray-600",children:["Lat: ",O.lat," | Lng: ",O.lng]}),(0,C.jsxs)("div",{className:"text-xs text-gray-600",children:["Zoom: ",O.zoom]})]})})},D={},R=e=>{const[t,o]=(0,n.useState)(null),[r,a]=(0,n.useState)(!1),[l,s]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(!e)return;(async()=>{if(D[e])return console.log("useGeoJSONCache: Dados de ".concat(e," encontrados no cache")),void o(D[e]);a(!0);try{var t,n;const r="".concat("/escolasindigenas","/").concat(e,".geojson");console.log("useGeoJSONCache: Carregando ".concat(e," de:"),r);const a=await fetch(r);if(!a.ok)throw new Error("Erro ao buscar GeoJSON (".concat(a.status,")"));const l=await a.json();console.log("useGeoJSONCache: ".concat(e," carregado com sucesso:"),{type:l.type,features:(null===(t=l.features)||void 0===t?void 0:t.length)||0,crs:l.crs,firstFeature:null!==(n=l.features)&&void 0!==n&&n[0]?{type:l.features[0].type,properties:l.features[0].properties?Object.keys(l.features[0].properties):"Sem propriedades",geometry:l.features[0].geometry?{type:l.features[0].geometry.type,coordinates:l.features[0].geometry.coordinates?"".concat(l.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),D[e]=l,o(l)}catch(r){console.error("useGeoJSONCache: Erro ao carregar ".concat(e,":"),r),s(r)}finally{a(!1)}})()}),[e]),{data:t,loading:r,error:l}},G=e=>{let{dataPoints:t,onPainelOpen:o,className:r="h-screen w-full"}=e;const{data:a,loading:l,error:s}=R("terras_indigenas"),{data:c,loading:i,error:d}=R("SP"),[u,f]=(0,n.useState)(!0),[g,h]=(0,n.useState)(!0),[m,p]=(0,n.useState)(!0),[x,y]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!1),k=(0,n.useCallback)((()=>{y(window.innerWidth<=768)}),[]);(0,n.useEffect)((()=>(k(),window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)})),[k]);const F=(0,n.useCallback)((()=>v((e=>!e))),[]);(0,n.useEffect)((()=>{var e,t,o,n;console.log("MapSelector: Status das camadas GeoJSON:",{terrasIndigenas:{loading:l,error:s,hasData:!!a,features:(null===a||void 0===a||null===(e=a.features)||void 0===e?void 0:e.length)||0,type:null===a||void 0===a?void 0:a.type,firstFeature:null!==a&&void 0!==a&&null!==(t=a.features)&&void 0!==t&&t[0]?{type:a.features[0].type,properties:a.features[0].properties?Object.keys(a.features[0].properties):"Sem propriedades"}:"Nenhum feature"},estadoSP:{loading:i,error:d,hasData:!!c,features:(null===c||void 0===c||null===(o=c.features)||void 0===o?void 0:o.length)||0,type:null===c||void 0===c?void 0:c.type,firstFeature:null!==c&&void 0!==c&&null!==(n=c.features)&&void 0!==n&&n[0]?{type:c.features[0].type,properties:c.features[0].properties?Object.keys(c.features[0].properties):"Sem propriedades"}:"Nenhum feature"}})}),[a,c,l,i,s,d]);const N=e=>{let{onMinimize:t,isMobile:o,isMinimized:n}=e;return(0,C.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-white",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:"Camadas do Mapa"}),(0,C.jsx)("div",{className:"flex items-center gap-2",children:(0,C.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":n?"Expandir":"Minimizar",type:"button",children:n?"\u25be":"\u25b4"})})]})},E=e=>{let{id:t,label:o,checked:n,onChange:r,disabled:a=!1,loading:l=!1,error:s=!1,total:c,color:i,subItems:d=null}=e;return(0,C.jsxs)("button",{type:"button",onClick:r,disabled:a,className:"w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors ".concat(n?"bg-gray-50":"hover:bg-gray-50"," ").concat(a?"opacity-50 cursor-not-allowed":""),children:[d?(0,C.jsx)("div",{className:"flex flex-col gap-1",children:d.map(((e,t)=>(0,C.jsxs)("div",{className:"flex items-center gap-1",children:[(0,C.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),(0,C.jsx)("span",{className:"text-xs text-gray-600",children:e.label})]},t)))}):(0,C.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i}}),(0,C.jsx)("span",{className:"text-sm text-gray-800",children:o}),void 0!==c&&(0,C.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",c,")"]}),l&&(0,C.jsx)("span",{className:"text-blue-500 ml-1",children:"(carregando...)"}),s&&(0,C.jsx)("span",{className:"text-red-500 ml-1",children:"(erro)"}),d?(0,C.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full bg-gray-300"}):(0,C.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full",style:{backgroundColor:i}})]})},S=x?w.mobile.center:w.center,P=x?w.mobile.zoom:w.zoom;return console.log("MapSelector - Debug zoom:",{isMobile:x,mobileZoom:w.mobile.zoom,desktopZoom:w.zoom,selectedZoom:P,mobileCenter:w.mobile.center,desktopCenter:w.center,selectedCenter:S}),(0,C.jsxs)("div",{className:r,style:{position:"relative"},children:[x?(0,C.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,C.jsxs)("div",{className:"bg-white border-t border-gray-100 shadow-lg",children:[(0,C.jsx)(N,{onMinimize:F,isMobile:!0,isMinimized:b}),!b&&(0,C.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-60 overflow-y-auto",children:[(0,C.jsx)(E,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:g,onChange:()=>h(!g),loading:i,error:d,color:"#10B981"}),(0,C.jsx)(E,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:m,onChange:()=>p(!m),total:null===t||void 0===t?void 0:t.length,color:"#3B82F6"}),(0,C.jsx)(E,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:u,onChange:()=>f(!u),loading:l,error:s,subItems:[{label:"Regularizadas",color:"#DC143C"},{label:"Declaradas",color:"#8B0000"}]})]})]})}):(0,C.jsxs)("div",{className:"fixed top-24 right-4 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:[(0,C.jsx)(N,{onMinimize:F,isMobile:!1,isMinimized:b}),!b&&(0,C.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-96 overflow-y-auto",children:[(0,C.jsx)(E,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:g,onChange:()=>h(!g),loading:i,error:d,color:"#10B981"}),(0,C.jsx)(E,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:m,onChange:()=>p(!m),total:null===t||void 0===t?void 0:t.length,color:"#3B82F6"}),(0,C.jsx)(E,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:u,onChange:()=>f(!u),loading:l,error:s,subItems:[{label:"Regularizadas",color:"#DC143C"},{label:"Declaradas",color:"#8B0000"}]})]})]}),(0,C.jsx)(_,{dataPoints:m?t:[],onPainelOpen:o,className:"h-full w-full",center:S,zoom:P,terrasIndigenasData:a,estadoSPData:c,showTerrasIndigenas:u,showEstadoSP:g,showMarcadores:m})]})};var T=o(859),B=o(6799),O=o(3303);const L=e=>{let{dataPoints:t,onPainelOpen:o}=e;console.log("DataPoints recebidos no MapaEscolasIndigenas:",t?{quantidade:t.length,exemplo:t[0]?{titulo:t[0].titulo,latitude:t[0].latitude,longitude:t[0].longitude,tipo:t[0].tipo}:"Nenhum ponto"}:"Nenhum dataPoint");const{refreshKey:r}=(0,O.b)(),a=(0,n.useMemo)((()=>new URLSearchParams(window.location.search)),[]).get("panel"),l=(0,n.useMemo)((()=>{if(a&&""!==a&&t&&t.length>0){return t.find((e=>(0,B.N)(e.titulo)===a))||null}return null}),[a,t]),[s,c]=(0,n.useState)(l),i=(0,n.useMemo)((()=>t?t.filter((e=>e.pontuacao>=0)):[]),[t]),d=(0,n.useMemo)((()=>i.length),[i]);(0,n.useEffect)((()=>{console.group("MapaEscolasIndigenas - painelInfo state changed"),console.log("Novo valor de painelInfo:",{titulo:null===s||void 0===s?void 0:s.titulo,tipo:null===s||void 0===s?void 0:s.tipo,hasLink:!(null===s||void 0===s||!s.link_para_documentos),linkValue:null===s||void 0===s?void 0:s.link_para_documentos,isInitialPanel:s===l,isNull:null===s,isUndefined:void 0===s}),console.groupEnd()}),[s,l]);const u=(0,n.useCallback)((e=>{e&&c(e)}),[]),f=(0,n.useCallback)((()=>{console.log("For\xe7ando refresh do painel de informa\xe7\xf5es")}),[]);(0,n.useEffect)((()=>{console.log("MapaEscolasIndigenas: onPainelOpen dispon\xedvel:",!!o),console.log("MapaEscolasIndigenas: abrirPainel dispon\xedvel:",!!u),o&&"function"===typeof o&&(console.log("MapaEscolasIndigenas: Expondo fun\xe7\xe3o abrirPainel e refreshPainel"),o(u,f))}),[u,o,f]);const g=(0,n.useCallback)((()=>{c(null)}),[]);return(0,C.jsxs)("div",{className:"relative h-screen w-full overflow-hidden",children:[(0,C.jsx)(G,{dataPoints:i,onPainelOpen:u,className:"h-full w-full"}),s&&(0,C.jsxs)(C.Fragment,{children:[console.log("MapaEscolasIndigenas - Renderizando PainelInformacoes com:",{painelInfo:s,hasLink:null===s||void 0===s?void 0:s.link_para_documentos,linkValue:null===s||void 0===s?void 0:s.link_para_documentos}),(0,C.jsx)(T.A,{painelInfo:s,closePainel:g,refreshKey:r})]}),(0,C.jsxs)("div",{className:"absolute top-20 left-4 z-30 bg-white bg-opacity-95 rounded-lg shadow-lg p-3",children:[(0,C.jsxs)("div",{className:"text-sm font-semibold text-gray-800",children:["Escolas Ind\xedgenas: ",d]}),(0,C.jsx)("div",{className:"text-xs text-gray-600",children:"Mapa otimizado sem gaps"})]})]})}},9845:(e,t,o)=>{o.d(t,{Fr:()=>n,uy:()=>r});const n=()=>window.innerWidth<=768;class r{constructor(){this.lastClickedFeature=null,this.clickTimeout=null,this.clickDelay=300}handleClick(e,t,o){arguments.length>3&&void 0!==arguments[3]&&arguments[3]?this.lastClickedFeature===e?(this.clearTimeout(),this.lastClickedFeature=null,o(e)):(this.lastClickedFeature&&this.clearTimeout(),this.lastClickedFeature=e,t(e),this.clickTimeout=setTimeout((()=>{this.lastClickedFeature=null}),this.clickDelay)):o(e)}clearTimeout(){this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null)}reset(){this.clearTimeout(),this.lastClickedFeature=null}}}}]);
//# sourceMappingURL=151.c036e391.chunk.js.map