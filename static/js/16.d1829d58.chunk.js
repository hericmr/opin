"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[16],{20016:(e,a,o)=>{o.r(a),o.d(a,{default:()=>n});var t=o(65043),r=o(40237),s=o(70579);const n=()=>{const[e,a]=(0,t.useState)([]),[o,n]=(0,t.useState)(!1),l=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const t=(new Date).toLocaleTimeString();a(a=>[...a,{timestamp:t,message:e,type:o}])};return(0,s.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-4xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Teste de Funcionalidade de Legendas"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("button",{onClick:async()=>{n(!0),a([]);try{l("=== INICIANDO TESTES DE LEGENDAS ===","header"),l("Teste 1: Verificando estrutura da tabela..."),await(0,r.iy)(),l("\u2705 Teste da estrutura da tabela conclu\xeddo"),l("Teste 2: Criando legenda de teste...");const e={escola_id:1,imagem_url:"test/test-image.jpg",legenda:"Legenda de teste",descricao_detalhada:"Descri\xe7\xe3o detalhada de teste",autor_foto:"Teste Autor",data_foto:"2024-01-01",categoria:"teste",ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},a=await(0,r.eP)(e);l("\u2705 Legenda criada com ID: ".concat(a.id)),l("Teste 3: Buscando legenda criada...");const o=await(0,r.qP)("test/test-image.jpg",1);o?l("\u2705 Legenda encontrada: ".concat(o.legenda)):l("\u274c Legenda n\xe3o encontrada","error"),l("Teste 4: Atualizando legenda...");const t={legenda:"Legenda atualizada",updated_at:(new Date).toISOString()},s=await(0,r.w_)(a.id,t);l("\u2705 Legenda atualizada: ".concat(s.legenda)),l("Teste 5: Verificando se a atualiza\xe7\xe3o foi salva...");const n=await(0,r.qP)("test/test-image.jpg",1);n&&"Legenda atualizada"===n.legenda?l("\u2705 Atualiza\xe7\xe3o salva corretamente"):l("\u274c Atualiza\xe7\xe3o n\xe3o foi salva corretamente","error"),l("=== TESTES CONCLU\xcdDOS COM SUCESSO ===","success")}catch(e){l("\u274c ERRO NOS TESTES: ".concat(e.message),"error"),console.error("Erro nos testes:",e)}finally{n(!1)}},disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 mr-4",children:o?"Executando Testes...":"Executar Testes"}),(0,s.jsx)("button",{onClick:()=>{a([])},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Limpar Logs"})]}),(0,s.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4 max-h-96 overflow-y-auto",children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Logs dos Testes:"}),0===e.length?(0,s.jsx)("p",{className:"text-gray-500",children:"Nenhum teste executado ainda."}):(0,s.jsx)("div",{className:"space-y-1",children:e.map((e,a)=>(0,s.jsxs)("div",{className:"text-sm font-mono ".concat("error"===e.type?"text-red-600":"success"===e.type?"text-green-600":"header"===e.type?"text-blue-600 font-bold":"text-gray-800"),children:["[",e.timestamp,"] ",e.message]},a))})]}),(0,s.jsxs)("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,s.jsx)("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Instru\xe7\xf5es:"}),(0,s.jsxs)("ol",{className:"text-sm text-yellow-700 space-y-1 list-decimal list-inside",children:[(0,s.jsx)("li",{children:'Clique em "Executar Testes" para verificar se a funcionalidade de legendas est\xe1 funcionando'}),(0,s.jsx)("li",{children:"Verifique os logs para identificar poss\xedveis problemas"}),(0,s.jsx)("li",{children:"Se houver erros, execute o script SQL no Supabase para corrigir a estrutura da tabela"}),(0,s.jsx)("li",{children:"Teste novamente ap\xf3s corrigir problemas no banco de dados"})]})]})]})}},40237:(e,a,o)=>{o.d(a,{eP:()=>l,iy:()=>r,jW:()=>i,qP:()=>s,s7:()=>g,t$:()=>n,w_:()=>c});var t=o(52480);const r=async()=>{try{const{error:e}=await t.N.from("legendas_fotos").select("count").limit(1);return e?(console.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(console.log("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return console.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},s=async function(e,a){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let r=t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a);!1!==o.ativo&&(r=r.eq("ativo",!0)),o.categoria&&(r=r.eq("categoria",o.categoria)),o.tipo_foto&&(r=r.eq("tipo_foto",o.tipo_foto));const{data:s,error:n}=await r.order("created_at",{ascending:!1});return n?(console.warn("Erro ao buscar legenda:",n.message),null):s&&s.length>0?s[0]:null}catch(r){return console.warn("Erro ao buscar legenda:",r.message),null}},n=async function(e,a){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(console.log("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(a,")")),o.categoria||o.tipo_foto){console.log("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const t=await s(e,a,o);if(t)return console.log("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),t}console.log("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:r,error:n}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(n)console.warn("  \u274c Erro na busca por URL e escola:",n.message);else if(r&&r.length>0)return console.log("  \u2705 Encontrada por URL e escola"),r[0];console.log("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:l,error:c}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).order("created_at",{ascending:!1});if(c)console.warn("  \u274c Erro na busca incluindo inativas:",c.message);else if(l&&l.length>0)return console.log("  \u2705 Encontrada incluindo legendas inativas"),l[0];const i=e.split("/").pop();console.log("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(i));const{data:d,error:g}=await t.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(i)).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(g)console.warn("  \u274c Erro na busca por nome do arquivo:",g.message);else if(d&&d.length>0)return console.log("  \u2705 Encontrada por nome do arquivo"),d[0];return console.log("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(r){return console.warn("Erro ao buscar legenda flex\xedvel:",r.message),null}},l=async e=>{try{const{data:a,error:o}=await t.N.from("legendas_fotos").insert([e]).select().single();if(o)throw o;return a}catch(a){throw console.error("Erro ao adicionar legenda:",a),a}},c=async(e,a)=>{try{const{data:o,error:r}=await t.N.from("legendas_fotos").update(a).eq("id",e).select().single();if(r)throw r;return o}catch(o){throw console.error("Erro ao atualizar legenda:",o),o}},i=async(e,a)=>{try{const{data:o,error:r}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("categoria","video").single();if(r){if("PGRST116"===r.code)return null;throw r}return o}catch(o){return console.warn("Erro ao buscar t\xedtulo do v\xeddeo:",o.message),null}},d=async(e,a,o)=>{try{const r=await s(e,a,{ativo:!1});if(r){const{data:e,error:a}=await t.N.from("legendas_fotos").update({ordem:o,updated_at:(new Date).toISOString()}).eq("id",r.id).select().single();if(a)throw a;return e}{const{data:r,error:s}=await t.N.from("legendas_fotos").insert([{escola_id:a,imagem_url:e,ordem:o,ativo:!0,tipo_foto:"escola",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(s)throw s;return r}}catch(r){throw console.error("Erro ao atualizar ordem da imagem:",r),r}},g=async(e,a)=>{try{return await Promise.all(e.map(e=>{let{imageUrl:o,ordem:t}=e;return d(o,a,t)}))}catch(o){throw console.error("Erro ao atualizar ordens das imagens:",o),o}}}}]);
//# sourceMappingURL=16.d1829d58.chunk.js.map