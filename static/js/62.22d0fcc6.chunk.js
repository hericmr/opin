"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[62],{3001:(e,n,o)=>{o.r(n),o.d(n,{default:()=>h});var t=o(5043),a=o(9896),r=o(9419),i=o(2023),s=o(228),l=o.n(s);const c=44,d=e=>new(l().DivIcon)({className:"custom-marker-".concat(e),html:'\n      <div class="relative" role="button" tabindex="0" aria-label="Marcador de localiza\xe7\xe3o">\n        <div class="marker-container" style="min-width: '.concat(c,"px; min-height: ").concat(c,'px; display: flex; align-items: center; justify-content: center;">\n          <svg \n            xmlns="http://www.w3.org/2000/svg" \n            viewBox="0 0 24 24" \n            class="w-8 h-8"\n            aria-hidden="true"\n            focusable="false"\n          >\n            <path \n              fill="').concat(e,'" \n              d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"\n            />\n            <circle cx="12" cy="9" r="3" fill="white" class="marker-pulse"/>\n          </svg>\n        </div>\n      </div>\n      <style>\n        .custom-marker-').concat(e," {\n          filter: drop-shadow(0 1px 3px rgb(0 0 0 / 0.2));\n        }\n        .marker-container {\n          transform-origin: bottom center;\n          animation: bounce 3s cubic-bezier(0.4, 0, 0.2, 1) infinite;\n          cursor: pointer;\n          border-radius: 50%;\n          transition: transform 0.2s ease, filter 0.2s ease;\n        }\n        .marker-container:hover, .marker-container:focus {\n          transform: scale(1.1);\n          filter: brightness(1.1);\n          outline: 2px solid ").concat(e,";\n          outline-offset: 2px;\n        }\n        .marker-container:focus {\n          outline: 2px solid ").concat(e,";\n          outline-offset: 2px;\n        }\n        .marker-pulse {\n          animation: pulse 4s cubic-bezier(0.4, 0, 0.2, 1) infinite;\n        }\n        @keyframes bounce {\n          0%, 100% { transform: translateY(0); }\n          50% { transform: translateY(-2px); }\n        }\n        @keyframes pulse {\n          0%, 100% { opacity: 0.9; }\n          50% { opacity: 0.7; }\n        }\n        @media (hover: none) {\n          .marker-container:hover {\n            transform: none;\n            filter: none;\n          }\n        }\n      </style>\n    "),iconSize:[c,c],iconAnchor:[22,c],popupAnchor:[0,-44]}),u=(d("#2196F3"),d("#4CAF50"),d("#FFC107"),d("#F44336"),new(l().Icon)({iconUrl:"data:image/svg+xml;base64,"+btoa('\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n      <path fill="#3B82F6" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>\n      <circle cx="12" cy="9" r="3" fill="white"/>\n    </svg>\n  '),iconSize:[24,24],iconAnchor:[12,24],popupAnchor:[0,-24]}));d("#212121"),d("#FF5722"),d("#FF9800");o(4260),o(5632),o(1845);var p=o(4128),m=o(579);const g=5e-5,f=e=>{let{dataPoints:n,visibility:o,onClick:r,mapView:i}=e;const s=(0,a.ko)(),c=(0,t.useRef)(null),d=(0,t.useRef)([]),m=(0,t.useMemo)((()=>l().Browser.mobile),[]),f=(0,t.useRef)(null),h=(0,t.useRef)(null);(0,t.useEffect)((()=>{s&&i&&s.setView(i.center,i.zoom,{animate:!1})}),[s,i]),(0,t.useEffect)((()=>{s&&i&&s.getZoom()!==i.zoom&&s.setView(i.center,i.zoom,{animate:!1})}),[s,i]);const b=(0,t.useCallback)((()=>{h.current&&(clearTimeout(h.current),h.current=null)}),[]),v=(0,t.useCallback)(((e,n,o)=>{m&&(o.originalEvent.stopPropagation(),f.current===e?(b(),e.closeTooltip(),null===r||void 0===r||r(n),f.current=null):(f.current&&f.current.closeTooltip(),f.current=e,e.openTooltip(),b(),h.current=setTimeout((()=>{e.closeTooltip(),f.current=null}),2e3)))}),[m,r,b]),x=t.useMemo((()=>{if(!Array.isArray(n)||0===n.length)return console.warn("Marcadores: Nenhum ponto de dados recebido"),[];console.log("Total de escolas recebidas:",n.length);const e=[],o=n.filter((n=>{if(!n.titulo||!n.latitude||!n.longitude)return e.push({escola:n.titulo||"Sem nome",problema:"Dados b\xe1sicos ausentes",detalhes:{titulo:!!n.titulo,latitude:!!n.latitude,longitude:!!n.longitude}}),!1;const o=parseFloat(n.latitude),t=parseFloat(n.longitude);return isNaN(o)||isNaN(t)?(e.push({escola:n.titulo,problema:"Coordenadas n\xe3o s\xe3o n\xfameros v\xe1lidos",detalhes:{latitude:n.latitude,longitude:n.longitude}}),!1):!(o<-90||o>90||t<-180||t>180)||(e.push({escola:n.titulo,problema:"Coordenadas fora dos limites v\xe1lidos",detalhes:{latitude:o,longitude:t,limites:{latMin:-90,latMax:90,lngMin:-180,lngMax:180}}}),!1)}));return e.length>0&&(console.group("Escolas com coordenadas inv\xe1lidas:"),e.forEach((e=>{console.group(e.escola),console.log("Problema:",e.problema),console.log("Detalhes:",e.detalhes),console.groupEnd()})),console.groupEnd(),console.log("Total de escolas com problemas: ".concat(e.length))),console.log("Escolas v\xe1lidas: ".concat(o.length," de ").concat(n.length)),o}),[n]),y=u,w=(0,t.useCallback)((e=>'\n      <div class="bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100 text-left w-full hover:text-violet-700 focus:text-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-opacity-50 transition-colors duration-200">\n        <button \n          onclick="event.stopPropagation(); window.dispatchEvent(new CustomEvent(\'marker-click\', { detail: '.concat(JSON.stringify(e),' }));"\n          aria-label="Ver detalhes da escola ').concat((0,p.k)(e.titulo),'"\n          class="w-full text-left"\n        >\n          <strong>').concat((0,p.k)(e.titulo),"</strong>\n          ").concat(e.etnia?'<div class="mt-1 text-xs text-gray-600">Etnia: '.concat(e.etnia,"</div>"):"","\n        </button>\n      </div>\n    ")),[]);return(0,t.useEffect)((()=>{if(!Array.isArray(n)||0===n.length)return void console.warn("Marcadores: Nenhum ponto de dados v\xe1lido recebido");if(!s||!x.length||!o.educacao)return;c.current&&s.removeLayer(c.current),d.current.forEach((e=>s.removeLayer(e))),d.current=[],f.current=null,b();const e=(e=>{const n=[],o=new Set;for(let t=0;t<e.length;t++)if(!o.has(t))for(let a=t+1;a<e.length;a++){if(o.has(a))continue;const r=e[t],i=e[a],s=Math.abs(parseFloat(r.latitude)-parseFloat(i.latitude)),l=Math.abs(parseFloat(r.longitude)-parseFloat(i.longitude));if(s<g&&l<g){n.push([t,a]),o.add(t),o.add(a);break}}return n})(x),t=(new Set(e.flat()),new(l().MarkerClusterGroup)({chunkedLoading:!0,maxClusterRadius:4,spiderfyOnMaxZoom:!0,showCoverageOnHover:!m,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0,disableClusteringAtZoom:12,minZoom:4,maxZoom:18,iconCreateFunction:function(e){const n=e.getChildCount();let o="small",t="#A0522D";n>100?(o="large",t="#4B2E14"):n>20&&(o="medium",t="#8B5A2B");const a=u.options.iconUrl,r=u.options.iconSize||[44,44];return e.bindTooltip('\n          <div class="bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100">\n            <strong>'.concat(n," escola").concat(n>1?"s":""," ind\xedgena").concat(n>1?"s":"",'</strong>\n            <br/>\n            <span class="text-xs text-gray-600">Clique para expandir</span>\n          </div>\n        '),{className:"cluster-tooltip",direction:"top",offset:[0,-10],opacity:1,permanent:!1,sticky:!m}),l().divIcon({html:'\n            <div \n              role="button"\n              tabindex="0"\n              aria-label="Grupo de '.concat(n,' escolas ind\xedgenas. Clique para expandir."\n              style="\n              background: radial-gradient(circle at 30% 30%, ').concat(t,", #3b2e2a);\n              color: ").concat("#fff",";\n              border-radius: 50%;\n                width: ").concat(r[0],"px;\n                height: ").concat(r[1],'px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              font-weight: bold;\n              border: 2px solid #f5f5dc;\n              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n                transition: transform 0.3s ease, box-shadow 0.3s ease;\n              padding: 2px;\n                cursor: pointer;\n              "\n            >\n              <img \n                src="').concat(a,'" \n                width="').concat(.6*r[0],'" \n                height="').concat(.6*r[1],'" \n                style="margin-bottom: 2px;"\n                alt=""\n                aria-hidden="true"\n              />\n              <span \n                style="\n                font-size: ').concat("large"===o?"16px":"medium"===o?"14px":"12px",';\n                "\n              >').concat(n,"</span>\n            </div>"),className:"marker-cluster marker-cluster-".concat(o),iconSize:l().point(r[0],r[1])})},animateAddingMarkers:!0,spiderLegPolylineOptions:{weight:1.3,color:"#5C4033",opacity:.5,dashArray:"2,4"},chunkInterval:m?100:200,chunkDelay:m?25:50,singleMarkerMode:!1,spiderfyDistanceMultiplier:m?2:1.5}));t.on("clusterclick",(function(e){const n=e.layer,o=n.getAllChildMarkers();if(s.getZoom()>=n.options.disableClusteringAtZoom){const e=l().tooltip({className:"cluster-expand-tooltip",direction:"center",permanent:!0,opacity:.9}).setContent('\n          <div class="bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100">\n            <strong>Expandindo '.concat(o.length," escola").concat(o.length>1?"s":"",'</strong>\n            <br/>\n            <span class="text-xs text-gray-600">Toque em um marcador para ver detalhes</span>\n          </div>\n        ')).setLatLng(n.getLatLng());e.addTo(s),setTimeout((()=>e.remove()),2e3)}})),x.forEach(((n,o)=>{const a=parseFloat(n.latitude),i=parseFloat(n.longitude),c=l().marker([a,i],{icon:y,zIndexOffset:1e3,keyboard:!0,alt:"Marcador para ".concat((0,p.k)(n.titulo)),riseOnHover:!0,interactive:!0,tooltip:null});c.unbindTooltip(),c.bindTooltip(w(n),{className:"custom-tooltip",direction:"top",offset:[0,-10],opacity:1,permanent:!1,sticky:!m,interactive:!0,tooltip:null}),c.on("click",(e=>{e.originalEvent&&e.originalEvent.stopPropagation(),console.log("Marcador clicado:",n.titulo),null===r||void 0===r||r(n)})),m&&c.on("touchend",(e=>{e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),console.log("Marcador tocado (mobile):",n.titulo),null===r||void 0===r||r(n)}));const u=e.findIndex((e=>e.includes(o)));if(-1!==u){const[n,t]=e[u],r=o===n,p=x[r?t:n];m||c.on("add",(function(){const e=r?"perspective(500px) rotateY(-20deg) translateX(-20px) rotate(-25deg) scale(0.9)":"perspective(500px) rotateY(20deg) translateX(20px) rotate(25deg) scale(0.9)";this._icon.style.transform=e,this._icon.style.transition="transform 0.5s ease-out, filter 0.3s ease-in",this._icon.style.filter="drop-shadow(0 4px 12px rgba(160, 82, 45, 0.35))",this._icon.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.35)"}));const g=((e,n,o,t,a)=>l().polyline([[n,o],[t,a]],{color:"#A0522D",weight:1.2,dashArray:"3,3",opacity:.6,className:"marker-connector"}).addTo(e))(s,a,i,parseFloat(p.latitude),parseFloat(p.longitude));d.current.push(g)}t.addLayer(c)})),s.addLayer(t),c.current=t;const a=e=>{const n=e.detail;null===r||void 0===r||r(n)};return window.addEventListener("marker-click",a),()=>{window.removeEventListener("marker-click",a),c.current&&s.removeLayer(c.current),d.current.forEach((e=>s.removeLayer(e))),d.current=[],b(),f.current=null}}),[s,x,r,y,o.educacao,n,m,w,v,b]),null},h=e=>{let{dataPoints:n,visibility:o,onClick:t,mapView:a}=e;return(0,m.jsxs)(r.W,{center:(null===a||void 0===a?void 0:a.center)||[-23.5505,-46.6333],zoom:(null===a||void 0===a?void 0:a.zoom)||8,style:{height:"100%",width:"100%",background:"transparent"},attributionControl:!1,zoomControl:!1,doubleClickZoom:!1,scrollWheelZoom:!1,dragging:!1,touchZoom:!1,boxZoom:!1,keyboard:!1,tap:!1,className:"markers-only-map",preferCanvas:!0,zoomSnap:0,zoomDelta:0,wheelPxPerZoomLevel:0,wheelDebounceTime:0,wheelSensitivity:0,children:[(0,m.jsx)(i.e,{url:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",attribution:"",opacity:0,zIndex:-1e3}),(0,m.jsx)(f,{dataPoints:n,visibility:o,onClick:t,mapView:a})]})}},4128:(e,n,o)=>{o.d(n,{k:()=>a});const t=["EE","EEI"],a=e=>{if(!e||"string"!==typeof e)return"";return e.split(/\s+/).map((e=>t.includes(e.toUpperCase())?e.toUpperCase():e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())).join(" ")}}}]);
//# sourceMappingURL=62.22d0fcc6.chunk.js.map