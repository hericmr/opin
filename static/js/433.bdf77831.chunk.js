"use strict";(self.webpackChunkmapa_santos=self.webpackChunkmapa_santos||[]).push([[250,433,491],{428:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var o=a(5043),s=a(9896),n=a(6679),i=a(228),r=a.n(i),l=(a(4260),a(5632),a(1845),a(4128));const c=5e-5,d=e=>{let{dataPoints:t,visibility:a,onClick:i}=e;const d=(0,s.ko)(),u=(0,o.useRef)(null),p=(0,o.useRef)([]),m=o.useMemo((()=>{if(!Array.isArray(t)||0===t.length)return[];const e=[],a=t.filter((t=>{if(!t.titulo||!t.latitude||!t.longitude)return e.push({escola:t.titulo||"Sem nome",problema:"Dados b\xe1sicos ausentes",detalhes:{titulo:!!t.titulo,latitude:!!t.latitude,longitude:!!t.longitude}}),!1;const a=parseFloat(t.latitude),o=parseFloat(t.longitude);return isNaN(a)||isNaN(o)?(e.push({escola:t.titulo,problema:"Coordenadas n\xe3o s\xe3o n\xfameros v\xe1lidos",detalhes:{latitude:t.latitude,longitude:t.longitude}}),!1):!(a<-90||a>90||o<-180||o>180)||(e.push({escola:t.titulo,problema:"Coordenadas fora dos limites v\xe1lidos",detalhes:{latitude:a,longitude:o,limites:{latMin:-90,latMax:90,lngMin:-180,lngMax:180}}}),!1)}));return e.length>0&&(console.group("Escolas com coordenadas inv\xe1lidas:"),e.forEach((e=>{console.group(e.escola),console.log("Problema:",e.problema),console.log("Detalhes:",e.detalhes),console.groupEnd()})),console.groupEnd(),console.log("Total de escolas com problemas: ".concat(e.length))),a}),[t]),g=n.rI;return(0,o.useEffect)((()=>{if(!Array.isArray(t)||0===t.length)return;if(!d||!m.length||!a.educacao)return;u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[];const e=(e=>{const t=[],a=new Set;for(let o=0;o<e.length;o++)if(!a.has(o))for(let s=o+1;s<e.length;s++){if(a.has(s))continue;const n=e[o],i=e[s],r=Math.abs(parseFloat(n.latitude)-parseFloat(i.latitude)),l=Math.abs(parseFloat(n.longitude)-parseFloat(i.longitude));if(r<c&&l<c){t.push([o,s]),a.add(o),a.add(s);break}}return t})(m),o=(new Set(e.flat()),new(r().MarkerClusterGroup)({chunkedLoading:!0,maxClusterRadius:4,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0,disableClusteringAtZoom:12,minZoom:4,maxZoom:18,iconCreateFunction:function(e){const t=e.getChildCount();let a="small",o="#A0522D";t>100?(a="large",o="#4B2E14"):t>20&&(a="medium",o="#8B5A2B");const s=n.rI.options.iconUrl,i=n.rI.options.iconSize||[30,30];return r().divIcon({html:'\n            <div style="\n              background: radial-gradient(circle at 30% 30%, '.concat(o,", #3b2e2a);\n              color: ").concat("#fff",";\n              border-radius: 50%;\n              width: ").concat(i[0]+10,"px;\n              height: ").concat(i[1]+10,'px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              font-weight: bold;\n              border: 2px solid #f5f5dc;\n              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n              transition: transform 0.3s ease;\n              padding: 2px;\n            ">\n              <img src="').concat(s,'" width="').concat(.6*i[0],'" height="').concat(.6*i[1],'" style="margin-bottom: 2px;" />\n              <span style="\n                font-size: ').concat("large"===a?"16px":"medium"===a?"14px":"12px",';\n              ">').concat(t,"</span>\n            </div>"),className:"marker-cluster marker-cluster-".concat(a),iconSize:r().point(i[0]+10,i[1]+10)})},animateAddingMarkers:!0,spiderLegPolylineOptions:{weight:1.3,color:"#5C4033",opacity:.5,dashArray:"2,4"},chunkInterval:200,chunkDelay:50,singleMarkerMode:!1,spiderfyDistanceMultiplier:1.5,polygonOptions:{fillColor:"#A0522D",color:"#5C4033",weight:1.2,opacity:.6,fillOpacity:.2}}));return m.forEach(((t,a)=>{const s=parseFloat(t.latitude),n=parseFloat(t.longitude),c=r().marker([s,n],{icon:g,zIndexOffset:1e3,interactive:!0,riseOnHover:!0,keyboard:!0,title:(0,l.k)(t.titulo)});window.innerWidth>768&&c.bindTooltip((0,l.k)(t.titulo),{className:"bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100",direction:"top",offset:[0,-10],opacity:1,permanent:!1,sticky:!0,interactive:!1}),c.on("click touchstart",(e=>{e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),c.closeTooltip(),window.innerWidth<=768&&(c.bindTooltip((0,l.k)(t.titulo),{className:"bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100",direction:"top",offset:[0,-10],opacity:1,permanent:!0,sticky:!1,interactive:!1}).openTooltip(),setTimeout((()=>{c.closeTooltip()}),1e3)),"touchstart"===e.type?setTimeout((()=>{null===i||void 0===i||i(t)}),100):null===i||void 0===i||i(t)})),c.on("touchstart",(()=>{c.setOpacity(.7)})),c.on("touchend touchcancel",(()=>{c.setOpacity(1)}));const u=e.findIndex((e=>e.includes(a)));if(-1!==u){const[t,o]=e[u],i=a===t,l=m[i?o:t];c.on("add",(function(){const e=i?"perspective(500px) rotateY(-20deg) translateX(-20px) rotate(-25deg) scale(0.9)":"perspective(500px) rotateY(20deg) translateX(20px) rotate(25deg) scale(0.9)";this._icon.style.transform=e,this._icon.style.transition="transform 0.5s ease-out, filter 0.3s ease-in",this._icon.style.filter="drop-shadow(0 4px 12px rgba(160, 82, 45, 0.35))",this._icon.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.35)"}));const g=((e,t,a,o,s)=>r().polyline([[t,a],[o,s]],{color:"#A0522D",weight:1.2,dashArray:"3,3",opacity:.6,className:"marker-connector"}).addTo(e))(d,s,n,parseFloat(l.latitude),parseFloat(l.longitude));p.current.push(g)}o.addLayer(c)})),d.addLayer(o),u.current=o,()=>{u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[]}}),[d,m,i,g,a.educacao,t]),null}},522:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var o=a(2555),s=a(5043),n=a(9896),i=a(9419),r=a(2023),l=a(579);const c=()=>window.innerWidth<=768,d=()=>{const e=(0,n.ko)();return(0,s.useEffect)((()=>{const t=()=>{requestAnimationFrame((()=>{e.invalidateSize()}))};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)}),[e]),null},u=e=>{let{children:t}=e;const a=(0,s.useRef)(null),o=c()?[-23.5505,-48.6333]:[-23.305,-43.9],n=c()?6:7,u=window.devicePixelRatio>1;return(0,l.jsx)("div",{className:"h-screen w-screen overflow-hidden",children:(0,l.jsxs)(i.W,{ref:a,center:o,zoom:n,className:"h-full w-full",attributionControl:!1,zoomSnap:.25,zoomDelta:.25,updateWhenIdle:!0,updateWhenZooming:!1,preferCanvas:!0,maxZoom:18,minZoom:4,wheelDebounceTime:40,wheelPxPerZoomLevel:60,zoomAnimation:!0,fadeAnimation:!0,markerZoomAnimation:!0,children:[(0,l.jsx)(r.e,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",detectRetina:!0,tileSize:u?512:256,zoomOffset:u?-1:0,keepBuffer:u?4:2,edgeBufferTiles:u?3:2,updateWhenIdle:!0,updateWhenZooming:!1,updateInterval:150,maxNativeZoom:19,maxZoom:19,crossOrigin:!0,bounds:void 0,noWrap:!0,className:"leaflet-tile-pane",style:{imageRendering:u?"crisp-edges":"auto"},attribution:'\xa9 <a href="https://www.esri.com/">Esri</a> \u2014 Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'}),(0,l.jsx)(d,{}),t]})})};var p=a(428);a(228);var m=a(5250),g=a(4867);const f=e=>{let{data:t}=e;(0,s.useEffect)((()=>{t&&console.log("EstadoSP: Dados recebidos:",t)}),[t]);const a=(0,s.useMemo)((()=>({color:"#000000",weight:2,fillColor:"#000000",fillOpacity:.3,dashArray:"",zIndex:999,interactive:!1})),[]);return t?(0,l.jsx)(g.k,{data:t,style:a,interactive:!1}):null},h={ESTADO_SP:{id:"estadoSP",label:"Estado de S\xe3o Paulo",cor:"#10B981"},ESCOLAS:{id:"educacao",label:"Escolas Ind\xedgenas",cor:"#3B82F6"},TERRAS_INDIGENAS:{id:"terrasIndigenas",label:"Terras Ind\xedgenas",cor:"#DC143C",corSecundaria:"#8B0000",labelSecundaria:"Declaradas"}},x=(0,s.memo)((e=>{let{onClose:t,onMinimize:a,isMobile:o,isMinimized:s}=e;return(0,l.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-white",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:"Camadas do Mapa"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":s?"Expandir":"Minimizar",type:"button",children:s?"\u25be":"\u25b4"}),(0,l.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":"Fechar",type:"button",children:"\u2715"})]})]})}));x.displayName="CabecalhoMenu";const v=(0,s.memo)((e=>{let{camada:t,ativo:a,onClick:o,total:s}=e;return(0,l.jsxs)("button",{onClick:o,className:"w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors ".concat(a?"bg-gray-50":"hover:bg-gray-50"),type:"button",children:["terrasIndigenas"===t.id?(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.cor}}),(0,l.jsx)("span",{className:"text-xs text-gray-600",children:"Regularizadas"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.corSecundaria}}),(0,l.jsx)("span",{className:"text-xs text-gray-600",children:t.labelSecundaria})]})]}):(0,l.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.cor}}),(0,l.jsx)("span",{className:"text-sm text-gray-800",children:t.label}),void 0!==s&&(0,l.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",s,")"]}),(0,l.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full",style:{backgroundColor:a?t.cor:"#e5e7eb"}})]})}));v.displayName="BotaoCamada";const y=e=>{let{estados:t,acoes:a,totalEscolas:o}=e;const[n,i]=(0,s.useState)(!0),[r,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),p=(0,s.useCallback)((()=>{c(window.innerWidth<=768)}),[]);(0,s.useEffect)((()=>(p(),window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)})),[p]);const m=(0,s.useCallback)((()=>i(!1)),[]),g=((0,s.useCallback)((()=>i(!0)),[]),(0,s.useCallback)((()=>u((e=>!e))),[]));return r?(0,l.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,l.jsxs)("div",{className:"bg-white border-t border-gray-100 shadow-lg",children:[(0,l.jsx)(x,{onClose:m,onMinimize:g,isMobile:!0,isMinimized:d}),!d&&(0,l.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-60 overflow-y-auto",children:[(0,l.jsx)(v,{camada:h.ESTADO_SP,ativo:t.estadoSP,onClick:a.toggleEstadoSP}),(0,l.jsx)(v,{camada:h.ESCOLAS,ativo:t.educacao,onClick:a.toggleEducacao,total:o}),(0,l.jsx)(v,{camada:h.TERRAS_INDIGENAS,ativo:t.terrasIndigenas,onClick:a.toggleTerrasIndigenas})]})]})}):(0,l.jsxs)("div",{className:"fixed top-24 right-4 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:[(0,l.jsx)(x,{onClose:m,onMinimize:g,isMobile:!1,isMinimized:d}),!d&&(0,l.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-96 overflow-y-auto",children:[(0,l.jsx)(v,{camada:h.ESTADO_SP,ativo:t.estadoSP,onClick:a.toggleEstadoSP}),(0,l.jsx)(v,{camada:h.ESCOLAS,ativo:t.educacao,onClick:a.toggleEducacao,total:o}),(0,l.jsx)(v,{camada:h.TERRAS_INDIGENAS,ativo:t.terrasIndigenas,onClick:a.toggleTerrasIndigenas})]})]})};y.displayName="MenuCamadas";const b=(0,s.memo)(y);var w=a(8415);const S={titulo:"Sobre o site",audioUrl:"",descricao_detalhada:"Este \xe9 um observat\xf3rio que busca mapear as escolas ind\xedgenas no estado de S\xe3o Paulo.\n",imagens:[""]},C=e=>{let{dataPoints:t}=e;const a=new URLSearchParams(window.location.search).get("panel");var n=S;if(a&&""!==a&&t&&t.length>0){const e=t.find((e=>e.titulo.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").trim()===a));null!=e&&(n=e)}const[i,r]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[g,h]=(0,s.useState)(null),[x,v]=(0,s.useState)({educacao:!0,terrasIndigenas:!0,estadoSP:!0}),[y,C]=(0,s.useState)(n),k=(0,s.useRef)(null);(0,s.useEffect)((()=>{0}),[y,n]);const j=t?t.filter((e=>e.pontuacao>=0)):[],E=j.length;(0,s.useEffect)((()=>{(async()=>{try{const[e,t,a]=await Promise.all([fetch("".concat("/escolasindigenas","/bairros.geojson")),fetch("".concat("/escolasindigenas","/terras_indigenas_simplified.geojson")),fetch("".concat("/escolasindigenas","/SP_simplified.geojson"))]);if(!e.ok)return void 0;if(!t.ok)return void 0;if(!a.ok)return void 0;const[o,s,n]=await Promise.all([e.json(),t.json(),a.json()]);if(!o||!o.features)return void 0;if(!s||!s.features)return void 0;if(!n||!n.features)return void 0;r(o),d(s),h(n)}catch(e){0}})()}),[]),(0,s.useEffect)((()=>{0}),[i,c,g]);const N=e=>{setTimeout((()=>{C((0,o.A)((0,o.A)({},e),{},{titulo:e.titulo||"Informa\xe7\xf5es",tipo:e.tipo||"escola",timestamp:Date.now()})),k.current&&k.current.invalidateSize()}),50)},A=e=>{v((t=>(0,o.A)((0,o.A)({},t),{},{[e]:!t[e]})))};return(0,s.useEffect)((()=>{0}),[y]),(0,l.jsxs)("div",{className:"relative h-screen w-full overflow-hidden",children:[(0,l.jsx)("div",{className:"absolute inset-0 z-0",children:(0,l.jsxs)(u,{children:[x.estadoSP&&g&&(0,l.jsx)(f,{data:g}),x.terrasIndigenas&&c&&(0,l.jsx)(m.default,{data:c,onClick:N}),t&&(0,l.jsx)(p.default,{dataPoints:j,visibility:x,onClick:N})]})}),(0,l.jsx)("div",{className:"absolute inset-0 z-[9999] pointer-events-none",children:y&&(0,l.jsx)("div",{className:"pointer-events-auto",children:(0,l.jsx)(w.A,{painelInfo:y,closePainel:()=>{C(null),setTimeout((()=>{k.current&&k.current.invalidateSize()}),300)}})})}),(0,l.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:(0,l.jsx)("div",{className:"pointer-events-auto",style:{zIndex:20},children:(0,l.jsx)(b,{estados:x,acoes:{toggleEducacao:()=>A("educacao"),toggleTerrasIndigenas:()=>A("terrasIndigenas"),toggleEstadoSP:()=>A("estadoSP")},totalEscolas:E})})})]})}},4867:(e,t,a)=>{a.d(t,{k:()=>c});var o=a(3986),s=a(1215),n=a(576),i=a(3391),r=a(228);const l=["data"],c=(0,s.Lt)((function(e,t){let{data:a}=e,s=(0,o.A)(e,l);const c=new r.GeoJSON(a,s);return(0,n.Q)(c,(0,i.W4)(t,{overlayContainer:c}))}),(function(e,t,a){t.style!==a.style&&(null==t.style?e.resetStyle():e.setStyle(t.style))}))},5250:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var o=a(2555),s=a(5043),n=a(9896),i=a(4867),r=(a(228),a(579));const l=e=>{let{data:t,onClick:a}=e;const l=(0,n.ko)();(0,s.useEffect)((()=>{}),[t]);const c=(0,s.useMemo)((()=>({color:"#B22222",weight:2,fillOpacity:.3,fillColor:"#DC143C",dashArray:"3",zIndex:2})),[]),d=(0,s.useCallback)((e=>{if(!e||!e.properties)return c;const t="Regularizada"===e.properties.fase_ti;return(0,o.A)((0,o.A)({},c),{},{fillColor:t?"#DC143C":"#8B0000",fillOpacity:t?.3:.25})}),[c]),u={weight:3,color:"#FF0000",fillOpacity:.45,dashArray:""},p=(0,s.useCallback)(((e,t)=>{if(!e||!e.properties)return void 0;const o='\n        <div class="bg-white p-2 rounded shadow-md">\n          <strong>'.concat(e.properties.terrai_nom||"Nome n\xe3o dispon\xedvel","</strong><br/>\n          ").concat(e.properties.etnia_nome||"Etnia n\xe3o dispon\xedvel","<br/>\n          ").concat(e.properties.fase_ti||"Fase n\xe3o dispon\xedvel","\n        </div>\n      ");t.bindTooltip(o,{sticky:!0,className:"custom-tooltip"}),t.on({mouseover:e=>{const t=e.target;t.setStyle(u),t.bringToFront()},mouseout:t=>{t.target.setStyle(d(e))},click:t=>{t.target;const o={titulo:e.properties.terrai_nom,tipo:"terra_indigena",etnia:e.properties.etnia_nome,municipio:e.properties.municipio_,uf:e.properties.uf_sigla,superficie:e.properties.superficie,fase:e.properties.fase_ti,modalidade:e.properties.modalidade,reestudo:e.properties.reestudo_t,cr:e.properties.cr,faixa_fron:e.properties.faixa_fron,undadm_nom:e.properties.undadm_nom,undadm_sig:e.properties.undadm_sig,dominio_un:e.properties.dominio_un,data_atual:e.properties.data_atual,terrai_cod:e.properties.terrai_cod,undadm_cod:e.properties.undadm_cod};a&&a(o)}})}),[l,d,a]);return t&&t.type&&"FeatureCollection"===t.type&&t.features&&Array.isArray(t.features)&&0!==t.features.length?(0,r.jsx)(i.k,{data:t,style:d,onEachFeature:p}):null}}}]);
//# sourceMappingURL=433.bdf77831.chunk.js.map