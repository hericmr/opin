"use strict";(self.webpackChunkmapa_santos=self.webpackChunkmapa_santos||[]).push([[491],{428:(e,o,t)=>{t.r(o),t.d(o,{default:()=>d});var a=t(5043),n=t(9896),r=t(6679),s=t(228),l=t.n(s),i=(t(4260),t(5632),t(1845),t(4128));const c=5e-5,d=e=>{let{dataPoints:o,visibility:t,onClick:s}=e;const d=(0,n.ko)(),u=(0,a.useRef)(null),p=(0,a.useRef)([]),g=a.useMemo((()=>{if(!Array.isArray(o)||0===o.length)return console.warn("Marcadores: Nenhum ponto de dados recebido"),[];console.log("Total de escolas recebidas:",o.length);const e=[],t=o.filter((o=>{if(!o.titulo||!o.latitude||!o.longitude)return e.push({escola:o.titulo||"Sem nome",problema:"Dados b\xe1sicos ausentes",detalhes:{titulo:!!o.titulo,latitude:!!o.latitude,longitude:!!o.longitude}}),!1;const t=parseFloat(o.latitude),a=parseFloat(o.longitude);return isNaN(t)||isNaN(a)?(e.push({escola:o.titulo,problema:"Coordenadas n\xe3o s\xe3o n\xfameros v\xe1lidos",detalhes:{latitude:o.latitude,longitude:o.longitude}}),!1):!(t<-90||t>90||a<-180||a>180)||(e.push({escola:o.titulo,problema:"Coordenadas fora dos limites v\xe1lidos",detalhes:{latitude:t,longitude:a,limites:{latMin:-90,latMax:90,lngMin:-180,lngMax:180}}}),!1)}));return e.length>0&&(console.group("Escolas com coordenadas inv\xe1lidas:"),e.forEach((e=>{console.group(e.escola),console.log("Problema:",e.problema),console.log("Detalhes:",e.detalhes),console.groupEnd()})),console.groupEnd(),console.log("Total de escolas com problemas: ".concat(e.length))),console.log("Escolas v\xe1lidas: ".concat(t.length," de ").concat(o.length)),t}),[o]),h=r.rI;return(0,a.useEffect)((()=>{if(!Array.isArray(o)||0===o.length)return void console.warn("Marcadores: Nenhum ponto de dados v\xe1lido recebido");if(!d||!g.length||!t.educacao)return;u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[];const e=(e=>{const o=[],t=new Set;for(let a=0;a<e.length;a++)if(!t.has(a))for(let n=a+1;n<e.length;n++){if(t.has(n))continue;const r=e[a],s=e[n],l=Math.abs(parseFloat(r.latitude)-parseFloat(s.latitude)),i=Math.abs(parseFloat(r.longitude)-parseFloat(s.longitude));if(l<c&&i<c){o.push([a,n]),t.add(a),t.add(n);break}}return o})(g),a=(new Set(e.flat()),new(l().MarkerClusterGroup)({chunkedLoading:!0,maxClusterRadius:4,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0,disableClusteringAtZoom:12,minZoom:4,maxZoom:18,iconCreateFunction:function(e){const o=e.getChildCount();let t="small",a="#A0522D";o>100?(t="large",a="#4B2E14"):o>20&&(t="medium",a="#8B5A2B");const n=r.rI.options.iconUrl,s=r.rI.options.iconSize||[30,30];return l().divIcon({html:'\n            <div style="\n              background: radial-gradient(circle at 30% 30%, '.concat(a,", #3b2e2a);\n              color: ").concat("#fff",";\n              border-radius: 50%;\n              width: ").concat(s[0]+10,"px;\n              height: ").concat(s[1]+10,'px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              font-weight: bold;\n              border: 2px solid #f5f5dc;\n              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n              transition: transform 0.3s ease;\n              padding: 2px;\n            ">\n              <img src="').concat(n,'" width="').concat(.6*s[0],'" height="').concat(.6*s[1],'" style="margin-bottom: 2px;" />\n              <span style="\n                font-size: ').concat("large"===t?"16px":"medium"===t?"14px":"12px",';\n              ">').concat(o,"</span>\n            </div>"),className:"marker-cluster marker-cluster-".concat(t),iconSize:l().point(s[0]+10,s[1]+10)})},animateAddingMarkers:!0,spiderLegPolylineOptions:{weight:1.3,color:"#5C4033",opacity:.5,dashArray:"2,4"},chunkInterval:200,chunkDelay:50,singleMarkerMode:!1,spiderfyDistanceMultiplier:1.5,polygonOptions:{fillColor:"#A0522D",color:"#5C4033",weight:1.2,opacity:.6,fillOpacity:.2}}));return g.forEach(((o,t)=>{const n=parseFloat(o.latitude),r=parseFloat(o.longitude),c=l().marker([n,r],{icon:h,zIndexOffset:1e3});c.bindTooltip((0,i.k)(o.titulo),{className:"bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100",direction:"top",offset:[0,-10],opacity:1,permanent:!1}),c.on("click",(()=>null===s||void 0===s?void 0:s(o)));const u=e.findIndex((e=>e.includes(t)));if(-1!==u){const[o,a]=e[u],s=t===o,i=g[s?a:o];c.on("add",(function(){const e=s?"perspective(500px) rotateY(-20deg) translateX(-20px) rotate(-25deg) scale(0.9)":"perspective(500px) rotateY(20deg) translateX(20px) rotate(25deg) scale(0.9)";this._icon.style.transform=e,this._icon.style.transition="transform 0.5s ease-out, filter 0.3s ease-in",this._icon.style.filter="drop-shadow(0 4px 12px rgba(160, 82, 45, 0.35))",this._icon.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.35)"}));const h=((e,o,t,a,n)=>l().polyline([[o,t],[a,n]],{color:"#A0522D",weight:1.2,dashArray:"3,3",opacity:.6,className:"marker-connector"}).addTo(e))(d,n,r,parseFloat(i.latitude),parseFloat(i.longitude));p.current.push(h)}a.addLayer(c)})),d.addLayer(a),u.current=a,()=>{u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[]}}),[d,g,s,h,t.educacao,o]),null}}}]);
//# sourceMappingURL=491.41c6c24b.chunk.js.map