"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[312],{21291:(e,r,a)=>{a.d(r,{hi:()=>i,j6:()=>t,mM:()=>o});const t=e=>{if(!e||""===e)return"";try{if(e.includes("/")&&10===e.length)return e;const r=new Date(e+"T00:00:00");if(isNaN(r.getTime()))return"";const a=String(r.getDate()).padStart(2,"0"),t=String(r.getMonth()+1).padStart(2,"0"),o=r.getFullYear();return"".concat(a,"/").concat(t,"/").concat(o)}catch(r){return""}},o=e=>{if(!e||""===e)return"";if(e.includes("-")&&10===e.length)return e;const r=e.replace(/[^\d/]/g,"");if(!r.includes("/")){const e=r.replace(/\D/g,"");if(8===e.length){const r=e.substring(0,2),a=e.substring(2,4),t=e.substring(4,8),o="".concat(r,"/").concat(a,"/").concat(t);return s(o)}return""}return s(r)},s=e=>{const r=e.split("/");if(3!==r.length)return"";const a=r[0].padStart(2,"0"),t=r[1].padStart(2,"0"),o=r[2];if(2!==a.length||2!==t.length||4!==o.length)return"";if(parseInt(t)<1||parseInt(t)>12)return"";if(parseInt(a)<1||parseInt(a)>31)return"";const s=new Date("".concat(o,"-").concat(t,"-").concat(a,"T00:00:00"));return isNaN(s.getTime())||s.getDate()!==parseInt(a)||s.getMonth()+1!==parseInt(t)?"":"".concat(o,"-").concat(t,"-").concat(a)},i=e=>{if(!e)return"";try{if(e instanceof Date)return e.toLocaleDateString("pt-BR");if("string"===typeof e){const r=new Date(e+"T00:00:00");if(!isNaN(r.getTime()))return r.toLocaleDateString("pt-BR");if(e.includes("/")&&10===e.length)return e}return""}catch(r){return""}}},40237:(e,r,a)=>{a.d(r,{eP:()=>c,iy:()=>s,jW:()=>d,qP:()=>i,s7:()=>g,t$:()=>n,w_:()=>l});var t=a(52480),o=a(5452);const s=async()=>{try{const{error:e}=await t.N.from("legendas_fotos").select("count").limit(1);return e?(o.A.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(o.A.debug("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return o.A.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},i=async function(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let s=t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",r);!1!==a.ativo&&(s=s.eq("ativo",!0)),a.categoria&&(s=s.eq("categoria",a.categoria)),a.tipo_foto&&(s=s.eq("tipo_foto",a.tipo_foto));const{data:i,error:n}=await s.order("created_at",{ascending:!1});return n?(o.A.warn("Erro ao buscar legenda:",n.message),null):i&&i.length>0?i[0]:null}catch(s){return o.A.warn("Erro ao buscar legenda:",s.message),null}},n=async function(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(o.A.debug("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(r,")")),a.categoria||a.tipo_foto){o.A.debug("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const t=await i(e,r,a);if(t)return o.A.debug("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),t}o.A.debug("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:s,error:n}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",r).eq("ativo",!0).order("created_at",{ascending:!1});if(n)o.A.warn("  \u274c Erro na busca por URL e escola:",n.message);else if(s&&s.length>0)return o.A.debug("  \u2705 Encontrada por URL e escola"),s[0];o.A.debug("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:c,error:l}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",r).order("created_at",{ascending:!1});if(l)o.A.warn("  \u274c Erro na busca incluindo inativas:",l.message);else if(c&&c.length>0)return o.A.debug("  \u2705 Encontrada incluindo legendas inativas"),c[0];const d=e.split("/").pop();o.A.debug("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(d));const{data:u,error:g}=await t.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(d)).eq("escola_id",r).eq("ativo",!0).order("created_at",{ascending:!1});if(g)o.A.warn("  \u274c Erro na busca por nome do arquivo:",g.message);else if(u&&u.length>0)return o.A.debug("  \u2705 Encontrada por nome do arquivo"),u[0];return o.A.debug("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(s){return o.A.warn("Erro ao buscar legenda flex\xedvel:",s.message),null}},c=async e=>{try{const{data:r,error:a}=await t.N.from("legendas_fotos").insert([e]).select().single();if(a)throw a;return r}catch(r){throw o.A.error("Erro ao adicionar legenda:",r),r}},l=async(e,r)=>{try{const{data:a,error:o}=await t.N.from("legendas_fotos").update(r).eq("id",e).select().single();if(o)throw o;return a}catch(a){throw o.A.error("Erro ao atualizar legenda:",a),a}},d=async(e,r)=>{try{const{data:a,error:o}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",r).eq("categoria","video").single();if(o){if("PGRST116"===o.code)return null;throw o}return a}catch(a){return o.A.warn("Erro ao buscar t\xedtulo do v\xeddeo:",a.message),null}},u=async(e,r,a)=>{try{const o=await i(e,r,{ativo:!1});if(o){const{data:e,error:r}=await t.N.from("legendas_fotos").update({ordem:a,updated_at:(new Date).toISOString()}).eq("id",o.id).select().single();if(r)throw r;return e}{const o=(e.split("/").pop()||"Imagem").replace(/\.[^/.]+$/,"").replace(/[_-]/g," ")||"Imagem",{data:s,error:i}=await t.N.from("legendas_fotos").insert([{escola_id:r,imagem_url:e,legenda:o,ordem:a,ativo:!0,tipo_foto:"escola",categoria:"geral",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(i)throw i;return s}}catch(s){throw o.A.error("Erro ao atualizar ordem da imagem:",s),s}},g=async(e,r)=>{try{return await Promise.all(e.map(e=>{let{imageUrl:a,ordem:t}=e;return u(a,r,t)}))}catch(a){throw o.A.error("Erro ao atualizar ordens das imagens:",a),a}}},57367:(e,r,a)=>{a.d(r,{LQ:()=>t,Rf:()=>s,gD:()=>o});const t=[{id:"basicInfo",label:"Informa\xe7\xf5es B\xe1sicas",description:"Nome, munic\xedpio, endere\xe7o, terra ind\xedgena",defaultVisible:!0,category:"grid"},{id:"modalidades",label:"Modalidades de Ensino",description:"Modalidades e turnos de funcionamento",defaultVisible:!0,category:"grid"},{id:"infraestrutura",label:"Infraestrutura",description:"Estrutura f\xedsica, \xe1gua, internet, equipamentos",defaultVisible:!0,category:"grid"},{id:"gestaoProfessores",label:"Equipe",description:"Dire\xe7\xe3o, professores, forma\xe7\xe3o profissional",defaultVisible:!0,category:"grid"},{id:"projetosParcerias",label:"Projetos e Parcerias",description:"Projetos, parcerias, ONGs, desejos da comunidade",defaultVisible:!0,category:"grid"},{id:"historiaEscola",label:"Hist\xf3ria da Escola",description:"Hist\xf3ria e contexto da escola",defaultVisible:!0,category:"standalone"},{id:"imagensEscola",label:"Imagens da Escola",description:"Galeria de fotos da escola",defaultVisible:!0,category:"standalone"},{id:"historiaProfessor",label:"Hist\xf3ria dos Professores",description:"Depoimentos e hist\xf3rias dos professores",defaultVisible:!0,category:"standalone"},{id:"documentos",label:"Documentos",description:"PDFs e documentos da escola",defaultVisible:!0,category:"standalone"},{id:"videos",label:"V\xeddeos",description:"V\xeddeos e produ\xe7\xf5es audiovisuais",defaultVisible:!0,category:"standalone"}],o=()=>t.reduce((e,r)=>(e[r.id]=r.defaultVisible,e),{}),s=function(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e&&e.hasOwnProperty(r)?!1!==e[r]:!a||!a.hasOwnProperty(r)||!1!==a[r]}},82006:(e,r,a)=>{a.d(r,{Y8:()=>n,e0:()=>l,g2:()=>d,lz:()=>c});var t=a(89379),o=a(52480),s=a(5452);const i={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},n=async e=>{try{const{data:r,error:a}=await o.N.from("historias_professor").select("*").eq("escola_id",e).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(a)throw a;if(!r||0===r.length)return[];return r.map(e=>{if(e.imagem_url)try{const{data:{publicUrl:r}}=o.N.storage.from(i.BUCKET_NAME).getPublicUrl(e.imagem_url);return(0,t.A)((0,t.A)({},e),{},{imagem_public_url:r})}catch(r){return(0,t.A)((0,t.A)({},e),{},{imagem_public_url:null,urlError:r.message})}return e})}catch(r){throw s.A.error("Erro ao buscar hist\xf3rias do professor:",r),r}},c=async e=>{try{const{data:r,error:a}=await o.N.from("historias_professor").insert([{escola_id:e.escola_id,nome_professor:e.nome_professor||null,historia:e.historia,ordem:e.ordem||1,ativo:!1!==e.ativo,foto_rosto:e.foto_rosto||null}]).select().single();if(a)throw a;return r}catch(r){throw s.A.error("Erro ao criar hist\xf3ria do professor:",r),r}},l=async(e,r)=>{try{const{data:a,error:t}=await o.N.from("historias_professor").update({nome_professor:r.nome_professor,historia:r.historia,ordem:r.ordem,ativo:r.ativo,foto_rosto:r.foto_rosto||null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(t)throw t;return a}catch(a){throw s.A.error("Erro ao atualizar hist\xf3ria do professor:",a),a}},d=async e=>{try{const{error:r}=await o.N.from("historias_professor").delete().eq("id",e);if(r)throw r}catch(r){throw s.A.error("Erro ao deletar hist\xf3ria do professor:",r),r}}},85759:(e,r,a)=>{a.d(r,{MK:()=>i,Sv:()=>o,Y5:()=>n,dq:()=>s});var t=a(52480);async function o(e){const{data:r,error:a}=await t.N.from("titulos_videos").select("*").eq("escola_id",e).eq("ativo",!0).order("created_at",{ascending:!1});if(a)throw a;return r}async function s(e){const{data:r,error:a}=await t.N.from("titulos_videos").insert([e]).select();if(a)throw a;return null===r||void 0===r?void 0:r[0]}async function i(e,r){const{data:a,error:o}=await t.N.from("titulos_videos").update(r).eq("id",e).select();if(o)throw o;return null===a||void 0===a?void 0:a[0]}async function n(e){const{error:r}=await t.N.from("titulos_videos").delete().eq("id",e);if(r)throw r;return!0}},94309:(e,r,a)=>{a.d(r,{B:()=>s});var t=a(52480),o=a(5452);class s{static async getGlobalCardsVisibility(){try{const{data:e,error:r}=await t.N.from("configuracao_global").select("valor").eq("chave","cards_visibilidade_global").single();if(r){if("PGRST116"===r.code)return null;throw r}return(null===e||void 0===e?void 0:e.valor)||null}catch(e){return o.A.error("Erro ao buscar configura\xe7\xe3o global de visibilidade:",e),null}}static async saveGlobalCardsVisibility(e){try{const{data:r,error:a}=await t.N.from("configuracao_global").upsert({chave:"cards_visibilidade_global",valor:e,descricao:"Configura\xe7\xe3o padr\xe3o de visibilidade de cards para todas as escolas",updated_at:(new Date).toISOString()},{onConflict:"chave"}).select().single();if(a)throw a;return{success:!0,data:r}}catch(r){return o.A.error("Erro ao salvar configura\xe7\xe3o global de visibilidade:",r),{success:!1,error:r.message||"Erro ao salvar configura\xe7\xe3o global"}}}}},98137:(e,r,a)=>{a.d(r,{V:()=>s});var t=a(65043),o=a(94309);const s=()=>{const[e,r]=(0,t.useState)(null),[a,s]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{(async()=>{try{s(!0);const e=await o.B.getGlobalCardsVisibility();r(e)}catch(e){console.error("Erro ao carregar configura\xe7\xe3o global:",e),r(null)}finally{s(!1)}})()},[]),{globalVisibility:e,loading:a}}}}]);
//# sourceMappingURL=312.d54d39ef.chunk.js.map