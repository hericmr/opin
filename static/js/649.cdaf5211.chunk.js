"use strict";(self.webpackChunkmapa_santos=self.webpackChunkmapa_santos||[]).push([[250,491,649],{428:(e,o,t)=>{t.r(o),t.d(o,{default:()=>d});var a=t(5043),n=t(9896),r=t(6679),s=t(228),i=t.n(s),l=(t(4260),t(5632),t(1845),t(4128));const c=5e-5,d=e=>{let{dataPoints:o,visibility:t,onClick:s}=e;const d=(0,n.ko)(),u=(0,a.useRef)(null),p=(0,a.useRef)([]),g=a.useMemo((()=>{if(!Array.isArray(o)||0===o.length)return[];const e=[],t=o.filter((o=>{if(!o.titulo||!o.latitude||!o.longitude)return e.push({escola:o.titulo||"Sem nome",problema:"Dados b\xe1sicos ausentes",detalhes:{titulo:!!o.titulo,latitude:!!o.latitude,longitude:!!o.longitude}}),!1;const t=parseFloat(o.latitude),a=parseFloat(o.longitude);return isNaN(t)||isNaN(a)?(e.push({escola:o.titulo,problema:"Coordenadas n\xe3o s\xe3o n\xfameros v\xe1lidos",detalhes:{latitude:o.latitude,longitude:o.longitude}}),!1):!(t<-90||t>90||a<-180||a>180)||(e.push({escola:o.titulo,problema:"Coordenadas fora dos limites v\xe1lidos",detalhes:{latitude:t,longitude:a,limites:{latMin:-90,latMax:90,lngMin:-180,lngMax:180}}}),!1)}));return e.length>0&&(console.group("Escolas com coordenadas inv\xe1lidas:"),e.forEach((e=>{console.group(e.escola),console.log("Problema:",e.problema),console.log("Detalhes:",e.detalhes),console.groupEnd()})),console.groupEnd(),console.log("Total de escolas com problemas: ".concat(e.length))),t}),[o]),m=r.rI;return(0,a.useEffect)((()=>{if(!Array.isArray(o)||0===o.length)return;if(!d||!g.length||!t.educacao)return;u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[];const e=(e=>{const o=[],t=new Set;for(let a=0;a<e.length;a++)if(!t.has(a))for(let n=a+1;n<e.length;n++){if(t.has(n))continue;const r=e[a],s=e[n],i=Math.abs(parseFloat(r.latitude)-parseFloat(s.latitude)),l=Math.abs(parseFloat(r.longitude)-parseFloat(s.longitude));if(i<c&&l<c){o.push([a,n]),t.add(a),t.add(n);break}}return o})(g),a=(new Set(e.flat()),new(i().MarkerClusterGroup)({chunkedLoading:!0,maxClusterRadius:4,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0,disableClusteringAtZoom:12,minZoom:4,maxZoom:18,iconCreateFunction:function(e){const o=e.getChildCount();let t="small",a="#A0522D";o>100?(t="large",a="#4B2E14"):o>20&&(t="medium",a="#8B5A2B");const n=r.rI.options.iconUrl,s=r.rI.options.iconSize||[30,30];return i().divIcon({html:'\n            <div style="\n              background: radial-gradient(circle at 30% 30%, '.concat(a,", #3b2e2a);\n              color: ").concat("#fff",";\n              border-radius: 50%;\n              width: ").concat(s[0]+10,"px;\n              height: ").concat(s[1]+10,'px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              font-weight: bold;\n              border: 2px solid #f5f5dc;\n              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n              transition: transform 0.3s ease;\n              padding: 2px;\n            ">\n              <img src="').concat(n,'" width="').concat(.6*s[0],'" height="').concat(.6*s[1],'" style="margin-bottom: 2px;" />\n              <span style="\n                font-size: ').concat("large"===t?"16px":"medium"===t?"14px":"12px",';\n              ">').concat(o,"</span>\n            </div>"),className:"marker-cluster marker-cluster-".concat(t),iconSize:i().point(s[0]+10,s[1]+10)})},animateAddingMarkers:!0,spiderLegPolylineOptions:{weight:1.3,color:"#5C4033",opacity:.5,dashArray:"2,4"},chunkInterval:200,chunkDelay:50,singleMarkerMode:!1,spiderfyDistanceMultiplier:1.5,polygonOptions:{fillColor:"#A0522D",color:"#5C4033",weight:1.2,opacity:.6,fillOpacity:.2}}));return g.forEach(((o,t)=>{const n=parseFloat(o.latitude),r=parseFloat(o.longitude),c=i().marker([n,r],{icon:m,zIndexOffset:1e3});c.bindTooltip((0,l.k)(o.titulo),{className:"bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100",direction:"top",offset:[0,-10],opacity:1,permanent:!1,interactive:!0}),c.on({click:e=>{e.originalEvent.stopPropagation(),null===s||void 0===s||s(o)},touchstart:e=>{e.originalEvent.stopPropagation()},touchend:e=>{e.originalEvent.stopPropagation(),null===s||void 0===s||s(o)}});const u=e.findIndex((e=>e.includes(t)));if(-1!==u){const[o,a]=e[u],s=t===o,l=g[s?a:o];c.on("add",(function(){const e=s?"perspective(500px) rotateY(-20deg) translateX(-20px) rotate(-25deg) scale(0.9)":"perspective(500px) rotateY(20deg) translateX(20px) rotate(25deg) scale(0.9)";this._icon.style.transform=e,this._icon.style.transition="transform 0.5s ease-out, filter 0.3s ease-in",this._icon.style.filter="drop-shadow(0 4px 12px rgba(160, 82, 45, 0.35))",this._icon.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.35)"}));const m=((e,o,t,a,n)=>i().polyline([[o,t],[a,n]],{color:"#A0522D",weight:1.2,dashArray:"3,3",opacity:.6,className:"marker-connector"}).addTo(e))(d,n,r,parseFloat(l.latitude),parseFloat(l.longitude));p.current.push(m)}a.addLayer(c)})),d.addLayer(a),u.current=a,()=>{u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[]}}),[d,g,s,m,t.educacao,o]),null}},4867:(e,o,t)=>{t.d(o,{k:()=>c});var a=t(3986),n=t(1215),r=t(576),s=t(3391),i=t(228);const l=["data"],c=(0,n.Lt)((function(e,o){let{data:t}=e,n=(0,a.A)(e,l);const c=new i.GeoJSON(t,n);return(0,r.Q)(c,(0,s.W4)(o,{overlayContainer:c}))}),(function(e,o,t){o.style!==t.style&&(null==o.style?e.resetStyle():e.setStyle(o.style))}))},5250:(e,o,t)=>{t.r(o),t.d(o,{default:()=>l});var a=t(2555),n=t(5043),r=t(9896),s=t(4867),i=(t(228),t(579));const l=e=>{let{data:o,onClick:t}=e;const l=(0,r.ko)();(0,n.useEffect)((()=>{}),[o]);const c=(0,n.useMemo)((()=>({color:"#B22222",weight:2,fillOpacity:.3,fillColor:"#DC143C",dashArray:"3",zIndex:2})),[]),d=(0,n.useCallback)((e=>{if(!e||!e.properties)return c;const o="Regularizada"===e.properties.fase_ti;return(0,a.A)((0,a.A)({},c),{},{fillColor:o?"#DC143C":"#8B0000",fillOpacity:o?.3:.25})}),[c]),u={weight:3,color:"#FF0000",fillOpacity:.45,dashArray:""},p=(0,n.useCallback)(((e,o)=>{if(!e||!e.properties)return void 0;const a='\n        <div class="bg-white p-2 rounded shadow-md">\n          <strong>'.concat(e.properties.terrai_nom||"Nome n\xe3o dispon\xedvel","</strong><br/>\n          ").concat(e.properties.etnia_nome||"Etnia n\xe3o dispon\xedvel","<br/>\n          ").concat(e.properties.fase_ti||"Fase n\xe3o dispon\xedvel","\n        </div>\n      ");o.bindTooltip(a,{sticky:!0,className:"custom-tooltip"}),o.on({mouseover:e=>{const o=e.target;o.setStyle(u),o.bringToFront()},mouseout:o=>{o.target.setStyle(d(e))},click:o=>{o.target;const a={titulo:e.properties.terrai_nom,tipo:"terra_indigena",etnia:e.properties.etnia_nome,municipio:e.properties.municipio_,uf:e.properties.uf_sigla,superficie:e.properties.superficie,fase:e.properties.fase_ti,modalidade:e.properties.modalidade,reestudo:e.properties.reestudo_t,cr:e.properties.cr,faixa_fron:e.properties.faixa_fron,undadm_nom:e.properties.undadm_nom,undadm_sig:e.properties.undadm_sig,dominio_un:e.properties.dominio_un,data_atual:e.properties.data_atual,terrai_cod:e.properties.terrai_cod,undadm_cod:e.properties.undadm_cod};t&&t(a)}})}),[l,d,t]);return o&&o.type&&"FeatureCollection"===o.type&&o.features&&Array.isArray(o.features)&&0!==o.features.length?(0,i.jsx)(s.k,{data:o,style:d,onEachFeature:p}):null}},9018:(e,o,t)=>{t.r(o),t.d(o,{default:()=>S});var a=t(2555),n=t(5043),r=t(9419),s=t(2023),i=t(579);const l=()=>window.innerWidth<=768,c=e=>{let{children:o}=e;const t=l()?[-23.5505,-48.6333]:[-23.305,-43.9],a=l()?6:7;return(0,i.jsx)("div",{className:"h-screen w-screen overflow-hidden",children:(0,i.jsxs)(r.W,{center:t,zoom:a,className:"h-full w-full",attributionControl:!1,children:[(0,i.jsx)(s.e,{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}),o]})})};var d=t(428);t(228);var u=t(5250),p=t(4867);const g=e=>{let{data:o}=e;(0,n.useEffect)((()=>{o&&console.log("EstadoSP: Dados recebidos:",o)}),[o]);const t=(0,n.useMemo)((()=>({color:"#000000",weight:2,fillColor:"#000000",fillOpacity:.3,dashArray:"",zIndex:999,interactive:!1})),[]);return o?(0,i.jsx)(p.k,{data:o,style:t,interactive:!1}):null},m={ESTADO_SP:{id:"estadoSP",label:"Estado de S\xe3o Paulo",cor:"#10B981"},ESCOLAS:{id:"educacao",label:"Escolas Ind\xedgenas",cor:"#3B82F6"},TERRAS_INDIGENAS:{id:"terrasIndigenas",label:"Terras Ind\xedgenas",cor:"#DC143C",corSecundaria:"#8B0000",labelSecundaria:"Declaradas"}},f=(0,n.memo)((e=>{let{onClose:o,onMinimize:t,isMobile:a,isMinimized:n}=e;return(0,i.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-white",children:[(0,i.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:"Camadas do Mapa"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":n?"Expandir":"Minimizar",type:"button",children:n?"\u25be":"\u25b4"}),(0,i.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":"Fechar",type:"button",children:"\u2715"})]})]})}));f.displayName="CabecalhoMenu";const h=(0,n.memo)((e=>{let{camada:o,ativo:t,onClick:a,total:n}=e;return(0,i.jsxs)("button",{onClick:a,className:"w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors ".concat(t?"bg-gray-50":"hover:bg-gray-50"),type:"button",children:["terrasIndigenas"===o.id?(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o.cor}}),(0,i.jsx)("span",{className:"text-xs text-gray-600",children:"Regularizadas"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o.corSecundaria}}),(0,i.jsx)("span",{className:"text-xs text-gray-600",children:o.labelSecundaria})]})]}):(0,i.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o.cor}}),(0,i.jsx)("span",{className:"text-sm text-gray-800",children:o.label}),void 0!==n&&(0,i.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",n,")"]}),(0,i.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full",style:{backgroundColor:t?o.cor:"#e5e7eb"}})]})}));h.displayName="BotaoCamada";const x=e=>{let{estados:o,acoes:t,totalEscolas:a}=e;const[r,s]=(0,n.useState)(!0),[l,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!1),p=(0,n.useCallback)((()=>{c(window.innerWidth<=768)}),[]);(0,n.useEffect)((()=>(p(),window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)})),[p]);const g=(0,n.useCallback)((()=>s(!1)),[]),x=((0,n.useCallback)((()=>s(!0)),[]),(0,n.useCallback)((()=>u((e=>!e))),[]));return l?(0,i.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,i.jsxs)("div",{className:"bg-white border-t border-gray-100 shadow-lg",children:[(0,i.jsx)(f,{onClose:g,onMinimize:x,isMobile:!0,isMinimized:d}),!d&&(0,i.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-60 overflow-y-auto",children:[(0,i.jsx)(h,{camada:m.ESTADO_SP,ativo:o.estadoSP,onClick:t.toggleEstadoSP}),(0,i.jsx)(h,{camada:m.ESCOLAS,ativo:o.educacao,onClick:t.toggleEducacao,total:a}),(0,i.jsx)(h,{camada:m.TERRAS_INDIGENAS,ativo:o.terrasIndigenas,onClick:t.toggleTerrasIndigenas})]})]})}):(0,i.jsxs)("div",{className:"fixed top-24 right-4 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:[(0,i.jsx)(f,{onClose:g,onMinimize:x,isMobile:!1,isMinimized:d}),!d&&(0,i.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-96 overflow-y-auto",children:[(0,i.jsx)(h,{camada:m.ESTADO_SP,ativo:o.estadoSP,onClick:t.toggleEstadoSP}),(0,i.jsx)(h,{camada:m.ESCOLAS,ativo:o.educacao,onClick:t.toggleEducacao,total:a}),(0,i.jsx)(h,{camada:m.TERRAS_INDIGENAS,ativo:o.terrasIndigenas,onClick:t.toggleTerrasIndigenas})]})]})};x.displayName="MenuCamadas";const v=(0,n.memo)(x);var y=t(6902);const b={titulo:"Sobre o site",audioUrl:"",descricao_detalhada:"Este \xe9 um observat\xf3rio que busca mapear as escolas ind\xedgenas no estado de S\xe3o Paulo.\n",imagens:[""]},C=(0,n.createContext)(null),E={didCatch:!1,error:null};class w extends n.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=E}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var o,t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];null===(o=(t=this.props).onReset)||void 0===o||o.call(t,{args:n,reason:"imperative-api"}),this.setState(E)}}componentDidCatch(e,o){var t,a;null===(t=(a=this.props).onError)||void 0===t||t.call(a,e,o)}componentDidUpdate(e,o){const{didCatch:t}=this.state,{resetKeys:a}=this.props;var n,r;t&&null!==o.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==o.length||e.some(((e,t)=>!Object.is(e,o[t])))}(e.resetKeys,a)&&(null===(n=(r=this.props).onReset)||void 0===n||n.call(r,{next:a,prev:e.resetKeys,reason:"keys"}),this.setState(E))}render(){const{children:e,fallbackRender:o,FallbackComponent:t,fallback:a}=this.props,{didCatch:r,error:s}=this.state;let i=e;if(r){const e={error:s,resetErrorBoundary:this.resetErrorBoundary};if("function"===typeof o)i=o(e);else if(t)i=(0,n.createElement)(t,e);else{if(void 0===a)throw s;i=a}}return(0,n.createElement)(C.Provider,{value:{didCatch:r,error:s,resetErrorBoundary:this.resetErrorBoundary}},i)}}const k=e=>{let{error:o,resetErrorBoundary:t}=e;return(0,i.jsxs)("div",{role:"alert",className:"fixed inset-0 bg-red-100 p-4 z-[1000]",children:[(0,i.jsx)("p",{className:"text-red-700",children:"Algo deu errado ao fechar o painel:"}),(0,i.jsx)("pre",{className:"text-sm text-red-600",children:o.message}),(0,i.jsx)("button",{onClick:t,className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Tentar novamente"})]})},S=e=>{let{dataPoints:o}=e;console.log("MapaEscolasIndigenas - PUBLIC_URL:",{publicUrl:"/escolasindigenas",baseUrl:window.location.origin+"/escolasindigenas",currentPath:window.location.pathname,fullUrl:window.location.href});const t=new URLSearchParams(window.location.search).get("panel");var r=b;if(t&&""!==t&&o&&o.length>0){const e=o.find((e=>e.titulo.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").trim()===t));null!=e&&(r=e)}const[s,l]=(0,n.useState)(null),[p,m]=(0,n.useState)(null),[f,h]=(0,n.useState)(null),[x,C]=(0,n.useState)({educacao:!0,terrasIndigenas:!0,estadoSP:!0}),[E,S]=(0,n.useState)(r);(0,n.useEffect)((()=>{0}),[E,r]);const j=o?o.filter((e=>e.pontuacao>=0)):[],N=j.length;(0,n.useEffect)((()=>{(async()=>{try{const[e,o,t]=await Promise.all([fetch("".concat("/escolasindigenas","/bairros.geojson")),fetch("".concat("/escolasindigenas","/terras_indigenas_simplified.geojson")),fetch("".concat("/escolasindigenas","/SP_simplified.geojson"))]);if(!e.ok)return void 0;if(!o.ok)return void 0;if(!t.ok)return void 0;const[a,n,r]=await Promise.all([e.json(),o.json(),t.json()]);if(!a||!a.features)return void 0;if(!n||!n.features)return void 0;if(!r||!r.features)return void 0;l(a),m(n),h(r)}catch(e){0}})()}),[]),(0,n.useEffect)((()=>{0}),[s,p,f]);const _=e=>{console.group("MapaEscolasIndigenas - abrirPainel"),console.log("Ambiente:","production"),console.log("Info recebida:",{titulo:null===e||void 0===e?void 0:e.titulo,tipo:null===e||void 0===e?void 0:e.tipo,hasLink:!(null===e||void 0===e||!e.link_para_documentos),linkValue:null===e||void 0===e?void 0:e.link_para_documentos,infoType:typeof e,isNull:null===e,isUndefined:void 0===e});try{S(e),A((e=>e+1)),requestAnimationFrame((()=>{console.log("Estado ap\xf3s requestAnimationFrame:",{painelInfo:E,forceUpdate:I})}))}catch(o){console.error("Erro ao abrir painel:",o)}finally{console.groupEnd()}},[I,A]=(0,n.useState)(0),P=(0,n.useCallback)((()=>{console.group("MapaEscolasIndigenas - fecharPainel"),console.log("Ambiente:","production"),console.log("Estado anterior:",{titulo:null===E||void 0===E?void 0:E.titulo,tipo:null===E||void 0===E?void 0:E.tipo,hasLink:!(null===E||void 0===E||!E.link_para_documentos),painelInfoType:typeof E,painelInfoIsNull:null===E,painelInfoIsUndefined:void 0===E,forceUpdate:I});try{S(null),A((e=>e+1)),requestAnimationFrame((()=>{null!==E&&(console.warn("Estado n\xe3o foi atualizado no primeiro frame, tentando novamente..."),S(null),A((e=>e+1)))}))}catch(e){console.error("Erro ao fechar painel:",e)}finally{console.groupEnd()}}),[E,I]);(0,n.useEffect)((()=>{console.group("MapaEscolasIndigenas - painelInfo changed (production)"),console.log("Novo estado:",{value:E,type:typeof E,isNull:null===E,isUndefined:void 0===E,forceUpdate:I}),console.groupEnd()}),[E,I]);const M=e=>{C((o=>(0,a.A)((0,a.A)({},o),{},{[e]:!o[e]})))};return(0,n.useEffect)((()=>{0}),[E]),(0,i.jsxs)("div",{className:"relative h-screen w-full overflow-hidden","data-debug-info":JSON.stringify({publicUrl:"/escolasindigenas",baseUrl:window.location.origin+"/escolasindigenas",currentPath:window.location.pathname}),children:[(0,i.jsxs)(c,{children:[x.estadoSP&&f&&(0,i.jsx)(g,{data:f}),x.terrasIndigenas&&p&&(0,i.jsx)(u.default,{data:p,onClick:_}),o&&(0,i.jsx)(d.default,{dataPoints:j,visibility:x,onClick:_})]}),E&&(0,i.jsx)(w,{FallbackComponent:k,onReset:()=>{S(null),A((e=>e+1))},children:(0,i.jsx)(y.A,{painelInfo:E,closePainel:P,publicUrl:"/escolasindigenas"},"painel-".concat(null===E||void 0===E?void 0:E.titulo,"-").concat(I))},"error-boundary-".concat(I)),(0,i.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:(0,i.jsx)("div",{className:"pointer-events-auto",style:{zIndex:20},children:(0,i.jsx)(v,{estados:x,acoes:{toggleEducacao:()=>M("educacao"),toggleTerrasIndigenas:()=>M("terrasIndigenas"),toggleEstadoSP:()=>M("estadoSP")},totalEscolas:N})})})]},"mapa-container-".concat(I))}}}]);
//# sourceMappingURL=649.cdaf5211.chunk.js.map