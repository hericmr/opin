"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[654],{3701:(e,s,a)=>{a.d(s,{A:()=>x});var r=a(2555),o=a(5043),l=a(4562),t=a(6478),i=a(193),n=a(256),d=a(7669),c=a(1184),m=a(1440),g=a(3536),u=a(579);const x=e=>{let{escolaId:s,onImagesUpdate:a}=e;const[x,p]=(0,o.useState)([]),[h,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(0),[j,y]=(0,o.useState)(""),[N,w]=(0,o.useState)(""),[A,E]=(0,o.useState)([]),[C,k]=(0,o.useState)(!0),[I,S]=(0,o.useState)({current:0,limit:5,canUpload:!0}),[U,z]=(0,o.useState)("professor"),[P,D]=(0,o.useState)(""),[G,q]=(0,o.useState)(""),[T,B]=(0,o.useState)({}),M=(0,o.useCallback)((async()=>{if(s)try{k(!0);const e=await(0,m.Gw)(s,"imagens-professores");E(e);const a={};e.forEach((e=>{a[e.id]=e.descricao})),B(a);const r=await(0,m.BZ)(s,"imagens-professores");S(r)}catch(e){console.error("Erro ao buscar imagens dos professores:",e),y("Erro ao carregar imagens dos professores")}finally{k(!1)}}),[s]);(0,o.useEffect)((()=>{M()}),[M]),(0,o.useEffect)((()=>{if(j||N){const e=setTimeout((()=>{y(""),w("")}),5e3);return()=>clearTimeout(e)}}),[j,N]);const F=(0,o.useCallback)((e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files);if(0===s.length)return;if(!I.canUpload)return void y("Limite de ".concat(I.limit," imagens dos professores atingido. Remova algumas imagens antes de adicionar novas."));if(A.length+x.length+s.length>I.limit)return void y("Voc\xea pode adicionar no m\xe1ximo ".concat(I.limit-A.length-x.length," imagens dos professores."));const a=s.filter((e=>e.type.startsWith("image/")));a.length>0&&(p((e=>[...e,...a])),y(""))}),[I,A.length,x.length]),L=(0,o.useCallback)((e=>{e.preventDefault()}),[]),_=(0,o.useCallback)((0,g.debounce)(((e,s)=>{(async(e,s)=>{try{await(0,m.vx)(e,s),E((a=>a.map((a=>a.id===e?(0,r.A)((0,r.A)({},a),{},{descricao:s.trim()}):a)))),w("Descri\xe7\xe3o atualizada com sucesso!")}catch(a){console.error("Erro ao atualizar descri\xe7\xe3o:",a),y("Erro ao atualizar descri\xe7\xe3o: ".concat(a.message))}})(e,s)}),1e3),[]);return C?(0,u.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg",children:(0,u.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,u.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),(0,u.jsx)("span",{className:"ml-2 text-gray-600",children:"Carregando imagens dos professores..."})]})}):(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)(l.A,{className:"w-5 h-5 text-green-600"}),(0,u.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens dos Professores"})]}),(0,u.jsxs)("div",{className:"text-sm text-gray-500",children:[I.current,"/",I.limit," imagens"]})]}),j&&(0,u.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,u.jsx)(t.A,{className:"w-5 h-5 text-red-600"}),(0,u.jsx)("span",{className:"text-red-700",children:j})]}),N&&(0,u.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,u.jsx)(i.A,{className:"w-5 h-5 text-green-600"}),(0,u.jsx)("span",{className:"text-green-700",children:N})]}),I.canUpload&&(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,u.jsx)("label",{htmlFor:"genero-professor",className:"text-sm font-medium text-gray-700",children:"G\xeanero:"}),(0,u.jsxs)("select",{id:"genero-professor",value:U,onChange:e=>z(e.target.value),className:"border rounded px-2 py-1 text-sm",disabled:h,children:[(0,u.jsx)("option",{value:"professor",children:"Professor"}),(0,u.jsx)("option",{value:"professora",children:"Professora"})]})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,u.jsx)("label",{htmlFor:"titulo-historia",className:"text-sm font-medium text-gray-700",children:"T\xedtulo da hist\xf3ria:"}),(0,u.jsx)("input",{id:"titulo-historia",type:"text",value:P,onChange:e=>D(e.target.value),className:"border rounded px-2 py-1 text-sm w-full",placeholder:"Ex: Hist\xf3ria da professora Mariza",disabled:h})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,u.jsx)("label",{htmlFor:"descricao-upload",className:"text-sm font-medium text-gray-700",children:"Legenda da imagem:"}),(0,u.jsx)("input",{id:"descricao-upload",type:"text",value:G,onChange:e=>q(e.target.value),className:"border rounded px-2 py-1 text-sm w-full",placeholder:"Ex: Professor em atividade cultural",disabled:h})]}),(0,u.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(h?"border-gray-300 bg-gray-50":"border-green-300 bg-green-50 hover:border-green-400 hover:bg-green-100"),onDrop:F,onDragOver:L,children:[(0,u.jsx)(n.A,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),(0,u.jsx)("p",{className:"text-gray-600 mb-2",children:"Arraste imagens dos professores aqui ou clique para selecionar"}),(0,u.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"JPG, PNG, WEBP, GIF \u2022 M\xe1ximo 5MB por arquivo \u2022 M\xe1ximo 5 imagens"}),(0,u.jsxs)("label",{className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer transition-colors",children:[(0,u.jsx)("input",{type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:e=>{const s=Array.from(e.target.files);if(0===s.length)return;if(!I.canUpload)return void y("Limite de ".concat(I.limit," imagens dos professores atingido. Remova algumas imagens antes de adicionar novas."));if(A.length+x.length+s.length>I.limit)return void y("Voc\xea pode adicionar no m\xe1ximo ".concat(I.limit-A.length-x.length," imagens dos professores."));const a=s.filter((e=>{const s=["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type),a=e.size<=5242880;return s||y('Arquivo "'.concat(e.name,'" n\xe3o \xe9 uma imagem v\xe1lida. Use apenas JPG, PNG, WEBP ou GIF.')),a||y('Arquivo "'.concat(e.name,'" \xe9 muito grande. Tamanho m\xe1ximo: 5MB.')),s&&a}));a.length>0&&(p((e=>[...e,...a])),y(""))},className:"hidden",disabled:h}),"Selecionar Arquivos"]})]}),h&&(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,u.jsx)("span",{children:"Fazendo upload das imagens dos professores..."}),(0,u.jsxs)("span",{children:[Math.round(f),"%"]})]}),(0,u.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,u.jsx)("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(f,"%")}})})]}),x.length>0&&(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsxs)("h4",{className:"font-medium text-gray-900",children:["Arquivos selecionados (",x.length,")"]}),(0,u.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:x.map(((e,s)=>(0,u.jsxs)("div",{className:"relative group",children:[(0,u.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-24 object-cover rounded-lg border"}),(0,u.jsx)("button",{onClick:()=>(e=>{p((s=>s.filter(((s,a)=>a!==e))))})(s),className:"absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,u.jsx)(d.A,{className:"w-3 h-3"})}),(0,u.jsx)("p",{className:"text-xs text-gray-600 mt-1 truncate",children:e.name})]},s)))}),(0,u.jsx)("button",{onClick:async()=>{if(0!==x.length){b(!0),v(0),y("");try{const e=[];for(let a=0;a<x.length;a++){const r=x[a],o=(a+1)/x.length*100;v(o);const l=await(0,m.wG)(r,s,G,U,P);e.push(l)}E((s=>[...s,...e])),p([]),q(""),v(0),w("".concat(e.length," imagem(ns) do(s) professor(es) carregada(s) com sucesso!"));const r=await(0,m.BZ)(s,"imagens-professores");S(r),a&&a()}catch(e){console.error("Erro no upload:",e),y("Erro ao fazer upload: ".concat(e.message))}finally{b(!1),v(0)}}},disabled:h,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Fazendo Upload...":"Fazer Upload"})]})]}),A.length>0&&(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("h4",{className:"font-medium text-gray-900",children:["Imagens dos Professores (",A.length,")"]}),(0,u.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:A.map((e=>(0,u.jsxs)("div",{className:"relative group bg-white rounded-lg border shadow-sm overflow-hidden",children:[(0,u.jsx)("img",{src:e.publicUrl,alt:e.descricao||"Imagem do professor",className:"w-full h-32 object-cover"}),(0,u.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,u.jsx)("button",{onClick:()=>(async(e,r)=>{if(window.confirm("Tem certeza que deseja excluir esta imagem do professor?"))try{await(0,m.vS)(e,r,"imagens-professores"),E((s=>s.filter((s=>s.id!==e))));const o=await(0,m.BZ)(s,"imagens-professores");S(o),w("Imagem do professor exclu\xedda com sucesso!"),a&&a()}catch(o){console.error("Erro ao deletar imagem:",o),y("Erro ao excluir imagem: ".concat(o.message))}})(e.id,e.url),className:"p-1 bg-red-600 text-white rounded-full hover:bg-red-700",title:"Excluir imagem",children:(0,u.jsx)(c.A,{className:"w-3 h-3"})})}),(0,u.jsx)("div",{className:"p-2",children:(0,u.jsx)("textarea",{value:T[e.id]||e.descricao||"",onChange:s=>{var a,o;a=e.id,o=s.target.value,B((e=>(0,r.A)((0,r.A)({},e),{},{[a]:o}))),_(a,o)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"w-full p-2 text-xs border rounded resize-none",rows:"2",placeholder:"Digite a descri\xe7\xe3o da imagem do professor..."})})]},e.id)))})]}),0===A.length&&!h&&(0,u.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,u.jsx)(l.A,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),(0,u.jsx)("p",{children:"Nenhuma imagem dos professores adicionada ainda."}),(0,u.jsx)("p",{className:"text-sm",children:"Adicione imagens para mostrar os professores da escola."})]})]})}},4654:(e,s,a)=>{a.r(s),a.d(s,{default:()=>x});var r=a(2555),o=a(5043),l=a(197),t=a(6464),i=a(4562),n=a(1209),d=a(2065),c=a(4224),m=a(7484),g=a(3701),u=a(579);const x=e=>{let{escola:s,onClose:a,onSave:x}=e;const[p,h]=(0,o.useState)((null===s||void 0===s?void 0:s.Escola)||""),[b,f]=(0,o.useState)(!1),[v,j]=(0,o.useState)(""),[y,N]=(0,o.useState)("dados-basicos"),w=[{id:"dados-basicos",label:"Dados B\xe1sicos",icon:l.A,description:"Informa\xe7\xf5es principais da escola"},{id:"imagens-escola",label:"Imagens da Escola",icon:t.A,description:"Upload e gerenciamento de imagens da escola (m\xe1x. 10)"},{id:"imagens-professores",label:"Imagens dos Professores",icon:i.A,description:"Upload e gerenciamento de imagens dos professores (m\xe1x. 5)"},{id:"localizacao",label:"Localiza\xe7\xe3o",icon:n.A,description:"Coordenadas e endere\xe7o da escola"},{id:"gestao",label:"Gest\xe3o",icon:d.A,description:"Informa\xe7\xf5es sobre gest\xe3o e funcion\xe1rios"},{id:"configuracoes",label:"Configura\xe7\xf5es",icon:c.A,description:"Configura\xe7\xf5es avan\xe7adas da escola"}],A=()=>{console.log("Imagens atualizadas - PainelInformacoes deve ser atualizado")};return(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl mx-auto",children:[(0,u.jsx)("div",{className:"border-b border-gray-200 px-6 py-4",children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{children:[(0,u.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Editar Escola: ",(null===s||void 0===s?void 0:s.Escola)||"Nova Escola"]}),(0,u.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Gerencie as informa\xe7\xf5es e imagens da escola"})]}),(0,u.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,u.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,u.jsx)("div",{className:"border-b border-gray-200",children:(0,u.jsx)("nav",{className:"flex space-x-8 px-6 overflow-x-auto",children:w.map((e=>{const s=e.icon;return(0,u.jsxs)("button",{type:"button",onClick:()=>N(e.id),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors ".concat(y===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),title:e.description,children:[(0,u.jsx)(s,{className:"w-4 h-4"}),e.label]},e.id)}))})}),(0,u.jsx)("div",{className:"p-6",children:(0,u.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),p.trim()){j(""),f(!0);try{await x((0,r.A)((0,r.A)({},s),{},{Escola:p})),a()}catch(o){j("Erro ao salvar.")}finally{f(!1)}}else j("O nome da escola \xe9 obrigat\xf3rio.")},children:[(0,u.jsx)("div",{className:"min-h-[400px]",children:(()=>{switch(y){case"dados-basicos":return(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Escola *"}),(0,u.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p,onChange:e=>h(e.target.value),disabled:b,placeholder:"Digite o nome da escola"})]}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Munic\xedpio"}),(0,u.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s["Munic\xedpio"])||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{"Munic\xedpio":e.target.value})),placeholder:"Nome do munic\xedpio"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terra Ind\xedgena (TI)"}),(0,u.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s["Terra Indigena (TI)"])||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{"Terra Indigena (TI)":e.target.value})),placeholder:"Nome da terra ind\xedgena"})]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere\xe7o"}),(0,u.jsx)("textarea",{className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",value:(null===s||void 0===s?void 0:s["Endere\xe7o"])||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{"Endere\xe7o":e.target.value})),placeholder:"Endere\xe7o completo da escola"})]})]});case"imagens-escola":return(0,u.jsx)(m.A,{escolaId:null===s||void 0===s?void 0:s.id,onImagesUpdate:A});case"imagens-professores":return(0,u.jsx)(g.A,{escolaId:null===s||void 0===s?void 0:s.id,onImagesUpdate:A});case"localizacao":return(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Latitude"}),(0,u.jsx)("input",{type:"number",step:"any",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s.latitude)||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{latitude:parseFloat(e.target.value)||null})),placeholder:"Ex: -23.5505"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Longitude"}),(0,u.jsx)("input",{type:"number",step:"any",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s.longitude)||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{longitude:parseFloat(e.target.value)||null})),placeholder:"Ex: -46.6333"})]})]}),(0,u.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,u.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,u.jsx)("strong",{children:"Dica:"})," Use o Google Maps para encontrar as coordenadas exatas da escola. Clique com o bot\xe3o direito no local da escola e selecione as coordenadas."]})})]});case"gestao":return(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gest\xe3o/Nome"}),(0,u.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s.gestao)||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{gestao:e.target.value})),placeholder:"Nome da gest\xe3o atual"})]}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professores Ind\xedgenas"}),(0,u.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s.professores_indigenas)||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{professores_indigenas:e.target.value})),placeholder:"Quantidade ou nomes"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professores N\xe3o Ind\xedgenas"}),(0,u.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===s||void 0===s?void 0:s.professores_nao_indigenas)||"",onChange:e=>x((0,r.A)((0,r.A)({},s),{},{professores_nao_indigenas:e.target.value})),placeholder:"Quantidade ou nomes"})]})]})]});case"configuracoes":return(0,u.jsx)("div",{className:"space-y-4",children:(0,u.jsx)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,u.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,u.jsx)("strong",{children:"Configura\xe7\xf5es Avan\xe7adas:"})," Esta se\xe7\xe3o ser\xe1 implementada em breve. Aqui voc\xea poder\xe1 configurar permiss\xf5es, notifica\xe7\xf5es e outras op\xe7\xf5es avan\xe7adas."]})})});default:return null}})()}),v&&(0,u.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,u.jsx)("p",{className:"text-red-700 text-sm",children:v})}),(0,u.jsxs)("div",{className:"flex gap-3 mt-6 pt-6 border-t border-gray-200",children:[(0,u.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:b,children:b?"Salvando...":"Salvar Altera\xe7\xf5es"}),(0,u.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",onClick:a,disabled:b,children:"Cancelar"})]})]})})]})}},7484:(e,s,a)=>{a.d(s,{A:()=>x});var r=a(2555),o=a(5043),l=a(6464),t=a(6478),i=a(193),n=a(256),d=a(7669),c=a(1184),m=a(1440),g=a(3536),u=a(579);const x=e=>{let{escolaId:s,onImagesUpdate:a}=e;const[x,p]=(0,o.useState)([]),[h,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(0),[j,y]=(0,o.useState)(""),[N,w]=(0,o.useState)(""),[A,E]=(0,o.useState)([]),[C,k]=(0,o.useState)(!0),[I,S]=(0,o.useState)({current:0,limit:10,canUpload:!0}),[U,z]=(0,o.useState)({}),P=(0,o.useCallback)((async()=>{if(s)try{k(!0);const e=await(0,m.Gw)(s,"imagens-das-escolas");E(e);const a={};e.forEach((e=>{a[e.id]=e.descricao})),z(a);const r=await(0,m.BZ)(s,"imagens-das-escolas");S(r)}catch(e){console.error("Erro ao buscar imagens:",e),y("Erro ao carregar imagens existentes")}finally{k(!1)}}),[s]);(0,o.useEffect)((()=>{P()}),[P]),(0,o.useEffect)((()=>{if(j||N){const e=setTimeout((()=>{y(""),w("")}),5e3);return()=>clearTimeout(e)}}),[j,N]);const D=(0,o.useCallback)((e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files);if(0===s.length)return;if(!I.canUpload)return void y("Limite de ".concat(I.limit," imagens atingido. Remova algumas imagens antes de adicionar novas."));if(A.length+x.length+s.length>I.limit)return void y("Voc\xea pode adicionar no m\xe1ximo ".concat(I.limit-A.length-x.length," imagens."));const a=s.filter((e=>e.type.startsWith("image/")));a.length>0&&(p((e=>[...e,...a])),y(""))}),[I,A.length,x.length]),G=(0,o.useCallback)((e=>{e.preventDefault()}),[]),q=(0,o.useCallback)((0,g.debounce)(((e,s)=>{(async(e,s)=>{try{await(0,m.vx)(e,s),E((a=>a.map((a=>a.id===e?(0,r.A)((0,r.A)({},a),{},{descricao:s.trim()}):a)))),w("Descri\xe7\xe3o atualizada com sucesso!")}catch(a){console.error("Erro ao atualizar descri\xe7\xe3o:",a),y("Erro ao atualizar descri\xe7\xe3o: ".concat(a.message))}})(e,s)}),1e3),[]);return C?(0,u.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg",children:(0,u.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,u.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,u.jsx)("span",{className:"ml-2 text-gray-600",children:"Carregando imagens..."})]})}):(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)(l.A,{className:"w-5 h-5 text-blue-600"}),(0,u.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens da Escola"})]}),(0,u.jsxs)("div",{className:"text-sm text-gray-500",children:[I.current,"/",I.limit," imagens"]})]}),j&&(0,u.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,u.jsx)(t.A,{className:"w-5 h-5 text-red-600"}),(0,u.jsx)("span",{className:"text-red-700",children:j})]}),N&&(0,u.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,u.jsx)(i.A,{className:"w-5 h-5 text-green-600"}),(0,u.jsx)("span",{className:"text-green-700",children:N})]}),I.canUpload&&(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(h?"border-gray-300 bg-gray-50":"border-blue-300 bg-blue-50 hover:border-blue-400 hover:bg-blue-100"),onDrop:D,onDragOver:G,children:[(0,u.jsx)(n.A,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),(0,u.jsx)("p",{className:"text-gray-600 mb-2",children:"Arraste imagens aqui ou clique para selecionar"}),(0,u.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"JPG, PNG, WEBP, GIF \u2022 M\xe1ximo 5MB por arquivo"}),(0,u.jsxs)("label",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors",children:[(0,u.jsx)("input",{type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:e=>{const s=Array.from(e.target.files);if(0===s.length)return;if(!I.canUpload)return void y("Limite de ".concat(I.limit," imagens atingido. Remova algumas imagens antes de adicionar novas."));if(A.length+x.length+s.length>I.limit)return void y("Voc\xea pode adicionar no m\xe1ximo ".concat(I.limit-A.length-x.length," imagens."));const a=s.filter((e=>{const s=["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type),a=e.size<=5242880;return s||y('Arquivo "'.concat(e.name,'" n\xe3o \xe9 uma imagem v\xe1lida. Use apenas JPG, PNG, WEBP ou GIF.')),a||y('Arquivo "'.concat(e.name,'" \xe9 muito grande. Tamanho m\xe1ximo: 5MB.')),s&&a}));a.length>0&&(p((e=>[...e,...a])),y(""))},className:"hidden",disabled:h}),"Selecionar Arquivos"]})]}),h&&(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,u.jsx)("span",{children:"Fazendo upload..."}),(0,u.jsxs)("span",{children:[Math.round(f),"%"]})]}),(0,u.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,u.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(f,"%")}})})]}),x.length>0&&(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsxs)("h4",{className:"font-medium text-gray-900",children:["Arquivos selecionados (",x.length,")"]}),(0,u.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:x.map(((e,s)=>(0,u.jsxs)("div",{className:"relative group",children:[(0,u.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-24 object-cover rounded-lg border"}),(0,u.jsx)("button",{onClick:()=>(e=>{p((s=>s.filter(((s,a)=>a!==e))))})(s),className:"absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,u.jsx)(d.A,{className:"w-3 h-3"})}),(0,u.jsx)("p",{className:"text-xs text-gray-600 mt-1 truncate",children:e.name})]},s)))}),(0,u.jsx)("button",{onClick:async()=>{if(0!==x.length){b(!0),v(0),y("");try{const e=[];for(let a=0;a<x.length;a++){const r=x[a],o=(a+1)/x.length*100;v(o);const l=await(0,m.gE)(r,s);e.push(l)}E((s=>[...s,...e])),p([]),v(0),w("".concat(e.length," imagem(ns) carregada(s) com sucesso!"));const r=await(0,m.BZ)(s,"imagens-das-escolas");S(r),a&&a()}catch(e){console.error("Erro no upload:",e),y("Erro ao fazer upload: ".concat(e.message))}finally{b(!1),v(0)}}},disabled:h,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Fazendo Upload...":"Fazer Upload"})]})]}),A.length>0&&(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("h4",{className:"font-medium text-gray-900",children:["Imagens da Escola (",A.length,")"]}),(0,u.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:A.map((e=>(0,u.jsxs)("div",{className:"relative group bg-white rounded-lg border shadow-sm overflow-hidden",children:[(0,u.jsx)("img",{src:e.publicUrl,alt:e.descricao||"Imagem da escola",className:"w-full h-32 object-cover"}),(0,u.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,u.jsx)("button",{onClick:()=>(async(e,r)=>{if(window.confirm("Tem certeza que deseja excluir esta imagem?"))try{await(0,m.vS)(e,r,"imagens-das-escolas"),E((s=>s.filter((s=>s.id!==e))));const o=await(0,m.BZ)(s,"imagens-das-escolas");S(o),w("Imagem exclu\xedda com sucesso!"),a&&a()}catch(o){console.error("Erro ao deletar imagem:",o),y("Erro ao excluir imagem: ".concat(o.message))}})(e.id,e.url),className:"p-1 bg-red-600 text-white rounded-full hover:bg-red-700",title:"Excluir imagem",children:(0,u.jsx)(c.A,{className:"w-3 h-3"})})}),(0,u.jsx)("div",{className:"p-2",children:(0,u.jsx)("textarea",{value:U[e.id]||e.descricao||"",onChange:s=>{var a,o;a=e.id,o=s.target.value,z((e=>(0,r.A)((0,r.A)({},e),{},{[a]:o}))),q(a,o)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"w-full p-2 text-xs border rounded resize-none",rows:"2",placeholder:"Digite a descri\xe7\xe3o da imagem..."})})]},e.id)))})]}),0===A.length&&!h&&(0,u.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,u.jsx)(l.A,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),(0,u.jsx)("p",{children:"Nenhuma imagem adicionada ainda."}),(0,u.jsx)("p",{className:"text-sm",children:"Adicione imagens para mostrar a escola."})]})]})}}}]);
//# sourceMappingURL=654.700e8f6a.chunk.js.map