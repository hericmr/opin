{"version":3,"file":"static/js/491.932af088.chunk.js","mappings":"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","sources":["components/Marcadores.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport { Marker, Tooltip, useMap } from \"react-leaflet\";\nimport { violetIcon } from \"./CustomIcon\";\nimport L from 'leaflet';\nimport 'leaflet.markercluster';\nimport 'leaflet.markercluster/dist/MarkerCluster.css';\nimport 'leaflet.markercluster/dist/MarkerCluster.Default.css';\nimport { capitalizeWords } from \"../utils/textFormatting\";\n\n// Constante para definir a proximidade entre marcadores (em graus)\nconst PROXIMITY_THRESHOLD = 0.00005;\n\n// Função para criar o conector entre marcadores\nconst createConnector = (map, centerLat, centerLng, markerLat, markerLng) => {\n  return L.polyline([[centerLat, centerLng], [markerLat, markerLng]], {\n    color: '#A0522D',\n    weight: 1.2,\n    dashArray: '3,3',\n    opacity: 0.6,\n    className: 'marker-connector'\n  }).addTo(map);\n};\n\n// Função para encontrar pares de marcadores próximos\nconst findNearbyPairs = (pontos) => {\n  const pairs = [];\n  const used = new Set();\n\n  for (let i = 0; i < pontos.length; i++) {\n    if (used.has(i)) continue;\n\n    for (let j = i + 1; j < pontos.length; j++) {\n      if (used.has(j)) continue;\n\n      const p1 = pontos[i];\n      const p2 = pontos[j];\n\n      const latDiff = Math.abs(parseFloat(p1.latitude) - parseFloat(p2.latitude));\n      const lngDiff = Math.abs(parseFloat(p1.longitude) - parseFloat(p2.longitude));\n\n      if (latDiff < PROXIMITY_THRESHOLD && lngDiff < PROXIMITY_THRESHOLD) {\n        pairs.push([i, j]);\n        used.add(i);\n        used.add(j);\n        break;\n      }\n    }\n  }\n\n  return pairs;\n};\n\nconst Marcadores = ({ dataPoints, visibility, onClick }) => {\n  const map = useMap();\n  const clusterGroupRef = useRef(null);\n  const connectorsRef = useRef([]);\n\n  // Filtra os pontos válidos\n  const pontosValidos = React.useMemo(() => {\n    if (!Array.isArray(dataPoints) || dataPoints.length === 0) {\n      return [];\n    }\n\n    // Array para armazenar escolas com coordenadas inválidas\n    const escolasComProblemas = [];\n\n    const pontosFiltrados = dataPoints.filter(ponto => {\n      // Verifica se o ponto tem as propriedades básicas\n      if (!ponto.titulo || !ponto.latitude || !ponto.longitude) {\n        escolasComProblemas.push({\n          escola: ponto.titulo || \"Sem nome\",\n          problema: \"Dados básicos ausentes\",\n          detalhes: {\n            titulo: !!ponto.titulo,\n            latitude: !!ponto.latitude,\n            longitude: !!ponto.longitude\n          }\n        });\n        return false;\n      }\n\n      const lat = parseFloat(ponto.latitude);\n      const lng = parseFloat(ponto.longitude);\n      \n      // Verifica se as coordenadas são números válidos\n      if (isNaN(lat) || isNaN(lng)) {\n        escolasComProblemas.push({\n          escola: ponto.titulo,\n          problema: \"Coordenadas não são números válidos\",\n          detalhes: {\n            latitude: ponto.latitude,\n            longitude: ponto.longitude\n          }\n        });\n        return false;\n      }\n\n      // Verifica se as coordenadas estão dentro dos limites válidos\n      if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n        escolasComProblemas.push({\n          escola: ponto.titulo,\n          problema: \"Coordenadas fora dos limites válidos\",\n          detalhes: {\n            latitude: lat,\n            longitude: lng,\n            limites: {\n              latMin: -90,\n              latMax: 90,\n              lngMin: -180,\n              lngMax: 180\n            }\n          }\n        });\n        return false;\n      }\n\n      return true;\n    });\n\n    // Log detalhado das escolas com problemas\n    if (escolasComProblemas.length > 0) {\n      console.group(\"Escolas com coordenadas inválidas:\");\n      escolasComProblemas.forEach(escola => {\n        console.group(escola.escola);\n        console.log(\"Problema:\", escola.problema);\n        console.log(\"Detalhes:\", escola.detalhes);\n        console.groupEnd();\n      });\n      console.groupEnd();\n      console.log(`Total de escolas com problemas: ${escolasComProblemas.length}`);\n    }\n\n    return pontosFiltrados;\n  }, [dataPoints]);\n\n  // Configuração do ícone para escolas indígenas\n  const escolaIcon = violetIcon;\n\n  useEffect(() => {\n    if (!Array.isArray(dataPoints) || dataPoints.length === 0) {\n      return;\n    }\n\n    if (!map || !pontosValidos.length || !visibility.educacao) return;\n\n    // Remove o grupo de clusters anterior e conectores\n    if (clusterGroupRef.current) {\n      map.removeLayer(clusterGroupRef.current);\n    }\n    connectorsRef.current.forEach(connector => map.removeLayer(connector));\n    connectorsRef.current = [];\n\n    // Encontra pares de marcadores próximos\n    const nearbyPairs = findNearbyPairs(pontosValidos);\n    const usedIndices = new Set(nearbyPairs.flat());\n\n    // Cria um novo grupo de clusters\n    const clusterGroup = new L.MarkerClusterGroup({\n      // Configurações básicas\n      chunkedLoading: true,\n      maxClusterRadius: 4,\n      spiderfyOnMaxZoom: true,\n      showCoverageOnHover: true,\n      zoomToBoundsOnClick: true,\n      removeOutsideVisibleBounds: true,\n      animate: true,\n      \n      // Configurações de zoom\n      disableClusteringAtZoom: 12,\n      minZoom: 4,\n      maxZoom: 18,\n      \n      // Configurações de ícones com estética indígena\n      iconCreateFunction: function(cluster) {\n        const count = cluster.getChildCount();\n        let size = 'small';\n        let background = '#A0522D';\n        let textColor = '#fff';\n\n        if (count > 100) {\n          size = 'large';\n          background = '#4B2E14';\n        } else if (count > 20) {\n          size = 'medium';\n          background = '#8B5A2B';\n        }\n\n        const iconUrl = violetIcon.options.iconUrl;\n        const iconSize = violetIcon.options.iconSize || [30, 30];\n\n        return L.divIcon({\n          html: `\n            <div style=\"\n              background: radial-gradient(circle at 30% 30%, ${background}, #3b2e2a);\n              color: ${textColor};\n              border-radius: 50%;\n              width: ${iconSize[0] + 10}px;\n              height: ${iconSize[1] + 10}px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              font-weight: bold;\n              border: 2px solid #f5f5dc;\n              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n              transition: transform 0.3s ease;\n              padding: 2px;\n            \">\n              <img src=\"${iconUrl}\" width=\"${iconSize[0] * 0.6}\" height=\"${iconSize[1] * 0.6}\" style=\"margin-bottom: 2px;\" />\n              <span style=\"\n                font-size: ${size === 'large' ? '16px' : size === 'medium' ? '14px' : '12px'};\n              \">${count}</span>\n            </div>`,\n          className: `marker-cluster marker-cluster-${size}`,\n          iconSize: L.point(iconSize[0] + 10, iconSize[1] + 10)\n        });\n      },\n      \n      // Configurações de animação suaves\n      animateAddingMarkers: true,\n      spiderLegPolylineOptions: { \n        weight: 1.3,\n        color: '#5C4033',\n        opacity: 0.5,\n        dashArray: '2,4'\n      },\n      \n      // Configurações de performance\n      chunkInterval: 200,\n      chunkDelay: 50,\n      \n      // Configurações de interatividade\n      singleMarkerMode: false,\n      spiderfyDistanceMultiplier: 1.5,\n      \n      // Configurações de estilo orgânico\n      polygonOptions: {\n        fillColor: '#A0522D',\n        color: '#5C4033',\n        weight: 1.2,\n        opacity: 0.6,\n        fillOpacity: 0.2\n      }\n    });\n\n    // Adiciona os marcadores ao grupo\n    pontosValidos.forEach((ponto, index) => {\n      const lat = parseFloat(ponto.latitude);\n      const lng = parseFloat(ponto.longitude);\n      \n      const marker = L.marker([lat, lng], { \n        icon: escolaIcon,\n        zIndexOffset: 1000,\n        interactive: true,\n        riseOnHover: true,\n        keyboard: true,\n        title: capitalizeWords(ponto.titulo)\n      });\n\n      // Adiciona o tooltip com o título capitalizado\n      marker.bindTooltip(capitalizeWords(ponto.titulo), {\n        className: \"bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100\",\n        direction: \"top\",\n        offset: [0, -10],\n        opacity: 1,\n        permanent: false,\n        sticky: true,\n        interactive: true\n      });\n\n      // Adiciona o evento de clique com suporte a toque\n      marker.on('click touchstart', (e) => {\n        e.originalEvent.stopPropagation();\n        e.originalEvent.preventDefault();\n        \n        if (e.type === 'touchstart') {\n          setTimeout(() => {\n            onClick?.(ponto);\n          }, 100);\n        } else {\n          onClick?.(ponto);\n        }\n      });\n\n      // Adiciona feedback visual para toque em dispositivos móveis\n      marker.on('touchstart', () => {\n        marker.setOpacity(0.7);\n      });\n\n      marker.on('touchend touchcancel', () => {\n        marker.setOpacity(1);\n      });\n\n      // Verifica se este marcador faz parte de um par próximo\n      const pairIndex = nearbyPairs.findIndex(pair => pair.includes(index));\n      if (pairIndex !== -1) {\n        const [first, second] = nearbyPairs[pairIndex];\n        const isFirst = index === first;\n        const otherIndex = isFirst ? second : first;\n        const otherPonto = pontosValidos[otherIndex];\n\n        // Aplica o efeito de fan-out aprimorado\n        marker.on('add', function() {\n          const transform = isFirst \n            ? 'perspective(500px) rotateY(-20deg) translateX(-20px) rotate(-25deg) scale(0.9)'\n            : 'perspective(500px) rotateY(20deg) translateX(20px) rotate(25deg) scale(0.9)';\n          \n          this._icon.style.transform = transform;\n          this._icon.style.transition = 'transform 0.5s ease-out, filter 0.3s ease-in';\n          this._icon.style.filter = 'drop-shadow(0 4px 12px rgba(160, 82, 45, 0.35))';\n          this._icon.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.35)';\n        });\n\n        // Cria o conector entre os marcadores\n        const connector = createConnector(\n          map,\n          lat,\n          lng,\n          parseFloat(otherPonto.latitude),\n          parseFloat(otherPonto.longitude)\n        );\n        connectorsRef.current.push(connector);\n      }\n\n      clusterGroup.addLayer(marker);\n    });\n\n    // Adiciona o grupo ao mapa\n    map.addLayer(clusterGroup);\n    clusterGroupRef.current = clusterGroup;\n\n    // Limpa o grupo e conectores quando o componente for desmontado\n    return () => {\n      if (clusterGroupRef.current) {\n        map.removeLayer(clusterGroupRef.current);\n      }\n      connectorsRef.current.forEach(connector => map.removeLayer(connector));\n      connectorsRef.current = [];\n    };\n  }, [map, pontosValidos, onClick, escolaIcon, visibility.educacao, dataPoints]);\n\n  return null;\n};\n\nexport default Marcadores; "],"names":["PROXIMITY_THRESHOLD","_ref","dataPoints","visibility","onClick","map","useMap","clusterGroupRef","useRef","connectorsRef","pontosValidos","React","Array","isArray","length","escolasComProblemas","pontosFiltrados","filter","ponto","titulo","latitude","longitude","push","escola","problema","detalhes","lat","parseFloat","lng","isNaN","limites","latMin","latMax","lngMin","lngMax","console","group","forEach","log","groupEnd","concat","escolaIcon","violetIcon","useEffect","educacao","current","removeLayer","connector","nearbyPairs","pontos","pairs","used","Set","i","has","j","p1","p2","latDiff","Math","abs","lngDiff","add","findNearbyPairs","clusterGroup","flat","L","chunkedLoading","maxClusterRadius","spiderfyOnMaxZoom","showCoverageOnHover","zoomToBoundsOnClick","removeOutsideVisibleBounds","animate","disableClusteringAtZoom","minZoom","maxZoom","iconCreateFunction","cluster","count","getChildCount","size","background","iconUrl","options","iconSize","html","className","animateAddingMarkers","spiderLegPolylineOptions","weight","color","opacity","dashArray","chunkInterval","chunkDelay","singleMarkerMode","spiderfyDistanceMultiplier","polygonOptions","fillColor","fillOpacity","index","marker","icon","zIndexOffset","interactive","riseOnHover","keyboard","title","capitalizeWords","bindTooltip","direction","offset","permanent","sticky","on","e","originalEvent","stopPropagation","preventDefault","type","setTimeout","setOpacity","pairIndex","findIndex","pair","includes","first","second","isFirst","otherPonto","transform","this","_icon","style","transition","boxShadow","createConnector","centerLat","centerLng","markerLat","markerLng","addTo","addLayer"],"sourceRoot":""}