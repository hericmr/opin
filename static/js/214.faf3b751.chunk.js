/*! For license information please see 214.faf3b751.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmapa_santos=self.webpackChunkmapa_santos||[]).push([[214,969],{7969:(e,a,t)=>{t.r(a),t.d(a,{default:()=>g});var s=t(2555),l=t(5043),o=t(2880),i=t(1504),r=t(3129),n=t(433),c=t(1833),d=t(7669),u=t(256),m=t(579);const g=e=>{let{location:a,onClose:t,onSave:g}=e;const[x,h]=(0,l.useState)((0,s.A)((0,s.A)({},a),{},{latitude:a.localizacao?a.localizacao.split(",")[0]:"",longitude:a.localizacao?a.localizacao.split(",")[1]:""})),[p,f]=(0,l.useState)(!1),[y,b]=(0,l.useState)(!1),[v,j]=(0,l.useState)({}),[N,w]=(0,l.useState)(!1),[A,k]=(0,l.useState)({selectedImages:[],imageUrls:[],uploadingImages:!1,uploadError:""}),[S,C]=(0,l.useState)({isRecording:!1,audioBlob:null,isPlaying:!1,uploadingAudio:!1});(0,l.useRef)(null),(0,l.useRef)([]),(0,l.useRef)(null);l.useEffect((()=>{if(a.imagens){const e=a.imagens.split(",").filter((e=>e));k((a=>(0,s.A)((0,s.A)({},a),{},{imageUrls:e})))}}),[a.imagens]);const z=async e=>{const a=Array.from(e.target.files);if(0===a.length)return;const t=a.filter((e=>{const a=["image/jpeg","image/png","image/jpg"].includes(e.type),t=e.size<=5242880;return a&&t}));t.length!==a.length&&k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:"Alguns arquivos foram ignorados. Use apenas imagens JPG/PNG at\xe9 5MB."}))),k((e=>(0,s.A)((0,s.A)({},e),{},{selectedImages:[...e.selectedImages,...t]}))),t.forEach((e=>{const a=new FileReader;a.onloadend=()=>{k((e=>(0,s.A)((0,s.A)({},e),{},{imageUrls:[...e.imageUrls,a.result]})))},a.readAsDataURL(e)}))},I=async()=>{if(0===A.selectedImages.length)return;k((e=>(0,s.A)((0,s.A)({},e),{},{uploadingImages:!0,uploadError:""})));const e=[];try{for(const t of A.selectedImages){const a=t.name.split(".").pop(),s="".concat(Math.random().toString(36).substring(2),".").concat(a),l="locations/".concat(s),{error:i}=await o.N.storage.from("media").upload(l,t);if(i)throw i;const{data:{publicUrl:r}}=o.N.storage.from("media").getPublicUrl(l);e.push(r)}const a=[...x.imagens?x.imagens.split(",").filter((e=>e)):[],...e];h((e=>(0,s.A)((0,s.A)({},e),{},{imagens:a.join(",")}))),k((e=>(0,s.A)((0,s.A)({},e),{},{selectedImages:[],imageUrls:a})))}catch(a){0,k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:"Erro ao fazer upload das imagens. Tente novamente."})))}finally{k((e=>(0,s.A)((0,s.A)({},e),{},{uploadingImages:!1})))}};return(0,m.jsx)("div",{className:"fixed top-16 right-0 sm:w-3/4 lg:w-[49%] bg-white rounded-xl shadow-lg z-[9999] text-gray-800",style:{height:"calc(100vh - 4rem)",maxHeight:"calc(100vh - 4rem)",display:"flex",flexDirection:"column"},children:(0,m.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,m.jsxs)("div",{className:"p-6",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,m.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Local"}),(0,m.jsx)("button",{onClick:t,className:"text-gray-600 hover:text-gray-900 text-lg","aria-label":"Fechar painel",children:"\u2716"})]}),(0,m.jsxs)("form",{className:"space-y-4",onSubmit:e=>{if(e.preventDefault(),(()=>{const e={};return x.titulo||(e.titulo="T\xedtulo \xe9 obrigat\xf3rio."),x.latitude&&x.longitude||(e.localizacao="Localiza\xe7\xe3o \xe9 obrigat\xf3ria."),x.descricao_detalhada||(e.descricao_detalhada="Descri\xe7\xe3o detalhada \xe9 obrigat\xf3ria."),j(e),0===Object.keys(e).length})()){const e=(0,s.A)((0,s.A)({},x),{},{imagens:x.imagens?x.imagens.split(",").map((e=>e.trim())).filter((e=>{try{return new URL(e),!0}catch(a){return!1}})).join(","):""});g(e),b(!0),setTimeout((()=>{b(!1)}),3e3)}},children:[(0,m.jsx)(r.A,{label:"T\xedtulo",id:"titulo",type:"text",value:x.titulo||"",onChange:e=>h((a=>(0,s.A)((0,s.A)({},a),{},{titulo:e.target.value}))),placeholder:"Digite o t\xedtulo do local",error:v.titulo}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block font-medium text-gray-800",children:["Tipo de Marcador ",(0,m.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,m.jsxs)("div",{className:"relative",style:{zIndex:99999999},children:[(0,m.jsxs)("button",{type:"button",onClick:()=>f(!p),className:"w-full border rounded p-2 flex items-center justify-between text-gray-800 bg-white hover:bg-gray-50",children:[(0,m.jsx)("span",{children:x.tipo||"Selecione o tipo de marcador"}),(0,m.jsx)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p&&(0,m.jsx)("div",{className:"absolute w-full bg-white border rounded shadow-lg",style:{top:"100%",left:0,zIndex:99999999,maxHeight:"300px",overflowY:"auto"},children:c.Q.map(((e,a)=>(0,m.jsxs)("button",{type:"button",onClick:()=>{return a=e.value,h((e=>(0,s.A)((0,s.A)({},e),{},{tipo:a}))),void f(!1);var a},className:"w-full text-left p-2 hover:bg-gray-50 flex items-center ".concat(e.cor," text-gray-800"),children:[e.icone.startsWith("http")?(0,m.jsx)("img",{src:e.icone,alt:e.label,className:"w-6 h-6 mr-2"}):(0,m.jsx)("span",{className:"mr-2",children:e.icone}),(0,m.jsx)("span",{children:e.label})]},a)))})]})]}),(0,m.jsx)(i.A,{newLocation:x,setNewLocation:h,error:v.localizacao,handleImageSelect:z,handleUploadImages:I,handleUploadAudio:async()=>{if(S.audioBlob){C((e=>(0,s.A)((0,s.A)({},e),{},{uploadingAudio:!0}))),k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:""})));try{const e="audio_".concat(Math.random().toString(36).substring(2),".wav"),a="audios/".concat(e),{error:t}=await o.N.storage.from("media").upload(a,S.audioBlob);if(t)throw t;const{data:{publicUrl:l}}=o.N.storage.from("media").getPublicUrl(a);h((e=>(0,s.A)((0,s.A)({},e),{},{audio:l}))),C((e=>(0,s.A)((0,s.A)({},e),{},{audioBlob:null,isPlaying:!1,uploadingAudio:!1})))}catch(e){0,k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:"Erro ao fazer upload do \xe1udio. Tente novamente."}))),C((e=>(0,s.A)((0,s.A)({},e),{},{uploadingAudio:!1})))}}},mediaState:A,audioState:S,setMediaState:k,setAudioState:C}),(0,m.jsx)("div",{className:"space-y-2",children:(0,m.jsx)(n.A,{value:x.descricao_detalhada,onChange:e=>h((a=>(0,s.A)((0,s.A)({},a),{},{descricao_detalhada:e}))),error:v.descricao_detalhada})}),(0,m.jsx)(r.A,{label:"Links",id:"links",type:"url",value:x.links||"",onChange:e=>h((a=>(0,s.A)((0,s.A)({},a),{},{links:e.target.value}))),placeholder:"Cole um link aqui (http://...)"}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsx)("label",{className:"block font-medium text-gray-800",children:"Imagens"}),(0,m.jsxs)("div",{className:"space-y-4",children:[A.imageUrls.length>0&&(0,m.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:A.imageUrls.map(((e,a)=>(0,m.jsxs)("div",{className:"relative group",children:[(0,m.jsx)("img",{src:e,alt:"Imagem ".concat(a+1),className:"w-full h-32 object-cover rounded-lg"}),(0,m.jsx)("button",{type:"button",onClick:()=>(e=>{const a=A.imageUrls.filter(((a,t)=>t!==e));k((e=>(0,s.A)((0,s.A)({},e),{},{imageUrls:a}))),h((e=>(0,s.A)((0,s.A)({},e),{},{imagens:a.join(",")})))})(a),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,m.jsx)(d.A,{className:"w-4 h-4"})})]},a)))}),(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[(0,m.jsxs)("label",{className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg cursor-pointer hover:bg-blue-600 transition-colors",children:[(0,m.jsx)(u.A,{className:"w-4 h-4"}),(0,m.jsx)("span",{children:"Adicionar Imagens"}),(0,m.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:z})]}),A.selectedImages.length>0&&(0,m.jsx)("button",{type:"button",onClick:I,disabled:A.uploadingImages,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:bg-green-300",children:A.uploadingImages?"Enviando...":"Enviar Imagens"})]}),A.uploadError&&(0,m.jsx)("p",{className:"text-red-500 text-sm",children:A.uploadError})]})]}),(0,m.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,m.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-gray-800",disabled:N,children:"Cancelar"}),(0,m.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-green-300",disabled:N,children:N?"Salvando...":"Salvar"})]}),v.submit&&(0,m.jsx)("p",{className:"text-red-500 text-sm mt-2",children:v.submit}),y&&(0,m.jsx)("div",{className:"text-green-600 text-sm mt-2 animate-fade-in",children:"\u2714 Local atualizado com sucesso!"})]})]})})})}},8214:(e,a,t)=>{t.r(a),t.d(a,{default:()=>h});var s=t(5043),l=t(2880),o=t(1114);const i=(0,o.A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),r=(0,o.A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var n=t(7669),c=t(1209),d=t(9449);const u=(0,o.A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),m=(0,o.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var g=t(7969),x=t(579);const h=()=>{const[e,a]=(0,s.useState)([]),[t,o]=(0,s.useState)(!0),[h,p]=(0,s.useState)(""),[f,y]=(0,s.useState)("todos"),[b,v]=(0,s.useState)(null),[j,N]=(0,s.useState)(null),[w,A]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1);(0,s.useEffect)((()=>{(async()=>{try{o(!0);const{data:e,error:t}=await l.N.from("escolas_completa").select("*").order("titulo",{ascending:!0});if(t)throw t;a(e)}catch(e){0,v("N\xe3o foi poss\xedvel carregar os locais. Por favor, tente novamente.")}finally{o(!1)}})()}),[]);const C=e.filter((e=>{var a,t;const s=(null===(a=e.titulo)||void 0===a?void 0:a.toLowerCase().includes(h.toLowerCase()))||(null===(t=e.descricao_detalhada)||void 0===t?void 0:t.toLowerCase().includes(h.toLowerCase())),l="todos"===f||e.tipo===f;return s&&l})),z=["todos",...new Set(e.map((e=>e.tipo)))];return(0,x.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,x.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,x.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Painel de Administra\xe7\xe3o"}),(0,x.jsx)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,x.jsxs)("div",{className:"relative flex-1",children:[(0,x.jsx)(i,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,x.jsx)("input",{type:"text",placeholder:"Buscar por t\xedtulo ou descri\xe7\xe3o...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:h,onChange:e=>p(e.target.value)})]}),(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,x.jsx)("select",{className:"pl-10 pr-4 py-2 border rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:f,onChange:e=>y(e.target.value),children:z.map((e=>(0,x.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]})]})}),b&&(0,x.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-6",children:b}),w&&(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,x.jsxs)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[(0,x.jsx)("h2",{className:"text-lg font-semibold",children:"Editar Local"}),(0,x.jsx)("button",{onClick:()=>A(null),className:"text-gray-500 hover:text-gray-700",children:(0,x.jsx)(n.A,{className:"w-5 h-5"})})]}),(0,x.jsx)(g.default,{location:w,onClose:()=>A(null),onSave:async t=>{if(t&&t.id)try{S(!0),v(null);const{error:s}=await l.N.from("escolas_completa").update({titulo:t.titulo,tipo:t.tipo,descricao_detalhada:t.descricao_detalhada,localizacao:"".concat(t.latitude,",").concat(t.longitude),links:t.links,audio:t.audio,imagens:t.imagens}).eq("id",t.id);if(s)throw s;a(e.map((e=>e.id===t.id?t:e))),A(null)}catch(s){0,v("N\xe3o foi poss\xedvel atualizar o local. Por favor, tente novamente.")}finally{S(!1)}else v("Dados do local inv\xe1lidos. Por favor, tente novamente.")}})]})}),(0,x.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t?(0,x.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Carregando..."}):0===C.length?(0,x.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Nenhum local encontrado."}):(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsx)("div",{className:"max-h-[calc(100vh-300px)] overflow-y-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,x.jsx)("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"T\xedtulo"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"Tipo"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"Localiza\xe7\xe3o"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"Pontua\xe7\xe3o"}),(0,x.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"A\xe7\xf5es"})]})}),(0,x.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map((t=>{var s;const i=(e=>{let a=0;return e.titulo&&"T\xedtulo n\xe3o dispon\xedvel"!==e.titulo&&(a+=15),e.descricao_detalhada&&e.descricao_detalhada.length>100&&(a+=25),e.imagens&&e.imagens.length>0&&(a+=15),e.audio&&(a+=15),e.links&&e.links.length>0&&(a+=15),e.video&&(a+=15),Math.round(a/100*100)})(t);return(0,x.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,x.jsxs)("td",{className:"px-6 py-4",children:[(0,x.jsx)("div",{className:"text-sm font-medium text-gray-900",children:t.titulo}),(0,x.jsx)("div",{className:"text-xs text-gray-500 line-clamp-2",children:null===(s=t.descricao_detalhada)||void 0===s?void 0:s.replace(/<[^>]*>/g,"")})]}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,x.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("lazer"===t.tipo?"bg-blue-100 text-blue-800":"assistencia"===t.tipo?"bg-green-100 text-green-800":"historico"===t.tipo?"bg-yellow-100 text-yellow-800":"comunidades"===t.tipo?"bg-red-100 text-red-800":"educa\xe7\xe3o"===t.tipo?"bg-violet-100 text-violet-800":"religiao"===t.tipo?"bg-gray-100 text-gray-800":"bg-orange-100 text-orange-800"),children:t.tipo})}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,x.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,x.jsx)(c.A,{className:"w-4 h-4 mr-1"}),t.localizacao]})}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden mr-2",children:(0,x.jsx)("div",{className:"h-full rounded-full transition-all duration-300 ".concat(i>=80?"bg-green-500":i>=60?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(i,"%")}})}),(0,x.jsxs)("div",{className:"flex items-center text-sm",children:[(0,x.jsx)(d.A,{className:"w-4 h-4 mr-1 text-yellow-400"}),i,"%"]})]})}),(0,x.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,x.jsx)("button",{className:"text-blue-600 hover:text-blue-900 mr-3",onClick:e=>(e=>{A(e)})(t),children:(0,x.jsx)(u,{className:"w-4 h-4"})}),(0,x.jsx)("button",{className:"text-red-600 hover:text-red-900",onClick:s=>(async t=>{if(window.confirm('Tem certeza que deseja excluir o local "'.concat(t.titulo,'"?')))try{o(!0);const{error:s}=await l.N.from("escolas_completa").delete().eq("id",t.id);if(s)throw s;a(e.filter((e=>e.id!==t.id))),v(null)}catch(s){v("N\xe3o foi poss\xedvel excluir o local. Por favor, tente novamente.")}finally{o(!1)}})(t),children:(0,x.jsx)(m,{className:"w-4 h-4"})})]})]},t.id)}))})]})})})})]})})}}}]);
//# sourceMappingURL=214.faf3b751.chunk.js.map