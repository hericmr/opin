"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[966],{40237:(e,o,r)=>{r.d(o,{eP:()=>i,iy:()=>t,jW:()=>l,qP:()=>s,s7:()=>g,t$:()=>n,w_:()=>c});var a=r(52480);const t=async()=>{try{const{error:e}=await a.N.from("legendas_fotos").select("count").limit(1);return e?(console.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(console.log("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return console.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},s=async function(e,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let t=a.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o);!1!==r.ativo&&(t=t.eq("ativo",!0)),r.categoria&&(t=t.eq("categoria",r.categoria)),r.tipo_foto&&(t=t.eq("tipo_foto",r.tipo_foto));const{data:s,error:n}=await t.order("created_at",{ascending:!1});return n?(console.warn("Erro ao buscar legenda:",n.message),null):s&&s.length>0?s[0]:null}catch(t){return console.warn("Erro ao buscar legenda:",t.message),null}},n=async function(e,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(console.log("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(o,")")),r.categoria||r.tipo_foto){console.log("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const a=await s(e,o,r);if(a)return console.log("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),a}console.log("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:t,error:n}=await a.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).eq("ativo",!0).order("created_at",{ascending:!1});if(n)console.warn("  \u274c Erro na busca por URL e escola:",n.message);else if(t&&t.length>0)return console.log("  \u2705 Encontrada por URL e escola"),t[0];console.log("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:i,error:c}=await a.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).order("created_at",{ascending:!1});if(c)console.warn("  \u274c Erro na busca incluindo inativas:",c.message);else if(i&&i.length>0)return console.log("  \u2705 Encontrada incluindo legendas inativas"),i[0];const l=e.split("/").pop();console.log("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(l));const{data:d,error:g}=await a.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(l)).eq("escola_id",o).eq("ativo",!0).order("created_at",{ascending:!1});if(g)console.warn("  \u274c Erro na busca por nome do arquivo:",g.message);else if(d&&d.length>0)return console.log("  \u2705 Encontrada por nome do arquivo"),d[0];return console.log("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(t){return console.warn("Erro ao buscar legenda flex\xedvel:",t.message),null}},i=async e=>{try{const{data:o,error:r}=await a.N.from("legendas_fotos").insert([e]).select().single();if(r)throw r;return o}catch(o){throw console.error("Erro ao adicionar legenda:",o),o}},c=async(e,o)=>{try{const{data:r,error:t}=await a.N.from("legendas_fotos").update(o).eq("id",e).select().single();if(t)throw t;return r}catch(r){throw console.error("Erro ao atualizar legenda:",r),r}},l=async(e,o)=>{try{const{data:r,error:t}=await a.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).eq("categoria","video").single();if(t){if("PGRST116"===t.code)return null;throw t}return r}catch(r){return console.warn("Erro ao buscar t\xedtulo do v\xeddeo:",r.message),null}},d=async(e,o,r)=>{try{const t=await s(e,o,{ativo:!1});if(t){const{data:e,error:o}=await a.N.from("legendas_fotos").update({ordem:r,updated_at:(new Date).toISOString()}).eq("id",t.id).select().single();if(o)throw o;return e}{const t=(e.split("/").pop()||"Imagem").replace(/\.[^/.]+$/,"").replace(/[_-]/g," ")||"Imagem",{data:s,error:n}=await a.N.from("legendas_fotos").insert([{escola_id:o,imagem_url:e,legenda:t,ordem:r,ativo:!0,tipo_foto:"escola",categoria:"geral",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(n)throw n;return s}}catch(t){throw console.error("Erro ao atualizar ordem da imagem:",t),t}},g=async(e,o)=>{try{return await Promise.all(e.map(e=>{let{imageUrl:r,ordem:a}=e;return d(r,o,a)}))}catch(r){throw console.error("Erro ao atualizar ordens das imagens:",r),r}}},82006:(e,o,r)=>{r.d(o,{Y8:()=>n,e0:()=>c,g2:()=>l,lz:()=>i});var a=r(89379),t=r(52480);const s={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},n=async e=>{try{const{data:o,error:r}=await t.N.from("historias_professor").select("*").eq("escola_id",e).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(r)throw r;if(!o||0===o.length)return[];return o.map(e=>{if(e.imagem_url)try{const{data:{publicUrl:o}}=t.N.storage.from(s.BUCKET_NAME).getPublicUrl(e.imagem_url);return(0,a.A)((0,a.A)({},e),{},{imagem_public_url:o})}catch(o){return(0,a.A)((0,a.A)({},e),{},{imagem_public_url:null,urlError:o.message})}return e})}catch(o){throw console.error("Erro ao buscar hist\xf3rias do professor:",o),o}},i=async e=>{try{const{data:o,error:r}=await t.N.from("historias_professor").insert([{escola_id:e.escola_id,nome_professor:e.nome_professor||null,historia:e.historia,ordem:e.ordem||1,ativo:!1!==e.ativo,foto_rosto:e.foto_rosto||null}]).select().single();if(r)throw r;return o}catch(o){throw console.error("Erro ao criar hist\xf3ria do professor:",o),o}},c=async(e,o)=>{try{const{data:r,error:a}=await t.N.from("historias_professor").update({nome_professor:o.nome_professor,historia:o.historia,ordem:o.ordem,ativo:o.ativo,foto_rosto:o.foto_rosto||null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(a)throw a;return r}catch(r){throw console.error("Erro ao atualizar hist\xf3ria do professor:",r),r}},l=async e=>{try{const{error:o}=await t.N.from("historias_professor").delete().eq("id",e);if(o)throw o}catch(o){throw console.error("Erro ao deletar hist\xf3ria do professor:",o),o}}},85759:(e,o,r)=>{r.d(o,{MK:()=>n,Sv:()=>t,Y5:()=>i,dq:()=>s});var a=r(52480);async function t(e){const{data:o,error:r}=await a.N.from("titulos_videos").select("*").eq("escola_id",e).eq("ativo",!0).order("created_at",{ascending:!1});if(r)throw r;return o}async function s(e){const{data:o,error:r}=await a.N.from("titulos_videos").insert([e]).select();if(r)throw r;return null===o||void 0===o?void 0:o[0]}async function n(e,o){const{data:r,error:t}=await a.N.from("titulos_videos").update(o).eq("id",e).select();if(t)throw t;return null===r||void 0===r?void 0:r[0]}async function i(e){const{error:o}=await a.N.from("titulos_videos").delete().eq("id",e);if(o)throw o;return!0}}}]);
//# sourceMappingURL=966.e1eb046f.chunk.js.map