"use strict";(self.webpackChunkmapa_santos=self.webpackChunkmapa_santos||[]).push([[969],{7969:(e,a,t)=>{t.r(a),t.d(a,{default:()=>m});var s=t(2555),l=t(5043),o=t(2880),i=t(1504),r=t(3129),n=t(433),c=t(1833),d=t(7669),g=t(256),u=t(579);const m=e=>{let{location:a,onClose:t,onSave:m}=e;const[p,h]=(0,l.useState)((0,s.A)((0,s.A)({},a),{},{latitude:a.localizacao?a.localizacao.split(",")[0]:"",longitude:a.localizacao?a.localizacao.split(",")[1]:""})),[x,b]=(0,l.useState)(!1),[f,A]=(0,l.useState)(!1),[j,y]=(0,l.useState)({}),[v,N]=(0,l.useState)(!1),[w,k]=(0,l.useState)({selectedImages:[],imageUrls:[],uploadingImages:!1,uploadError:""}),[I,S]=(0,l.useState)({isRecording:!1,audioBlob:null,isPlaying:!1,uploadingAudio:!1});(0,l.useRef)(null),(0,l.useRef)([]),(0,l.useRef)(null);l.useEffect((()=>{if(a.imagens){const e=a.imagens.split(",").filter((e=>e));k((a=>(0,s.A)((0,s.A)({},a),{},{imageUrls:e})))}}),[a.imagens]);const U=async e=>{const a=Array.from(e.target.files);if(0===a.length)return;const t=a.filter((e=>{const a=["image/jpeg","image/png","image/jpg"].includes(e.type),t=e.size<=5242880;return a&&t}));t.length!==a.length&&k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:"Alguns arquivos foram ignorados. Use apenas imagens JPG/PNG at\xe9 5MB."}))),k((e=>(0,s.A)((0,s.A)({},e),{},{selectedImages:[...e.selectedImages,...t]}))),t.forEach((e=>{const a=new FileReader;a.onloadend=()=>{k((e=>(0,s.A)((0,s.A)({},e),{},{imageUrls:[...e.imageUrls,a.result]})))},a.readAsDataURL(e)}))},C=async()=>{if(0===w.selectedImages.length)return;k((e=>(0,s.A)((0,s.A)({},e),{},{uploadingImages:!0,uploadError:""})));const e=[];try{for(const t of w.selectedImages){const a=t.name.split(".").pop(),s="".concat(Math.random().toString(36).substring(2),".").concat(a),l="locations/".concat(s),{error:i}=await o.N.storage.from("media").upload(l,t);if(i)throw i;const{data:{publicUrl:r}}=o.N.storage.from("media").getPublicUrl(l);e.push(r)}const a=[...p.imagens?p.imagens.split(",").filter((e=>e)):[],...e];h((e=>(0,s.A)((0,s.A)({},e),{},{imagens:a.join(",")}))),k((e=>(0,s.A)((0,s.A)({},e),{},{selectedImages:[],imageUrls:a})))}catch(a){0,k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:"Erro ao fazer upload das imagens. Tente novamente."})))}finally{k((e=>(0,s.A)((0,s.A)({},e),{},{uploadingImages:!1})))}};return(0,u.jsx)("div",{className:"fixed top-16 right-0 sm:w-3/4 lg:w-[49%] bg-white rounded-xl shadow-lg z-[9999] text-gray-800",style:{height:"calc(100vh - 4rem)",maxHeight:"calc(100vh - 4rem)",display:"flex",flexDirection:"column"},children:(0,u.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,u.jsxs)("div",{className:"p-6",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Local"}),(0,u.jsx)("button",{onClick:t,className:"text-gray-600 hover:text-gray-900 text-lg","aria-label":"Fechar painel",children:"\u2716"})]}),(0,u.jsxs)("form",{className:"space-y-4",onSubmit:e=>{if(e.preventDefault(),(()=>{const e={};return p.titulo||(e.titulo="T\xedtulo \xe9 obrigat\xf3rio."),p.latitude&&p.longitude||(e.localizacao="Localiza\xe7\xe3o \xe9 obrigat\xf3ria."),p.descricao_detalhada||(e.descricao_detalhada="Descri\xe7\xe3o detalhada \xe9 obrigat\xf3ria."),y(e),0===Object.keys(e).length})()){const e=(0,s.A)((0,s.A)({},p),{},{imagens:p.imagens?p.imagens.split(",").map((e=>e.trim())).filter((e=>{try{return new URL(e),!0}catch(a){return!1}})).join(","):""});m(e),A(!0),setTimeout((()=>{A(!1)}),3e3)}},children:[(0,u.jsx)(r.A,{label:"T\xedtulo",id:"titulo",type:"text",value:p.titulo||"",onChange:e=>h((a=>(0,s.A)((0,s.A)({},a),{},{titulo:e.target.value}))),placeholder:"Digite o t\xedtulo do local",error:j.titulo}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("label",{className:"block font-medium text-gray-800",children:["Tipo de Marcador ",(0,u.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,u.jsxs)("div",{className:"relative",style:{zIndex:99999999},children:[(0,u.jsxs)("button",{type:"button",onClick:()=>b(!x),className:"w-full border rounded p-2 flex items-center justify-between text-gray-800 bg-white hover:bg-gray-50",children:[(0,u.jsx)("span",{children:p.tipo||"Selecione o tipo de marcador"}),(0,u.jsx)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),x&&(0,u.jsx)("div",{className:"absolute w-full bg-white border rounded shadow-lg",style:{top:"100%",left:0,zIndex:99999999,maxHeight:"300px",overflowY:"auto"},children:c.Q.map(((e,a)=>(0,u.jsxs)("button",{type:"button",onClick:()=>{return a=e.value,h((e=>(0,s.A)((0,s.A)({},e),{},{tipo:a}))),void b(!1);var a},className:"w-full text-left p-2 hover:bg-gray-50 flex items-center ".concat(e.cor," text-gray-800"),children:[e.icone.startsWith("http")?(0,u.jsx)("img",{src:e.icone,alt:e.label,className:"w-6 h-6 mr-2"}):(0,u.jsx)("span",{className:"mr-2",children:e.icone}),(0,u.jsx)("span",{children:e.label})]},a)))})]})]}),(0,u.jsx)(i.A,{newLocation:p,setNewLocation:h,error:j.localizacao,handleImageSelect:U,handleUploadImages:C,handleUploadAudio:async()=>{if(I.audioBlob){S((e=>(0,s.A)((0,s.A)({},e),{},{uploadingAudio:!0}))),k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:""})));try{const e="audio_".concat(Math.random().toString(36).substring(2),".wav"),a="audios/".concat(e),{error:t}=await o.N.storage.from("media").upload(a,I.audioBlob);if(t)throw t;const{data:{publicUrl:l}}=o.N.storage.from("media").getPublicUrl(a);h((e=>(0,s.A)((0,s.A)({},e),{},{audio:l}))),S((e=>(0,s.A)((0,s.A)({},e),{},{audioBlob:null,isPlaying:!1,uploadingAudio:!1})))}catch(e){0,k((e=>(0,s.A)((0,s.A)({},e),{},{uploadError:"Erro ao fazer upload do \xe1udio. Tente novamente."}))),S((e=>(0,s.A)((0,s.A)({},e),{},{uploadingAudio:!1})))}}},mediaState:w,audioState:I,setMediaState:k,setAudioState:S}),(0,u.jsx)("div",{className:"space-y-2",children:(0,u.jsx)(n.A,{value:p.descricao_detalhada,onChange:e=>h((a=>(0,s.A)((0,s.A)({},a),{},{descricao_detalhada:e}))),error:j.descricao_detalhada})}),(0,u.jsx)(r.A,{label:"Links",id:"links",type:"url",value:p.links||"",onChange:e=>h((a=>(0,s.A)((0,s.A)({},a),{},{links:e.target.value}))),placeholder:"Cole um link aqui (http://...)"}),(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsx)("label",{className:"block font-medium text-gray-800",children:"Imagens"}),(0,u.jsxs)("div",{className:"space-y-4",children:[w.imageUrls.length>0&&(0,u.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:w.imageUrls.map(((e,a)=>(0,u.jsxs)("div",{className:"relative group",children:[(0,u.jsx)("img",{src:e,alt:"Imagem ".concat(a+1),className:"w-full h-32 object-cover rounded-lg"}),(0,u.jsx)("button",{type:"button",onClick:()=>(e=>{const a=w.imageUrls.filter(((a,t)=>t!==e));k((e=>(0,s.A)((0,s.A)({},e),{},{imageUrls:a}))),h((e=>(0,s.A)((0,s.A)({},e),{},{imagens:a.join(",")})))})(a),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,u.jsx)(d.A,{className:"w-4 h-4"})})]},a)))}),(0,u.jsxs)("div",{className:"flex items-center gap-4",children:[(0,u.jsxs)("label",{className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg cursor-pointer hover:bg-blue-600 transition-colors",children:[(0,u.jsx)(g.A,{className:"w-4 h-4"}),(0,u.jsx)("span",{children:"Adicionar Imagens"}),(0,u.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:U})]}),w.selectedImages.length>0&&(0,u.jsx)("button",{type:"button",onClick:C,disabled:w.uploadingImages,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:bg-green-300",children:w.uploadingImages?"Enviando...":"Enviar Imagens"})]}),w.uploadError&&(0,u.jsx)("p",{className:"text-red-500 text-sm",children:w.uploadError})]})]}),(0,u.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,u.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-gray-800",disabled:v,children:"Cancelar"}),(0,u.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-green-300",disabled:v,children:v?"Salvando...":"Salvar"})]}),j.submit&&(0,u.jsx)("p",{className:"text-red-500 text-sm mt-2",children:j.submit}),f&&(0,u.jsx)("div",{className:"text-green-600 text-sm mt-2 animate-fade-in",children:"\u2714 Local atualizado com sucesso!"})]})]})})})}}}]);
//# sourceMappingURL=969.b803d951.chunk.js.map