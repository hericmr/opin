"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[992],{1564:(e,o,t)=>{t.r(o),t.d(o,{default:()=>D});var a=t(5043),r=t(9379),n=t(154),s=t(5351),l=t(6528),i=t(5366),c=t(495),d=t(6644),u=t(9468),p=t(2463),g=t(3241),m=t(3104),h=t(5921),f=t(5263),y=t(3361),x=t(1247),b=t(7790),v=t(1060),w=t(2861),M=t(3908),S=t(9333),C=t(9826);t(3976);const k={center:[-48.4129,-22.3794],zoom:7.63,maxZoom:18,minZoom:4,mobile:{center:[-48.5935,-21.9212],zoom:5},clusterDistance:30,proximityThreshold:5e-5,disableClusteringAtZoom:12,tooltipOffset:10};var O=t(9845);var E=t(579);C.A.defs("EPSG:4674","+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"),(0,S.kz)(C.A);const P=5e-5,L=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{borderColor:a=null,showShadow:r=!0,showGradient:n=!0,showGlow:s=!1,isNearbyPair:l=!1}=t,i=e,c=a||i,d=o/2,u=o/24,p=3*u,g=2*u,m="M".concat(d," ").concat(2*u,"C").concat(d-3.87*u," ").concat(2*u," ").concat(d-7*u," ").concat(5.13*u," ").concat(d-7*u," ").concat(9*u,"c0 ").concat(5.25*u," ").concat(7*u," ").concat(13*u," ").concat(7*u," ").concat(13*u,"s").concat(7*u," -").concat(7.75*u," ").concat(7*u," -").concat(13*u,"c0 -").concat(3.87*u," -").concat(3.13*u," -").concat(7*u," -").concat(7*u," -").concat(7*u,"z");return'\n    <svg width="'.concat(o,'" height="').concat(o,'" viewBox="0 0 ').concat(o," ").concat(o,'" xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        ').concat(r?'\n        <filter id="shadow-'.concat(o,'" x="-50%" y="-50%" width="200%" height="200%">\n          <feDropShadow dx="0" dy="').concat(2*u,'" stdDeviation="').concat(3*u,'" flood-color="rgba(0,0,0,0.3)"/>\n        </filter>\n        '):"","\n        ").concat(n?'\n        <linearGradient id="gradient-'.concat(o,'" x1="0%" y1="0%" x2="100%" y2="100%">\n          <stop offset="0%" style="stop-color:').concat(i,';stop-opacity:1" />\n          <stop offset="100%" style="stop-color:').concat(c,';stop-opacity:1" />\n        </linearGradient>\n        '):"","\n        ").concat(s?'\n        <filter id="glow-'.concat(o,'" x="-50%" y="-50%" width="200%" height="200%">\n          <feGaussianBlur stdDeviation="').concat(1*u,'" result="coloredBlur"/>\n          <feMerge> \n            <feMergeNode in="coloredBlur"/>\n            <feMergeNode in="SourceGraphic"/>\n          </feMerge>\n        </filter>\n        '):"","\n      </defs>\n      \n      \x3c!-- Brilho sutil de fundo --\x3e\n      ").concat(s?'\n      <circle cx="'.concat(d-2*u,'" cy="').concat(d-2*u,'" r="').concat(g,'" fill="white" opacity="0.2"/>\n      '):"",'\n      \n      \x3c!-- Marcador principal (gota invertida) --\x3e\n      <path d="').concat(m,'" \n            fill="').concat(n?"url(#gradient-".concat(o,")"):i,'" \n            ').concat(r?'filter="url(#shadow-'.concat(o,')"'):"","\n            ").concat(s?'filter="url(#glow-'.concat(o,')"'):"",'/>\n      \n      \x3c!-- C\xedrculo interno branco (bolinha) --\x3e\n      <circle cx="').concat(d,'" cy="').concat(9*u,'" r="').concat(p,'" fill="white" opacity="0.9"/>\n      \n      \x3c!-- Brilho sutil no c\xedrculo --\x3e\n      <circle cx="').concat(d-2*u,'" cy="').concat(7*u,'" r="').concat(.6*p,'" fill="white" opacity="0.4"/>\n      \n      \x3c!-- Indicador de par pr\xf3ximo (se aplic\xe1vel) --\x3e\n      ').concat(l?'\n      <circle cx="'.concat(o-4*u,'" cy="').concat(4*u,'" r="').concat(3*u,'" fill="#FF6B6B" opacity="0.8"/>\n      <text x="').concat(o-4*u,'" y="').concat(6*u,'" text-anchor="middle" font-size="').concat(8*u,'" fill="white" font-weight="bold">P</text>\n      '):"","\n    </svg>\n  ")},F=e=>{let{dataPoints:o=[],onPainelOpen:t,center:S=k.center,zoom:C=k.zoom,className:F="h-screen w-full",terrasIndigenasData:N=null,estadoSPData:T=null,showTerrasIndigenas:I=!0,showEstadoSP:j=!0,showMarcadores:A=!0,showNomesEscolas:z=!1}=e;console.log("OpenLayersMap - Debug zoom recebido:",{center:S,zoom:C,defaultCenter:k.center,defaultZoom:k.zoom,mobileZoom:k.mobile.zoom}),console.log("OpenLayersMap - onPainelOpen dispon\xedvel:",!!t),console.log("OpenLayersMap - Tipo do onPainelOpen:",typeof t),(0,a.useEffect)((()=>{if(t&&"function"===typeof t){console.log("OpenLayersMap: Testando fun\xe7\xe3o onPainelOpen...");const e={titulo:"TESTE - Escola Teste",id:999,tipo:"escola",latitude:-23.5505,longitude:-46.6333};console.log("OpenLayersMap: Chamando onPainelOpen com dados de teste:",e)}}),[t]);const D=(0,a.useRef)(null),_=(0,a.useRef)(null),G=(0,a.useRef)(null),R=(0,a.useRef)(null),B=(0,a.useRef)(null),Z=(0,a.useRef)(null),[W,U]=(0,a.useState)({lng:S[0],lat:S[1],zoom:C}),[J,q]=(0,a.useState)(C),[V,Y]=(0,a.useState)(!1),[H,X]=(0,a.useState)(!1),K=(0,a.useRef)(null),Q=(0,a.useRef)(null),$=(0,a.useRef)(new O.uy),[ee,oe]=(0,a.useState)(null),te=(0,a.useRef)(null),ae=(0,a.useCallback)((e=>{if(!_.current||!H)return;const o=_.current.getView(),t=o.getZoom(),a=Math.max(4,Math.min(18,e));if(Math.abs(a-t)<.01)return;const r=Math.abs(a-t),n=Math.min(300+50*r,800);o.animate({zoom:a,duration:n,easing:e=>1-Math.pow(1-e,3)})}),[H]),re=(0,a.useCallback)(((e,o)=>{let t;return function(){for(var a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];clearTimeout(t),t=setTimeout((()=>{clearTimeout(t),e(...r)}),o)}})((e=>{ae(e),Y(!1)}),100),[ae]),ne=(0,a.useCallback)((()=>({satelliteLayer:new l.A({source:new u.A({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:'\xa9 <a href="https://www.esri.com/">Esri</a>',maxZoom:19,wrapX:!1,tilePixelRatio:1,tileSize:256}),preload:1,useInterimTilesOnError:!1})})),[]),se=(0,a.useCallback)((e=>{try{const o=e.get("schoolData");if(!o)return console.log("OpenLayersMap: createMarkerStyle - feature sem schoolData"),null;console.log("OpenLayersMap: createMarkerStyle - criando estilo para:",o.titulo);const t="#3B82F6",a="#1E40AF",r=e.get("isNearbyPair"),n=(e.get("pairIndex"),L(t,24,{borderColor:a,showShadow:!0,showGradient:!0,showGlow:!1,isNearbyPair:r})),s="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n),l=new h.Ay({image:new f.A({src:s,scale:r?1.1:1,anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction"})});return z&&l.setText(new y.A({text:o.titulo||"Escola",font:"bold 10px Arial",fill:new x.A({color:"#FFFFFF"}),stroke:new b.A({color:"#000000",width:2}),offsetY:r?-35:-30,textAlign:"center",textBaseline:"middle"})),console.log("OpenLayersMap: createMarkerStyle - estilo criado com sucesso para:",o.titulo),l}catch(o){return console.error("OpenLayersMap: Erro ao criar estilo do marcador:",o),null}}),[z]),le=(0,a.useCallback)((e=>{try{const t=e.get("features");if(!t||0===t.length)return console.log("OpenLayersMap: createClusterStyle - feature sem features v\xe1lidas"),null;const a=t.length;if(console.log("OpenLayersMap: createClusterStyle - processando feature com",a,"features"),1===a){var o;const e=t[0];return e?(console.log("OpenLayersMap: createClusterStyle - retornando estilo individual para:",null===(o=e.get("schoolData"))||void 0===o?void 0:o.titulo),se(e)):(console.log("OpenLayersMap: createClusterStyle - singleFeature \xe9 null"),null)}let r="#3B82F6",n=32;a>100?(r="#1E40AF",n=40):a>50?(r="#2563EB",n=36):a>20?(r="#3B82F6",n=34):a>10&&(r="#60A5FA",n=33);const s=Math.min(1+.015*a,1.8),l=Math.round(n*s),i=L(r,l,{borderColor:r,showShadow:!0,showGradient:!0,showGlow:a>20,isNearbyPair:!1}),c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i);let d="12px",u="bold";return a>100?d="14px":a>50?d="13px":a>20&&(d="12px"),new h.Ay({image:new f.A({src:c,scale:1,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),text:new y.A({text:a.toString(),font:"".concat(u," ").concat(d," Arial"),fill:new x.A({color:"#FFFFFF"}),stroke:new b.A({color:"#000000",width:2}),offsetY:.6*l})})}catch(t){return console.error("OpenLayersMap: Erro ao criar estilo do cluster:",t),null}}),[se]),ie=(0,a.useCallback)((e=>e.titulo||"Escola Ind\xedgena"),[]),ce=(0,a.useCallback)(((e,o)=>{try{if(!(0,O.Fr)())return;console.log("OpenLayersMap: Mostrando tooltip mobile:",o),ee&&(ee.remove(),oe(null));const t=document.createElement("div");if(t.className="mobile-tooltip",t.innerHTML='\n        <div style="font-weight: bold; margin-bottom: 4px;">'.concat(o,'</div>\n        <div style="font-size: 12px; opacity: 0.8;">Toque novamente para abrir</div>\n      '),t.style.position="absolute",t.style.backgroundColor="rgba(0, 0, 0, 0.9)",t.style.color="white",t.style.padding="10px 14px",t.style.borderRadius="8px",t.style.fontSize="14px",t.style.fontFamily="Arial, sans-serif",t.style.fontWeight="500",t.style.maxWidth="280px",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.zIndex="1000",t.style.pointerEvents="none",t.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.4)",t.style.border="1px solid rgba(255, 255, 255, 0.2)",t.style.backdropFilter="blur(4px)",_.current&&e.coordinate){const o=e.coordinate,a=_.current.getPixelFromCoordinate(o);a&&D.current&&(t.style.left=a[0]+10+"px",t.style.top=a[1]-10+"px",D.current.appendChild(t),oe(t),setTimeout((()=>{t.parentNode&&(t.remove(),oe(null))}),3e3))}}catch(t){console.error("OpenLayersMap: Erro ao mostrar tooltip mobile:",t)}}),[ee]);return(0,a.useEffect)((()=>{if(_.current)return;G.current=new c.A,R.current=new d.A({distance:z?15:5,source:G.current,geometryFunction:e=>{const o=e.getGeometry();return"Point"===o.getType()?o:null}}),B.current=new i.A({source:R.current,style:le,zIndex:15,interactive:!0}),console.log("OpenLayersMap: Camada vetorial criada com interatividade ativada");const{satelliteLayer:e}=ne();Z.current=e,_.current=new n.A({target:D.current,layers:[Z.current,B.current],view:new s.Ay({center:(0,p.Rb)(S),zoom:C,maxZoom:18,minZoom:4}),controls:(0,v.N)(),interactions:(0,w.N)()}),console.log("OpenLayersMap: Mapa criado com intera\xe7\xf5es:",_.current.getInteractions().getLength(),"intera\xe7\xf5es ativas"),_.current.on("moveend",(()=>{const e=_.current.getView(),o=(0,p.WP)(e.getCenter()),t=e.getZoom(),a={lng:o[0].toFixed(4),lat:o[1].toFixed(4),zoom:t.toFixed(2)};if(U(a),!V&&H){const e=parseFloat(J);Math.abs(t-e)>.1&&q(t)}})),_.current.on("moveend",(()=>{B.current&&B.current.changed()})),_.current.on("click",(e=>{console.log("OpenLayersMap: Clique detectado no mapa"),console.log("OpenLayersMap: Pixel do clique:",e.pixel),console.log("OpenLayersMap: Coordenada do clique:",e.coordinate);const o=_.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(console.log("OpenLayersMap: Feature encontrada pelo forEachFeatureAtPixel:",!!o),o)if(o.get("features")){const e=o.get("features");if(console.log("OpenLayersMap: Cluster com",e.length,"features"),1===e.length){const o=e[0].get("schoolData");console.log("OpenLayersMap: Cluster com 1 marcador - schoolData:",!!o),o&&t&&t(o)}else{console.log("OpenLayersMap: Cluster clicado com ".concat(e.length," escolas"));const t=o.getGeometry().getExtent(),a=_.current.getView().getZoom();let r=12;r=e.length>20?10:e.length>10?11:e.length>5?12:13,r=Math.max(r,a+1),_.current.getView().fit(t,{duration:800,padding:[80,80,80,80],maxZoom:r,callback:()=>{console.log("OpenLayersMap: Zoom conclu\xeddo para cluster com ".concat(e.length," escolas"))}})}}else{const e=o.get("schoolData");console.log("OpenLayersMap: Marcador individual - schoolData:",!!e),e&&t&&t(e)}}));let o=null;_.current.on("pointermove",(e=>{o&&(o.remove(),o=null);const t=_.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(t)if(t.get("features")){const n=t.get("features");if(console.log("OpenLayersMap: Cluster com",n.length,"features"),1===n.length){const t=n[0].get("schoolData");console.log("OpenLayersMap: Cluster com 1 marcador - schoolData:",!!t),t&&(o=a(e,t))}else o=r(e,n.length)}else{const r=t.get("schoolData");console.log("OpenLayersMap: Marcador individual - schoolData:",!!r),r&&(o=a(e,r))}}));const a=(e,o)=>{const t=document.createElement("div");t.className="ol-tooltip",t.textContent=ie(o),t.style.position="absolute",t.style.backgroundColor="rgba(255, 255, 255, 0.95)",t.style.color="#374151",t.style.padding="8px 12px",t.style.borderRadius="8px",t.style.fontSize="13px",t.style.fontFamily="Arial, sans-serif",t.style.fontWeight="500",t.style.maxWidth="200px",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.zIndex="1000",t.style.pointerEvents="none",t.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",t.style.border="1px solid rgba(0, 0, 0, 0.1)",t.style.backdropFilter="blur(4px)";const a=e.coordinate,r=_.current.getPixelFromCoordinate(a);return t.style.left=r[0]+-100+"px",t.style.top=r[1]+-40+"px",D.current.appendChild(t),t},r=(e,o)=>{const t=document.createElement("div");t.className="ol-tooltip",t.textContent="".concat(o," escolas ind\xedgenas"),t.style.position="absolute",t.style.backgroundColor="rgba(255, 255, 255, 0.95)",t.style.color="#374151",t.style.padding="8px 12px",t.style.borderRadius="8px",t.style.fontSize="13px",t.style.fontFamily="Arial, sans-serif",t.style.fontWeight="500",t.style.maxWidth="200px",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.zIndex="1000",t.style.pointerEvents="none",t.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",t.style.border="1px solid rgba(0, 0, 0, 0.1)",t.style.backdropFilter="blur(4px)";const a=e.coordinate,r=_.current.getPixelFromCoordinate(a);return t.style.left=r[0]+-100+"px",t.style.top=r[1]+-40+"px",D.current.appendChild(t),t};return()=>{_.current&&(_.current.setTarget(void 0),_.current=null),o&&(o.remove(),oe(null)),o&&o.remove(),te.current&&(clearTimeout(te.current),te.current=null),$.current.reset()}}),[ne,le,ie,ce,t]),(0,a.useEffect)((()=>{const e=setTimeout((()=>{X(!0)}),500);return()=>clearTimeout(e)}),[]),(0,a.useEffect)((()=>{H||q(C)}),[C,H]),(0,a.useEffect)((()=>{if(!G.current||!o||!A)return;G.current.clear();const e=o.filter((e=>{if(!e.latitude||!e.longitude)return!1;const o=parseFloat(e.latitude),t=parseFloat(e.longitude);return!isNaN(o)&&!isNaN(t)&&o>=-90&&o<=90&&t>=-180&&t<=180})),t=(e=>{const o=[],t=new Set;for(let a=0;a<e.length;a++)if(!t.has(a))for(let r=a+1;r<e.length;r++){if(t.has(r))continue;const n=e[a],s=e[r],l=Math.abs(parseFloat(n.latitude)-parseFloat(s.latitude)),i=Math.abs(parseFloat(n.longitude)-parseFloat(s.longitude));if(l<P&&i<P){o.push([a,r]),t.add(a),t.add(r);break}}return o})(e);new Set(t.flat());if(console.log("OpenLayersMap: Processando ".concat(e.length," marcadores v\xe1lidos")),console.log("OpenLayersMap: Encontrados ".concat(t.length," pares pr\xf3ximos")),e.forEach(((e,o)=>{if(e.latitude&&e.longitude){const a=new m.A({geometry:new g.A((0,p.Rb)([e.longitude,e.latitude]))});a.set("schoolData",e);const n=t.findIndex((e=>e.includes(o)));a.set("isNearbyPair",-1!==n),a.set("pairIndex",-1!==n?n:null),G.current.addFeature(a),0===o&&console.log("OpenLayersMap: Primeiro marcador criado:",(0,r.A)((0,r.A)({},e),{},{feature:a,hasSchoolData:!!a.get("schoolData")}))}})),R.current){R.current.refresh();const e=R.current.getFeatures();console.log("OpenLayersMap: ClusterSource atualizado. Total de features no ClusterSource:",e.length)}console.log("OpenLayersMap: Adicionados ".concat(e.length," marcadores com clustering inteligente"));const a=G.current.getFeatures();console.log("OpenLayersMap: Total de features na fonte:",a.length),a.length>0&&console.log("OpenLayersMap: Primeira feature:",{hasGeometry:!!a[0].getGeometry(),hasSchoolData:!!a[0].get("schoolData"),schoolData:a[0].get("schoolData")});const n=R.current.getFeatures();var s;(console.log("OpenLayersMap: Total de features no ClusterSource:",n.length),n.length>0)&&console.log("OpenLayersMap: Primeira feature do cluster:",{hasFeatures:!!n[0].get("features"),featuresCount:(null===(s=n[0].get("features"))||void 0===s?void 0:s.length)||0,hasGeometry:!!n[0].getGeometry()})}),[o,A]),(0,a.useEffect)((()=>{B.current&&B.current.setStyle(le)}),[le]),(0,a.useEffect)((()=>{B.current&&(console.log("OpenLayersMap: Atualizando estilo dos marcadores - showNomesEscolas:",z),B.current.setStyle(le),B.current.changed())}),[z,le]),(0,a.useEffect)((()=>{_.current&&G.current&&(console.log("OpenLayersMap: Recriando ClusterSource - showNomesEscolas:",z),B.current&&_.current.removeLayer(B.current),R.current=new d.A({distance:z?15:10,source:G.current,geometryFunction:e=>{const o=e.getGeometry();return"Point"===o.getType()?o:null}}),B.current=new i.A({source:R.current,style:le,zIndex:15}),_.current.addLayer(B.current))}),[z,le]),(0,a.useEffect)((()=>{var e,o;if(_.current){if(console.log("OpenLayersMap: Gerenciando camadas GeoJSON:",{showTerrasIndigenas:I,showEstadoSP:j,terrasIndigenasData:!!N,estadoSPData:!!T,terrasFeatures:(null===N||void 0===N||null===(e=N.features)||void 0===e?void 0:e.length)||0,estadoFeatures:(null===T||void 0===T||null===(o=T.features)||void 0===o?void 0:o.length)||0,mapLayers:_.current.getLayers().getLength()}),K.current&&(_.current.removeLayer(K.current),K.current=null),Q.current&&(_.current.removeLayer(Q.current),Q.current=null),I&&N){var t,a;if(console.log("OpenLayersMap: Adicionando camada Terras Ind\xedgenas"),console.log("OpenLayersMap: Dados Terras Ind\xedgenas:",{type:N.type,features:(null===(t=N.features)||void 0===t?void 0:t.length)||0,crs:N.crs,firstFeature:null!==(a=N.features)&&void 0!==a&&a[0]?{type:N.features[0].type,properties:N.features[0].properties?Object.keys(N.features[0].properties):"Sem propriedades",geometry:N.features[0].geometry?{type:N.features[0].geometry.type,coordinates:N.features[0].geometry.coordinates?"".concat(N.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),!N.features||0===N.features.length)return void console.error("OpenLayersMap: Dados Terras Ind\xedgenas n\xe3o t\xeam features v\xe1lidas");const e=N.features[0];if(e.geometry&&e.geometry.coordinates){const o=e.geometry.coordinates[0][0];console.log("OpenLayersMap: Primeira coordenada das Terras Ind\xedgenas:",o),console.log("OpenLayersMap: Tipo das coordenadas:",typeof o[0],typeof o[1])}try{const e=new M.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).readFeatures(N);if(console.log("OpenLayersMap: Features lidas do GeoJSON:",e.length),e.length>0){const o=e[0],t=o.getGeometry();console.log("OpenLayersMap: Primeira feature processada:",{geometry:t?t.getType():"Sem geometria",extent:t?t.getExtent():"Sem extent",properties:o.getProperties()})}const o=new i.A({source:new c.A({features:e}),style:e=>{const o="Regularizada"===e.getProperties().fase_ti;return new h.Ay({fill:new x.A({color:o?"rgba(220, 20, 60, 0.3)":"rgba(139, 0, 0, 0.25)"}),stroke:new b.A({color:"#B22222",width:2,lineDash:[3,3]})})},zIndex:10});o.getSource().getFeatures().forEach((e=>{const o=e.getProperties();e.set("terraIndigenaInfo",{titulo:o.terrai_nom,tipo:"terra_indigena",etnia:o.etnia_nome,municipio:o.municipio_,uf:o.uf_sigla,superficie:o.superficie,fase:o.fase_ti,modalidade:o.modalidade,reestudo:o.reestudo_t,cr:o.cr,faixa_fron:o.faixa_fron,undadm_nom:o.undadm_nom,undadm_sig:o.undadm_sig,dominio_un:o.dominio_un,data_atual:o.data_atual,terrai_cod:o.terrai_cod,undadm_cod:o.undadm_cod})})),_.current.addLayer(o),K.current=o,console.log("OpenLayersMap: Camada Terras Ind\xedgenas adicionada com sucesso. Total de camadas:",_.current.getLayers().getLength())}catch(s){console.error("OpenLayersMap: Erro ao processar Terras Ind\xedgenas:",s)}}if(j&&T){var r,n;if(console.log("OpenLayersMap: Adicionando camada Estado SP"),console.log("OpenLayersMap: Dados Estado SP:",{type:T.type,features:(null===(r=T.features)||void 0===r?void 0:r.length)||0,crs:T.crs,firstFeature:null!==(n=T.features)&&void 0!==n&&n[0]?{type:T.features[0].type,properties:T.features[0].properties?Object.keys(T.features[0].properties):"Sem propriedades",geometry:T.features[0].geometry?{type:T.features[0].geometry.type,coordinates:T.features[0].geometry.coordinates?"".concat(T.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),!T.features||0===T.features.length)return void console.error("OpenLayersMap: Dados Estado SP n\xe3o t\xeam features v\xe1lidas");const e=T.features[0];if(e.geometry&&e.geometry.coordinates){const o=e.geometry.coordinates[0][0];console.log("OpenLayersMap: Primeira coordenada do Estado SP:",o),console.log("OpenLayersMap: Tipo das coordenadas Estado SP:",typeof o[0],typeof o[1])}try{const e=new M.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).readFeatures(T);if(console.log("OpenLayersMap: Features Estado SP lidas do GeoJSON:",e.length),e.length>0){const o=e[0],t=o.getGeometry();console.log("OpenLayersMap: Primeira feature Estado SP processada:",{geometry:t?t.getType():"Sem geometria",extent:t?t.getExtent():"Sem extent",properties:o.getProperties()})}const o=new i.A({source:new c.A({features:e}),style:new h.Ay({fill:new x.A({color:"rgba(0, 0, 0, 0.3)"}),stroke:new b.A({color:"#000000",width:2})}),zIndex:5,interactive:!1});_.current.addLayer(o),Q.current=o,console.log("OpenLayersMap: Camada Estado SP adicionada com sucesso. Total de camadas:",_.current.getLayers().getLength())}catch(s){console.error("OpenLayersMap: Erro ao processar Estado SP:",s)}}console.log("OpenLayersMap: Finaliza\xe7\xe3o - Total de camadas no mapa:",_.current.getLayers().getLength())}}),[I,j,N,T]),(0,a.useEffect)((()=>{if(!_.current)return;const e=e=>{const o=_.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(o){const e=o.get("terraIndigenaInfo");e&&t&&t(e)}};return _.current.on("click",e),()=>{_.current&&_.current.un("click",e)}}),[t]),(0,E.jsx)("div",{className:F,ref:D,children:(0,E.jsx)("div",{className:"absolute bottom-20 sm:bottom-4 left-4 z-10 bg-white bg-opacity-95 rounded-lg shadow-lg p-3",children:(0,E.jsxs)("div",{className:"flex flex-col items-center space-y-1",children:[(0,E.jsx)("button",{onClick:()=>{const e=Math.min(18,parseFloat(J)+1);q(e),Y(!0),ae(e)},className:"w-6 h-6 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 transition-colors duration-200 flex items-center justify-center text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom In",disabled:parseFloat(J)>=18,children:(0,E.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,E.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,E.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),(0,E.jsx)("div",{className:"relative",children:(0,E.jsx)("input",{type:"range",min:"4",max:"18",step:"0.1",value:J,onChange:e=>{const o=parseFloat(e.target.value);q(o),Y(!0),re(o)},onMouseDown:()=>Y(!0),onMouseUp:()=>{setTimeout((()=>Y(!1)),150)},onTouchStart:()=>Y(!0),onTouchEnd:()=>{setTimeout((()=>Y(!1)),150)},className:"h-16 w-1 bg-gray-200 rounded appearance-none cursor-pointer slider-vertical",style:{background:"linear-gradient(to bottom, #e5e7eb 0%, #e5e7eb ".concat(100-(J-4)/14*100,"%, #3b82f6 ").concat(100-(J-4)/14*100,"%, #3b82f6 100%)"),outline:"none",transition:"background 0.2s ease"}})}),(0,E.jsx)("button",{onClick:()=>{const e=Math.max(4,parseFloat(J)-1);q(e),Y(!0),ae(e)},className:"w-6 h-6 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 transition-colors duration-200 flex items-center justify-center text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom Out",disabled:parseFloat(J)<=4,children:(0,E.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,E.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})})]})})})},N={},T=e=>{const[o,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(!1),[s,l]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(!e)return;(async()=>{if(N[e])return console.log("useGeoJSONCache: Dados de ".concat(e," encontrados no cache")),void t(N[e]);n(!0);try{var o,a;const r="".concat("/escolasindigenas","/").concat(e,".geojson");console.log("useGeoJSONCache: Carregando ".concat(e," de:"),r);const n=await fetch(r);if(!n.ok)throw new Error("Erro ao buscar GeoJSON (".concat(n.status,")"));const s=await n.json();console.log("useGeoJSONCache: ".concat(e," carregado com sucesso:"),{type:s.type,features:(null===(o=s.features)||void 0===o?void 0:o.length)||0,crs:s.crs,firstFeature:null!==(a=s.features)&&void 0!==a&&a[0]?{type:s.features[0].type,properties:s.features[0].properties?Object.keys(s.features[0].properties):"Sem propriedades",geometry:s.features[0].geometry?{type:s.features[0].geometry.type,coordinates:s.features[0].geometry.coordinates?"".concat(s.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),N[e]=s,t(s)}catch(r){console.error("useGeoJSONCache: Erro ao carregar ".concat(e,":"),r),l(r)}finally{n(!1)}})()}),[e]),{data:o,loading:r,error:s}},I=e=>{let{dataPoints:o,onPainelOpen:t,className:r="h-screen w-full"}=e;const{data:n,loading:s,error:l}=T("terras_indigenas"),{data:i,loading:c,error:d}=T("SP"),[u,p]=(0,a.useState)(!0),[g,m]=(0,a.useState)(!0),[h,f]=(0,a.useState)(!0),[y,x]=(0,a.useState)(!1),[b,v]=(0,a.useState)(!1),w=(0,a.useCallback)((()=>{x(window.innerWidth<=768)}),[]);(0,a.useEffect)((()=>(w(),window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w)})),[w]);const M=(0,a.useCallback)((()=>v((e=>!e))),[]);(0,a.useEffect)((()=>{var e,o,t,a;console.log("MapSelector: Status das camadas GeoJSON:",{terrasIndigenas:{loading:s,error:l,hasData:!!n,features:(null===n||void 0===n||null===(e=n.features)||void 0===e?void 0:e.length)||0,type:null===n||void 0===n?void 0:n.type,firstFeature:null!==n&&void 0!==n&&null!==(o=n.features)&&void 0!==o&&o[0]?{type:n.features[0].type,properties:n.features[0].properties?Object.keys(n.features[0].properties):"Sem propriedades"}:"Nenhum feature"},estadoSP:{loading:c,error:d,hasData:!!i,features:(null===i||void 0===i||null===(t=i.features)||void 0===t?void 0:t.length)||0,type:null===i||void 0===i?void 0:i.type,firstFeature:null!==i&&void 0!==i&&null!==(a=i.features)&&void 0!==a&&a[0]?{type:i.features[0].type,properties:i.features[0].properties?Object.keys(i.features[0].properties):"Sem propriedades"}:"Nenhum feature"}})}),[n,i,s,c,l,d]);const S=e=>{let{onMinimize:o,isMobile:t,isMinimized:a}=e;return(0,E.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-white",children:[(0,E.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:"Camadas do Mapa"}),(0,E.jsx)("div",{className:"flex items-center gap-2",children:(0,E.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":a?"Expandir":"Minimizar",type:"button",children:a?"\u25be":"\u25b4"})})]})},C=e=>{let{id:o,label:t,checked:a,onChange:r,disabled:n=!1,loading:s=!1,error:l=!1,total:i,color:c,subItems:d=null}=e;return(0,E.jsxs)("button",{type:"button",onClick:r,disabled:n,className:"w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors ".concat(a?"bg-gray-50":"hover:bg-gray-50"," ").concat(n?"opacity-50 cursor-not-allowed":""),children:[d?(0,E.jsx)("div",{className:"flex flex-col gap-1",children:d.map(((e,o)=>(0,E.jsxs)("div",{className:"flex items-center gap-1",children:[(0,E.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),(0,E.jsx)("span",{className:"text-xs text-gray-600",children:e.label})]},o)))}):(0,E.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:c}}),(0,E.jsx)("span",{className:"text-sm text-gray-800",children:t}),void 0!==i&&(0,E.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",i,")"]}),s&&(0,E.jsx)("span",{className:"text-blue-500 ml-1",children:"(carregando...)"}),l&&(0,E.jsx)("span",{className:"text-red-500 ml-1",children:"(erro)"}),d?(0,E.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full bg-gray-300"}):(0,E.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full",style:{backgroundColor:c}})]})},O=y?k.mobile.center:k.center,P=y?k.mobile.zoom:k.zoom;return console.log("MapSelector - Debug zoom:",{isMobile:y,mobileZoom:k.mobile.zoom,desktopZoom:k.zoom,selectedZoom:P,mobileCenter:k.mobile.center,desktopCenter:k.center,selectedCenter:O}),console.log("MapSelector - onPainelOpen dispon\xedvel:",!!t),console.log("MapSelector - Tipo do onPainelOpen:",typeof t),(0,E.jsxs)("div",{className:r,style:{position:"relative"},children:[y?(0,E.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,E.jsxs)("div",{className:"bg-white border-t border-gray-100 shadow-lg",children:[(0,E.jsx)(S,{onMinimize:M,isMobile:!0,isMinimized:b}),!b&&(0,E.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-60 overflow-y-auto",children:[(0,E.jsx)(C,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:g,onChange:()=>m(!g),loading:c,error:d,color:"#10B981"}),(0,E.jsx)(C,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:h,onChange:()=>f(!h),total:null===o||void 0===o?void 0:o.length,color:"#3B82F6"}),(0,E.jsx)(C,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:u,onChange:()=>p(!u),loading:s,error:l,subItems:[{label:"Regularizadas",color:"#DC143C"},{label:"Declaradas",color:"#8B0000"}]})]})]})}):(0,E.jsxs)("div",{className:"fixed top-24 right-4 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:[(0,E.jsx)(S,{onMinimize:M,isMobile:!1,isMinimized:b}),!b&&(0,E.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-96 overflow-y-auto",children:[(0,E.jsx)(C,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:g,onChange:()=>m(!g),loading:c,error:d,color:"#10B981"}),(0,E.jsx)(C,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:h,onChange:()=>f(!h),total:null===o||void 0===o?void 0:o.length,color:"#3B82F6"}),(0,E.jsx)(C,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:u,onChange:()=>p(!u),loading:s,error:l,subItems:[{label:"Regularizadas",color:"#DC143C"},{label:"Declaradas",color:"#8B0000"}]})]})]}),(0,E.jsx)(F,{dataPoints:h?o:[],onPainelOpen:t,className:"h-full w-full",center:O,zoom:P,terrasIndigenasData:n,estadoSPData:i,showTerrasIndigenas:u,showEstadoSP:g,showMarcadores:h})]})};var j=t(8990),A=t(6799),z=t(3303);const D=e=>{let{dataPoints:o,onPainelOpen:t}=e;console.log("DataPoints recebidos no MapaEscolasIndigenas:",o?{quantidade:o.length,exemplo:o[0]?{titulo:o[0].titulo,latitude:o[0].latitude,longitude:o[0].longitude,tipo:o[0].tipo}:"Nenhum ponto"}:"Nenhum dataPoint");const{refreshKey:r}=(0,z.b)(),n=(0,a.useMemo)((()=>new URLSearchParams(window.location.search)),[]).get("panel"),s=(0,a.useMemo)((()=>{if(n&&""!==n&&o&&o.length>0){return o.find((e=>(0,A.N)(e.titulo)===n))||null}return null}),[n,o]),[l,i]=(0,a.useState)(s),c=(0,a.useMemo)((()=>o?o.filter((e=>e.pontuacao>=0)):[]),[o]),d=(0,a.useMemo)((()=>c.length),[c]);(0,a.useEffect)((()=>{console.group("MapaEscolasIndigenas - painelInfo state changed"),console.log("Novo valor de painelInfo:",{titulo:null===l||void 0===l?void 0:l.titulo,tipo:null===l||void 0===l?void 0:l.tipo,hasLink:!(null===l||void 0===l||!l.link_para_documentos),linkValue:null===l||void 0===l?void 0:l.link_para_documentos,isInitialPanel:l===s,isNull:null===l,isUndefined:void 0===l}),console.groupEnd()}),[l,s]);const u=(0,a.useCallback)((e=>{console.log("MapaEscolasIndigenas: abrirPainel chamado com:",{info:e,titulo:null===e||void 0===e?void 0:e.titulo,tipo:null===e||void 0===e?void 0:e.tipo,id:null===e||void 0===e?void 0:e.id,isNull:null===e,isUndefined:void 0===e}),e?(console.log("MapaEscolasIndigenas: Definindo painelInfo como:",e),i(e)):console.warn("MapaEscolasIndigenas: abrirPainel recebeu info null/undefined")}),[]),p=(0,a.useCallback)((()=>{console.log("For\xe7ando refresh do painel de informa\xe7\xf5es")}),[]);(0,a.useEffect)((()=>{console.log("MapaEscolasIndigenas: onPainelOpen dispon\xedvel:",!!t),console.log("MapaEscolasIndigenas: abrirPainel dispon\xedvel:",!!u),t&&"function"===typeof t&&(console.log("MapaEscolasIndigenas: Expondo fun\xe7\xe3o abrirPainel e refreshPainel"),t(u,p))}),[u,t,p]);const g=(0,a.useCallback)((()=>{i(null)}),[]);return(0,E.jsxs)("div",{className:"relative h-screen w-full overflow-hidden",children:[(0,E.jsx)(I,{dataPoints:c,onPainelOpen:u,className:"h-full w-full"}),l&&(0,E.jsxs)(E.Fragment,{children:[console.log("MapaEscolasIndigenas - Renderizando PainelInformacoes com:",{painelInfo:l,hasLink:null===l||void 0===l?void 0:l.link_para_documentos,linkValue:null===l||void 0===l?void 0:l.link_para_documentos}),(0,E.jsx)(j.A,{painelInfo:l,closePainel:g,refreshKey:r})]}),(0,E.jsxs)("div",{className:"absolute top-20 left-4 z-30 bg-white bg-opacity-95 rounded-lg shadow-lg p-3",children:[(0,E.jsxs)("div",{className:"text-sm font-semibold text-gray-800",children:["Escolas Ind\xedgenas: ",d]}),(0,E.jsx)("div",{className:"text-xs text-gray-600",children:"Mapa otimizado sem gaps"})]})]})}},9845:(e,o,t)=>{t.d(o,{Fr:()=>a,uy:()=>r});const a=()=>{const e=navigator.userAgent||navigator.vendor||window.opera,o=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase()),t=window.innerWidth<=768,a="ontouchstart"in window||navigator.maxTouchPoints>0;return console.log("Mobile detection:",{userAgent:e,isMobileUserAgent:o,isMobileScreen:t,isTouchDevice:a,windowWidth:window.innerWidth,windowHeight:window.innerHeight}),o||t||a};class r{constructor(){this.lastClickedFeature=null,this.clickTimeout=null,this.clickDelay=500,this.lastClickTime=0}handleClick(e,o,t){const r=Date.now(),n=a();if(console.log("MobileInteractionManager: handleClick chamado",{isMobile:n,feature:e?"presente":"ausente",lastClickedFeature:this.lastClickedFeature?"presente":"ausente",timeSinceLastClick:r-this.lastClickTime,clickDelay:this.clickDelay}),!n)return console.log("MobileInteractionManager: Desktop - executando a\xe7\xe3o direta"),void t(e);this.lastClickedFeature===e&&r-this.lastClickTime<this.clickDelay?(console.log("MobileInteractionManager: Segundo clique detectado - executando a\xe7\xe3o"),this.clearTimeout(),this.lastClickedFeature=null,this.lastClickTime=0,t(e)):(console.log("MobileInteractionManager: Primeiro clique detectado"),this.lastClickedFeature&&this.clearTimeout(),this.lastClickedFeature=e,this.lastClickTime=r,o(e),this.clickTimeout=setTimeout((()=>{console.log("MobileInteractionManager: Timeout expirado - limpando primeiro clique"),this.lastClickedFeature=null,this.lastClickTime=0}),this.clickDelay))}clearTimeout(){this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null)}reset(){console.log("MobileInteractionManager: Reset chamado"),this.clearTimeout(),this.lastClickedFeature=null,this.lastClickTime=0}}}}]);
//# sourceMappingURL=992.76e840a6.chunk.js.map