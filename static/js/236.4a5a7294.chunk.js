"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[236],{40237:(e,o,a)=>{a.d(o,{eP:()=>n,iy:()=>t,jW:()=>c,qP:()=>s,s7:()=>u,t$:()=>i,w_:()=>l});var r=a(52480);const t=async()=>{try{const{error:e}=await r.N.from("legendas_fotos").select("count").limit(1);return e?(console.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(console.log("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return console.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},s=async function(e,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let t=r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o);!1!==a.ativo&&(t=t.eq("ativo",!0)),a.categoria&&(t=t.eq("categoria",a.categoria)),a.tipo_foto&&(t=t.eq("tipo_foto",a.tipo_foto));const{data:s,error:i}=await t.order("created_at",{ascending:!1});return i?(console.warn("Erro ao buscar legenda:",i.message),null):s&&s.length>0?s[0]:null}catch(t){return console.warn("Erro ao buscar legenda:",t.message),null}},i=async function(e,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(console.log("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(o,")")),a.categoria||a.tipo_foto){console.log("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const r=await s(e,o,a);if(r)return console.log("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),r}console.log("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:t,error:i}=await r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).eq("ativo",!0).order("created_at",{ascending:!1});if(i)console.warn("  \u274c Erro na busca por URL e escola:",i.message);else if(t&&t.length>0)return console.log("  \u2705 Encontrada por URL e escola"),t[0];console.log("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:n,error:l}=await r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).order("created_at",{ascending:!1});if(l)console.warn("  \u274c Erro na busca incluindo inativas:",l.message);else if(n&&n.length>0)return console.log("  \u2705 Encontrada incluindo legendas inativas"),n[0];const c=e.split("/").pop();console.log("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(c));const{data:d,error:u}=await r.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(c)).eq("escola_id",o).eq("ativo",!0).order("created_at",{ascending:!1});if(u)console.warn("  \u274c Erro na busca por nome do arquivo:",u.message);else if(d&&d.length>0)return console.log("  \u2705 Encontrada por nome do arquivo"),d[0];return console.log("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(t){return console.warn("Erro ao buscar legenda flex\xedvel:",t.message),null}},n=async e=>{try{const{data:o,error:a}=await r.N.from("legendas_fotos").insert([e]).select().single();if(a)throw a;return o}catch(o){throw console.error("Erro ao adicionar legenda:",o),o}},l=async(e,o)=>{try{const{data:a,error:t}=await r.N.from("legendas_fotos").update(o).eq("id",e).select().single();if(t)throw t;return a}catch(a){throw console.error("Erro ao atualizar legenda:",a),a}},c=async(e,o)=>{try{const{data:a,error:t}=await r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).eq("categoria","video").single();if(t){if("PGRST116"===t.code)return null;throw t}return a}catch(a){return console.warn("Erro ao buscar t\xedtulo do v\xeddeo:",a.message),null}},d=async(e,o,a)=>{try{const t=await s(e,o,{ativo:!1});if(t){const{data:e,error:o}=await r.N.from("legendas_fotos").update({ordem:a,updated_at:(new Date).toISOString()}).eq("id",t.id).select().single();if(o)throw o;return e}{const t=(e.split("/").pop()||"Imagem").replace(/\.[^/.]+$/,"").replace(/[_-]/g," ")||"Imagem",{data:s,error:i}=await r.N.from("legendas_fotos").insert([{escola_id:o,imagem_url:e,legenda:t,ordem:a,ativo:!0,tipo_foto:"escola",categoria:"geral",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(i)throw i;return s}}catch(t){throw console.error("Erro ao atualizar ordem da imagem:",t),t}},u=async(e,o)=>{try{return await Promise.all(e.map(e=>{let{imageUrl:a,ordem:r}=e;return d(a,o,r)}))}catch(a){throw console.error("Erro ao atualizar ordens das imagens:",a),a}}},57367:(e,o,a)=>{a.d(o,{LQ:()=>r,Rf:()=>s,gD:()=>t});const r=[{id:"basicInfo",label:"Informa\xe7\xf5es B\xe1sicas",description:"Nome, munic\xedpio, endere\xe7o, terra ind\xedgena",defaultVisible:!0,category:"grid"},{id:"modalidades",label:"Modalidades de Ensino",description:"Modalidades e turnos de funcionamento",defaultVisible:!0,category:"grid"},{id:"infraestrutura",label:"Infraestrutura",description:"Estrutura f\xedsica, \xe1gua, internet, equipamentos",defaultVisible:!0,category:"grid"},{id:"gestaoProfessores",label:"Gest\xe3o e Professores",description:"Dire\xe7\xe3o, professores, forma\xe7\xe3o profissional",defaultVisible:!0,category:"grid"},{id:"projetosParcerias",label:"Projetos e Parcerias",description:"Projetos, parcerias, ONGs, desejos da comunidade",defaultVisible:!0,category:"grid"},{id:"historiaEscola",label:"Hist\xf3ria da Escola",description:"Hist\xf3ria e contexto da escola",defaultVisible:!0,category:"standalone"},{id:"imagensEscola",label:"Imagens da Escola",description:"Galeria de fotos da escola",defaultVisible:!0,category:"standalone"},{id:"historiaProfessor",label:"Hist\xf3ria dos Professores",description:"Depoimentos e hist\xf3rias dos professores",defaultVisible:!0,category:"standalone"},{id:"documentos",label:"Documentos",description:"PDFs e documentos da escola",defaultVisible:!0,category:"standalone"},{id:"videos",label:"V\xeddeos",description:"V\xeddeos e produ\xe7\xf5es audiovisuais",defaultVisible:!0,category:"standalone"}],t=()=>r.reduce((e,o)=>(e[o.id]=o.defaultVisible,e),{}),s=function(e,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e&&e.hasOwnProperty(o)?!1!==e[o]:!a||!a.hasOwnProperty(o)||!1!==a[o]}},82006:(e,o,a)=>{a.d(o,{Y8:()=>i,e0:()=>l,g2:()=>c,lz:()=>n});var r=a(89379),t=a(52480);const s={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},i=async e=>{try{const{data:o,error:a}=await t.N.from("historias_professor").select("*").eq("escola_id",e).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(a)throw a;if(!o||0===o.length)return[];return o.map(e=>{if(e.imagem_url)try{const{data:{publicUrl:o}}=t.N.storage.from(s.BUCKET_NAME).getPublicUrl(e.imagem_url);return(0,r.A)((0,r.A)({},e),{},{imagem_public_url:o})}catch(o){return(0,r.A)((0,r.A)({},e),{},{imagem_public_url:null,urlError:o.message})}return e})}catch(o){throw console.error("Erro ao buscar hist\xf3rias do professor:",o),o}},n=async e=>{try{const{data:o,error:a}=await t.N.from("historias_professor").insert([{escola_id:e.escola_id,nome_professor:e.nome_professor||null,historia:e.historia,ordem:e.ordem||1,ativo:!1!==e.ativo,foto_rosto:e.foto_rosto||null}]).select().single();if(a)throw a;return o}catch(o){throw console.error("Erro ao criar hist\xf3ria do professor:",o),o}},l=async(e,o)=>{try{const{data:a,error:r}=await t.N.from("historias_professor").update({nome_professor:o.nome_professor,historia:o.historia,ordem:o.ordem,ativo:o.ativo,foto_rosto:o.foto_rosto||null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(r)throw r;return a}catch(a){throw console.error("Erro ao atualizar hist\xf3ria do professor:",a),a}},c=async e=>{try{const{error:o}=await t.N.from("historias_professor").delete().eq("id",e);if(o)throw o}catch(o){throw console.error("Erro ao deletar hist\xf3ria do professor:",o),o}}},85759:(e,o,a)=>{a.d(o,{MK:()=>i,Sv:()=>t,Y5:()=>n,dq:()=>s});var r=a(52480);async function t(e){const{data:o,error:a}=await r.N.from("titulos_videos").select("*").eq("escola_id",e).eq("ativo",!0).order("created_at",{ascending:!1});if(a)throw a;return o}async function s(e){const{data:o,error:a}=await r.N.from("titulos_videos").insert([e]).select();if(a)throw a;return null===o||void 0===o?void 0:o[0]}async function i(e,o){const{data:a,error:t}=await r.N.from("titulos_videos").update(o).eq("id",e).select();if(t)throw t;return null===a||void 0===a?void 0:a[0]}async function n(e){const{error:o}=await r.N.from("titulos_videos").delete().eq("id",e);if(o)throw o;return!0}},94309:(e,o,a)=>{a.d(o,{B:()=>t});var r=a(52480);class t{static async getGlobalCardsVisibility(){try{const{data:e,error:o}=await r.N.from("configuracao_global").select("valor").eq("chave","cards_visibilidade_global").single();if(o){if("PGRST116"===o.code)return null;throw o}return(null===e||void 0===e?void 0:e.valor)||null}catch(e){return console.error("Erro ao buscar configura\xe7\xe3o global de visibilidade:",e),null}}static async saveGlobalCardsVisibility(e){try{const{data:o,error:a}=await r.N.from("configuracao_global").upsert({chave:"cards_visibilidade_global",valor:e,descricao:"Configura\xe7\xe3o padr\xe3o de visibilidade de cards para todas as escolas",updated_at:(new Date).toISOString()},{onConflict:"chave"}).select().single();if(a)throw a;return{success:!0,data:o}}catch(o){return console.error("Erro ao salvar configura\xe7\xe3o global de visibilidade:",o),{success:!1,error:o.message||"Erro ao salvar configura\xe7\xe3o global"}}}}},98137:(e,o,a)=>{a.d(o,{V:()=>s});var r=a(65043),t=a(94309);const s=()=>{const[e,o]=(0,r.useState)(null),[a,s]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{s(!0);const e=await t.B.getGlobalCardsVisibility();o(e)}catch(e){console.error("Erro ao carregar configura\xe7\xe3o global:",e),o(null)}finally{s(!1)}})()},[]),{globalVisibility:e,loading:a}}}}]);
//# sourceMappingURL=236.4a5a7294.chunk.js.map