"use strict";(self.webpackChunkmapa_santos=self.webpackChunkmapa_santos||[]).push([[491],{428:(e,t,o)=>{o.r(t),o.d(t,{default:()=>d});var n=o(5043),a=o(9896),r=o(6679),l=o(228),s=o.n(l),i=(o(4260),o(5632),o(1845),o(4128));const c=5e-5,d=e=>{let{dataPoints:t,visibility:o,onClick:l}=e;const d=(0,a.ko)(),u=(0,n.useRef)(null),p=(0,n.useRef)([]),g=(0,n.useMemo)((()=>s().Browser.mobile),[]),m=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useCallback)((()=>{h.current&&(clearTimeout(h.current),h.current=null)}),[]),x=(0,n.useCallback)(((e,t,o)=>{g&&(o.originalEvent.stopPropagation(),m.current===e?(f(),e.closeTooltip(),null===l||void 0===l||l(t),m.current=null):(m.current&&m.current.closeTooltip(),m.current=e,e.openTooltip(),f(),h.current=setTimeout((()=>{e.closeTooltip(),m.current=null}),2e3)))}),[g,l,f]),b=n.useMemo((()=>{if(!Array.isArray(t)||0===t.length)return console.warn("Marcadores: Nenhum ponto de dados recebido"),[];console.log("Total de escolas recebidas:",t.length);const e=[],o=t.filter((t=>{if(!t.titulo||!t.latitude||!t.longitude)return e.push({escola:t.titulo||"Sem nome",problema:"Dados b\xe1sicos ausentes",detalhes:{titulo:!!t.titulo,latitude:!!t.latitude,longitude:!!t.longitude}}),!1;const o=parseFloat(t.latitude),n=parseFloat(t.longitude);return isNaN(o)||isNaN(n)?(e.push({escola:t.titulo,problema:"Coordenadas n\xe3o s\xe3o n\xfameros v\xe1lidos",detalhes:{latitude:t.latitude,longitude:t.longitude}}),!1):!(o<-90||o>90||n<-180||n>180)||(e.push({escola:t.titulo,problema:"Coordenadas fora dos limites v\xe1lidos",detalhes:{latitude:o,longitude:n,limites:{latMin:-90,latMax:90,lngMin:-180,lngMax:180}}}),!1)}));return e.length>0&&(console.group("Escolas com coordenadas inv\xe1lidas:"),e.forEach((e=>{console.group(e.escola),console.log("Problema:",e.problema),console.log("Detalhes:",e.detalhes),console.groupEnd()})),console.groupEnd(),console.log("Total de escolas com problemas: ".concat(e.length))),console.log("Escolas v\xe1lidas: ".concat(o.length," de ").concat(t.length)),o}),[t]),y=r.rI,v=(0,n.useCallback)((e=>'\n      <div class="bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100 text-left w-full hover:text-violet-700 focus:text-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-opacity-50 transition-colors duration-200">\n        <button \n          onclick="event.stopPropagation(); window.dispatchEvent(new CustomEvent(\'marker-click\', { detail: '.concat(JSON.stringify(e),' }));"\n          aria-label="Ver detalhes da escola ').concat((0,i.k)(e.titulo),'"\n          class="w-full text-left"\n        >\n          <strong>').concat((0,i.k)(e.titulo),"</strong>\n          ").concat(e.etnia?'<div class="mt-1 text-xs text-gray-600">Etnia: '.concat(e.etnia,"</div>"):"","\n        </button>\n      </div>\n    ")),[]);return(0,n.useEffect)((()=>{if(!Array.isArray(t)||0===t.length)return void console.warn("Marcadores: Nenhum ponto de dados v\xe1lido recebido");if(!d||!b.length||!o.educacao)return;u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[],m.current=null,f();const e=(e=>{const t=[],o=new Set;for(let n=0;n<e.length;n++)if(!o.has(n))for(let a=n+1;a<e.length;a++){if(o.has(a))continue;const r=e[n],l=e[a],s=Math.abs(parseFloat(r.latitude)-parseFloat(l.latitude)),i=Math.abs(parseFloat(r.longitude)-parseFloat(l.longitude));if(s<c&&i<c){t.push([n,a]),o.add(n),o.add(a);break}}return t})(b),n=(new Set(e.flat()),new(s().MarkerClusterGroup)({chunkedLoading:!0,maxClusterRadius:4,spiderfyOnMaxZoom:!0,showCoverageOnHover:!g,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0,disableClusteringAtZoom:12,minZoom:4,maxZoom:18,iconCreateFunction:function(e){const t=e.getChildCount();let o="small",n="#A0522D";t>100?(o="large",n="#4B2E14"):t>20&&(o="medium",n="#8B5A2B");const a=r.rI.options.iconUrl,l=r.rI.options.iconSize||[44,44];return e.bindTooltip('\n          <div class="bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100">\n            <strong>'.concat(t," escola").concat(t>1?"s":""," ind\xedgena").concat(t>1?"s":"",'</strong>\n            <br/>\n            <span class="text-xs text-gray-600">Clique para expandir</span>\n          </div>\n        '),{className:"cluster-tooltip",direction:"top",offset:[0,-10],opacity:1,permanent:!1,sticky:!g}),s().divIcon({html:'\n            <div \n              role="button"\n              tabindex="0"\n              aria-label="Grupo de '.concat(t,' escolas ind\xedgenas. Clique para expandir."\n              style="\n              background: radial-gradient(circle at 30% 30%, ').concat(n,", #3b2e2a);\n              color: ").concat("#fff",";\n              border-radius: 50%;\n                width: ").concat(l[0],"px;\n                height: ").concat(l[1],'px;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              font-weight: bold;\n              border: 2px solid #f5f5dc;\n              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n                transition: transform 0.3s ease, box-shadow 0.3s ease;\n              padding: 2px;\n                cursor: pointer;\n              "\n            >\n              <img \n                src="').concat(a,'" \n                width="').concat(.6*l[0],'" \n                height="').concat(.6*l[1],'" \n                style="margin-bottom: 2px;"\n                alt=""\n                aria-hidden="true"\n              />\n              <span \n                style="\n                font-size: ').concat("large"===o?"16px":"medium"===o?"14px":"12px",';\n                "\n              >').concat(t,"</span>\n            </div>"),className:"marker-cluster marker-cluster-".concat(o),iconSize:s().point(l[0],l[1])})},animateAddingMarkers:!0,spiderLegPolylineOptions:{weight:1.3,color:"#5C4033",opacity:.5,dashArray:"2,4"},chunkInterval:g?100:200,chunkDelay:g?25:50,singleMarkerMode:!1,spiderfyDistanceMultiplier:g?2:1.5,polygonOptions:{fillColor:"#A0522D",color:"#5C4033",weight:1.2,opacity:.6,fillOpacity:.2}}));n.on("clusterclick",(function(e){const t=e.layer,o=t.getAllChildMarkers();if(d.getZoom()>=t.options.disableClusteringAtZoom){const e=s().tooltip({className:"cluster-expand-tooltip",direction:"center",permanent:!0,opacity:.9}).setContent('\n          <div class="bg-white/95 text-gray-800 text-sm font-medium px-3 py-1.5 rounded shadow-sm border border-gray-100">\n            <strong>Expandindo '.concat(o.length," escola").concat(o.length>1?"s":"",'</strong>\n            <br/>\n            <span class="text-xs text-gray-600">Toque em um marcador para ver detalhes</span>\n          </div>\n        ')).setLatLng(t.getLatLng());e.addTo(d),setTimeout((()=>e.remove()),2e3)}})),b.forEach(((t,o)=>{const a=parseFloat(t.latitude),r=parseFloat(t.longitude),c=s().marker([a,r],{icon:y,zIndexOffset:1e3,keyboard:!0,alt:"Marcador para ".concat((0,i.k)(t.titulo)),riseOnHover:!0,interactive:!0,tooltip:null});c.unbindTooltip(),c.bindTooltip(v(t),{className:"custom-tooltip",direction:"top",offset:[0,-10],opacity:1,permanent:!1,sticky:!g,interactive:!0,tooltip:null}),g?c.on("click",(e=>x(c,t,e))):c.on("click",(()=>null===l||void 0===l?void 0:l(t)));const u=e.findIndex((e=>e.includes(o)));if(-1!==u){const[t,n]=e[u],l=o===t,i=b[l?n:t];g||c.on("add",(function(){const e=l?"perspective(500px) rotateY(-20deg) translateX(-20px) rotate(-25deg) scale(0.9)":"perspective(500px) rotateY(20deg) translateX(20px) rotate(25deg) scale(0.9)";this._icon.style.transform=e,this._icon.style.transition="transform 0.5s ease-out, filter 0.3s ease-in",this._icon.style.filter="drop-shadow(0 4px 12px rgba(160, 82, 45, 0.35))",this._icon.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.35)"}));const m=((e,t,o,n,a)=>s().polyline([[t,o],[n,a]],{color:"#A0522D",weight:1.2,dashArray:"3,3",opacity:.6,className:"marker-connector"}).addTo(e))(d,a,r,parseFloat(i.latitude),parseFloat(i.longitude));p.current.push(m)}n.addLayer(c)})),d.addLayer(n),u.current=n;const a=e=>{const t=e.detail;null===l||void 0===l||l(t)};return window.addEventListener("marker-click",a),()=>{window.removeEventListener("marker-click",a),u.current&&d.removeLayer(u.current),p.current.forEach((e=>d.removeLayer(e))),p.current=[],f(),m.current=null}}),[d,b,l,y,o.educacao,t,g,v,x,f]),null}}}]);
//# sourceMappingURL=491.39958cea.chunk.js.map