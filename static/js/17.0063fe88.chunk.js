/*! For license information please see 17.0063fe88.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[17],{1440:(e,a,s)=>{s.d(a,{BZ:()=>u,Gw:()=>c,gE:()=>n,vS:()=>d,vx:()=>g,wG:()=>i});var o=s(2880);const r={BUCKET_NAME:"imagens-das-escolas",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_SCHOOL:10,MIN_DIMENSIONS:{width:200,height:200}},t={BUCKET_NAME:"imagens-professores",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_SCHOOL:5,MIN_DIMENSIONS:{width:200,height:200}},l=(e,a)=>{if(!a.ALLOWED_TYPES.includes(e.type))return{isValid:!1,error:"Tipo de arquivo n\xe3o suportado. Use apenas: ".concat(a.ALLOWED_TYPES.map((e=>e.split("/")[1].toUpperCase())).join(", "))};if(e.size>a.MAX_FILE_SIZE)return{isValid:!1,error:"Arquivo muito grande. Tamanho m\xe1ximo: ".concat(a.MAX_FILE_SIZE/1048576,"MB")};const s=e.name.split(".").pop().toLowerCase(),o=a.ALLOWED_TYPES.map((e=>e.split("/")[1]));return o.includes(s)?{isValid:!0}:{isValid:!1,error:"Extens\xe3o n\xe3o permitida. Use apenas: ".concat(o.join(", "))}},n=async function(e,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const t=l(e,r);if(!t.isValid)throw new Error(t.error);const n=((e,a)=>{const s=Date.now(),o=Math.random().toString(36).substring(2,8),r=e.name.split(".").pop().toLowerCase();return"".concat(a,"_").concat(s,"_").concat(o,".").concat(r)})(e,a),i="".concat(a,"/").concat(n),{error:c}=await o.N.storage.from(r.BUCKET_NAME).upload(i,e,{cacheControl:"3600",upsert:!1});if(c)throw new Error("Erro no upload: ".concat(c.message));const{data:{publicUrl:d}}=o.N.storage.from(r.BUCKET_NAME).getPublicUrl(i);return{id:Date.now(),url:i,publicUrl:d,descricao:s.trim()||"Imagem da escola ".concat(a),created_at:(new Date).toISOString()}}catch(t){throw console.error("Erro no upload da imagem da escola:",t),t}},i=async function(e,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"professor";try{const n=l(e,t);if(!n.isValid)throw new Error(n.error);const i=((e,a,s)=>{const o=Date.now(),r=Math.random().toString(36).substring(2,8),t=e.name.split(".").pop().toLowerCase();return"".concat(s,"_").concat(a,"_").concat(o,"_").concat(r,".").concat(t)})(e,a,r),c="".concat(a,"/").concat(i),{error:d}=await o.N.storage.from(t.BUCKET_NAME).upload(c,e,{cacheControl:"3600",upsert:!1});if(d)throw console.error("Erro detalhado do upload:",d),new Error("Erro no upload: ".concat(d.message));const{data:{publicUrl:g}}=o.N.storage.from(t.BUCKET_NAME).getPublicUrl(c);return{id:Date.now(),url:c,publicUrl:g,descricao:s.trim()||"Imagem do ".concat(r," da escola ").concat(a),genero:r,created_at:(new Date).toISOString()}}catch(n){throw console.error("Erro no upload da imagem do professor:",n),n}},c=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.BUCKET_NAME;try{const{data:s,error:r}=await o.N.storage.from(a).list("".concat(e,"/"));if(r)throw r;if(!s||0===s.length)return[];return s.map(((s,r)=>{const t="".concat(e,"/").concat(s.name),{data:{publicUrl:l}}=o.N.storage.from(a).getPublicUrl(t);return{id:r+1,url:t,publicUrl:l,descricao:"Imagem ".concat(r+1),created_at:s.created_at||(new Date).toISOString()}}))}catch(s){throw console.error("Erro ao buscar imagens da escola:",s),s}},d=async(e,a,s)=>{try{const{error:e}=await o.N.storage.from(s).remove([a]);if(e)throw new Error("Erro ao deletar arquivo: ".concat(e.message))}catch(r){throw console.error("Erro ao deletar imagem:",r),r}},g=async(e,a)=>{try{return{id:e,descricao:a.trim()}}catch(s){throw console.error("Erro ao atualizar descri\xe7\xe3o da imagem:",s),s}},u=async(e,a)=>{try{const s=a===t.BUCKET_NAME?t:r,{data:l,error:n}=await o.N.storage.from(a).list("".concat(e,"/"));if(n)throw n;const i=l?l.length:0;return{current:i,limit:s.MAX_IMAGES_PER_SCHOOL,canUpload:i<s.MAX_IMAGES_PER_SCHOOL}}catch(s){throw console.error("Erro ao verificar limite de imagens:",s),s}}},2999:(e,a,s)=>{s.d(a,{A:()=>x});var o=s(9379),r=s(5043),t=s(9769),l=s(8590);const n=(0,s(1114).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var i=s(1184),c=s(7669),d=s(4488),g=s(6478),u=s(193),m=s(237),p=s(579);const x=e=>{var a;let{escolaId:s,videoUrl:x,onVideoUrlChange:h,onTitulosUpdate:b}=e;const[f,v]=(0,r.useState)([]),[y,j]=(0,r.useState)(!0),[N,w]=(0,r.useState)(""),[A,E]=(0,r.useState)(""),[_,S]=(0,r.useState)(!1),[C,k]=(0,r.useState)({url:"",titulo:""}),D=(0,r.useCallback)((async()=>{if(s)try{j(!0);const e=(await(0,m.L6)(s)).map((e=>({id:e.id,url:e.video_url,titulo:e.titulo,plataforma:e.plataforma,categoria:e.categoria})));v(e)}catch(e){console.error("Erro ao buscar v\xeddeos:",e),w("Erro ao carregar v\xeddeos")}finally{j(!1)}}),[s]);(0,r.useEffect)((()=>{D()}),[D]),(0,r.useEffect)((()=>{if(N||A){const e=setTimeout((()=>{w(""),E("")}),5e3);return()=>clearTimeout(e)}}),[N,A]);const I=async(e,a)=>{if(a.trim())try{await(0,m.KM)(e,{titulo:a,escola_id:s}),D(),b&&b()}catch(o){console.error("Erro ao atualizar t\xedtulo:",o),w("Erro ao atualizar t\xedtulo")}},U=e=>{if(!e)return"";const a=e.match(/(?:youtu.be\/|youtube.com\/(?:watch\?v=|embed\/|v\/))([\w-]{11})/);if(a)return"https://www.youtube.com/embed/".concat(a[1]);const s=e.match(/vimeo.com\/(\d+)/);return s?"https://player.vimeo.com/video/".concat(s[1]):e};return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)(t.A,{className:"w-5 h-5 text-blue-600"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"V\xeddeo Principal"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL do V\xeddeo"}),(0,p.jsx)("input",{type:"url",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x||"",onChange:e=>h(e.target.value),placeholder:"Cole aqui o link do v\xeddeo (YouTube, Vimeo, etc)"}),(0,p.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Exemplo: https://www.youtube.com/watch?v=..."})]}),x&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xedtulo do V\xeddeo"}),(0,p.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:(null===(a=f.find((e=>e.url===x)))||void 0===a?void 0:a.titulo)||"",onChange:e=>{const a=f.find((e=>e.url===x));a&&I(a.id,e.target.value)},placeholder:"Das crian\xe7as da Aldeia Uru'ity para o mundo"}),(0,p.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:'Exemplo: "Das crian\xe7as da Aldeia Uru\'ity para o mundo"'})]}),x&&U(x)&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pr\xe9-visualiza\xe7\xe3o"}),(0,p.jsx)("div",{className:"aspect-w-16 aspect-h-9 bg-black rounded-lg overflow-hidden",children:(0,p.jsx)("iframe",{src:U(x),title:"Pr\xe9-visualiza\xe7\xe3o do v\xeddeo",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full"})})]})]}),(0,p.jsxs)("div",{className:"border-t pt-6",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)(l.A,{className:"w-5 h-5 text-green-600"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Outros V\xeddeos"})]}),(0,p.jsxs)("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,p.jsx)(n,{className:"w-4 h-4"}),"Adicionar Outro V\xeddeo"]})]}),f.filter((e=>e.url!==x)).length>0&&(0,p.jsx)("div",{className:"space-y-4",children:f.filter((e=>e.url!==x)).map((e=>(0,p.jsxs)("div",{className:"bg-gray-50 border rounded-lg p-4",children:[(0,p.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,p.jsxs)("div",{className:"flex-1",children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xedtulo do V\xeddeo"}),(0,p.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:e.titulo,onChange:a=>I(e.id,a.target.value),placeholder:"Digite o t\xedtulo do v\xeddeo"})]}),(0,p.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Tem certeza que deseja remover este v\xeddeo?"))try{await(0,m.qp)(e),E("V\xeddeo removido com sucesso!"),D(),b&&b()}catch(a){console.error("Erro ao remover v\xeddeo:",a),w("Erro ao remover v\xeddeo")}})(e.id),className:"ml-3 p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remover v\xeddeo",children:(0,p.jsx)(i.A,{className:"w-4 h-4"})})]}),(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL do V\xeddeo"}),(0,p.jsx)("input",{type:"url",className:"w-full border rounded-lg px-3 py-2 bg-gray-100",value:e.url,disabled:!0})]}),U(e.url)&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pr\xe9-visualiza\xe7\xe3o"}),(0,p.jsx)("div",{className:"aspect-w-16 aspect-h-9 bg-black rounded-lg overflow-hidden",children:(0,p.jsx)("iframe",{src:U(e.url),title:e.titulo,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full"})})]})]},e.id)))}),0===f.filter((e=>e.url!==x)).length&&!_&&(0,p.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,p.jsx)(l.A,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),(0,p.jsx)("p",{children:"Nenhum v\xeddeo adicional adicionado."}),(0,p.jsx)("p",{className:"text-sm",children:'Clique em "Adicionar Outro V\xeddeo" para incluir mais v\xeddeos.'})]}),_&&(0,p.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,p.jsx)("h4",{className:"text-lg font-medium text-blue-800",children:"Adicionar Novo V\xeddeo"}),(0,p.jsx)("button",{onClick:()=>{S(!1),k({url:"",titulo:""})},className:"text-blue-500 hover:text-blue-700",children:(0,p.jsx)(c.A,{className:"w-5 h-5"})})]}),(0,p.jsxs)("form",{onSubmit:async e=>{var a;if(e.preventDefault(),C.url.trim()&&C.titulo.trim())try{if(f.find((e=>e.url===C.url)))return void w("Este v\xeddeo j\xe1 foi adicionado");await(0,m.I5)({video_url:C.url,titulo:C.titulo,plataforma:(a=C.url,a.includes("youtube.com")||a.includes("youtu.be")?"youtube":a.includes("vimeo.com")?"vimeo":a.includes("facebook.com")?"facebook":a.includes("instagram.com")?"instagram":"outro"),categoria:"geral",escola_id:s}),E("V\xeddeo adicionado com sucesso!"),k({url:"",titulo:""}),S(!1),D(),b&&b()}catch(o){console.error("Erro ao adicionar v\xeddeo:",o),w("Erro ao adicionar v\xeddeo")}else w("URL e t\xedtulo s\xe3o obrigat\xf3rios")},className:"space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL do V\xeddeo *"}),(0,p.jsx)("input",{type:"url",required:!0,className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:C.url,onChange:e=>k((0,o.A)((0,o.A)({},C),{},{url:e.target.value})),placeholder:"https://www.youtube.com/watch?v=..."})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xedtulo do V\xeddeo *"}),(0,p.jsx)("input",{type:"text",required:!0,className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:C.titulo,onChange:e=>k((0,o.A)((0,o.A)({},C),{},{titulo:e.target.value})),placeholder:"Digite o t\xedtulo do v\xeddeo"})]}),(0,p.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,p.jsxs)("button",{type:"submit",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,p.jsx)(d.A,{className:"w-4 h-4"}),"Adicionar V\xeddeo"]}),(0,p.jsx)("button",{type:"button",onClick:()=>{S(!1),k({url:"",titulo:""})},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancelar"})]})]})]})]}),N&&(0,p.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,p.jsx)(g.A,{className:"w-5 h-5 text-red-600"}),(0,p.jsx)("span",{className:"text-red-700",children:N})]}),A&&(0,p.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,p.jsx)(u.A,{className:"w-5 h-5 text-green-600"}),(0,p.jsx)("span",{className:"text-green-700",children:A})]})]})}},4488:(e,a,s)=>{s.d(a,{A:()=>o});const o=(0,s(1114).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},6017:(e,a,s)=>{s.r(a),s.d(a,{default:()=>h});var o=s(9379),r=s(5043),t=s(197),l=s(6464),n=s(4562),i=s(8590),c=s(1209),d=s(2065);const g=(0,s(1114).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var u=s(7484),m=s(6208),p=s(2999),x=s(579);const h=e=>{let{escola:a,onClose:s,onSave:h}=e;const[b,f]=(0,r.useState)((null===a||void 0===a?void 0:a.Escola)||""),[v,y]=(0,r.useState)(!1),[j,N]=(0,r.useState)(""),[w,A]=(0,r.useState)("dados-basicos"),E=[{id:"dados-basicos",label:"Dados B\xe1sicos",icon:t.A,description:"Informa\xe7\xf5es principais da escola"},{id:"imagens-escola",label:"Imagens da Escola",icon:l.A,description:"Upload e gerenciamento de imagens da escola (m\xe1x. 10)"},{id:"imagens-professores",label:"Imagens dos Professores",icon:n.A,description:"Upload e gerenciamento de imagens dos professores (m\xe1x. 5)"},{id:"video",label:"V\xeddeo",icon:i.A,description:"Link do v\xeddeo e gerenciamento de t\xedtulos"},{id:"localizacao",label:"Localiza\xe7\xe3o",icon:c.A,description:"Coordenadas e endere\xe7o da escola"},{id:"gestao",label:"Gest\xe3o",icon:d.A,description:"Informa\xe7\xf5es sobre gest\xe3o e funcion\xe1rios"},{id:"configuracoes",label:"Configura\xe7\xf5es",icon:g,description:"Configura\xe7\xf5es avan\xe7adas da escola"}],_=()=>{console.log("Imagens atualizadas - PainelInformacoes deve ser atualizado")},S=()=>{console.log("T\xedtulos atualizados - PainelInformacoes deve ser atualizado")},C="undefined"!==typeof window&&window.innerWidth<=768;return(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 ".concat(C?"p-0":""),style:{padding:C?0:void 0},children:(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col ".concat(C?"rounded-none h-screen max-w-full":""),style:{width:C?"100vw":"min(100vw, 640px)",height:C?"100vh":"min(90vh, 900px)",maxWidth:C?"100vw":"96vw",maxHeight:C?"100vh":"90vh",overflow:"hidden"},children:[(0,x.jsxs)("div",{className:"flex items-center justify-between ".concat(C?"p-4":"p-6"," border-b"),children:[(0,x.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 ".concat(C?"text-lg":""),children:["Editar Escola: ",(null===a||void 0===a?void 0:a.Escola)||"Nova Escola"]}),(0,x.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 ".concat(C?"w-8 h-8":""),style:C?{fontSize:24}:{},children:(0,x.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,x.jsx)("nav",{className:"flex border-b bg-gray-50 ".concat(C?"overflow-x-auto no-scrollbar":""),style:C?{WebkitOverflowScrolling:"touch",scrollBehavior:"smooth"}:{},role:"tablist","aria-label":"Abas de edi\xe7\xe3o da escola",children:E.map(((e,a)=>{const s=e.icon,o=w===e.id;return(0,x.jsxs)("button",{id:"tab-".concat(e.id),onClick:()=>A(e.id),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 ".concat(o?"text-blue-700 border-b-4 border-blue-600 bg-white shadow-sm":"text-gray-600 hover:text-blue-700 hover:bg-blue-50"," ").concat(C?"px-2 py-2 text-xs":""),title:e.description,role:"tab","aria-selected":o,"aria-controls":"tabpanel-".concat(e.id),tabIndex:o?0:-1,children:[(0,x.jsx)(s,{className:"w-5 h-5 ".concat(o?"text-blue-700":"text-gray-400")}),(0,x.jsx)("span",{className:"".concat(C?"hidden xs:inline":""),children:e.label})]},e.id)}))}),(0,x.jsx)("div",{className:"flex-1 overflow-y-auto ".concat(C?"p-3":"p-6"),style:C?{fontSize:"1rem"}:{},children:(0,x.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),b.trim()){N(""),y(!0);try{await h((0,o.A)((0,o.A)({},a),{},{Escola:b})),s()}catch(r){N("Erro ao salvar.")}finally{y(!1)}}else N("O nome da escola \xe9 obrigat\xf3rio.")},children:[(0,x.jsx)("div",{className:"min-h-[300px] md:min-h-[400px]",id:"tabpanel-".concat(w),role:"tabpanel","aria-labelledby":"tab-".concat(w),children:(()=>{switch(w){case"dados-basicos":return(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Escola *"}),(0,x.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:b,onChange:e=>f(e.target.value),disabled:v,placeholder:"Digite o nome da escola"})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Munic\xedpio"}),(0,x.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a["Munic\xedpio"])||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{"Munic\xedpio":e.target.value})),placeholder:"Nome do munic\xedpio"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terra Ind\xedgena (TI)"}),(0,x.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a["Terra Indigena (TI)"])||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{"Terra Indigena (TI)":e.target.value})),placeholder:"Nome da terra ind\xedgena"})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere\xe7o"}),(0,x.jsx)("textarea",{className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",value:(null===a||void 0===a?void 0:a["Endere\xe7o"])||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{"Endere\xe7o":e.target.value})),placeholder:"Endere\xe7o completo da escola"})]})]});case"imagens-escola":return(0,x.jsx)(u.A,{escolaId:null===a||void 0===a?void 0:a.id,onImagesUpdate:_});case"imagens-professores":return(0,x.jsx)(m.A,{escolaId:null===a||void 0===a?void 0:a.id,onImagesUpdate:_});case"video":return(0,x.jsx)(p.A,{escolaId:null===a||void 0===a?void 0:a.id,videoUrl:(null===a||void 0===a?void 0:a.link_para_videos)||"",onVideoUrlChange:e=>h((0,o.A)((0,o.A)({},a),{},{link_para_videos:e})),onTitulosUpdate:S});case"localizacao":return(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Latitude"}),(0,x.jsx)("input",{type:"number",step:"any",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a.latitude)||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{latitude:parseFloat(e.target.value)||null})),placeholder:"Ex: -23.5505"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Longitude"}),(0,x.jsx)("input",{type:"number",step:"any",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a.longitude)||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{longitude:parseFloat(e.target.value)||null})),placeholder:"Ex: -46.6333"})]})]}),(0,x.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,x.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,x.jsx)("strong",{children:"Dica:"})," Use o Google Maps para encontrar as coordenadas exatas da escola. Clique com o bot\xe3o direito no local da escola e selecione as coordenadas."]})})]});case"gestao":return(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gest\xe3o/Nome"}),(0,x.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a.gestao)||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{gestao:e.target.value})),placeholder:"Nome da gest\xe3o atual"})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professores Ind\xedgenas"}),(0,x.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a.professores_indigenas)||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{professores_indigenas:e.target.value})),placeholder:"Quantidade ou nomes"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professores N\xe3o Ind\xedgenas"}),(0,x.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===a||void 0===a?void 0:a.professores_nao_indigenas)||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{professores_nao_indigenas:e.target.value})),placeholder:"Quantidade ou nomes"})]})]})]});case"infraestrutura":return(0,x.jsx)("div",{className:"space-y-4",children:(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Merenda diferenciada"}),(0,x.jsx)("textarea",{className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",value:(null===a||void 0===a?void 0:a.merenda_diferenciada)||"",onChange:e=>h((0,o.A)((0,o.A)({},a),{},{merenda_diferenciada:e.target.value})),placeholder:"Descreva a situa\xe7\xe3o do fornecimento de merenda (ex: se a escola recebe, se h\xe1 interrup\xe7\xf5es, etc.)"})]})});case"configuracoes":return(0,x.jsx)("div",{className:"space-y-4",children:(0,x.jsx)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,x.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,x.jsx)("strong",{children:"Configura\xe7\xf5es Avan\xe7adas:"})," Esta se\xe7\xe3o ser\xe1 implementada em breve. Aqui voc\xea poder\xe1 configurar permiss\xf5es, notifica\xe7\xf5es e outras op\xe7\xf5es avan\xe7adas."]})})});default:return null}})()}),j&&(0,x.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,x.jsx)("p",{className:"text-red-700 text-sm",children:j})}),(0,x.jsxs)("div",{className:"flex gap-3 mt-6 pt-6 border-t border-gray-200 ".concat(C?"flex-col":""),style:C?{gap:8}:{},children:[(0,x.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors ".concat(C?"w-full text-base":""),disabled:v,children:v?"Salvando...":"Salvar Altera\xe7\xf5es"}),(0,x.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors ".concat(C?"w-full text-base":""),onClick:s,disabled:v,children:"Cancelar"})]})]})})]})})}},6208:(e,a,s)=>{s.d(a,{A:()=>b});var o=s(9379),r=s(5043),t=s(4562),l=s(6478),n=s(193),i=s(256),c=s(7669),d=s(1184),g=s(4488),u=s(1440),m=s(237),p=s(2880);const x=async e=>{const{data:a,error:s}=await p.N.from("imagens_professores").insert([e]).select().single();if(s)throw s;return a};var h=s(579);const b=e=>{let{escolaId:a,onImagesUpdate:s}=e;const[b,f]=(0,r.useState)([]),[v,y]=(0,r.useState)(!1),[j,N]=(0,r.useState)(0),[w,A]=(0,r.useState)(""),[E,_]=(0,r.useState)(""),[S,C]=(0,r.useState)([]),[k,D]=(0,r.useState)(!0),[I,U]=(0,r.useState)({current:0,limit:5,canUpload:!0}),[L,M]=(0,r.useState)(null),[T,P]=(0,r.useState)(""),[z,q]=(0,r.useState)("professor"),[B,O]=(0,r.useState)(""),V=(0,r.useCallback)((async()=>{if(a)try{D(!0);const e=await(0,u.Gw)(a,"imagens-professores");C(e);const s=await(0,u.BZ)(a,"imagens-professores");U(s)}catch(e){console.error("Erro ao buscar imagens dos professores:",e),A("Erro ao carregar imagens dos professores")}finally{D(!1)}}),[a]);(0,r.useEffect)((()=>{V()}),[V]),(0,r.useEffect)((()=>{a&&(console.log("Testando estrutura da tabela legendas_fotos (professores)..."),(0,m.iy)())}),[a]),(0,r.useEffect)((()=>{(async()=>{if(!S.length)return;console.log("Buscando legendas para",S.length,"imagens de professores");const e={};for(const s of S){console.log("Buscando legenda para imagem de professor:",s.url);const o=await(0,m.qP)(s.url,a,"professor");console.log("Legenda encontrada para professor:",o),e[s.url]=o}C((a=>a.map((a=>(0,o.A)((0,o.A)({},a),{},{legendaData:e[a.url]||{legenda:"",descricao_detalhada:"",autor_foto:"",data_foto:"",categoria:"geral"}})))))})()}),[S.length,a]),(0,r.useEffect)((()=>{if(w||E){const e=setTimeout((()=>{A(""),_("")}),5e3);return()=>clearTimeout(e)}}),[w,E]);const G=(0,r.useCallback)((e=>{e.preventDefault();const a=Array.from(e.dataTransfer.files);if(0===a.length)return;if(!I.canUpload)return void A("Limite de ".concat(I.limit," imagens dos professores atingido. Remova algumas imagens antes de adicionar novas."));if(S.length+b.length+a.length>I.limit)return void A("Voc\xea pode adicionar no m\xe1ximo ".concat(I.limit-S.length-b.length," imagens dos professores."));const s=a.filter((e=>e.type.startsWith("image/")));s.length>0&&(f((e=>[...e,...s])),A(""))}),[I,S.length,b.length]),R=(0,r.useCallback)((e=>{e.preventDefault()}),[]),F=(e,a,s)=>{C((r=>r.map((r=>r.id===e?(0,o.A)((0,o.A)({},r),{},{legendaData:(0,o.A)((0,o.A)({},r.legendaData),{},{[a]:s})}):r))))},W=async e=>{console.log("=== DEBUG: Salvando legenda de professor ==="),console.log("Imagem completa:",e);const r=e.url,t=e.legendaData;console.log("URL relativa:",r),console.log("Dados da legenda:",t),console.log("Escola ID:",a);try{console.log("Buscando legenda existente...");let l=await(0,m.qP)(r,a,"professor");if(console.log("Legenda existente encontrada:",l),l){console.log("Atualizando legenda existente...");const e=(0,o.A)((0,o.A)({},t),{},{updated_at:(new Date).toISOString()});console.log("Dados para atualiza\xe7\xe3o:",e);const a=await(0,m.w_)(l.id,e);console.log("Legenda de professor atualizada com sucesso:",a)}else{console.log("Criando nova legenda...");const e=(0,o.A)((0,o.A)({escola_id:a,imagem_url:r},t),{},{ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),tipo_foto:"professor"});console.log("Dados para nova legenda:",e);const s=await(0,m.eP)(e);console.log("Nova legenda de professor criada:",s)}console.log("Atualizando metadados da imagem...");let n=await(async(e,a)=>{const{data:s,error:o}=await p.N.from("imagens_professores").select("*").eq("imagem_url",e).eq("escola_id",a).eq("ativo",!0).single();if(o&&"PGRST116"!==o.code)throw o;return s||null})(e.publicUrl,a);n?(console.log("Metadados encontrados:",n),await(async(e,a)=>{const{data:s,error:o}=await p.N.from("imagens_professores").update(a).eq("id",e).select().single();if(o)throw o;return s})(n.id,{autor:t.autor_foto,updated_at:(new Date).toISOString()}),console.log("Metadados atualizados com sucesso")):console.log("Nenhum metadado encontrado para atualizar"),_("Legenda salva com sucesso!"),s&&(console.log("Chamando onImagesUpdate..."),s())}catch(l){console.error("=== ERRO ao salvar legenda de professor ==="),console.error("Erro completo:",l),console.error("Mensagem de erro:",l.message),console.error("Stack trace:",l.stack),A("Erro ao salvar legenda: "+l.message)}};return k?(0,h.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg",children:(0,h.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,h.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),(0,h.jsx)("span",{className:"ml-2 text-gray-600",children:"Carregando imagens dos professores..."})]})}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)(t.A,{className:"w-5 h-5 text-green-600"}),(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens dos Professores"})]}),(0,h.jsxs)("div",{className:"text-sm text-gray-500",children:[I.current,"/",I.limit," imagens"]})]}),w&&(0,h.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,h.jsx)(l.A,{className:"w-5 h-5 text-red-600"}),(0,h.jsx)("span",{className:"text-red-700",children:w})]}),E&&(0,h.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,h.jsx)(n.A,{className:"w-5 h-5 text-green-600"}),(0,h.jsx)("span",{className:"text-green-700",children:E})]}),I.canUpload&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(v?"border-gray-300 bg-gray-50":"border-green-300 bg-green-50 hover:border-green-400 hover:bg-green-100"),onDrop:G,onDragOver:R,children:[(0,h.jsx)(i.A,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),(0,h.jsx)("p",{className:"text-gray-600 mb-2",children:"Arraste imagens dos professores aqui ou clique para selecionar"}),(0,h.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"JPG, PNG, WEBP, GIF \u2022 M\xe1ximo 5MB por arquivo \u2022 M\xe1ximo 5 imagens"}),(0,h.jsxs)("label",{className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer transition-colors",children:[(0,h.jsx)("input",{type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:e=>{const a=Array.from(e.target.files);if(0===a.length)return;if(!I.canUpload)return void A("Limite de ".concat(I.limit," imagens dos professores atingido. Remova algumas imagens antes de adicionar novas."));if(S.length+b.length+a.length>I.limit)return void A("Voc\xea pode adicionar no m\xe1ximo ".concat(I.limit-S.length-b.length," imagens dos professores."));const s=a.filter((e=>{const a=["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type),s=e.size<=5242880;return a||A('Arquivo "'.concat(e.name,'" n\xe3o \xe9 uma imagem v\xe1lida. Use apenas JPG, PNG, WEBP ou GIF.')),s||A('Arquivo "'.concat(e.name,'" \xe9 muito grande. Tamanho m\xe1ximo: 5MB.')),a&&s}));s.length>0&&(f((e=>[...e,...s])),A(""))},className:"hidden",disabled:v}),"Selecionar Arquivos"]})]}),v&&(0,h.jsxs)("div",{className:"space-y-2",children:[(0,h.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,h.jsx)("span",{children:"Fazendo upload das imagens dos professores..."}),(0,h.jsxs)("span",{children:[Math.round(j),"%"]})]}),(0,h.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,h.jsx)("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(j,"%")}})})]}),b.length>0&&(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsxs)("h4",{className:"font-medium text-gray-900",children:["Arquivos selecionados (",b.length,")"]}),(0,h.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:b.map(((e,a)=>(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-24 object-cover rounded-lg border"}),(0,h.jsx)("button",{onClick:()=>(e=>{f((a=>a.filter(((a,s)=>s!==e))))})(a),className:"absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,h.jsx)(c.A,{className:"w-3 h-3"})}),(0,h.jsx)("p",{className:"text-xs text-gray-600 mt-1 truncate",children:e.name})]},a)))}),(0,h.jsx)("button",{onClick:async()=>{if(0!==b.length){y(!0),N(0),A("");try{const e=[];for(let s=0;s<b.length;s++){const o=b[s],r=(s+1)/b.length*100;N(r);const t=await(0,u.wG)(o,a,"",z,B);e.push(t),await x({escola_id:a,imagem_url:t.url,nome_arquivo:o.name,autor:"",ativo:!0})}C((a=>[...a,...e])),f([]),N(0),_("".concat(e.length," imagem(ns) do(s) professor(es) carregada(s) com sucesso!"));const o=await(0,u.BZ)(a,"imagens-professores");U(o),s&&s()}catch(e){console.error("Erro no upload:",e),A("Erro ao fazer upload: ".concat(e.message))}finally{y(!1),N(0)}}},disabled:v,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Fazendo Upload...":"Fazer Upload"})]})]}),S.length>0&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("h4",{className:"font-medium text-gray-900",children:["Imagens dos Professores (",S.length,")"]}),(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map((e=>{var o,r,t,l,n;return(0,h.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:[(0,h.jsxs)("div",{className:"relative group",children:[(0,h.jsx)("img",{src:e.publicUrl,alt:e.descricao||"Imagem do professor",className:"w-full h-48 object-cover"}),(0,h.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center",children:(0,h.jsx)("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,h.jsx)("button",{onClick:()=>(async(e,o)=>{if(window.confirm("Tem certeza que deseja excluir esta imagem do professor?"))try{await(0,u.vS)(e,o,"imagens-professores"),C((a=>a.filter((a=>a.id!==e))));const r=await(0,u.BZ)(a,"imagens-professores");U(r),_("Imagem do professor exclu\xedda com sucesso!"),s&&s()}catch(r){console.error("Erro ao deletar imagem:",r),A("Erro ao excluir imagem: ".concat(r.message))}})(e.id,e.url),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700",title:"Excluir imagem",children:(0,h.jsx)(d.A,{className:"w-4 h-4"})})})})]}),(0,h.jsxs)("div",{className:"p-4 space-y-2",children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Legenda"}),(0,h.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:(null===(o=e.legendaData)||void 0===o?void 0:o.legenda)||"",onChange:a=>F(e.id,"legenda",a.target.value),placeholder:"Digite a legenda da imagem..."}),(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri\xe7\xe3o Detalhada"}),(0,h.jsx)("textarea",{className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:(null===(r=e.legendaData)||void 0===r?void 0:r.descricao_detalhada)||"",onChange:a=>F(e.id,"descricao_detalhada",a.target.value),placeholder:"Descri\xe7\xe3o detalhada da imagem..."}),(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Autor da Foto"}),(0,h.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:(null===(t=e.legendaData)||void 0===t?void 0:t.autor_foto)||"",onChange:a=>F(e.id,"autor_foto",a.target.value),placeholder:"Nome do fot\xf3grafo"}),(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data da Foto"}),(0,h.jsx)("input",{type:"date",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:(null===(l=e.legendaData)||void 0===l?void 0:l.data_foto)||"",onChange:a=>F(e.id,"data_foto",a.target.value)}),(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),(0,h.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",value:(null===(n=e.legendaData)||void 0===n?void 0:n.categoria)||"",onChange:a=>F(e.id,"categoria",a.target.value),placeholder:"Digite a categoria da imagem..."}),(0,h.jsx)("div",{className:"flex gap-2 pt-2",children:(0,h.jsxs)("button",{onClick:()=>W(e),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",type:"button",children:[(0,h.jsx)(g.A,{className:"w-4 h-4"})," Salvar Legenda"]})})]})]},e.id)}))})]}),0===S.length&&!v&&(0,h.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,h.jsx)(t.A,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),(0,h.jsx)("p",{children:"Nenhuma imagem dos professores adicionada ainda."}),(0,h.jsx)("p",{className:"text-sm",children:"Adicione imagens para mostrar os professores da escola."})]})]})}},6464:(e,a,s)=>{s.d(a,{A:()=>o});const o=(0,s(1114).A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},7484:(e,a,s)=>{s.d(a,{A:()=>x});var o=s(9379),r=s(5043),t=s(6464),l=s(6478),n=s(193),i=s(256),c=s(7669),d=s(1184),g=s(4488),u=s(1440),m=s(237),p=s(579);const x=e=>{let{escolaId:a,onImagesUpdate:s}=e;const[x,h]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[v,y]=(0,r.useState)(0),[j,N]=(0,r.useState)(""),[w,A]=(0,r.useState)(""),[E,_]=(0,r.useState)([]),[S,C]=(0,r.useState)(!0),[k,D]=(0,r.useState)({current:0,limit:10,canUpload:!0}),[I,U]=(0,r.useState)(null),[L,M]=(0,r.useState)(""),T=(0,r.useCallback)((async()=>{if(a)try{C(!0);const e=await(0,u.Gw)(a,"imagens-das-escolas");_(e);const s=await(0,u.BZ)(a,"imagens-das-escolas");D(s)}catch(e){console.error("Erro ao buscar imagens:",e),N("Erro ao carregar imagens existentes")}finally{C(!1)}}),[a]);(0,r.useEffect)((()=>{T()}),[T]),(0,r.useEffect)((()=>{a&&(console.log("Testando estrutura da tabela legendas_fotos..."),(0,m.iy)())}),[a]),(0,r.useEffect)((()=>{(async()=>{if(!E.length)return;console.log("Buscando legendas para",E.length,"imagens");const e={};for(const s of E){console.log("Buscando legenda para imagem:",s.url);const o=await(0,m.qP)(s.url,a,"escola");console.log("Legenda encontrada:",o),e[s.url]=o}_((a=>a.map((a=>(0,o.A)((0,o.A)({},a),{},{legendaData:e[a.url]||{legenda:"",descricao_detalhada:"",autor_foto:"",data_foto:"",categoria:"geral"}})))))})()}),[E.length,a]),(0,r.useEffect)((()=>{if(j||w){const e=setTimeout((()=>{N(""),A("")}),5e3);return()=>clearTimeout(e)}}),[j,w]);const P=(0,r.useCallback)((e=>{e.preventDefault();const a=Array.from(e.dataTransfer.files);if(0===a.length)return;if(!k.canUpload)return void N("Limite de ".concat(k.limit," imagens atingido. Remova algumas imagens antes de adicionar novas."));if(E.length+x.length+a.length>k.limit)return void N("Voc\xea pode adicionar no m\xe1ximo ".concat(k.limit-E.length-x.length," imagens."));const s=a.filter((e=>e.type.startsWith("image/")));s.length>0&&(h((e=>[...e,...s])),N(""))}),[k,E.length,x.length]),z=(0,r.useCallback)((e=>{e.preventDefault()}),[]),q=(e,a,s)=>{_((r=>r.map((r=>r.id===e?(0,o.A)((0,o.A)({},r),{},{legendaData:(0,o.A)((0,o.A)({},r.legendaData),{},{[a]:s})}):r))))};return S?(0,p.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg",children:(0,p.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,p.jsx)("span",{className:"ml-2 text-gray-600",children:"Carregando imagens..."})]})}):(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)(t.A,{className:"w-5 h-5 text-blue-600"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens da Escola"})]}),(0,p.jsxs)("div",{className:"text-sm text-gray-500",children:[k.current,"/",k.limit," imagens"]})]}),j&&(0,p.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,p.jsx)(l.A,{className:"w-5 h-5 text-red-600"}),(0,p.jsx)("span",{className:"text-red-700",children:j})]}),w&&(0,p.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,p.jsx)(n.A,{className:"w-5 h-5 text-green-600"}),(0,p.jsx)("span",{className:"text-green-700",children:w})]}),k.canUpload&&(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(b?"border-gray-300 bg-gray-50":"border-blue-300 bg-blue-50 hover:border-blue-400 hover:bg-blue-100"),onDrop:P,onDragOver:z,children:[(0,p.jsx)(i.A,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),(0,p.jsx)("p",{className:"text-gray-600 mb-2",children:"Arraste imagens aqui ou clique para selecionar"}),(0,p.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"JPG, PNG, WEBP, GIF \u2022 M\xe1ximo 5MB por arquivo"}),(0,p.jsxs)("label",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors",children:[(0,p.jsx)("input",{type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:e=>{const a=Array.from(e.target.files);if(0===a.length)return;if(!k.canUpload)return void N("Limite de ".concat(k.limit," imagens atingido. Remova algumas imagens antes de adicionar novas."));if(E.length+x.length+a.length>k.limit)return void N("Voc\xea pode adicionar no m\xe1ximo ".concat(k.limit-E.length-x.length," imagens."));const s=a.filter((e=>{const a=["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type),s=e.size<=5242880;return a||N('Arquivo "'.concat(e.name,'" n\xe3o \xe9 uma imagem v\xe1lida. Use apenas JPG, PNG, WEBP ou GIF.')),s||N('Arquivo "'.concat(e.name,'" \xe9 muito grande. Tamanho m\xe1ximo: 5MB.')),a&&s}));s.length>0&&(h((e=>[...e,...s])),N(""))},className:"hidden",disabled:b}),"Selecionar Arquivos"]})]}),b&&(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,p.jsx)("span",{children:"Fazendo upload..."}),(0,p.jsxs)("span",{children:[Math.round(v),"%"]})]}),(0,p.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,p.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(v,"%")}})})]}),x.length>0&&(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsxs)("h4",{className:"font-medium text-gray-900",children:["Arquivos selecionados (",x.length,")"]}),(0,p.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:x.map(((e,a)=>(0,p.jsxs)("div",{className:"relative group",children:[(0,p.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-24 object-cover rounded-lg border"}),(0,p.jsx)("button",{onClick:()=>(e=>{h((a=>a.filter(((a,s)=>s!==e))))})(a),className:"absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,p.jsx)(c.A,{className:"w-3 h-3"})}),(0,p.jsx)("p",{className:"text-xs text-gray-600 mt-1 truncate",children:e.name})]},a)))}),(0,p.jsx)("button",{onClick:async()=>{if(0!==x.length){f(!0),y(0),N("");try{const e=[];for(let s=0;s<x.length;s++){const o=x[s],r=(s+1)/x.length*100;y(r);const t=await(0,u.gE)(o,a);e.push(t)}_((a=>[...a,...e])),h([]),y(0),A("".concat(e.length," imagem(ns) carregada(s) com sucesso!"));const o=await(0,u.BZ)(a,"imagens-das-escolas");D(o),s&&s()}catch(e){console.error("Erro no upload:",e),N("Erro ao fazer upload: ".concat(e.message))}finally{f(!1),y(0)}}},disabled:b,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Fazendo Upload...":"Fazer Upload"})]})]}),E.length>0&&(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("h4",{className:"font-medium text-gray-900",children:["Imagens da Escola (",E.length,")"]}),(0,p.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map((e=>{var r,t,l,n,i;return(0,p.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:[(0,p.jsxs)("div",{className:"relative group",children:[(0,p.jsx)("img",{src:e.publicUrl,alt:e.descricao||"Imagem da escola",className:"w-full h-48 object-cover"}),(0,p.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center",children:(0,p.jsx)("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,p.jsx)("button",{onClick:()=>(async(e,o)=>{if(window.confirm("Tem certeza que deseja excluir esta imagem?"))try{await(0,u.vS)(e,o,"imagens-das-escolas"),_((a=>a.filter((a=>a.id!==e))));const r=await(0,u.BZ)(a,"imagens-das-escolas");D(r),A("Imagem exclu\xedda com sucesso!"),s&&s()}catch(r){console.error("Erro ao deletar imagem:",r),N("Erro ao excluir imagem: ".concat(r.message))}})(e.id,e.url),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700",title:"Excluir imagem",children:(0,p.jsx)(d.A,{className:"w-4 h-4"})})})})]}),(0,p.jsxs)("div",{className:"p-4 space-y-2",children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Legenda"}),(0,p.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===(r=e.legendaData)||void 0===r?void 0:r.legenda)||"",onChange:a=>q(e.id,"legenda",a.target.value),placeholder:"Digite a legenda da imagem..."}),(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri\xe7\xe3o Detalhada"}),(0,p.jsx)("textarea",{className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===(t=e.legendaData)||void 0===t?void 0:t.descricao_detalhada)||"",onChange:a=>q(e.id,"descricao_detalhada",a.target.value),placeholder:"Descri\xe7\xe3o detalhada da imagem..."}),(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Autor da Foto"}),(0,p.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===(l=e.legendaData)||void 0===l?void 0:l.autor_foto)||"",onChange:a=>q(e.id,"autor_foto",a.target.value),placeholder:"Nome do fot\xf3grafo"}),(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data da Foto"}),(0,p.jsx)("input",{type:"date",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===(n=e.legendaData)||void 0===n?void 0:n.data_foto)||"",onChange:a=>q(e.id,"data_foto",a.target.value)}),(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),(0,p.jsx)("input",{type:"text",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:(null===(i=e.legendaData)||void 0===i?void 0:i.categoria)||"",onChange:a=>q(e.id,"categoria",a.target.value),placeholder:"Digite a categoria da imagem..."}),(0,p.jsx)("div",{className:"flex gap-2 pt-2",children:(0,p.jsxs)("button",{onClick:()=>(async e=>{console.log("=== DEBUG: Salvando legenda ==="),console.log("Imagem completa:",e);const r=e.url,t=e.legendaData;console.log("URL relativa:",r),console.log("Dados da legenda:",t),console.log("Escola ID:",a);try{console.log("Buscando legenda existente...");let e=await(0,m.qP)(r,a,"escola");if(console.log("Legenda existente encontrada:",e),e){console.log("Atualizando legenda existente...");const a=(0,o.A)((0,o.A)({},t),{},{updated_at:(new Date).toISOString()});console.log("Dados para atualiza\xe7\xe3o:",a);const s=await(0,m.w_)(e.id,a);console.log("Legenda atualizada com sucesso:",s)}else{console.log("Criando nova legenda...");const e=(0,o.A)((0,o.A)({escola_id:a,imagem_url:r},t),{},{ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),tipo_foto:"escola"});console.log("Dados para nova legenda:",e);const s=await(0,m.eP)(e);console.log("Nova legenda criada:",s)}A("Legenda salva com sucesso!"),s&&(console.log("Chamando onImagesUpdate..."),s())}catch(l){console.error("=== ERRO ao salvar legenda ==="),console.error("Erro completo:",l),console.error("Mensagem de erro:",l.message),console.error("Stack trace:",l.stack),N("Erro ao salvar legenda: "+l.message)}})(e),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",type:"button",children:[(0,p.jsx)(g.A,{className:"w-4 h-4"})," Salvar Legenda"]})})]})]},e.id)}))})]}),0===E.length&&!b&&(0,p.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,p.jsx)(t.A,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),(0,p.jsx)("p",{children:"Nenhuma imagem adicionada ainda."}),(0,p.jsx)("p",{className:"text-sm",children:"Adicione imagens para mostrar a escola."})]})]})}},8590:(e,a,s)=>{s.d(a,{A:()=>o});const o=(0,s(1114).A)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]])}}]);
//# sourceMappingURL=17.0063fe88.chunk.js.map