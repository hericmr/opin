"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[308],{73848:(e,a,t)=>{t.r(a),t.d(a,{default:()=>jt});var o=t(53986),r=t(65043),s=t(1642),n=t(75351),l=t(56528),i=t(99468),c=t(62463),d=t(41060),u=t(9333),m=t(89826),g=(t(43976),t(35366)),h=t(20495),p=t(63104),x=t(43241),f=t(45921),b=t(85263),v=t(73361),w=t(61247),y=t(47790),j=t(57442);const N="".concat("/opin","/map-marker.svg"),k=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=e.get("markerData")||e.get("schoolData"),o=e.get("isNearbyPair");if(!t)return null;const r=new f.Ay({image:new b.A({src:N,scale:o?1.2:1,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),geometry:e.getGeometry()});if(a&&t.titulo){return[r,new f.Ay({text:new v.A({text:t.titulo,font:"12px Arial",fill:new w.A({color:"#1F2937"}),stroke:new y.A({color:"#FFFFFF",width:2}),offsetY:-15,textAlign:"center"}),geometry:e.getGeometry()})]}return r};var C=t(89379),A=t(80074);const I=()=>{const e=window.innerWidth;if(e>A.LO.mobile)return!1;const a=e<=A.LO.mobile,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),o=void 0!==window.orientation;return!(!a||!t&&!o)||a};class L{constructor(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.map=e,this.options=(0,C.A)({enableHover:!1!==a.enableHover,enableClick:!1!==a.enableClick,enableDoubleClick:!1!==a.enableDoubleClick,enableTouch:!1!==a.enableTouch,hoverDelay:a.hoverDelay||200,clickDelay:a.clickDelay||300},a),this.eventHandlers=new Map,this.hoveredFeature=null,this.clickedFeature=null,this.clickTimeout=null,this.hoverTimeout=null,this.tooltipElement=null,console.log("[OpenLayersInteractions] Intera\xe7\xf5es inicializadas"),this.initializeInteractions()}isMobile(){const e=I(),a="ontouchstart"in window||navigator.maxTouchPoints>0;return console.log("[OpenLayersInteractions] Detec\xe7\xe3o de mobile:",{mobile:e,hasTouch:a,windowWidth:window.innerWidth,userAgent:navigator.userAgent}),e||a}initializeInteractions(){this.options.enableHover&&this.setupHoverInteraction(),this.options.enableClick&&this.setupClickInteraction(),this.options.enableDoubleClick&&this.setupDoubleClickInteraction(),this.options.enableTouch&&this.isMobile()&&this.setupTouchInteraction()}setupHoverInteraction(){this.map.on("pointermove",e=>{this.handlePointerMove(e)}),this.map.on("pointerleave",()=>{this.handlePointerLeave()})}setupClickInteraction(){this.map.on("click",e=>{this.handleClick(e)})}setupDoubleClickInteraction(){this.map.on("dblclick",e=>{this.handleDoubleClick(e)})}setupTouchInteraction(){console.log("[OpenLayersInteractions] Touch interaction configurada para mobile")}handlePointerMove(e){if(this.isMobile())return;const a=this.map.forEachFeatureAtPixel(e.pixel,e=>e);a&&!this.hoveredFeature&&console.log("[OpenLayersInteractions] Feature detectado:",{type:a.get("type"),schoolData:a.get("schoolData"),terraIndigenaInfo:a.get("terraIndigenaInfo")}),a!==this.hoveredFeature&&(this.hoveredFeature&&this.clearHover(),a&&this.applyHover(a,e))}handlePointerLeave(){this.clearHover()}handleClick(e){const a=this.map.forEachFeatureAtPixel(e.pixel,e=>e);a&&(this.isMobile()?this.handleMobileClick(a,e):this.clickedFeature!==a?(this.clickedFeature=a,this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(()=>{this.clickedFeature=null},this.options.clickDelay),this.executeClickHandler(a,e)):this.handleDoubleClick(e))}handleDoubleClick(e){const a=this.map.forEachFeatureAtPixel(e.pixel,e=>e);a&&(this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.clickedFeature=null,this.executeDoubleClickHandler(a,e))}handleTouchEnd(e){const a=this.map.forEachFeatureAtPixel(e.pixel,e=>e);a&&this.executeClickHandler(a,e)}handleMobileClick(e,a){if(this.clickedFeature===e)return console.log("[OpenLayersInteractions] Segundo clique em mobile - abrindo painel"),this.forceHideTooltip(),void this.executeClickHandler(e,a);console.log("[OpenLayersInteractions] Primeiro clique em mobile - mostrando tooltip"),this.clickedFeature=e,this.options.showTooltip&&this.showTooltip(e,a),this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(()=>{console.log("[OpenLayersInteractions] Timeout mobile - escondendo tooltip e resetando"),this.forceHideTooltip()},3e3),this.executeHoverHandler(e,a)}applyHover(e,a){this.hoveredFeature=e,this.applyHoverStyle(e),this.options.showTooltip&&!this.isMobile()&&this.showTooltip(e,a),this.executeHoverHandler(e,a)}clearHover(){this.hoveredFeature&&(this.clearHoverStyle(this.hoveredFeature),this.isMobile()||this.hideTooltip(),this.executeHoverOutHandler(this.hoveredFeature),this.hoveredFeature=null)}applyHoverStyle(e){this.options.hoverStyleFunction&&this.options.hoverStyleFunction(e,!0)}clearHoverStyle(e){this.options.hoverStyleFunction&&this.options.hoverStyleFunction(e,!1)}showTooltip(e,a){this.tooltipElement&&this.hideTooltip();const t=this.getTooltipContent(e);console.log("[OpenLayersInteractions] Conte\xfado do tooltip:",t),t?(this.tooltipElement=this.createTooltipElement(t,a),this.map.getTargetElement().appendChild(this.tooltipElement),console.log("[OpenLayersInteractions] Tooltip criado e adicionado ao DOM")):console.log("[OpenLayersInteractions] Sem conte\xfado para tooltip")}hideTooltip(){this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null,console.log("[OpenLayersInteractions] Tooltip escondido"))}forceHideTooltip(){this.hideTooltip(),this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.clickedFeature=null,console.log("[OpenLayersInteractions] Tooltip for\xe7adamente escondido e estado resetado")}createTooltipElement(e,a){const t=document.createElement("div");t.className="ol-tooltip";const o=e.includes("Terra Ind\xedgena");if(this.isMobile()){const r='<span class="tooltip-clickable">'.concat(e,"</span>");t.innerHTML=r;const s=o?{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"rgba(239, 68, 68, 0.15)"}:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"rgba(5, 150, 105, 0.15)"};Object.assign(t.style,(0,C.A)({position:"absolute",padding:"6px 10px",borderRadius:"6px",fontSize:"13px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:"400",color:"#4B5563",pointerEvents:"auto",zIndex:"1000",maxWidth:"250px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04)",border:"1px solid ".concat(s.borderColor),cursor:"default",transition:"all 0.2s ease",backdropFilter:"blur(8px)"},s));const n=t.querySelector(".tooltip-clickable");n&&(Object.assign(n.style,{cursor:"pointer",textDecoration:"underline",textDecorationColor:"#3B82F6",textDecorationThickness:"2px",transition:"all 0.2s ease",display:"inline-block",padding:"2px 4px",borderRadius:"4px",fontWeight:"800"}),n.addEventListener("click",()=>{console.log("[OpenLayersInteractions] Nome clicado no tooltip mobile");const e=this.map.forEachFeatureAtPixel(a.pixel,e=>e);e&&this.executeClickHandler(e,a)}),n.addEventListener("mouseenter",()=>{n.style.backgroundColor="rgba(59, 130, 246, 0.1)",n.style.textDecorationColor="#1D4ED8",n.style.transform="scale(1.05)"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="transparent",n.style.textDecorationColor="#3B82F6",n.style.transform="scale(1)"}))}else{t.innerHTML=e;const a=o?{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"rgba(239, 68, 68, 0.15)"}:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"rgba(5, 150, 105, 0.15)"};Object.assign(t.style,(0,C.A)({position:"absolute",padding:"6px 10px",borderRadius:"6px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:"400",color:"#4B5563",pointerEvents:"none",zIndex:"1000",maxWidth:"250px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04)",border:"1px solid ".concat(a.borderColor),transition:"all 0.2s ease",backdropFilter:"blur(8px)"},a))}const r=a.coordinate,s=this.map.getPixelFromCoordinate(r);return t.style.left=s[0]+10+"px",t.style.top=s[1]-10+"px",t}getTooltipContent(e){if(console.log("[OpenLayersInteractions] Obtendo conte\xfado do tooltip para feature:",{type:e.get("type"),schoolData:e.get("schoolData"),terraIndigenaInfo:e.get("terraIndigenaInfo")}),this.options.tooltipContentFunction){const a=this.options.tooltipContentFunction(e);return console.log("[OpenLayersInteractions] Conte\xfado do tooltip (fun\xe7\xe3o customizada):",a),a}const a=e.get("schoolData");if(a){const e=a.titulo||"Escola Ind\xedgena";return console.log("[OpenLayersInteractions] T\xedtulo extra\xeddo (padr\xe3o):",e),console.log("[OpenLayersInteractions] Conte\xfado do tooltip (padr\xe3o escola - FOR\xc7ADO apenas t\xedtulo):",e),e}const t=e.get("terraIndigenaInfo");if(t){const e="Terra Ind\xedgena ".concat(t.titulo||"Ind\xedgena");return console.log("[OpenLayersInteractions] Conte\xfado do tooltip (padr\xe3o terra ind\xedgena):",e),e}return console.log("[OpenLayersInteractions] Nenhum conte\xfado encontrado para tooltip"),null}executeClickHandler(e,a){const t=this.eventHandlers.get("click");t&&"function"===typeof t&&t(e,a)}executeDoubleClickHandler(e,a){const t=this.eventHandlers.get("doubleClick");t&&"function"===typeof t&&t(e,a)}executeHoverHandler(e,a){const t=this.eventHandlers.get("hover");t&&"function"===typeof t&&t(e,a)}executeHoverOutHandler(e){const a=this.eventHandlers.get("hoverOut");a&&"function"===typeof a&&a(e)}on(e,a){this.eventHandlers.set(e,a)}off(e){this.eventHandlers.delete(e)}clearHandlers(){this.eventHandlers.clear()}updateOptions(e){this.options=(0,C.A)((0,C.A)({},this.options),e),e.enableHover,e.enableClick}destroy(){this.clickTimeout&&clearTimeout(this.clickTimeout),this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hideTooltip(),this.clearHover(),this.clearHandlers()}}function S(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new L(e,(0,C.A)((0,C.A)({},{enableHover:!0,enableClick:!0,enableDoubleClick:!0,enableTouch:!0,showTooltip:!0,hoverDelay:200,clickDelay:300}),a))}var z=t(6454);function E(e,a){var t;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!a)return;const r=null!==(t=o.durationMs)&&void 0!==t?t:350,s=e.getView(),n={center:a,duration:r};"number"===typeof o.zoom&&(n.zoom=o.zoom),s.animate(n)}var M=t(5452),_=t(70579);const P=e=>{let{dataPoints:a=[],onPainelOpen:t,showMarcadores:o=!0,showNomesEscolas:s=!1,map:n,className:l="h-full w-full"}=e;const i=(0,r.useRef)(null),d=(0,r.useRef)(null),[,u]=r.useState(null),m=(0,r.useCallback)(()=>{n&&(M.A.debug("[OpenLayersMarkers] Inicializando marcadores individuais..."),i.current=new h.A,d.current=new g.A({source:i.current,style:e=>k(e,s),zIndex:100}),n.addLayer(d.current),v())},[n,s]),v=(0,r.useCallback)(()=>{if(!n||!d.current)return;M.A.debug("[OpenLayersMarkers] Configurando intera\xe7\xf5es com tooltips...");const e=function(e,a,t){console.log("[createMarkerInteractions] Criando intera\xe7\xf5es para marcadores...");const o=S(e,{showTooltip:!0,tooltipContentFunction:e=>{console.log("[createMarkerInteractions] Fun\xe7\xe3o de conte\xfado do tooltip chamada para:",e);const a=e.get("schoolData");if(a){const e=a.titulo||"Escola Ind\xedgena";return console.log("[createMarkerInteractions] T\xedtulo extra\xeddo:",e),console.log("[createMarkerInteractions] Conte\xfado do tooltip gerado (FOR\xc7ADO apenas t\xedtulo):",e),e}return console.log("[createMarkerInteractions] Sem dados de escola para tooltip"),null}});return a&&(console.log("[createMarkerInteractions] Configurando handler de clique personalizado"),o.on("click",a)),t&&o.on("hover",t),console.log("[createMarkerInteractions] Intera\xe7\xf5es criadas com sucesso"),o}(n,C,A);e.on("click",C),e.on("hover",A),e.on("hoverOut",I),M.A.debug("[OpenLayersMarkers] Intera\xe7\xf5es configuradas e integradas com o mapa")},[n]),C=(0,r.useCallback)((e,a)=>{const o=e.get("schoolData");if(o&&t){var r;const a=null===(r=e.getGeometry())||void 0===r?void 0:r.getCoordinates();if(n&&a){let e=.25;try{var s;const a=document.querySelector(".mj-panel");(null===a||void 0===a||null===(s=a.classList)||void 0===s?void 0:s.contains("mj-maximized"))&&(e=.5)}catch(l){}!function(e,a){var t;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!a)return;const r=null!==(t=o.durationMs)&&void 0!==t?t:350,s=o.zoom,n="number"===typeof o.fractionX?o.fractionX:.25,l="number"===typeof o.fractionY?o.fractionY:.5,i=e.getSize();if(!i)return E(e,a,{durationMs:r,zoom:s});const[c,d]=i,u=Math.max(0,Math.min(1,n))*c,m=Math.max(0,Math.min(1,l))*d,g=e.getPixelFromCoordinate(a);if(!g)return E(e,a,{durationMs:r,zoom:s});const h=[g[0]-u+c/2,g[1]-m+d/2],p=e.getCoordinateFromPixel(h);if(!p)return E(e,a,{durationMs:r,zoom:s});const x=e.getView(),f={center:p,duration:r};"number"===typeof s&&(f.zoom=s),x.animate(f)}(n,a,{durationMs:550,fractionX:e}),function(e,a){var t,o;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!a)return;const s=null!==(t=r.radiusPx)&&void 0!==t?t:18,n=null!==(o=r.durationMs)&&void 0!==o?o:900,i=document.createElement("div");i.className="ol-click-pulse",i.style.width="".concat(2*s,"px"),i.style.height="".concat(2*s,"px"),i.style.marginLeft="".concat(-s,"px"),i.style.marginTop="".concat(-s,"px");const c=new z.A({element:i,positioning:"center-center",stopEvent:!1});e.addOverlay(c),c.setPosition(a);const d=()=>{try{e.removeOverlay(c)}catch(l){}};i.addEventListener("animationend",d,{once:!0}),setTimeout(d,n+100)}(n,a)}M.A.debug("[OpenLayersMarkers] Marcador clicado:",o.titulo),t(o)}},[t,n]),A=(0,r.useCallback)((e,a)=>{u(e),d.current&&(d.current.setStyle(a=>a===e?((e,a)=>{if(!a)return null;const t=e.getGeometry(),o=new f.Ay({image:new j.A({radius:12,fill:new w.A({color:"transparent"}),stroke:new y.A({color:"#ffffff",width:3,lineCap:"round",lineJoin:"round"})}),geometry:t}),r=new f.Ay({image:new b.A({src:N,scale:1.1,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),geometry:t});return Array.isArray(a)?[o,...a,r]:[o,a,r]})(a,k(a,s)):k(a,s)),d.current.changed())},[s]),I=(0,r.useCallback)(()=>{u(null),d.current&&(d.current.setStyle(e=>k(e,s)),d.current.changed())},[s]),L=(0,r.useCallback)(()=>{if(!i.current||!a)return;if(M.A.debug("[OpenLayersMarkers] Atualizando marcadores...",a.length,"showMarcadores:",o),i.current.clear(),!o)return void M.A.debug("[OpenLayersMarkers] Marcadores desabilitados, removendo todos");const e=a.filter(e=>{if(!e.latitude||!e.longitude)return!1;const a=parseFloat(e.latitude),t=parseFloat(e.longitude);return!isNaN(a)&&!isNaN(t)&&a>=-90&&a<=90&&t>=-180&&t<=180});M.A.debug("[OpenLayersMarkers] Pontos v\xe1lidos:",e.length),e.forEach((e,a)=>{if(e.latitude&&e.longitude){const t=new p.A({geometry:new x.A((0,c.Rb)([e.longitude,e.latitude]))});t.set("markerData",e),t.set("schoolData",e),t.set("markerId","marker_".concat(a)),t.set("type","marker"),i.current.addFeature(t)}}),M.A.debug("[OpenLayersMarkers] ".concat(e.length," marcadores individuais adicionados"))},[a,o]),P=(0,r.useCallback)(()=>{d.current&&(d.current.setStyle(e=>k(e,s)),d.current.changed())},[s]);return(0,r.useEffect)(()=>(n&&m(),()=>{d.current&&n&&n.removeLayer(d.current)}),[n,m]),(0,r.useEffect)(()=>{L()},[L]),(0,r.useEffect)(()=>{P()},[P]),(0,_.jsx)("div",{className:l})};var T=t(3908);const F={terrasIndigenas:{regularizada:{fill:"rgba(220, 20, 60, 0.3)",stroke:"#B22222",hover:{fill:"rgba(220, 20, 60, 0.45)",stroke:"#FF0000"}},declarada:{fill:"rgba(139, 0, 0, 0.25)",stroke:"#B22222",hover:{fill:"rgba(139, 0, 0, 0.4)",stroke:"#FF0000"}}},estadoSP:{fill:"rgba(0, 0, 0, 0.3)",stroke:"#000000",hover:{fill:"rgba(0, 0, 0, 0.4)",stroke:"#333333"}}},D=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!e.properties)return new f.Ay({fill:new w.A({color:F.terrasIndigenas.regularizada.fill}),stroke:new y.A({color:F.terrasIndigenas.regularizada.stroke,width:2})});const t="Regularizada"===e.properties.fase_ti?F.terrasIndigenas.regularizada:F.terrasIndigenas.declarada,o=a?t.hover:t;return new f.Ay({fill:new w.A({color:o.fill}),stroke:new y.A({color:o.stroke,width:a?3:2,lineDash:a?[]:[3,3]})})};const H={center:[-48.4129,-22.3794],zoom:7.63,maxZoom:18,minZoom:4,mobile:{center:[-48.5935,-21.9212],zoom:5.7},clusterDistance:15,clusterMinDistance:3,clusterAnimationDuration:300,proximityThreshold:5e-5,disableClusteringAtZoom:12,tooltipOffset:10,tooltipDelay:200,interaction:{enableHover:!0,enableClick:!0,enableDoubleClick:!0,enableTouch:!0,clickDelay:300,hoverDelay:200},performance:{enableLazyLoading:!0,maxFeaturesPerTile:1e3,enableFeatureCulling:!0,enableTileCaching:!0},ANIMATION_CONFIG:{duration:{marker:300,cluster:500,zoom:800,pan:600},easing:{marker:"ease-out",cluster:"ease-in-out",zoom:"ease-out",pan:"ease-out"}}},R={small:"#60A5FA",medium:"#3B82F6",large:"#2563EB",xlarge:"#1E40AF"},O={min:11,max:20,size:52},U={min:21,max:50,size:56},B={min:51,max:100,size:64},V="EPSG:4326",W="EPSG:3857",q="EPSG:4674",G={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:'\xa9 <a href="https://www.esri.com/">Esri</a>',maxZoom:19,wrapX:!1,tilePixelRatio:1,tileSize:256},Z=(R.small,O.size,R.medium,U.size,R.large,B.size,R.xlarge,(0,r.forwardRef)((e,a)=>{let{data:t,onPainelOpen:o,showTerrasIndigenas:s=!0,map:n,className:l="h-full w-full"}=e;const i=(0,r.useRef)(null),c=(0,r.useRef)(null),d=(0,r.useRef)(null),[,u]=r.useState(null),[m,p]=r.useState(null),x=(0,r.useMemo)(()=>I(),[]),b=(0,r.useCallback)(()=>{if(n&&t)if(t.features&&Array.isArray(t.features)&&0!==t.features.length)try{const e=new T.A({dataProjection:q||V,featureProjection:W}).readFeatures(t);i.current=new h.A({features:e}),c.current=new g.A({source:i.current,style:e=>D(e,!1),zIndex:10}),e.forEach(e=>{const a=e.getProperties();e.set("terraIndigenaInfo",{titulo:a.terrai_nom,tipo:"terra_indigena",etnia:a.etnia_nome,municipio:a.municipio_,uf:a.uf_sigla,superficie:a.superficie,fase:a.fase_ti,modalidade:a.modalidade,reestudo:a.reestudo_t,cr:a.cr,faixa_fron:a.faixa_fron,undadm_nom:a.undadm_nom,undadm_sig:a.undadm_sig,dominio_un:a.dominio_un,data_atual:a.data_atual,terrai_cod:a.terrai_cod,undadm_cod:a.undadm_cod})}),n.addLayer(c.current),v(),console.log("[OpenLayersTerrasIndigenas] Camada criada com ".concat(e.length," features"))}catch(e){console.error("[OpenLayersTerrasIndigenas] Erro ao criar camada:",e)}else console.warn("[OpenLayersTerrasIndigenas] Dados inv\xe1lidos ou vazios:",t)},[n,t]),v=(0,r.useCallback)(()=>{n&&c.current&&(d.current=function(e,a,t){const o=S(e,{showTooltip:!0,tooltipContentFunction:e=>{const a=e.get("terraIndigenaInfo");return a?"Terra Ind\xedgena ".concat(a.titulo||"Ind\xedgena"):null}});return a&&o.on("click",a),t&&o.on("hover",t),o}(n,j,N),d.current.on("click",j),d.current.on("hover",N),d.current.on("hoverOut",k))},[n]),j=(0,r.useCallback)((e,a)=>{if(!e)return;const t=e.get("terraIndigenaInfo");if(t)if(x)o&&o(t);else if(m===e)o&&o(t),p(null);else{p(e);const a=e.getGeometry();if(a){const e=a.getExtent();n.getView().fit(e,{duration:H.ANIMATION_CONFIG.duration.zoom,padding:[50,50,50,50],maxZoom:15})}}},[x,o,m,n]),N=(0,r.useCallback)((e,a)=>{x||(u(e),c.current&&(c.current.setStyle(a=>D(a,a===e)),c.current.changed()))},[x]),k=(0,r.useCallback)(e=>{u(null),c.current&&(c.current.setStyle(e=>D(e,!1)),c.current.changed())},[]),C=(0,r.useCallback)(e=>{c.current&&(c.current.setStyle(a=>{if(a===e){return function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{fillColor:o="rgba(59, 130, 246, 0.3)",strokeColor:r="#1E40AF",strokeWidth:s=3,lineDash:n=[5,5]}=t,l=new f.Ay({fill:new w.A({color:o}),stroke:new y.A({color:r,width:s,lineDash:n})});return Array.isArray(a)?[...a,l]:[a,l]}(a,D(a,!1))}return D(a,!1)}),c.current.changed())},[]),A=(0,r.useCallback)(e=>{c.current&&(c.current.setStyle(e=>D(e,!1)),c.current.changed())},[]);return(0,r.useEffect)(()=>(n&&t&&s&&b(),()=>{d.current&&d.current.destroy(),c.current&&n&&n.removeLayer(c.current)}),[n,t,s,b]),(0,r.useEffect)(()=>{m?C(m):c.current&&A()},[m,C,A]),(0,r.useEffect)(()=>{if(m){const e=setTimeout(()=>{p(null)},H.interaction.clickDelay);return()=>clearTimeout(e)}},[m]),s&&t?(0,_.jsx)("div",{className:l}):null})),K=(0,r.forwardRef)((e,a)=>{let{data:t,showEstadoSP:o=!0,map:s,className:n="h-full w-full"}=e;const l=(0,r.useRef)(null),i=(0,r.useRef)(null),c=(0,r.useCallback)(()=>{if(s&&t)if(t.features&&Array.isArray(t.features)&&0!==t.features.length)try{const e=new T.A({dataProjection:q||V,featureProjection:W}).readFeatures(t);l.current=new h.A({features:e}),i.current=new g.A({source:l.current,style:e=>function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=a?F.estadoSP.hover:F.estadoSP;return new f.Ay({fill:new w.A({color:t.fill}),stroke:new y.A({color:t.stroke,width:a?2:1})})}(e,!1),zIndex:5,interactive:!1}),s.addLayer(i.current),console.log("[OpenLayersEstadoSP] Camada criada com ".concat(e.length," features"))}catch(e){console.error("[OpenLayersEstadoSP] Erro ao criar camada:",e)}else console.warn("[OpenLayersEstadoSP] Dados inv\xe1lidos ou vazios:",t)},[s,t]);return(0,r.useEffect)(()=>(s&&t&&o&&c(),()=>{i.current&&s&&s.removeLayer(i.current)}),[s,t,o,c]),o&&t?(0,_.jsx)("div",{className:n}):null}),J=e=>{let{terrasIndigenasData:a,estadoSPData:t,showTerrasIndigenas:o=!0,showEstadoSP:s=!0,onPainelOpen:n,map:l,className:i="h-full w-full"}=e;const c=(0,r.useRef)(null),d=(0,r.useRef)(null),[u,m]=r.useState({terrasIndigenas:{visible:o,loaded:!1,error:null},estadoSP:{visible:s,loaded:!1,error:null}}),g=(0,r.useMemo)(()=>({terrasIndigenas:a&&a.features&&a.features.length>0,estadoSP:t&&t.features&&t.features.length>0}),[a,t]),h=(0,r.useCallback)((e,a)=>{m(t=>(0,C.A)((0,C.A)({},t),{},{[e]:(0,C.A)((0,C.A)({},t[e]),a)}))},[]),p=(0,r.useCallback)((e,a)=>{console.error("[OpenLayersLayers] Erro na camada ".concat(e,":"),a),h(e,{error:a.message})},[h]),x=(0,r.useCallback)(e=>{h(e,{loaded:!0,error:null})},[h]),f=(0,r.useCallback)(()=>{const e={total:0,visible:0,loaded:0,errors:0};return Object.values(u).forEach(a=>{e.total++,a.visible&&e.visible++,a.loaded&&e.loaded++,a.error&&e.errors++}),e},[u]),b=(0,r.useCallback)(()=>({terrasIndigenas:(0,C.A)((0,C.A)({},u.terrasIndigenas),{},{hasData:g.terrasIndigenas,featureCount:g.terrasIndigenas?a.features.length:0}),estadoSP:(0,C.A)((0,C.A)({},u.estadoSP),{},{hasData:g.estadoSP,featureCount:g.estadoSP?t.features.length:0})}),[u,g,a,t]);return(0,r.useEffect)(()=>{const e=f(),a=b();console.log("[OpenLayersLayers] Status das camadas:",{stats:e,info:a,hasValidData:g})},[u,f,b,g]),(0,r.useEffect)(()=>{m(e=>({terrasIndigenas:(0,C.A)((0,C.A)({},e.terrasIndigenas),{},{visible:o}),estadoSP:(0,C.A)((0,C.A)({},e.estadoSP),{},{visible:s})}))},[o,s]),g.terrasIndigenas||g.estadoSP?(0,_.jsxs)("div",{className:i,children:[g.terrasIndigenas&&(0,_.jsx)(Z,{ref:c,data:a,onPainelOpen:n,showTerrasIndigenas:o,map:l,onLoad:()=>x("terrasIndigenas"),onError:e=>p("terrasIndigenas",e)}),g.estadoSP&&(0,_.jsx)(K,{ref:d,data:t,showEstadoSP:s,map:l,onLoad:()=>x("estadoSP"),onError:e=>p("estadoSP",e)})]}):(0,_.jsx)("div",{className:i,children:(0,_.jsx)("div",{className:"text-center text-gray-500 p-4",children:"Nenhuma camada GeoJSON dispon\xedvel"})})},X=r.forwardRef((e,a)=>(0,_.jsx)("div",(0,C.A)({id:"map",className:"w-full h-full",ref:a},e)));m.A.defs("EPSG:4674","+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"),(0,u.kz)(m.A);const Y=e=>{let{dataPoints:a=[],onPainelOpen:t,center:o=H.center,zoom:u=H.zoom,className:m="h-screen w-full",terrasIndigenasData:g=null,estadoSPData:h=null,showTerrasIndigenas:p=!0,showEstadoSP:x=!0,showMarcadores:f=!0,showNomesEscolas:b=!1,onMapReady:v=null}=e;const w=(0,r.useRef)(null),y=(0,r.useRef)(null),j=(0,r.useRef)(null),[,N]=(0,r.useState)({lng:o[0],lat:o[1],zoom:u}),k=(0,r.useMemo)(()=>I(),[]),C=k?H.mobile.center:o,A=k?H.mobile.zoom:u,L=(0,r.useCallback)(()=>({satelliteLayer:new l.A({source:new i.A({url:G.url,attributions:G.attributions,maxZoom:G.maxZoom,wrapX:G.wrapX,tilePixelRatio:G.tilePixelRatio,tileSize:G.tileSize}),preload:1,useInterimTilesOnError:!1})}),[]),S=(0,r.useCallback)(()=>{if(y.current)return;const{satelliteLayer:e}=L();j.current=e,y.current=new s.A({target:w.current,layers:[j.current],view:new n.Ay({center:(0,c.Rb)(C),zoom:A,maxZoom:H.maxZoom,minZoom:H.minZoom,enableRotation:!1}),controls:(0,d.N)({zoom:!1})}),y.current.on("moveend",()=>{const e=y.current.getView(),a=(0,c.WP)(e.getCenter()),t={lng:a[0].toFixed(4),lat:a[1].toFixed(4),zoom:e.getZoom().toFixed(2)};N(t)}),console.log("[OpenLayersMap] Mapa inicializado com sucesso"),"function"===typeof v&&v(y.current)},[C,A,L,v]),z=(0,r.useCallback)(()=>{if(!y.current)return;const e=I(),a=e?H.mobile.center:o,t=e?H.mobile.zoom:u,r=y.current.getView(),s=(0,c.WP)(r.getCenter()),n=r.getZoom();s[0]===a[0]&&s[1]===a[1]&&n===t||(r.setCenter((0,c.Rb)(a)),r.setZoom(t))},[o,u]);return(0,r.useEffect)(()=>(S(),()=>{y.current&&(y.current.setTarget(void 0),"function"===typeof v&&v(null),y.current=null)}),[S,v]),(0,r.useEffect)(()=>{z()},[z]),(0,_.jsx)(X,{ref:w,children:y.current&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(P,{dataPoints:a,onPainelOpen:t,showMarcadores:f,showNomesEscolas:b,map:y.current}),(0,_.jsx)(J,{terrasIndigenasData:g,estadoSPData:h,showTerrasIndigenas:p,showEstadoSP:x,onPainelOpen:t,map:y.current})]})})},$={},Q=e=>{const[a,t]=(0,r.useState)(null),[o,s]=(0,r.useState)(!1),[n,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e)return;(async()=>{if($[e])return M.A.debug("useGeoJSONCache: Dados de ".concat(e," encontrados no cache")),void t($[e]);s(!0);try{var a;const o="".concat("/opin","/").concat(e,".geojson");M.A.debug("useGeoJSONCache: Carregando ".concat(e," de:"),o);const r=await fetch(o);if(!r.ok)throw new Error("Erro ao buscar GeoJSON (".concat(r.status,")"));const s=await r.json();M.A.debug("useGeoJSONCache: ".concat(e," carregado com sucesso:"),{type:s.type,features:(null===(a=s.features)||void 0===a?void 0:a.length)||0}),$[e]=s,t(s)}catch(o){M.A.error("useGeoJSONCache: Erro ao carregar ".concat(e,":"),o),l(o)}finally{s(!1)}})()},[e]),{data:a,loading:o,error:n}},ee=(e,a)=>(0,r.useMemo)(()=>e?{minimized:{path:"M5 15l7-7 7 7",ariaLabel:"Expandir menu"},expanded:{path:"M19 9l-7 7-7-7",ariaLabel:"Minimizar menu"}}:{minimized:{path:"M19 9l-7 7-7-7",ariaLabel:"Expandir menu"},expanded:{path:"M5 15l7-7 7 7",ariaLabel:"Minimizar menu"}},[e]),ae=e=>{let{isMobile:a,isMinimized:t,className:o="w-4 h-4"}=e;const r=ee(a),s=t?r.minimized:r.expanded;return(0,_.jsx)("svg",{className:o,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-label":s.ariaLabel,children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:s.path})})};var te=t(29134),oe=t(91357);const re=e=>{let{dataPoints:a,onPainelOpen:t,painelAberto:o=!1,className:s="h-screen w-full",isMainLoading:n=!1}=e;const{data:l,loading:i,error:c}=Q("terras_indigenas"),{data:d,loading:u,error:m}=Q("SP"),[g,h]=(0,r.useState)(!0),[p,x]=(0,r.useState)(!0),[f,b]=(0,r.useState)(!0),{isMobile:v}=(0,te.d)(),[w,y]=(0,r.useState)(!1),j=(0,r.useCallback)(()=>y(e=>!e),[]),[N,k]=(0,r.useState)(()=>{const e="undefined"!==typeof window?localStorage.getItem("opin:textScale"):null;return e?parseFloat(e):1}),[C,A]=(0,r.useState)(null),I=(0,r.useCallback)(e=>{A(e)},[]),L=(0,r.useCallback)(e=>{if(!C)return;const a=C.getView();if(!a)return;const t=a.getZoom();"number"===typeof t&&a.animate({zoom:t+e,duration:200})},[C]);(0,r.useEffect)(()=>{const e=Math.min(1.3,Math.max(.9,N));if(e!==N)return void k(e);document.documentElement.style.fontSize="".concat(16*e,"px");try{localStorage.setItem("opin:textScale",String(e))}catch(a){}},[N]),(0,r.useEffect)(()=>{var e,a;M.A.debug("MapSelector: Status das camadas GeoJSON:",{terrasIndigenas:{loading:i,error:c,hasData:!!l,features:(null===l||void 0===l||null===(e=l.features)||void 0===e?void 0:e.length)||0},estadoSP:{loading:u,error:m,hasData:!!d,features:(null===d||void 0===d||null===(a=d.features)||void 0===a?void 0:a.length)||0}})},[l,d,i,u,c,m]),(0,r.useEffect)(()=>{!o&&v&&(M.A.debug("MapSelector: Painel fechado em mobile, reativando marcadores"),b(!0))},[o,v]);const S=e=>{let{onMinimize:a,isMobile:t,isMinimized:o}=e;return(0,_.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-green-900/80 to-green-800/80 text-white",children:[(0,_.jsxs)("div",{className:"flex items-center gap-2",children:[(0,_.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"})}),(0,_.jsx)("h3",{className:"text-sm font-semibold tracking-wide",children:"Camadas do Mapa"})]}),(0,_.jsx)("div",{className:"flex items-center gap-2",children:(0,_.jsx)("button",{onClick:a,className:"text-white hover:bg-white/10 transition-all duration-200 p-1.5 rounded-md","aria-label":o?"Expandir":"Minimizar",type:"button",children:(0,_.jsx)(ae,{isMobile:t,isMinimized:o,className:"w-4 h-4"})})})]})},z=e=>{let{id:a,label:t,checked:o,onChange:r,disabled:s=!1,loading:l=!1,error:i=!1}=e;return(0,_.jsxs)("button",{type:"button",onClick:r,disabled:s,className:"group w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 focus:outline-none focus:ring-0 ".concat(o?"bg-white/10":"bg-white/5 hover:bg-white/10"," ").concat(s?"opacity-50 cursor-not-allowed":"cursor-pointer"),children:[(0,_.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,_.jsx)("div",{className:"flex items-center gap-2",children:(0,_.jsx)("span",{className:"text-sm font-medium ".concat(o?"text-white":"text-white/90"),children:t})}),(0,_.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[l&&!n&&(0,_.jsx)("div",{className:"flex items-center gap-1 text-white/80",children:(0,_.jsx)("span",{className:"text-xs",children:"Carregando..."})}),i&&(0,_.jsxs)("div",{className:"flex items-center gap-1 text-red-300",children:[(0,_.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,_.jsx)("span",{className:"text-xs",children:"Erro"})]})]})]}),(0,_.jsx)("div",{className:"flex-shrink-0 ml-2",role:"switch","aria-checked":o,"aria-label":t,children:(0,_.jsx)("div",{className:"relative inline-flex h-5 w-10 items-center rounded-full transition-colors duration-200 ".concat(o?"bg-green-500/70":"bg-gray-300"),children:(0,_.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white shadow transition-transform duration-200 ".concat(o?"translate-x-5":"translate-x-1")})})})]})},E=v?H.mobile.center:H.center,P=v?H.mobile.zoom:H.zoom;return M.A.debug("MapSelector - Configura\xe7\xe3o do mapa:",{isMobile:v,zoom:P,center:E}),(0,_.jsxs)("div",{className:s,style:{position:"relative"},children:[v?(0,_.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,_.jsxs)("div",{className:"bg-green-900/30 backdrop-blur-md shadow-2xl rounded-t-2xl text-white",children:[(0,_.jsx)(S,{onMinimize:j,isMobile:!0,isMinimized:w}),!w&&(0,_.jsxs)("div",{className:"p-4 flex flex-col gap-3 max-h-80 overflow-y-auto",children:[(0,_.jsx)(z,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:p,onChange:()=>x(!p),loading:u,error:m}),(0,_.jsx)(z,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:f,onChange:()=>b(!f)}),(0,_.jsx)(z,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:g,onChange:()=>h(!g),loading:i,error:c})]})]})}):(0,_.jsxs)("div",{className:"fixed top-20 left-4 w-72 bg-green-900/30 backdrop-blur-md rounded-2xl shadow-2xl z-20 overflow-hidden text-white",children:[(0,_.jsx)(S,{onMinimize:j,isMobile:!1,isMinimized:w}),!w&&(0,_.jsxs)("div",{className:"p-4 flex flex-col gap-3 max-h-96 overflow-y-auto",children:[(0,_.jsx)(z,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:p,onChange:()=>x(!p),loading:u,error:m}),(0,_.jsx)(z,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:f,onChange:()=>b(!f)}),(0,_.jsx)(z,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:g,onChange:()=>h(!g),loading:i,error:c})]})]}),(0,_.jsxs)("div",{className:"fixed top-4 left-4 z-30 flex flex-col sm:flex-row items-start sm:items-center gap-3 pointer-events-auto",children:[(0,_.jsxs)(oe.N_,{to:"/",className:"rounded-full bg-green-900/90 hover:bg-green-800 p-3 shadow-lg flex items-center justify-center cursor-pointer transition-all duration-200 backdrop-blur-md","aria-label":"Sair do mapa e voltar para a p\xe1gina inicial",title:"Sair do mapa",children:[(0,_.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,_.jsx)("path",{d:"M16 17L21 12L16 7",stroke:"#CDE8CF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,_.jsx)("path",{d:"M21 12H9",stroke:"#CDE8CF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,_.jsx)("path",{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"#CDE8CF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,_.jsx)("span",{className:"sr-only",children:"Sair do mapa"})]}),(0,_.jsxs)("button",{type:"button",onClick:()=>k(e=>e>=1.3?1:Math.round(100*(e+.15))/100),className:"rounded-full bg-green-900/90 hover:bg-green-800 p-3 shadow-lg flex items-center justify-center cursor-pointer transition-all duration-200 backdrop-blur-md","aria-label":"Ajustar tamanho do texto",title:"Tamanho do texto: ".concat(Math.round(100*N),"% (clique para alterar)"),children:[(0,_.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,_.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.6117 5.00684C6.86862 5.02589 7.11696 5.11134 7.3324 5.25488C7.57862 5.41908 7.77125 5.65263 7.88514 5.92578L11.9232 15.6162C12.1352 16.1258 11.8947 16.7115 11.3851 16.9238C10.8755 17.1362 10.2901 16.8942 10.0775 16.3848L9.08338 14H3.91736L2.92322 16.3857C2.71049 16.8948 2.12502 17.1359 1.6156 16.9238C1.10605 16.7114 0.865522 16.1258 1.07752 15.6162L5.11658 5.92578L5.16248 5.8252C5.27895 5.59518 5.45376 5.39859 5.66932 5.25488L5.76307 5.19727C5.98766 5.07035 6.24213 5.00195 6.50135 5.00195L6.6117 5.00684ZM4.75135 12H8.25037L6.50037 7.80176L4.75135 12Z",fill:"#CDE8CF"}),(0,_.jsx)("path",{d:"M18.0209 6.00098C18.0385 6.00133 18.0561 6.00165 18.0736 6.00293C18.0913 6.00421 18.1089 6.00562 18.1263 6.00781C18.1434 6.00996 18.1602 6.01358 18.1771 6.0166C18.1869 6.01835 18.1968 6.01946 18.2064 6.02148C18.234 6.02726 18.2614 6.03388 18.2885 6.04199C18.2921 6.04309 18.2956 6.04476 18.2992 6.0459C18.317 6.05145 18.3344 6.05789 18.3519 6.06445C18.368 6.07049 18.3841 6.07618 18.3998 6.08301C18.5114 6.13159 18.6161 6.20168 18.7074 6.29297L22.7074 10.293C23.0977 10.6835 23.0979 11.3166 22.7074 11.707C22.3169 12.0975 21.6839 12.0973 21.2933 11.707L19.0004 9.41406V16C19.0004 16.5522 18.5526 16.9999 18.0004 17C17.4481 17 17.0004 16.5523 17.0004 16V9.41406L14.7074 11.707C14.3169 12.0975 13.6839 12.0973 13.2933 11.707C12.9028 11.3165 12.9028 10.6835 13.2933 10.293L17.2933 6.29297C17.3386 6.2477 17.3876 6.20587 17.4408 6.16992C17.4934 6.13439 17.5488 6.10452 17.6058 6.08008C17.6512 6.06059 17.6989 6.04587 17.7474 6.0332C17.7614 6.02955 17.7753 6.0255 17.7894 6.02246C17.8033 6.01948 17.8173 6.01704 17.8314 6.01465C17.847 6.01199 17.8626 6.00973 17.8783 6.00781C17.8961 6.00565 17.914 6.00415 17.932 6.00293C17.948 6.00184 17.9639 6.00131 17.9799 6.00098C17.9866 6.00084 17.9936 6 18.0004 6C18.0072 6 18.0141 6.00084 18.0209 6.00098Z",fill:"#CDE8CF"})]}),(0,_.jsx)("div",{className:"hidden lg:block ml-2 text-green-100 text-sm",children:"Tamanho do texto"})]}),(0,_.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,_.jsx)("button",{type:"button",onClick:()=>L(.5),className:"rounded-full bg-green-900/90 hover:bg-green-800 p-3 shadow-lg flex items-center justify-center cursor-pointer transition-all duration-200 backdrop-blur-md","aria-label":"Aproximar mapa",title:"Aproximar mapa",children:(0,_.jsx)("span",{className:"text-green-100 text-lg font-semibold leading-none",children:"+"})}),(0,_.jsx)("button",{type:"button",onClick:()=>L(-.5),className:"rounded-full bg-green-900/90 hover:bg-green-800 p-3 shadow-lg flex items-center justify-center cursor-pointer transition-all duration-200 backdrop-blur-md","aria-label":"Afastar mapa",title:"Afastar mapa",children:(0,_.jsx)("span",{className:"text-green-100 text-lg font-semibold leading-none",children:"\u2212"})})]})]}),(0,_.jsx)(Y,{dataPoints:f?a:[],onPainelOpen:t,className:"h-full w-full",center:E,zoom:P,terrasIndigenasData:l,estadoSPData:d,showTerrasIndigenas:g,showEstadoSP:p,showMarcadores:f,onMapReady:I})]})},se=r.memo(re);var ne=t(16799);var le=t(52480);const ie=e=>{const[a,t]=(0,r.useState)([]),[o,s]=(0,r.useState)(!0),[n,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{if(console.log("\ud83d\udd04 Iniciando busca de documentos para escola:",e,"tipo:",typeof e),!e)return console.log("\u26a0\ufe0f Nenhum ID de escola fornecido, retornando array vazio"),t([]),void s(!1);try{s(!0),console.log("\ud83d\udce1 Consultando tabela documentos_escola...");const{data:a,error:o}=await le.N.auth.getSession();console.log("\ud83d\udd10 Estado da autentica\xe7\xe3o:",{temSessao:!(null===a||void 0===a||!a.session),error:o});const{error:r}=await le.N.from("documentos_escola").select("count").limit(1);console.log("\ud83d\udd11 Verifica\xe7\xe3o de permiss\xf5es:",{podeAcessar:!r,error:r?{code:r.code,message:r.message,details:r.details,hint:r.hint}:null});const{data:n,error:l}=await le.N.from("documentos_escola").select("*");l?console.error("\u274c Erro ao buscar todos os documentos:",{code:l.code,message:l.message,details:l.details,hint:l.hint}):(console.log("\ud83d\udcca Todos os documentos na tabela:",n),n&&n.length>0?(console.log("\ud83d\udcca Exemplo de documento:",n[0]),console.log("\ud83d\udcca Tipos de escola_id encontrados:",n.map(e=>({id:e.id,escola_id:e.escola_id,tipo_escola_id:typeof e.escola_id,valor_escola_id:e.escola_id})))):console.log("\u26a0\ufe0f Tabela est\xe1 vazia ou n\xe3o temos permiss\xe3o para ver os dados")),console.log("\ud83d\udd0d Buscando documentos para escola_id:",e);const{data:i,error:c}=await le.N.from("documentos_escola").select("*").eq("escola_id",e.toString()).order("created_at",{ascending:!1});if(c)throw console.error("\u274c Erro na consulta Supabase:",{code:c.code,message:c.message,details:c.details,hint:c.hint}),c;if(console.log("\u2705 Documentos encontrados:",(null===i||void 0===i?void 0:i.length)||0),0===(null===i||void 0===i?void 0:i.length)){console.log("\u2139\ufe0f Nenhum documento encontrado para a escola ID:",e),console.log("\u2139\ufe0f Tentando buscar com diferentes formatos de escola_id...");const{data:a,error:t}=await le.N.from("documentos_escola").select("*").eq("escola_id",Number(e)),{data:o,error:r}=await le.N.from("documentos_escola").select("*").eq("escola_id",String(e));console.log("Resultados com escola_id como n\xfamero:",{count:(null===a||void 0===a?void 0:a.length)||0,error:t}),console.log("Resultados com escola_id como string:",{count:(null===o||void 0===o?void 0:o.length)||0,error:r})}else console.log("\ud83d\udcc4 Dados dos documentos:",i);t(i||[])}catch(a){console.error("\u274c Erro ao buscar documentos:",a),l(a.message)}finally{s(!1)}})()},[e]),{documentos:a,isLoading:o,error:n}};var ce=t(57367),de=t(98137),ue=t(21209),me=t(74387),ge=t(79816),he=t(50225),pe=t(99769),xe=t(56863),fe=t(86093),be=t(94183);const ve=(0,r.memo)(e=>{let{children:a,columns:t="auto-fit",gap:o=4,className:r=""}=e;return(0,_.jsx)("div",{className:"grid ".concat({"auto-fit":"grid-cols-2 lg:grid-cols-3",2:"grid-cols-2",3:"grid-cols-2 lg:grid-cols-3",4:"grid-cols-2 lg:grid-cols-4"}[t]," gap-").concat(o," ").concat(r," [&>*]:bg-green-100"),children:a})}),we=(0,r.memo)(e=>{let{data:a,className:t=""}=e;return a&&0!==a.length?(0,_.jsx)("div",{className:"bg-green-100 rounded-lg overflow-hidden ".concat(t),children:(0,_.jsx)("table",{className:"w-full",children:(0,_.jsx)("tbody",{children:a.map((e,a)=>(0,_.jsxs)("tr",{className:a%2===0?"bg-white":"bg-green-50",children:[(0,_.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-700 border-r border-green-200",children:e.label}),(0,_.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.value})]},a))})})}):null}),ye=(0,r.memo)(e=>{let{stats:a,className:t=""}=e;return a&&0!==a.length?(0,_.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 ".concat(t," [&>*]:border-b [&>*]:border-gray-200 [&>*]:pb-2 [&>*]:mb-2"),children:a.map((e,a)=>(0,_.jsxs)("div",{className:"text-center rounded-lg p-4",children:[(0,_.jsx)("div",{className:"flex justify-center mb-2",children:e.icon&&(0,_.jsx)(e.icon,{className:"w-6 h-6 text-gray-700"})}),(0,_.jsx)("div",{className:"text-3xl font-medium text-green-800 mb-1",children:e.value}),(0,_.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:e.label})]},a))}):null}),je=(0,r.memo)(e=>{let{title:a,icon:t,children:o,description:s,defaultCollapsed:n=!1,className:l="",layout:i="default",layoutProps:c={}}=e;const[d,u]=(0,r.useState)(n),m=a&&""!==a.trim();return(0,_.jsxs)("section",{className:"\n        bg-white rounded-2xl p-5\n        shadow-sm transition-all duration-200\n        ".concat(l,"\n      "),children:[m&&(0,_.jsxs)("button",{onClick:()=>u(!d),className:" w-full flex items-center justify-between  text-base sm:text-lg font-semibold mb-4 sm:mb-5 text-gray-900 hover:text-green-800  transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md p-1 -m-1 ","aria-expanded":!d,"aria-controls":"".concat(a,"-content"),id:"".concat(a,"-button"),children:[(0,_.jsxs)("div",{className:"flex items-center gap-2.5 sm:gap-3",children:[t&&(0,_.jsx)(t,{className:"w-5 h-5 text-green-700 flex-shrink-0"}),(0,_.jsx)("span",{className:"tracking-tight leading-tight",children:a})]}),(0,_.jsx)("svg",{className:"w-5 h-5 text-gray-500 transition-transform duration-200 flex-shrink-0 ".concat(d?"":"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(!m||!d)&&(0,_.jsxs)("div",{id:m?"".concat(a,"-content"):void 0,className:"space-y-4 sm:space-y-5 overflow-visible",role:m?"region":void 0,"aria-labelledby":m?"".concat(a,"-button"):void 0,children:[s&&(0,_.jsx)("div",{className:"bg-green-50 border border-green-100 rounded-lg p-4",children:(0,_.jsx)("p",{className:"text-gray-700 text-sm leading-relaxed",style:{lineHeight:"1.7"},children:s})}),(()=>{if(!o)return null;switch(i){case"grid":return(0,_.jsx)(ve,(0,C.A)((0,C.A)({},c),{},{children:o}));case"table":return(0,_.jsx)(we,{data:c.data,className:c.className});case"stats":return(0,_.jsx)(ye,{stats:c.stats,className:c.className});default:return(0,_.jsx)("div",{className:"space-y-4",children:o})}})()]})]})}),Ne=(0,r.memo)(e=>{let{icon:a,label:t,value:o,type:s="text",className:n="",iconColor:l="green",showIconCircle:i=!0,description:c=null,layout:d="vertical",category:u=null}=e;if(null===o||void 0===o)return null;if("string"===typeof o&&""===o.trim())return null;const m=()=>{switch(s){case"number":const e=o||0;return(0,_.jsx)("div",{className:"text-center w-full flex items-center justify-center h-full min-w-0",children:(0,_.jsx)("div",{className:"text-3xl font-semibold text-green-800 truncate",style:{fontSize:"1.875rem",fontWeight:"600",color:"#166534",lineHeight:"1.2"},title:String(e),children:e.toLocaleString("pt-BR")})});case"boolean":return o?(0,_.jsxs)("span",{className:"flex items-center gap-1.5 text-green-700 text-sm font-semibold",children:[(0,_.jsx)("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,_.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Sim"]}):(0,_.jsxs)("span",{className:"flex items-center gap-1.5 text-gray-600 text-sm font-semibold",children:[(0,_.jsx)("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,_.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"N\xe3o"]});default:if(r.isValidElement(o))return o;const a=String(o||""),t=a.length>30;return(0,_.jsx)("div",{className:"text-sm text-gray-800 ".concat(t?"text-left":"text-center"," w-full font-medium leading-relaxed break-words px-2"),style:{lineHeight:"1.6"},children:a})}},g={green:{bg:"#D1FAE5",icon:"#166534"},teal:{bg:"#14B8A6",icon:"#FFFFFF"},blue:{bg:"#3B82F6",icon:"#FFFFFF"}},h=g[l]||g.green;if("horizontal"===d)return(0,_.jsxs)("div",{className:"\n          rounded-xl p-4 \n          overflow-visible\n          card-container\n          relative\n          ".concat(n,"\n        "),style:{border:"none",outline:"none",backgroundColor:"#D1FAE5"},children:[a&&(0,_.jsx)("div",{className:"absolute -top-3 -left-3 z-10",style:{transform:"translate(0, 0)"},children:i?(0,_.jsx)("div",{className:"rounded-full p-2 flex items-center justify-center",style:{backgroundColor:h.bg,width:"40px",height:"40px"},children:(0,_.jsx)(a,{className:"w-5 h-5",style:{color:h.icon}})}):(0,_.jsx)("div",{className:"bg-white rounded-full p-2 border-2 border-gray-200",children:(0,_.jsx)(a,{className:"w-5 h-5 text-gray-700"})})}),(0,_.jsx)("div",{className:"flex items-center relative z-20",children:(0,_.jsxs)("div",{className:"flex-1 min-w-0 relative z-20",children:[u&&(0,_.jsx)("div",{className:"text-xs font-semibold text-teal-600 uppercase tracking-wide mb-1.5 break-words relative z-20",style:{lineHeight:"1.5"},children:u}),(0,_.jsx)("h5",{className:"font-medium leading-relaxed break-words relative z-20 ".concat(u?"text-base text-gray-700":"text-sm text-gray-700"),style:{lineHeight:"1.6"},children:"number"===s?(0,_.jsx)("span",{className:"text-lg font-semibold text-gray-700",children:o||"0"}):"boolean"===s?m():r.isValidElement(o)?o:(0,_.jsx)("span",{className:"break-words",children:String(o||t)})})]})}),c&&(0,_.jsx)("div",{className:"text-xs text-gray-700 leading-relaxed mt-2 pt-2 border-t border-gray-200 whitespace-pre-line break-words relative z-20",style:{lineHeight:"1.6"},children:c})]});const p=n.includes("h-[")||n.includes("h-auto")||n.includes("min-h-[")?"":"min-h-[140px]",x=("text"===s||!s||"default"===s)&&(o&&"string"===typeof o)&&String(o).trim().length>20;return(0,_.jsxs)("div",{className:"\n        rounded-xl p-4 \n        ".concat(p," flex flex-col\n        overflow-visible\n        card-container\n        relative\n        ").concat(n,"\n      "),style:{border:"none",outline:"none",backgroundColor:"#D1FAE5"},children:[a&&(0,_.jsx)("div",{className:"absolute -top-3 -left-3 z-10",style:{transform:"translate(0, 0)"},children:i?(0,_.jsx)("div",{className:"rounded-full p-2 flex items-center justify-center",style:{backgroundColor:h.bg,width:"40px",height:"40px"},children:(0,_.jsx)(a,{className:"w-5 h-5",style:{color:h.icon}})}):(0,_.jsx)("div",{className:"bg-white rounded-full p-2 border-2 border-gray-200",children:(0,_.jsx)(a,{className:"w-5 h-5 text-gray-700"})})}),(0,_.jsxs)("div",{className:"flex flex-col relative z-20",children:[(0,_.jsx)("div",{className:"flex items-center justify-center mb-2 flex-shrink-0 min-h-[32px] pt-1 relative z-20",children:(0,_.jsx)("div",{className:"text-xs text-gray-700 font-semibold leading-tight text-center uppercase tracking-wide break-words px-2 relative z-20",style:{lineHeight:"1.5"},children:t})}),(0,_.jsx)("div",{className:"".concat(x?"flex-grow flex items-start justify-center py-2":"flex-1 flex items-center justify-center"," relative z-20"),children:m()}),c&&(0,_.jsx)("div",{className:"text-xs text-gray-700 leading-relaxed mt-2 pt-2 border-t border-gray-200 break-words relative z-20",style:{lineHeight:"1.6"},children:c})]})]})});Ne.displayName="NativeLandCard";const ke=Ne,Ce=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"",Ae=e=>{let{escola:a}=e;if(!(a.logradouro||a.numero||a.bairro||a.cep))return(0,_.jsx)("div",{className:"p-2.5 bg-green-50 border border-green-100 rounded-md",children:(0,_.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed break-words",style:{lineHeight:"1.6"},children:Ce(a.endereco)})});return(0,_.jsxs)("div",{className:"space-y-2",children:[[{field:"logradouro",label:"Logradouro"},{field:"numero",label:"N\xfamero"},{field:"complemento",label:"Complemento"},{field:"bairro",label:"Bairro"}].map(e=>{let{field:t,label:o}=e;return a[t]&&(0,_.jsxs)("div",{className:"flex items-start gap-2.5 p-2.5 bg-green-50 border border-green-100 rounded-md",children:[(0,_.jsx)(ue.A,{className:"w-5 h-5 text-green-700 mt-0.5 flex-shrink-0","aria-hidden":"true"}),(0,_.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,_.jsx)("div",{className:"text-xs font-semibold text-gray-800 mb-1",children:o}),(0,_.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed break-words",style:{lineHeight:"1.6"},children:a[t]})]})]},t)}),(a.cep||a.estado)&&(0,_.jsxs)("div",{className:"flex items-start gap-2.5 p-2.5 bg-green-50 border border-green-100 rounded-md",children:[(0,_.jsx)(ue.A,{className:"w-5 h-5 text-green-700 mt-0.5 flex-shrink-0","aria-hidden":"true"}),(0,_.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,_.jsx)("div",{className:"text-xs font-semibold text-gray-800 mb-1",children:"Localiza\xe7\xe3o"}),(0,_.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed break-words",style:{lineHeight:"1.6"},children:[a.municipio,a.estado,a.cep].filter(Boolean).join(", ")})]})]})]})},Ie=e=>{let{escola:a}=e;if(!(a.Latitude&&a.Longitude))return null;return(0,_.jsxs)("button",{onClick:()=>{window.open("https://www.google.com/maps?q=".concat(a.Latitude,",").concat(a.Longitude),"_blank")},className:"w-full flex items-center justify-center gap-2 p-2.5 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white rounded-md transition-colors text-sm font-semibold mt-3 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",children:[(0,_.jsx)(me.A,{className:"w-5 h-5","aria-hidden":"true"}),"Ver no Google Maps"]})},Le=e=>{let{links:a,expanded:t,onToggle:o}=e;const r=(a||"").split(",").map(e=>e.trim()).filter(Boolean);return 0===r.length?null:(0,_.jsxs)("div",{className:"bg-green-100 rounded-md",children:[(0,_.jsxs)("button",{onClick:()=>o("social"),className:"w-full flex justify-between items-center p-2.5 hover:bg-green-100 text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 rounded-md","aria-expanded":t.social,children:[(0,_.jsxs)("span",{className:"flex items-center gap-2 text-gray-800 font-semibold",children:[(0,_.jsx)(ge.A,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"}),"Redes sociais (",r.length,")"]}),(0,_.jsx)(he.A,{className:"w-5 h-5 text-gray-500 transition-transform ".concat(t.social?"rotate-90":""),"aria-hidden":"true"})]}),t.social&&(0,_.jsx)("div",{className:"px-3 pb-3 border-t border-green-200 bg-white",children:(0,_.jsx)("div",{className:"mt-2 space-y-2",children:r.map((e,a)=>(0,_.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-green-50 rounded-md hover:bg-green-100 group text-sm transition-colors",children:[(0,_.jsx)(pe.A,{className:"w-5 h-5 text-blue-600 flex-shrink-0","aria-hidden":"true"}),(0,_.jsx)("span",{className:"truncate flex-1 text-gray-700 font-medium",children:e}),(0,_.jsx)(xe.A,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-600 flex-shrink-0","aria-hidden":"true"})]},a))})})]})},Se=(0,r.memo)(e=>{let{escola:a}=e;const[t,o]=(0,r.useState)({});if(!a)return null;const s=e=>{o(a=>(0,C.A)((0,C.A)({},a),{},{[e]:!a[e]}))},n=e=>null===e||void 0===e||("string"===typeof e&&""===e.trim()||!("number"!==typeof e||!isNaN(e))),l=e=>{if(!e)return!1;if(r.isValidElement(e))return!1;if("string"===typeof e){const a=e.trim();return a.length>30||a.includes(",")&&a.length>20}return!1},i=[...[{icon:fe.A,label:"Munic\xedpio",value:Ce(a.municipio)},{icon:be.A,label:"Funda\xe7\xe3o",value:a.ano_criacao,type:"number"},{icon:ge.A,label:"Redes sociais",value:a.usa_redes_sociais,type:"boolean"}].filter(e=>!n(e.value))];return a.diretoria_ensino&&!n(a.diretoria_ensino)&&i.push({icon:fe.A,label:"Diretoria de ensino",value:a.diretoria_ensino}),(0,_.jsxs)(_.Fragment,{children:[a.povos_indigenas&&(0,_.jsx)("div",{className:"mb-4",children:(0,_.jsxs)("div",{className:"text-lg sm:text-xl font-bold text-green-800 leading-tight",children:["Povos Ind\xedgenas: ",(0,_.jsx)("span",{className:"font-semibold text-gray-900",children:a.povos_indigenas})]})}),(0,_.jsxs)(je,{title:"Localiza\xe7\xe3o",icon:ue.A,children:[(()=>{const e=i.filter(e=>l(e.value)),a=i.filter(e=>!l(e.value));return(0,_.jsxs)(_.Fragment,{children:[e.length>0&&(0,_.jsx)("div",{className:"space-y-3 mb-4",style:{paddingTop:"12px",paddingLeft:"12px"},children:e.map((e,a)=>(0,_.jsx)(ke,(0,C.A)((0,C.A)({},e),{},{showIconCircle:!0}),"long-".concat(a)))}),a.length>0&&(0,_.jsx)("div",{className:"grid ".concat((t=a.length,0===t||1===t?"grid-cols-1":2===t?"grid-cols-2":"grid-cols-3 lg:grid-cols-3")," gap-2 sm:gap-3 ").concat((e.length,"mb-4")," items-stretch overflow-visible"),style:{paddingTop:"12px",paddingLeft:"12px"},children:a.map((e,a)=>(0,_.jsx)(ke,(0,C.A)((0,C.A)({},e),{},{showIconCircle:!0}),"normal-".concat(a)))})]});var t})(),(0,_.jsxs)("div",{className:"space-y-1.5",children:[a.endereco&&(0,_.jsxs)("div",{className:"bg-green-100 rounded-md",children:[(0,_.jsxs)("button",{onClick:()=>s("endereco"),className:"w-full flex justify-between items-center p-2.5 hover:bg-green-100 text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 rounded-md","aria-expanded":t.endereco,children:[(0,_.jsxs)("span",{className:"flex items-center gap-2 text-gray-800 font-semibold",children:[(0,_.jsx)(fe.A,{className:"w-5 h-5 text-green-700","aria-hidden":"true"}),"Endere\xe7o"]}),(0,_.jsx)(he.A,{className:"w-5 h-5 text-gray-500 transition-transform ".concat(t.endereco?"rotate-90":""),"aria-hidden":"true"})]}),t.endereco&&(0,_.jsxs)("div",{className:"px-3 pb-3 border-t border-green-200 bg-white",children:[(0,_.jsx)(Ae,{escola:a}),(0,_.jsx)(Ie,{escola:a})]})]}),(0,_.jsx)(Le,{links:a.links_redes_sociais,expanded:t,onToggle:s})]})]})]})}),ze=Se,Ee=e=>{let{htmlContent:a}=e;return(0,_.jsx)("div",{className:"historia-escola-content prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 prose-strong:text-green-800 prose-em:text-green-700 prose-blockquote:border-l-green-300 prose-blockquote:bg-green-50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:rounded-r-lg prose-ul:text-black prose-ol:text-black prose-li:text-black prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm",dangerouslySetInnerHTML:{__html:a}})},Me=()=>(0,_.jsx)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:(0,_.jsxs)("div",{className:"flex items-center gap-3",children:[(0,_.jsx)("span",{className:"bg-green-200 rounded-full flex items-center justify-center w-16 h-16 sm:w-28 sm:h-28",children:(0,_.jsx)("img",{src:"".concat("/opin","/onca.svg"),alt:"\xcdcone de on\xe7a",className:"w-18 h-18 sm:w-36 sm:h-36",style:{filter:"none",borderRadius:"0",boxShadow:"none",margin:"0",padding:"0",border:"none",outline:"none",transform:"translateY(17px)"},"aria-hidden":"true"})}),(0,_.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-black m-0",children:"Hist\xf3ria da Escola"})]})}),_e=(0,r.memo)(e=>{let{escola:a,refreshKey:t=0,isMaximized:o=!1}=e;if(null===a||void 0===a||!a.historia_da_escola)return null;const r=a.historia_da_escola;return(0,_.jsxs)("div",{className:"mt-8 mb-12 flex flex-col items-center w-full",children:[(0,_.jsxs)("header",{className:"historia-escola-header mb-6 sm:mb-8 w-full max-w-4xl mx-auto",children:[(0,_.jsx)(Me,{}),(0,_.jsx)("div",{className:"h-1 w-20 sm:w-24 bg-green-300 rounded-full"})]}),(0,_.jsx)("article",{className:" px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg prose prose-sm sm:prose-base md:prose-lg lg:prose-xl prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 max-w-4xl mx-auto w-full ",children:(0,_.jsx)(Ee,{htmlContent:r})})]})});var Pe=t(56735),Te=t(12065),Fe=t(43531),De=t(80197),He=t(98242);const Re=(0,r.memo)(e=>{let{value:a}=e;return void 0===a||null===a?null:(0,_.jsx)("span",{className:"font-medium text-center w-full block ".concat(a?"text-green-600":"text-neutral-400"),children:a?"Sim":"N\xe3o"})});const Oe=e=>{let{items:a}=e;return a&&0!==a.length?(0,_.jsx)("div",{className:"text-sm text-gray-800 text-left w-full font-medium leading-relaxed break-words px-2",children:(0,_.jsx)("ul",{className:"list-none pl-0 ml-0 space-y-1.5",children:a.map((e,a)=>(0,_.jsxs)("li",{className:"leading-relaxed m-0 p-0 pl-0 ml-0 flex items-start",style:{lineHeight:"1.7"},children:[(0,_.jsx)("span",{className:"mr-2 text-green-700 select-none font-bold flex-shrink-0",style:{minWidth:"0.75em",display:"inline-block"},"aria-hidden":"true",children:"\u2022"}),(0,_.jsx)("span",{className:"flex-1",children:e})]},a))})}):null},Ue=e=>{if(!e)return!1;if(r.isValidElement(e))return!1;if("string"===typeof e){const a=e.trim();return a.length>30||a.includes(",")&&a.length>20}return!1},Be=(0,r.memo)(e=>{let{escola:a}=e;if(!a)return null;const t=a.turnos_funcionamento||a.turnos_funcionamento||"",o=(r=a.modalidade_ensino)&&"string"===typeof r?r.split("\u2013").map(e=>e.trim()).filter(Boolean):[];var r;const s=[t&&{icon:Pe.A,label:"Turnos de Funcionamento",value:t},{icon:Te.A,label:"N\xfamero de Alunos",value:a.numero_alunos||"0",type:"number"},{icon:Fe.A,label:"L\xednguas Faladas",value:a.linguas_faladas},{icon:De.A,label:"Material Pedag\xf3gico N\xe3o Ind\xedgena",value:(0,_.jsx)(Re,{value:a.material_nao_indigena})},{icon:De.A,label:"Material Pedag\xf3gico Ind\xedgena",value:(0,_.jsx)(Re,{value:a.material_indigena})},{icon:De.A,label:"PPP Pr\xf3prio",value:(0,_.jsx)(Re,{value:a.ppp_proprio})},{icon:De.A,label:"PPP com Comunidade",value:(0,_.jsx)(Re,{value:a.ppp_comunidade})}].filter(Boolean).filter(e=>{return!(null===(a=e.value)||void 0===a||"string"===typeof a&&""===a.trim()||"number"===typeof a&&isNaN(a));var a});return 0===s.length&&0===o.length?null:(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(je,{children:[o.length>0&&(0,_.jsx)("div",{className:"mb-4",style:{paddingTop:"12px",paddingLeft:"12px"},children:(0,_.jsx)(ke,{icon:He.A,label:"Modalidade de Ensino",value:(0,_.jsx)(Oe,{items:o}),showIconCircle:!0})}),s.length>0&&(()=>{const e=s.filter(e=>Ue(e.value)),a=s.filter(e=>!Ue(e.value));return(0,_.jsxs)(_.Fragment,{children:[e.length>0&&(0,_.jsx)("div",{className:"space-y-3 ".concat(o.length>0?"mt-3":"mt-1"),style:{paddingTop:"12px",paddingLeft:"12px"},children:e.map((e,a)=>(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:e.value,type:e.type,showIconCircle:!0},"long-".concat(a)))}),a.length>0&&(0,_.jsx)("div",{className:"grid ".concat((t=a.length,0===t||1===t?"grid-cols-1":2===t?"grid-cols-2":"grid-cols-3 lg:grid-cols-3")," gap-2 sm:gap-3 ").concat(e.length>0||o.length>0?"mt-3":"mt-1"," items-stretch overflow-visible"),style:{paddingTop:"12px",paddingLeft:"12px"},children:a.map((e,a)=>(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:e.value,type:e.type,showIconCircle:!0},"normal-".concat(a)))})]});var t})()]})})});var Ve=t(52499),We=t(31184),qe=t(26920),Ge=t(1799),Ze=t(64758),Ke=t(98493),Je=t(141),Xe=t(31441);const Ye=e=>{if(!e)return!1;if(r.isValidElement(e))return!1;if("string"===typeof e){const a=e.trim();return a.length>30||a.includes(",")&&a.length>20}return!1},$e=(0,r.memo)(e=>{let{escola:a}=e;if(!a)return null;const t=[{icon:Ve.A,label:"Acesso \xe0 \xc1gua",value:a.acesso_agua},{icon:We.A,label:"Coleta de Lixo",value:a.coleta_lixo},{icon:qe.A,label:"Acesso \xe0 Internet",value:(0,_.jsx)(Re,{value:a.acesso_internet})},{icon:Ge.A,label:"Equipamentos Tecnol\xf3gicos",value:a.equipamentos},{icon:ue.A,label:"Modo de Acesso \xe0 Escola",value:a.modo_acesso},{icon:Ze.A,label:"Cozinha",value:(0,_.jsx)(Re,{value:a.cozinha})},{icon:Ke.A,label:"Merenda Escolar",value:(0,_.jsx)(Re,{value:a.merenda_escolar})},{icon:Je.A,label:"Merenda Diferenciada",value:(0,_.jsx)(Re,{value:a.diferenciada})}].filter(e=>{return!(null===(a=e.value)||void 0===a||"string"===typeof a&&""===a.trim()||"number"===typeof a&&isNaN(a));var a});if(0===t.length)return null;const o=t.filter(e=>Ye(e.value)),r=t.filter(e=>!Ye(e.value));return(0,_.jsxs)(je,{title:"Infraestrutura",icon:Xe.A,children:[a.espaco_escolar&&(0,_.jsx)("div",{className:"p-3 text-sm text-gray-700 border-b border-gray-200 whitespace-pre-wrap leading-relaxed mb-4",style:{lineHeight:"1.7"},children:a.espaco_escolar}),o.length>0&&(0,_.jsx)("div",{className:"space-y-3 mt-3",style:{paddingTop:"12px",paddingLeft:"12px"},children:o.map((e,a)=>(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:e.value,showIconCircle:!0},"long-".concat(a)))}),r.length>0&&(0,_.jsx)("div",{className:"grid ".concat((s=r.length,0===s||1===s?"grid-cols-1":2===s?"grid-cols-2":"grid-cols-3 lg:grid-cols-3")," gap-2 sm:gap-3 ").concat((o.length,"mt-3")," items-stretch overflow-visible"),style:{paddingTop:"12px",paddingLeft:"12px"},children:r.map((e,a)=>(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:e.value,showIconCircle:!0},"normal-".concat(a)))})]});var s});var Qe=t(193),ea=t(7669),aa=t(12427),ta=t(86635),oa=t(21172),ra=t(29449),sa=t(74562),na=t(63626);const la=e=>{const a=String(e).trim().toLowerCase();return"sim"===a?(0,_.jsxs)("div",{className:"flex items-center gap-1 text-green-700",children:[(0,_.jsx)(Qe.A,{className:"w-5 h-5"}),"Sim"]}):"n\xe3o"===a||"nao"===a?(0,_.jsxs)("div",{className:"flex items-center gap-1 text-gray-500",children:[(0,_.jsx)(ea.A,{className:"w-5 h-5"}),"N\xe3o"]}):e},ia=e=>null===e||void 0===e||("string"===typeof e&&""===e.trim()||!("number"!==typeof e||!isNaN(e))),ca=e=>{if(!e)return!1;if(r.isValidElement(e))return!1;if("string"===typeof e){const a=e.trim();return a.length>30||a.includes(",")&&a.length>20}return!1},da=(0,r.memo)(e=>{let{escola:a}=e;if(!a)return null;const t=(e=>{if(!e)return null;const[a,...t]=e.split("/"),o=t.join("/").trim();return{status:"sim"===a.trim().toLowerCase()?"Sim":a.trim(),descricao:o||null}})(a.formacao_professores),o=(e=>{if(!e)return null;const[a,...t]=e.split("/"),o=t.join("/").trim();return{status:"sim"===a.trim().toLowerCase()?"Sim":a.trim(),descricao:o||null}})(a.formacao_continuada),r=[!ia(a.professores_indigenas)&&{icon:aa.A,label:"Professores Ind\xedgenas",value:a.professores_indigenas,type:"number"},!ia(a.professores_nao_indigenas)&&{icon:ta.A,label:"Professores N\xe3o Ind\xedgenas",value:a.professores_nao_indigenas,type:"number"},!ia(a.professores_falam_lingua)&&{icon:Fe.A,label:"Professores que falam l\xedngua ind\xedgena",value:la(a.professores_falam_lingua)}].filter(Boolean);return(0,_.jsxs)(je,{title:"Gestores",icon:oa.A,children:[(0,_.jsxs)("div",{className:"space-y-4 mt-1",children:[(()=>{const e=r.filter(e=>ca(e.value)),a=r.filter(e=>!ca(e.value));return(0,_.jsxs)(_.Fragment,{children:[e.length>0&&(0,_.jsx)("div",{className:"space-y-3",style:{paddingTop:"12px",paddingLeft:"12px"},children:e.map((e,a)=>(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:e.value,type:e.type,showIconCircle:!0},"long-".concat(a)))}),a.length>0&&(0,_.jsx)("div",{className:"grid ".concat((t=a.length,0===t||1===t?"grid-cols-1":2===t?"grid-cols-2":"grid-cols-3 lg:grid-cols-3")," gap-2 sm:gap-3 ").concat(e.length>0?"mt-3":""," items-stretch overflow-visible"),style:{paddingTop:"12px",paddingLeft:"12px"},children:a.map((e,a)=>(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:e.value,type:e.type,showIconCircle:!0},"normal-".concat(a)))})]});var t})(),(null===t||void 0===t?void 0:t.status)&&(0,_.jsx)("div",{style:{paddingTop:"12px",paddingLeft:"12px"},children:(0,_.jsx)(ke,{icon:ra.A,label:"Forma\xe7\xe3o dos Professores",value:la(t.status),description:t.descricao,showIconCircle:!0,className:"h-auto min-h-[140px]"})})]}),(0,_.jsxs)("div",{className:"space-y-4 mt-4",children:[!ia(a.gestao)&&(0,_.jsx)("div",{style:{paddingTop:"12px",paddingLeft:"12px"},children:(0,_.jsx)(ke,{icon:sa.A,label:"Gest\xe3o/Nome",value:a.gestao,showIconCircle:!0})}),!ia(a.outros_funcionarios)&&(0,_.jsx)("div",{style:{paddingTop:"12px",paddingLeft:"12px"},children:(0,_.jsx)(ke,{icon:oa.A,label:"Outros Funcion\xe1rios",value:a.outros_funcionarios,showIconCircle:!0})}),(null===o||void 0===o?void 0:o.status)&&(0,_.jsx)("div",{style:{paddingTop:"12px",paddingLeft:"12px"},children:(0,_.jsx)(ke,{icon:na.A,label:"Visitas de Supervisores e Forma\xe7\xe3o Continuada",value:la(o.status),description:o.descricao,showIconCircle:!0,className:"h-auto min-h-[140px]"})})]})]})});var ua=t(46192),ma=t(24621),ga=t(21204);const ha=(0,r.memo)(e=>{let{escola:a}=e;if(!a)return null;const t=[{field:"projetos_andamento",icon:De.A,label:"Projetos em andamento"},{field:"parcerias_universidades",icon:ua.A,label:"Parcerias com universidades"},{field:"acoes_ongs",icon:Te.A,label:"A\xe7\xf5es com ONGs ou coletivos"},{field:"desejos_comunidade",icon:ma.A,label:"Desejos da comunidade para a escola"},{field:"parcerias_municipio",icon:ga.A,label:"Parcerias com o munic\xedpio"}].filter(e=>a[e.field]&&a[e.field].trim());return 0===t.length?null:(0,_.jsx)(je,{title:"Projetos e Parcerias",icon:ga.A,children:(0,_.jsx)("div",{className:"grid grid-cols-1 gap-4 items-stretch overflow-visible",style:{paddingTop:"12px",paddingLeft:"12px"},children:t.map(e=>{const t=a[e.field],o="n\xe3o"===(null===t||void 0===t?void 0:t.trim().toLowerCase());return(0,_.jsx)("div",{className:"relative mt-3",children:(0,_.jsx)(ke,{icon:e.icon,label:e.label,value:o?"N\xe3o":t,layout:"vertical",showIconCircle:!0,className:"h-auto"})},e.field)})})})});var pa=t(38438),xa=t(82006),fa=t(40237),ba=t(57908),va=t(49147),wa=t(35757);const ya=e=>{let{images:a=[],currentImageIndex:t=0,isOpen:o=!1,onClose:s,onImageChange:n,showNavigation:l=!0,showControls:i=!0,showCounter:c=!0,showCaption:d=!0}=e;const[u,m]=(0,r.useState)(1),[g,h]=(0,r.useState)(0),[p,x]=(0,r.useState)(t);(0,r.useEffect)(()=>{m(1),h(0),x(t)},[t,o]);const f=a[p],b=(0,r.useCallback)(()=>{m(1),h(0),s()},[s]),v=()=>{m(1),h(0)},w=(0,r.useCallback)(()=>{if(p<a.length-1){const e=p+1;x(e),n&&n(e)}},[p,a.length,n]),y=(0,r.useCallback)(()=>{if(p>0){const e=p-1;x(e),n&&n(e)}},[p,n]);return(0,r.useEffect)(()=>{const e=e=>{"Escape"===e.key&&b()};if(o)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,b]),(0,r.useEffect)(()=>{const e=e=>{if(o)switch(e.key){case"ArrowLeft":e.preventDefault(),y();break;case"ArrowRight":e.preventDefault(),w();break;case"r":case"R":e.preventDefault(),h(e=>(e+90)%360);break;case"+":case"=":e.preventDefault(),m(e=>Math.min(e+.25,3));break;case"-":e.preventDefault(),m(e=>Math.max(e-.25,.5));break;case"0":e.preventDefault(),v()}};if(o)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,p,a.length,w,y]),o&&f?(0,_.jsxs)("div",{className:"image-zoom-modal",onClick:b,children:[(0,_.jsx)("button",{onClick:b,className:"image-zoom-close","aria-label":"Fechar",children:(0,_.jsx)(ea.A,{size:24})}),i&&(0,_.jsxs)("div",{className:"image-zoom-controls",children:[(0,_.jsx)("button",{onClick:e=>{e.stopPropagation(),m(e=>Math.min(e+.25,3))},className:"image-zoom-control-button","aria-label":"Aumentar zoom",children:(0,_.jsx)(ba.A,{size:20})}),(0,_.jsx)("button",{onClick:e=>{e.stopPropagation(),m(e=>Math.max(e-.25,.5))},className:"image-zoom-control-button","aria-label":"Diminuir zoom",children:(0,_.jsx)(va.A,{size:20})}),(0,_.jsx)("button",{onClick:e=>{e.stopPropagation(),h(e=>(e+90)%360)},className:"image-zoom-control-button","aria-label":"Rotacionar",children:(0,_.jsx)(wa.A,{size:20})}),(0,_.jsx)("button",{onClick:e=>{e.stopPropagation(),v()},className:"image-zoom-control-button text-xs px-3","aria-label":"Resetar",children:"Reset"})]}),l&&a.length>1&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("button",{onClick:e=>{e.stopPropagation(),y()},className:"image-zoom-navigation prev",disabled:0===p,"aria-label":"Imagem anterior",children:(0,_.jsx)(pa.A,{size:24})}),(0,_.jsx)("button",{onClick:e=>{e.stopPropagation(),w()},className:"image-zoom-navigation next",disabled:p===a.length-1,"aria-label":"Pr\xf3xima imagem",children:(0,_.jsx)(he.A,{size:24})})]}),c&&a.length>1&&(0,_.jsxs)("div",{className:"image-zoom-counter",children:[p+1," / ",a.length]}),(0,_.jsxs)("div",{className:"image-zoom-container",children:[(0,_.jsx)("div",{className:"image-zoom-image-wrapper",children:(0,_.jsx)("img",{src:f.url||f.publicURL||f.imagem_public_url,alt:f.descricao||f.descricao_imagem||"Imagem",className:"image-zoom-image",style:{transform:"scale(".concat(u,") rotate(").concat(g,"deg)"),cursor:"grab"},onClick:e=>e.stopPropagation(),onMouseDown:e=>{e.preventDefault()}})}),d&&(f.descricao||f.descricao_imagem)&&(0,_.jsxs)("div",{className:"image-zoom-caption",children:[(0,_.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:f.descricao||f.descricao_imagem}),(0,_.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[f.categoria&&(0,_.jsx)("span",{className:"capitalize bg-gray-100 px-2 py-1 rounded text-gray-800",children:f.categoria}),f.autor&&(0,_.jsxs)("span",{children:["Fot\xf3grafo: ",f.autor]}),f.dataFoto&&(0,_.jsxs)("span",{children:["Data: ",new Date(f.dataFoto).toLocaleDateString("pt-BR")]})]}),f.descricaoDetalhada&&(0,_.jsx)("p",{className:"text-gray-600 leading-relaxed",children:f.descricaoDetalhada})]})]}),(0,_.jsx)("div",{className:"image-zoom-instructions",children:(0,_.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,_.jsx)("div",{children:"ESC: Fechar | \u2190 \u2192: Navegar | R: Rotacionar"}),(0,_.jsx)("div",{children:"+ -: Zoom | 0: Reset"})]})})]}):null},ja=["src","alt","className","isPreloaded","placeholder","onLoad","onError"],Na=e=>{let{src:a,alt:t,className:s="",isPreloaded:n=!1,placeholder:l=null,onLoad:i,onError:c}=e,d=(0,o.A)(e,ja);const[u,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),[p,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{n&&(m(!0),x(!0))},[n]);return g?l||null:(0,_.jsxs)("div",{className:"relative overflow-hidden ".concat(s),children:[!u&&(0,_.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:(0,_.jsx)("div",{className:"flex flex-col items-center space-y-2",children:(0,_.jsx)("div",{className:"text-xs text-gray-500",children:"Carregando..."})})}),(0,_.jsx)("img",(0,C.A)({src:a,alt:t,className:"w-full h-full object-cover transition-all duration-500 ease-out ".concat(p?"opacity-100 scale-100":"opacity-0 scale-105"),onLoad:()=>{m(!0),h(!1),x(!0),i&&i()},onError:()=>{h(!0),m(!1),c&&c()}},d))]})},ka=function(e){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[t,o]=(0,r.useState)(new Map),[s,n]=(0,r.useState)(!1),l=(0,r.useRef)(null),i=async e=>{const a=e.map(e=>(e=>new Promise((a,t)=>{const o=new Image;o.onload=()=>a(e),o.onerror=()=>t(new Error("Failed to load image: ".concat(e))),o.src=e}))(e).catch(a=>(M.A.warn("Erro ao preload da imagem:",e,a),null)));return(await Promise.all(a)).filter(Boolean)},c=async()=>{if(e&&a){n(!0),M.A.debug("\ud83d\uddbc\ufe0f Iniciando preload de imagens para escola:",e);try{const{data:a}=await le.N.storage.from("imagens-das-escolas").list("".concat(e,"/")),{data:t}=await le.N.storage.from("imagens-professores").list("".concat(e,"/")),r=[];if(a&&a.length>0&&a.forEach(a=>{const{data:{publicUrl:t}}=le.N.storage.from("imagens-das-escolas").getPublicUrl("".concat(e,"/").concat(a.name));r.push(t)}),t&&t.length>0&&t.forEach(a=>{const{data:{publicUrl:t}}=le.N.storage.from("imagens-professores").getPublicUrl("".concat(e,"/").concat(a.name));r.push(t)}),M.A.debug("\ud83d\uddbc\ufe0f Preload: ".concat(r.length," imagens encontradas")),r.length>0){const e=5,a=[];for(let o=0;o<r.length;o+=e)a.push(r.slice(o,o+e));for(let o=0;o<a.length;o++){const e=a[o];M.A.debug("\ud83d\uddbc\ufe0f Preload lote ".concat(o+1,"/").concat(a.length,": ").concat(e.length," imagens")),await i(e),o<a.length-1&&await new Promise(e=>setTimeout(e,200))}const t=new Map;r.forEach(e=>{t.set(e,!0)}),o(t),M.A.debug("\u2705 Preload conclu\xeddo:",r.length,"imagens")}}catch(t){M.A.error("\u274c Erro durante preload:",t)}finally{n(!1)}}};(0,r.useEffect)(()=>{if(e&&a)return l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{c()},500),()=>{l.current&&clearTimeout(l.current)}},[e,a]);return{isPreloading:s,preloadedImages:t,isImagePreloaded:e=>t.has(e),startPreload:c}},Ca=e=>{let{escola_id:a,refreshKey:t=0,isMaximized:o=!1,hideInlineMedia:s=!1}=e;const[n,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[m,g]=(0,r.useState)(null),[h,p]=(0,r.useState)(0),{isImagePreloaded:x}=ka(a,!0),f=(0,r.useCallback)(()=>{g(null),p(0)},[]);return(0,r.useEffect)(()=>{t>0&&(console.log("ImagemHistoriadoProfessor: refreshKey mudou, for\xe7ando recarga"),l([]),c(!0),u(null))},[t]),(0,r.useEffect)(()=>{a&&(c(!0),u(null),le.N.storage.from("imagens-professores").list("".concat(a,"/")).then(async e=>{let{data:t,error:o}=e;if(o)return u(o.message),void c(!1);if(t&&t.length>0){console.log("Arquivos de professores encontrados:",t.length);const e=await Promise.all(t.map(async(e,t)=>{var r,s,n,l,i;const{data:{publicUrl:c}}=le.N.storage.from("imagens-professores").getPublicUrl("".concat(a,"/").concat(e.name));let d="professor";e.name.startsWith("professora_")?d="professora":e.name.startsWith("professor_")&&(d="professor");let u=null;try{const t="".concat(a,"/").concat(e.name);console.log("Buscando legenda para professor:",t),u=await(0,fa.t$)(t,a,{categoria:"professor",tipo_foto:"professor"}),console.log("Legenda encontrada:",u)}catch(o){console.warn("Erro ao buscar legenda:",o)}const m=(null===(r=u)||void 0===r?void 0:r.legenda)||null;return{id:t+1,publicURL:c,genero:d,nome:e.name,created_at:e.created_at||"",legenda:m,descricao:m,descricaoDetalhada:null===(s=u)||void 0===s?void 0:s.descricao_detalhada,autor:null===(n=u)||void 0===n?void 0:n.autor_foto,dataFoto:null===(l=u)||void 0===l?void 0:l.data_foto,categoria:null===(i=u)||void 0===i?void 0:i.categoria}}));l(e)}else l([]);c(!1)}).catch(e=>{u("Erro inesperado: ".concat(e.message)),c(!1)}))},[a]),i?(0,_.jsx)("div",{className:"text-gray-500",children:"Carregando imagens do professor..."}):d?(0,_.jsxs)("div",{className:"text-red-600",children:["Erro ao carregar imagens: ",d]}):n.length?s?null:(0,_.jsxs)("section",{className:"my-6",children:[(0,_.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:n.map((e,a)=>(0,_.jsxs)("figure",{className:"rounded-lg overflow-hidden bg-white shadow-sm flex flex-col cursor-pointer transition hover:shadow-md",onClick:()=>{e.publicURL&&(p(a),g(e))},children:[(0,_.jsx)("div",{className:"w-full aspect-[4/3] bg-gray-100 flex items-center justify-center",children:(0,_.jsx)(Na,{src:e.publicURL,alt:e.legenda,className:"w-full h-full object-cover object-center transition-transform duration-200 hover:scale-105",isPreloaded:x(e.publicURL),style:{maxHeight:"350px"}})}),e.legenda&&(0,_.jsxs)("figcaption",{className:"p-3 bg-white",children:[(0,_.jsx)("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:e.legenda}),(0,_.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.categoria&&(0,_.jsx)("span",{className:"capitalize bg-gray-100 px-2 py-1 rounded",children:e.categoria}),e.autor&&(0,_.jsxs)("span",{children:["Por: ",e.autor]}),e.dataFoto&&(0,_.jsx)("span",{children:new Date(e.dataFoto).toLocaleDateString("pt-BR")})]}),e.descricaoDetalhada&&(0,_.jsx)("p",{className:"text-xs text-gray-600 mt-2 line-clamp-2",children:e.descricaoDetalhada})]})]},e.id))}),(0,_.jsx)(ya,{images:n,currentImageIndex:h,isOpen:!!m,onClose:f,onImageChange:p,showNavigation:!0,showControls:!0,showCounter:!0,showCaption:!0})]}):null},Aa=r.memo(Ca);var Ia=t(56478),La=t(84583);const Sa=["src","alt","name","size","customSize","shape","variant","loading","error","clickable","className","borderColor","backgroundColor","textColor","badge","badgePosition","badgeColor","badgeSize","onClick","onError","onLoad","fallbackIcon","showInitials","maxInitials","lazy","priority"],za=e=>{let{src:a,alt:t,name:s,size:n="medium",customSize:l,shape:i="circle",variant:c="default",loading:d=!1,error:u=!1,clickable:m=!1,className:g="",borderColor:h="border-green-200",backgroundColor:p="bg-gray-100",textColor:x="text-gray-600",badge:f,badgePosition:b="bottom-right",badgeColor:v="bg-green-500",badgeSize:w="small",onClick:y,onError:j,onLoad:N,fallbackIcon:k="user",showInitials:A=!0,maxInitials:I=2,lazy:L=!0,priority:S=!1}=e,z=(0,o.A)(e,Sa);const[E,M]=(0,r.useState)(!1),[P,T]=(0,r.useState)(!!a),F=(0,r.useMemo)(()=>{if(l)return{container:"w-full h-full",text:"text-sm",icon:"w-6 h-6",badge:"w-3 h-3",customSize:l};const e={xs:{container:"w-6 h-6",text:"text-xs",icon:"w-3 h-3",badge:"w-2 h-2"},small:{container:"w-8 h-8",text:"text-xs",icon:"w-4 h-4",badge:"w-2 h-2"},medium:{container:"w-12 h-12 sm:w-16 sm:h-16",text:"text-sm sm:text-base",icon:"w-6 h-6 sm:w-8 sm:h-8",badge:"w-3 h-3"},large:{container:"w-16 h-16 sm:w-20 sm:h-20",text:"text-base sm:text-lg",icon:"w-8 h-8 sm:w-10 sm:h-10",badge:"w-4 h-4"},xlarge:{container:"w-20 h-20 sm:w-24 sm:h-24",text:"text-lg sm:text-xl",icon:"w-10 h-10 sm:w-12 sm:h-12",badge:"w-5 h-5"},xxlarge:{container:"w-24 h-24 sm:w-32 sm:h-32",text:"text-xl sm:text-2xl",icon:"w-12 h-12 sm:w-16 sm:h-16",badge:"w-6 h-6"}};return e[n]||e.medium},[n,l]),D=(0,r.useMemo)(()=>{const e={circle:"rounded-full",square:"rounded-lg",rounded:"rounded-xl",none:"rounded-none"};return e[i]||e.circle},[i]),H=(0,r.useMemo)(()=>{const e={default:{border:"border-2",shadow:"shadow-md",hover:"hover:shadow-lg"},minimal:{border:"border",shadow:"shadow-sm",hover:"hover:shadow-md"},flat:{border:"border-2",shadow:"shadow-none",hover:"hover:shadow-sm"},elevated:{border:"border-2",shadow:"shadow-lg",hover:"hover:shadow-xl"}};return e[c]||e.default},[c]),R=(0,r.useMemo)(()=>{const e={"top-left":"top-0 left-0","top-right":"top-0 right-0","bottom-left":"bottom-0 left-0","bottom-right":"bottom-0 right-0",center:"top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"},a={small:"w-3 h-3",medium:"w-4 h-4",large:"w-5 h-5"};return{position:e[b]||e["bottom-right"],size:a[w]||a.small}},[b,w]),O=(0,r.useMemo)(()=>{if(!s||!A)return"";return s.trim().split(" ").slice(0,I).map(e=>e.charAt(0).toUpperCase()).filter(e=>e.match(/[A-Z]/)).join("")},[s,A,I]),U=(0,r.useMemo)(()=>{const e={user:sa.A,alert:Ia.A,loading:La.A};return e[k]||e.user},[k]),B=a&&!E&&!d,V=!B&&O&&!u,W=!B&&!V&&!u,q="\n    ".concat(F.container,"\n    ").concat(D,"\n    ").concat(H.border,"\n    ").concat(h,"\n    ").concat(H.shadow,"\n    ").concat(m||y?"cursor-pointer":"","\n    ").concat(H.hover,"\n    transition-all duration-200\n    relative overflow-hidden\n    flex items-center justify-center\n    ").concat(g,"\n  ").trim().replace(/\s+/g," ");return(0,_.jsxs)("div",(0,C.A)((0,C.A)({className:q,style:l?{width:l,height:l}:void 0,onClick:e=>{(m||y)&&(null===y||void 0===y||y(e))},role:m||y?"button":void 0,tabIndex:m||y?0:void 0},z),{},{children:[d&&(0,_.jsx)("div",{className:"absolute inset-0 ".concat(p," flex items-center justify-center"),children:(0,_.jsx)("span",{className:"text-xs text-green-600",children:"Carregando..."})}),B&&(0,_.jsx)("img",(0,C.A)({src:a,alt:t||"Avatar de ".concat(s)||0,className:"w-full h-full object-cover ".concat(P?"opacity-0":"opacity-100"," transition-opacity duration-200"),onLoad:()=>{T(!1),M(!1),null===N||void 0===N||N()},onError:()=>{T(!1),M(!0),null===j||void 0===j||j()},loading:L?"lazy":"eager"},S&&{fetchPriority:"high"})),P&&B&&(0,_.jsx)("div",{className:"absolute inset-0 ".concat(p," flex items-center justify-center"),children:(0,_.jsx)("span",{className:"text-xs text-green-600",children:"Carregando..."})}),V&&(0,_.jsx)("span",{className:"".concat(F.text," font-semibold ").concat(x),children:O}),W&&(0,_.jsx)(U,{className:"".concat(F.icon," ").concat(x)}),u&&(0,_.jsx)("div",{className:"absolute inset-0 ".concat(p," flex items-center justify-center"),children:(0,_.jsx)(Ia.A,{className:"".concat(F.icon," text-red-500")})}),f&&(0,_.jsx)("div",{className:"absolute ".concat(R.position," ").concat(R.size," ").concat(v," rounded-full border-2 border-white"),children:"string"===typeof f?(0,_.jsx)("span",{className:"text-xs text-white font-bold flex items-center justify-center h-full",children:f}):f})]}))},Ea={default:{borderColor:"border-green-200",backgroundColor:"bg-green-50",textColor:"text-green-700",badgeColor:"bg-green-500",hoverBorderColor:"hover:border-green-300"},professor:{borderColor:"border-blue-200",backgroundColor:"bg-blue-50",textColor:"text-blue-700",badgeColor:"bg-blue-500",hoverBorderColor:"hover:border-blue-300"},escola:{borderColor:"border-orange-200",backgroundColor:"bg-orange-50",textColor:"text-orange-700",badgeColor:"bg-orange-500",hoverBorderColor:"hover:border-orange-300"},neutral:{borderColor:"border-gray-200",backgroundColor:"bg-gray-50",textColor:"text-gray-700",badgeColor:"bg-gray-500",hoverBorderColor:"hover:border-gray-300"},indigena:{borderColor:"border-amber-200",backgroundColor:"bg-amber-50",textColor:"text-amber-800",badgeColor:"bg-amber-600",hoverBorderColor:"hover:border-amber-300"},success:{borderColor:"border-emerald-200",backgroundColor:"bg-emerald-50",textColor:"text-emerald-700",badgeColor:"bg-emerald-500",hoverBorderColor:"hover:border-emerald-300"},warning:{borderColor:"border-yellow-200",backgroundColor:"bg-yellow-50",textColor:"text-yellow-800",badgeColor:"bg-yellow-500",hoverBorderColor:"hover:border-yellow-300"},error:{borderColor:"border-red-200",backgroundColor:"bg-red-50",textColor:"text-red-700",badgeColor:"bg-red-500",hoverBorderColor:"hover:border-red-300"}},Ma=e=>{let{fotoUrl:a,nomeProfessor:t,tamanho:o="medium",className:r="",showFallback:s=!0,theme:n="professor",variant:l="default",shape:i="circle",clickable:c=!1,badge:d,badgePosition:u="bottom-right",onClick:m,onError:g,onLoad:h,size:p,customSize:x,escolaId:f}=e;const b=p||{small:"medium",medium:"large",large:"xlarge",xlarge:"xxlarge"}[o]||"large",{isImagePreloaded:v}=ka(f,!!f),w=Ea[n]||Ea.professor;return a||s?(0,_.jsx)(za,{src:a,name:t,alt:t?"Foto de ".concat(t):"Foto do professor",size:x?void 0:b,customSize:x,shape:i,variant:l,theme:n,clickable:c,badge:d,badgePosition:u,className:r,onClick:m,onError:g,onLoad:h,showInitials:!0,maxInitials:2,fallbackIcon:"user",lazy:!v(a),borderColor:w.borderColor,backgroundColor:w.backgroundColor,textColor:w.textColor,badgeColor:w.badgeColor}):null},_a=(0,r.memo)(e=>{let{escola:a,refreshKey:t=0,isMaximized:o=!1,shouldHideInlineMedia:s=!1}=e;const[n,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[m,g]=(0,r.useState)(0),[h,p]=(0,r.useState)(null),x=(0,r.useCallback)(()=>p(null),[]);(0,r.useEffect)(()=>{const e=e=>{"Escape"===e.key&&x()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[x]),(0,r.useEffect)(()=>{if(null===a||void 0===a||!a.id)return void c(!1);(async()=>{try{c(!0),u(null);const e=await(0,xa.Y8)(a.id);l(e||[]),g(0)}catch(e){u(e.message)}finally{c(!1)}})()},[null===a||void 0===a?void 0:a.id,t]);const f=(0,r.useCallback)(()=>{g(e=>e<n.length-1?e+1:0)},[n.length]),b=(0,r.useCallback)(()=>{g(e=>e>0?e-1:n.length-1)},[n.length]);if((0,r.useEffect)(()=>{const e=e=>{n.length<=1||("ArrowRight"===e.key?f():"ArrowLeft"===e.key&&b())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[n.length,f,b]),i)return(0,_.jsx)("div",{className:"mt-8 mb-12 max-w-4xl mx-auto px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg border border-green-100/50",children:(0,_.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,_.jsx)("span",{className:"ml-2 text-gray-600",children:"Carregando hist\xf3rias do professor..."})})});if(d)return(0,_.jsx)("div",{className:"mt-8 mb-12 max-w-4xl mx-auto px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg border border-red-100/50",children:(0,_.jsx)("div",{className:"text-center py-8",children:(0,_.jsxs)("p",{className:"text-red-600",children:["Erro ao carregar hist\xf3rias do professor: ",d]})})});if(!n.length)return null;const v=n[m],w=n.length>1;return(0,_.jsxs)("div",{className:"mt-8 mb-12 flex flex-col items-center w-full",children:[(0,_.jsxs)("header",{className:"historia-professor-header mb-6 sm:mb-8 w-full max-w-4xl mx-auto",children:[(0,_.jsxs)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[(0,_.jsxs)("div",{className:"flex items-center gap-3",children:[(0,_.jsx)("span",{className:"bg-green-200 rounded-full flex items-center justify-center w-16 h-16 sm:w-28 sm:h-28",children:(0,_.jsx)("img",{src:"".concat("/opin","/passaro.svg"),alt:"\xcdcone de p\xe1ssaro",className:"w-12 h-12 sm:w-24 sm:h-24",style:{filter:"none",borderRadius:"0",boxShadow:"none",margin:"0",padding:"0",border:"none",outline:"none"},"aria-hidden":"true"})}),(0,_.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-black m-0",children:"Depoimento dos Professores"})]}),w&&(0,_.jsx)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:(0,_.jsxs)("span",{children:[m+1," de ",n.length]})})]}),(0,_.jsx)("div",{className:"h-1 w-20 sm:w-24 bg-green-300 rounded-full"})]}),(0,_.jsxs)("article",{className:" px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg prose prose-sm sm:prose-base md:prose-lg lg:prose-xl prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 max-w-4xl mx-auto w-full ",children:[(0,_.jsxs)("section",{className:"text-base sm:text-lg leading-relaxed text-neutral-800",children:[v.nome_professor&&(0,_.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,_.jsx)("div",{className:"flex-shrink-0",children:(0,_.jsx)(Ma,{fotoUrl:v.foto_rosto,nomeProfessor:v.nome_professor,customSize:"200px",className:"shadow-lg",escolaId:a.id})}),(0,_.jsxs)("div",{className:"w-full text-center",children:[(0,_.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-green-800 mb-4 m-0",children:v.nome_professor}),(0,_.jsx)("div",{className:"historia-professor-content prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 prose-strong:text-green-800 prose-em:text-green-700 prose-blockquote:border-l-green-300 prose-blockquote:bg-green-50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:rounded-r-lg prose-ul:text-black prose-ol:text-black prose-li:text-black prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm",dangerouslySetInnerHTML:{__html:v.historia}})]})]}),!v.nome_professor&&(0,_.jsx)("div",{className:"historia-professor-content prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 prose-strong:text-green-800 prose-em:text-green-700 prose-blockquote:border-l-green-300 prose-blockquote:bg-green-50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:rounded-r-lg prose-ul:text-black prose-ol:text-black prose-li:text-black prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm",dangerouslySetInnerHTML:{__html:v.historia}}),v.imagem_public_url&&(0,_.jsx)("figure",{className:"my-6",children:(0,_.jsxs)("div",{className:"relative",children:[(0,_.jsx)("img",{src:v.imagem_public_url,alt:v.descricao_imagem||"Imagem da hist\xf3ria do professor",className:"w-full max-w-2xl mx-auto rounded-xl shadow-lg cursor-pointer transition-transform duration-200 hover:scale-105",onClick:()=>p(v),loading:"lazy"}),v.descricao_imagem&&(0,_.jsx)("figcaption",{className:"text-center text-sm text-gray-600 mt-2",children:v.descricao_imagem})]})})]}),w&&(0,_.jsxs)("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200",children:[(0,_.jsxs)("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 text-green-700 hover:text-green-800 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Hist\xf3ria anterior",children:[(0,_.jsx)(pa.A,{className:"w-5 h-5"}),(0,_.jsx)("span",{className:"hidden sm:inline",children:"Anterior"})]}),(0,_.jsx)("div",{className:"flex gap-2",children:n.map((e,a)=>(0,_.jsx)("button",{onClick:()=>g(a),className:"w-3 h-3 rounded-full border-2 ".concat(a===m?"bg-green-600 border-green-600":"bg-white border-gray-300"," transition-colors"),"aria-label":"Ir para hist\xf3ria ".concat(a+1)},a))}),(0,_.jsxs)("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 text-green-700 hover:text-green-800 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Pr\xf3xima hist\xf3ria",children:[(0,_.jsx)("span",{className:"hidden sm:inline",children:"Pr\xf3xima"}),(0,_.jsx)(he.A,{className:"w-5 h-5"})]})]}),h&&(0,_.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",onClick:x,children:(0,_.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center p-4",onClick:e=>e.stopPropagation(),children:[(0,_.jsx)("button",{className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-80 z-10",onClick:x,"aria-label":"Fechar zoom",children:(0,_.jsx)(ea.A,{className:"w-6 h-6"})}),(0,_.jsx)("img",{src:h.imagem_public_url,alt:h.descricao_imagem||"Imagem da hist\xf3ria do professor",className:"max-w-full max-h-full object-contain rounded-xl shadow-2xl border-4 border-white"}),h.descricao_imagem&&(0,_.jsx)("figcaption",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-center text-sm text-white bg-black bg-opacity-50 rounded-lg px-3 py-1.5 max-w-2xl",children:h.descricao_imagem})]})}),(0,_.jsx)(Aa,{escola_id:a.id,refreshKey:t,isMaximized:o,hideInlineMedia:s})]})]})});var Pa=t(35349);const Ta=e=>{let{escola_id:a,refreshKey:t=0,isMaximized:o=!1,hideInlineMedia:s=!1}=e;const[n,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[m,g]=(0,r.useState)(0),[h,p]=(0,r.useState)(""),x=(0,r.useRef)({}),[f,b]=(0,r.useState)(0),{isImagePreloaded:v}=ka(a,!0),w=(0,r.useCallback)(()=>{console.log("Limpando cache e recarregando imagens..."),x.current={},b(e=>e+1)},[]);(0,r.useEffect)(()=>{t>0&&(console.log("ImagensdasEscolas: refreshKey mudou, for\xe7ando recarga"),w())},[t,w]),(0,r.useEffect)(()=>{t>0&&b(e=>e+1)},[t]);const y=(0,r.useCallback)(()=>{u(null),g(0),document.body.style.overflow="auto"},[]);return(0,r.useEffect)(()=>{const e=e=>{"Escape"===e.key&&y()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y]),(0,r.useEffect)(()=>{if(!a)return void c(!1);const e="".concat(a,"_v").concat(f,"_rk").concat(t);(async()=>{console.log("Buscando imagens para escola",a,"refreshKey:",t);try{const{data:t,error:o}=await le.N.from("legendas_fotos").select("*").eq("escola_id",a).eq("tipo_foto","escola").eq("ativo",!0).order("ordem",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!0}),r=new Map;t&&!o&&t.forEach(e=>{const a=e.imagem_url;r.set(a,e)});const{data:s,error:n}=await le.N.storage.from("imagens-das-escolas").list("".concat(a,"/"));if(n)throw n;if(!s||0===s.length)return console.log("Nenhum arquivo encontrado para escola",a),l([]),void c(!1);console.log("Arquivos encontrados:",s.length);const i=await Promise.all(s.map(async(e,t)=>{var o,s,l,i,c,d,u;const m="".concat(a,"/").concat(e.name),{data:{publicUrl:g}}=le.N.storage.from("imagens-das-escolas").getPublicUrl(m);let h=r.get(m);if(!h)try{console.log("Buscando legenda para:",m),h=await(0,fa.t$)(m,a,{categoria:"escola",tipo_foto:"escola"}),console.log("Legenda encontrada:",h)}catch(n){console.warn("Erro ao buscar legenda para",m,":",n)}return{id:"".concat(a,"-").concat(e.name),publicURL:g,filePath:m,descricao:(null===(o=h)||void 0===o?void 0:o.legenda)||"Imagem ".concat(t+1),descricaoDetalhada:null===(s=h)||void 0===s?void 0:s.descricao_detalhada,autor:null===(l=h)||void 0===l?void 0:l.autor_foto,dataFoto:null===(i=h)||void 0===i?void 0:i.data_foto,categoria:null===(c=h)||void 0===c?void 0:c.categoria,ordem:null!==(null===(d=h)||void 0===d?void 0:d.ordem)&&void 0!==(null===(u=h)||void 0===u?void 0:u.ordem)?h.ordem:1/0,urlError:null}}));i.sort((e,a)=>e.ordem!==a.ordem?e.ordem-a.ordem:0),console.log("Imagens processadas e ordenadas:",i.length),console.log("Ordem das imagens:",i.map(e=>({file:e.filePath.split("/").pop(),ordem:e.ordem}))),x.current[e]=i,l(i),0===i.length&&p("Nenhuma imagem encontrada para esta escola.")}catch(h){console.error("Erro ao processar imagens:",h),p("Erro ao carregar imagens da escola.")}finally{c(!1)}})()},[a,f,t]),i?(0,_.jsx)("div",{className:"text-gray-500 flex items-center gap-2",children:"Carregando imagens da escola..."}):h?(0,_.jsxs)("div",{className:"text-red-600 flex items-center gap-2",children:[(0,_.jsx)("span",{children:h}),(0,_.jsx)("button",{onClick:w,className:"text-blue-600 hover:text-blue-800",title:"Tentar novamente",children:(0,_.jsx)(Pa.A,{className:"w-5 h-5"})})]}):n.length?s?null:(0,_.jsxs)("section",{className:"my-6",children:[(0,_.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:n.map(e=>(0,_.jsxs)("figure",{className:"rounded-lg overflow-hidden bg-white shadow-sm flex flex-col cursor-pointer transition hover:shadow-md",onClick:()=>{if(e.publicURL){const a=n.findIndex(a=>a.publicURL===e.publicURL);g(a),u(e)}},children:[(0,_.jsx)("div",{className:"w-full aspect-[4/3] bg-gray-100 flex items-center justify-center",children:(0,_.jsx)(Na,{src:e.publicURL,alt:e.descricao,className:"w-full h-full object-cover object-center transition-transform duration-200 hover:scale-105",isPreloaded:v(e.publicURL),style:{maxHeight:"350px"}})}),e.descricao&&(0,_.jsxs)("figcaption",{className:"p-3 bg-white",children:[(0,_.jsx)("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:e.descricao}),(0,_.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.categoria&&(0,_.jsx)("span",{className:"capitalize bg-gray-100 px-2 py-1 rounded",children:e.categoria}),e.autor&&(0,_.jsxs)("span",{children:["Por: ",e.autor]}),e.dataFoto&&(0,_.jsx)("span",{children:new Date(e.dataFoto).toLocaleDateString("pt-BR")})]}),e.descricaoDetalhada&&(0,_.jsx)("p",{className:"text-xs text-gray-600 mt-2 line-clamp-2",children:e.descricaoDetalhada})]})]},e.id))}),(0,_.jsx)(ya,{images:n,currentImageIndex:m,isOpen:!!d,onClose:y,onImageChange:g,showNavigation:!0,showControls:!0,showCounter:!0,showCaption:!0})]}):(0,_.jsxs)("div",{className:"text-yellow-700 flex items-center gap-2",children:[(0,_.jsx)("span",{children:"Nenhuma imagem encontrada para esta escola."}),(0,_.jsx)("button",{onClick:w,className:"text-blue-600 hover:text-blue-800",title:"Tentar novamente",children:(0,_.jsx)(Pa.A,{className:"w-5 h-5"})})]})},Fa=r.memo(Ta),Da=(0,r.memo)(e=>{let{children:a,shouldUseGrid:t}=e;const o=t?"masonry-grid":"space-y-4";return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("style",{children:"\n  .masonry-grid {\n    column-count: 1;\n    column-gap: 1.5rem;\n    column-fill: balance;\n  }\n  \n  .masonry-grid > * {\n    display: block;\n    break-inside: avoid;\n    page-break-inside: avoid;\n    margin-bottom: 1.5rem;\n  }\n  \n  /* Mobile: 1 coluna */\n  @media (max-width: 767px) {\n    .masonry-grid {\n      column-count: 1;\n    }\n  }\n  \n  /* Tablet e Desktop: 2 colunas */\n  @media (min-width: 768px) {\n    .masonry-grid {\n      column-count: 2;\n    }\n  }\n"}),(0,_.jsx)("div",{className:"".concat(o," transition-all duration-300 ease-in-out"),children:a})]})}),Ha=(0,r.memo)(e=>{let{escola:a,shouldUseGrid:t=!1,refreshKey:o=0,sectionRefs:r,isMaximized:s=!1,shouldHideInlineMedia:n=!1}=e;console.log("EscolaInfo recebeu:",a);const{globalVisibility:l}=(0,de.V)();if(!a)return console.log("EscolaInfo: escola \xe9 null ou undefined"),null;const i=a.cards_visibilidade,c=[{Component:ze,props:{escola:a},id:"basicInfo"},{Component:Be,props:{escola:a},id:"modalidades"},{Component:$e,props:{escola:a},id:"infraestrutura"},{Component:da,props:{escola:a},id:"gestaoProfessores"},{Component:ha,props:{escola:a},id:"projetosParcerias"}].filter(e=>{let{id:a}=e;return(0,ce.Rf)(i,a,l)});return(0,_.jsxs)("div",{className:"space-y-8",children:[c.length>0&&(0,_.jsx)("div",{ref:e=>r&&(r.dados=e),children:(0,_.jsx)(Da,{shouldUseGrid:t,children:c.map((e,a)=>{let{Component:t,props:o}=e;return(0,_.jsx)(t,(0,C.A)({},o),a)})})}),(0,ce.Rf)(i,"historiaEscola",l)&&(0,_.jsx)("div",{ref:e=>r&&(r.historia=e),children:(0,_.jsx)(_e,{escola:a,refreshKey:o,isMaximized:s})}),(0,ce.Rf)(i,"imagensEscola",l)&&(0,_.jsx)(Fa,{escola_id:a.id,refreshKey:o,isMaximized:s,hideInlineMedia:n}),(0,ce.Rf)(i,"historiaProfessor",l)&&(0,_.jsx)("div",{ref:e=>r&&(r.depoimentos=e),children:(0,_.jsx)(_a,{escola:a,refreshKey:o,isMaximized:s,shouldHideInlineMedia:n})})]})}),Ra=["className"],Oa=e=>{let{className:a="w-5 h-5"}=e,t=(0,o.A)(e,Ra);return(0,_.jsx)("svg",(0,C.A)((0,C.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",fill:"currentColor",className:a},t),{},{children:(0,_.jsx)("path",{d:"M200,80H184V64a32,32,0,0,0-56-21.13A32,32,0,0,0,72.21,60.42,32,32,0,0,0,24,88v40a104,104,0,0,0,208,0V112A32,32,0,0,0,200,80ZM152,48a16,16,0,0,1,16,16V80H136V64A16,16,0,0,1,152,48ZM88,64a16,16,0,0,1,32,0v40a16,16,0,0,1-32,0ZM40,88a16,16,0,0,1,32,0v16a16,16,0,0,1-32,0Zm176,40a88,88,0,0,1-175.92,3.75A31.93,31.93,0,0,0,80,125.13a31.93,31.93,0,0,0,44.58,3.35,32.21,32.21,0,0,0,11.8,11.44A47.88,47.88,0,0,0,120,176a8,8,0,0,0,16,0,32,32,0,0,1,32-32,8,8,0,0,0,0-16H152a16,16,0,0,1-16-16V96h64a16,16,0,0,1,16,16Z"})}))},Ua=(0,r.memo)(e=>{let{label:a,value:t,className:o="",isTextArea:r=!1}=e;if(!t&&0!==t)return null;const s=o.includes("flex flex-col")?"flex flex-col gap-1.5 text-sm py-1":"grid grid-cols-[auto,1fr] gap-x-3 gap-y-1 text-sm py-1";return(0,_.jsxs)("div",{className:"".concat(s," ").concat(o),children:[(0,_.jsxs)("span",{className:"font-semibold text-gray-800 leading-tight",children:[a,":"]}),r?(0,_.jsx)("div",{className:"text-gray-700",children:(0,_.jsx)("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",style:{lineHeight:"1.7"},children:t})}):(0,_.jsx)("span",{className:"text-gray-700 break-words leading-relaxed",style:{lineHeight:"1.6"},children:t})]})}),Ba=e=>(0,_.jsx)(Oa,(0,C.A)({className:"w-8 h-8"},e)),Va=(0,r.memo)(e=>{let{terraIndigena:a}=e;if(!a)return console.log("TerraIndigenaInfo: terraIndigena \xe9 null ou undefined"),null;return(0,_.jsxs)(je,{title:"Informa\xe7\xf5es da Terra Ind\xedgena",icon:Ba,children:[(0,_.jsx)(Ua,{label:"Povos Ind\xedgenas",value:a.etnia}),(0,_.jsx)(Ua,{label:"Localiza\xe7\xe3o",value:"".concat(a.municipio||"",", ").concat(a.uf||"").trim()}),(0,_.jsx)(Ua,{label:"Superf\xedcie",value:a.superficie?"Superf\xedcie: ".concat(parseFloat(a.superficie).toFixed(2)," ha"):null}),(0,_.jsx)(Ua,{label:"Fase",value:a.fase}),(0,_.jsx)(Ua,{label:"Modalidade",value:a.modalidade}),(0,_.jsx)(Ua,{label:"Reestudo",value:a.reestudo}),(0,_.jsx)(Ua,{label:"Coordena\xe7\xe3o Regional",value:a.cr}),(0,_.jsx)(Ua,{label:"Faixa de Fronteira",value:a.faixa_fron}),(0,_.jsx)(Ua,{label:"Unidade Administrativa",value:a.undadm_nom}),(0,_.jsx)(Ua,{label:"Sigla Unidade",value:a.undadm_sig}),(0,_.jsx)(Ua,{label:"Dom\xednio",value:a.dominio_un}),(0,_.jsx)(Ua,{label:"Data de Atualiza\xe7\xe3o",value:a.data_atual}),(0,_.jsx)(Ua,{label:"C\xf3digo Terra Ind\xedgena",value:a.terrai_cod}),(0,_.jsx)(Ua,{label:"C\xf3digo Unidade Administrativa",value:a.undadm_cod})]})});var Wa=t(87977);const qa=e=>{let{descricao:a,className:t=""}=e;const o=(0,r.useMemo)(()=>a?Wa.A.sanitize((e=>{if(!e)return"";let a=e.replace(/\n\n+/g,"</p><p>");return a=a.replace(/\n/g,"<br>"),a.startsWith("<p>")||(a="<p>"+a),a.endsWith("</p>")||(a+="</p>"),a=a.replace(/>\s+</g,"><"),a})(a),{ALLOWED_TAGS:["b","i","em","strong","a","p","br","ul","ol","li","div","span","img","h1","h2","h3","h4","h5","h6","center","blockquote","code","pre","hr","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","target","rel","class","style","src","alt","width","height","id","title","aria-label","aria-describedby"],ADD_TAGS:["center","blockquote"],ADD_ATTR:["target","className","title"],KEEP_CONTENT:!0,ALLOW_DATA_ATTR:!1}):"",[a]);return a?(0,_.jsx)("div",{className:"mb-6 ".concat(t),children:(0,_.jsx)("div",{className:"prose prose-lg lg:prose-xl max-w-none px-1",style:{"--tw-prose-body":"#1f2937","--tw-prose-headings":"#111827","--tw-prose-links":"#059669","--tw-prose-bold":"#111827","--tw-prose-counters":"#1f2937","--tw-prose-bullets":"#4b5563","--tw-prose-hr":"#e5e7eb","--tw-prose-quotes":"#111827","--tw-prose-quote-borders":"#10b981","--tw-prose-captions":"#6b7280","--tw-prose-code":"#111827","--tw-prose-pre-code":"#e5e7eb","--tw-prose-pre-bg":"#1f2937","--tw-prose-th-borders":"#d1d5db","--tw-prose-td-borders":"#e5e7eb",lineHeight:"1.8",fontSize:"1.125rem",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"0.015em"},dangerouslySetInnerHTML:{__html:o},"aria-live":"polite"})}):null},Ga=r.memo(qa),Za=(0,r.memo)(e=>{let{painelInfo:a}=e;return(0,_.jsxs)("div",{className:"space-y-6",children:[(0,_.jsx)("div",{className:"prose prose-lg lg:prose-xl max-w-none",children:(0,_.jsx)("div",{className:"bg-green-100 rounded-lg p-6",children:(0,_.jsx)(Ga,{descricao:a.descricao_detalhada})})}),a.audioUrl&&(0,_.jsx)("div",{className:"mt-6",children:(0,_.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,_.jsx)("source",{src:a.audioUrl,type:"audio/mpeg"}),"Seu navegador n\xe3o suporta o elemento de \xe1udio."]})})]})});var Ka=t(2922),Ja=t(64224);const Xa=["EE","EEI"],Ya=e=>{if(!e||"string"!==typeof e)return"";return e.split(/\s+/).map(e=>Xa.includes(e.toUpperCase())?e.toUpperCase():e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()).join(" ")};var $a=t(519),Qa=t(39501),et=t(65410),at=t(37384);const tt=e=>{let{url:a,title:t,description:o=""}=e;const[s,n]=(0,r.useState)(!1),l=a||("undefined"!==typeof window?window.location.href:""),i=t||"OPIN - Observat\xf3rio Dos Professores Ind\xedgenas";return(0,_.jsxs)("span",{className:"shareBtns flex items-center",children:[(0,_.jsx)($a.uI,{url:l,quote:i,className:"shareIcon blackHover","aria-label":"Compartilhar no Facebook",children:(0,_.jsx)(Qa.A,{className:"w-4 h-4"})}),(0,_.jsx)($a.r6,{url:l,title:i,className:"shareIcon blackHover","aria-label":"Compartilhar no Twitter",children:(0,_.jsx)(et.A,{className:"w-4 h-4"})}),(0,_.jsx)($a.Kz,{url:l,title:i,className:"shareIcon blackHover","aria-label":"Compartilhar no WhatsApp",children:(0,_.jsx)(Fe.A,{className:"w-4 h-4"})}),(0,_.jsx)("button",{onClick:async()=>{try{await navigator.clipboard.writeText(l),n(!0),setTimeout(()=>n(!1),2e3)}catch(e){const a=document.createElement("input");a.value=l,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),n(!0),setTimeout(()=>n(!1),2e3)}},className:"shareIcon blackHover","aria-label":s?"Link copiado":"Copiar link",title:s?"Link copiado!":"Copiar link",children:s?(0,_.jsx)(Qe.A,{className:"w-4 h-4"}):(0,_.jsx)(at.A,{className:"w-4 h-4"})})]})},ot=e=>{if(!e)return"";const a=e.toLowerCase();if(a.includes("escola estadual")&&a.includes("aldeia")){const a=e.split(" "),t=a.findIndex(e=>e.toLowerCase().includes("aldeia"));if(-1!==t&&t<a.length-1){const e=a.slice(t+1).join(" ");return"E.E.I ".concat(Ya(e))}}return Ya(e)},rt=e=>{let{titulo:a,closePainel:t,toggleMaximize:o,isMaximized:r,imagemHeader:s,shareUrl:n,shareTitle:l}=e;const i=window.innerWidth<=A.LO.mobile,c=i&&window.innerWidth>window.innerHeight,d=r&&(!i||c),u=d?"mj-header-half-right":"",m=d?{position:"absolute",top:0,right:0,width:"50%",background:"#ffffff",borderBottom:"1px solid rgba(5, 150, 105, 0.1)",zIndex:1e3}:{},g=c?"px-3 py-2":"px-3 sm:px-4 md:px-6 lg:px-8 py-2 sm:py-2 md:py-3",h=c?"flex flex-row items-center justify-between gap-2 pr-2":"flex flex-col sm:flex-row items-start sm:items-center justify-between pr-12",p=c?"flex-1 min-w-0":"space-y-1",x=c?"font-bold text-gray-900 leading-tight tracking-tight break-words text-[clamp(1.05rem,3.4vw,1.6rem)]":"font-bold text-gray-900 leading-tight tracking-tight break-words text-2xl sm:text-3xl md:text-4xl",f=c?"text-[11px] font-medium":"text-xs sm:text-sm font-medium",b=()=>c?(0,_.jsxs)("div",{className:"flex items-center gap-1 ml-2",style:{zIndex:1005},children:[n&&(0,_.jsx)("div",{className:"linkSocialContainer scale-90 origin-right",style:{zIndex:1005},children:(0,_.jsx)(tt,{url:n,title:l||a})}),(0,_.jsx)("button",{onClick:t,className:"p-1.5 text-gray-700 hover:text-gray-900 hover:bg-green-100 transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2","aria-label":"Fechar painel",style:{zIndex:1005},children:(0,_.jsx)(ea.A,{size:18,"aria-hidden":"true",className:"stroke-2"})})]}):(0,_.jsxs)("div",{className:"absolute top-2 sm:top-4 right-2 sm:right-4 flex items-center gap-3",style:{zIndex:1005},children:[n&&(0,_.jsx)("div",{className:"linkSocialContainer",style:{zIndex:1005},children:(0,_.jsx)(tt,{url:n,title:l||a})}),!i&&(0,_.jsx)("button",{onClick:o,className:"p-2 text-green-700 hover:text-green-900 hover:bg-green-100 transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2","aria-label":r?"Restaurar painel":"Maximizar painel",title:r?"Restaurar":"Maximizar",style:{zIndex:1005},children:r?(0,_.jsx)(Ka.A,{size:18,className:"stroke-2","aria-hidden":"true"}):(0,_.jsx)(Ja.A,{size:18,className:"stroke-2","aria-hidden":"true"})}),(0,_.jsx)("button",{onClick:t,className:"p-2 text-gray-700 hover:text-gray-900 hover:bg-green-100 transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2","aria-label":"Fechar painel",style:{zIndex:1005},children:(0,_.jsx)(ea.A,{size:20,"aria-hidden":"true",className:"stroke-2"})})]});return a?(0,_.jsxs)("header",{className:"relative border-b border-green-100 ".concat(c?"min-h-[60px]":""),style:(0,C.A)({zIndex:1e3},m),children:[(0,_.jsx)("div",{className:"".concat(g," ").concat(u),style:{position:"relative",zIndex:1e3},children:(0,_.jsxs)("div",{className:h,children:[(0,_.jsxs)("div",{className:p,style:{position:"relative",zIndex:1015},children:[(0,_.jsx)("h2",{id:"painel-titulo",className:x,children:ot(a)}),(0,_.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600",children:[(0,_.jsx)(ue.A,{className:"w-3 h-3","aria-hidden":"true"}),(0,_.jsx)("span",{className:f,children:"Escola Estadual Ind\xedgena"})]})]}),c&&b()]})}),!c&&b()]}):null},st=e=>{let{imagemUrl:a,className:t="",isPreloaded:o=!1}=e;const[s,n]=(0,r.useState)(!1);return!a||s?null:(0,_.jsxs)("div",{className:"escola-header-image escola-header-shimmer relative overflow-hidden ".concat(t),children:[(0,_.jsx)("div",{className:"absolute inset-0",children:(0,_.jsx)(Na,{src:a,alt:"Imagem da escola",className:"w-full h-full object-cover transition-all duration-700 ease-out",style:{filter:"saturate(1.3)"},isPreloaded:o,onLoad:()=>{n(!1)},onError:()=>{n(!0)}})}),(0,_.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-black/20 via-black/10 to-black/30"}),(0,_.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"}),(0,_.jsx)("div",{className:"absolute inset-0 opacity-5",children:(0,_.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.05)_0%,transparent_50%)]"})}),(0,_.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-radial from-white/5 to-transparent rounded-full blur-xl"})]})},nt=e=>{let{escolaId:a,refreshKey:t=0,showTeacher:o=!0,showSchool:s=!0,scrollProgress:n,headerUrl:l,onCurrentItemChange:i}=e;const c=l?[{id:"header-".concat(a||"temp"),url:l,titulo:"",descricao:"",autor:"",dataFoto:"",origem:"capa"}]:[],[d,u]=(0,r.useState)(c),[m,g]=(0,r.useState)(0),[h,p]=(0,r.useState)(!0),[x,f]=(0,r.useState)(""),{isImagePreloaded:b}=ka(a,!0),[v,w]=(0,r.useState)(0),[y,j]=(0,r.useState)(new Map),N=(0,r.useCallback)(async(e,t)=>{const{data:o,error:r}=await le.N.storage.from(e).list("".concat(a,"/"));if(r)throw r;if(!o||0===o.length)return[];const s=await Promise.all(o.map(async(o,r)=>{var s,n,l,i,c;const d="".concat(a,"/").concat(o.name),{data:{publicUrl:u}}=le.N.storage.from(e).getPublicUrl(d);let m=null;try{m=await(0,fa.t$)(d,a,{categoria:t,tipo_foto:t})}catch(g){}return{id:"".concat(e,"-").concat(o.name),url:u,filePath:d,titulo:(null===(s=m)||void 0===s?void 0:s.legenda)||"Imagem ".concat(r+1),descricao:(null===(n=m)||void 0===n?void 0:n.descricao_detalhada)||"",autor:(null===(l=m)||void 0===l?void 0:l.autor_foto)||"",dataFoto:(null===(i=m)||void 0===i?void 0:i.data_foto)||"",origem:t,ordem:(null===(c=m)||void 0===c?void 0:c.ordem)||1/0}}));return s.sort((e,a)=>e.ordem!==a.ordem?e.ordem-a.ordem:0),s},[a]);(0,r.useEffect)(()=>{if(l){const e={id:"header-".concat(a||"temp"),url:l,titulo:"",descricao:"",autor:"",dataFoto:"",origem:"capa"};u(a=>{if(a.some(e=>"capa"===e.origem&&e.url===l))return a;const t=a.filter(e=>"capa"!==e.origem);return[e,...t]})}},[l,a]),(0,r.useEffect)(()=>{let e=!0;if(a)return p(!0),f(""),(async()=>{try{const t=[];s&&t.push(N("imagens-das-escolas","escola")),o&&t.push(N("imagens-professores","professor"));let r=(await Promise.all(t)).flat();if(l){const e=r.some(e=>e.url===l),t={id:"header-".concat(a),url:l,titulo:"",descricao:"",autor:"",dataFoto:"",origem:"capa"};r=e?r:[t,...r]}if(!e)return;const n=r.sort((e,a)=>"capa"===e.origem?-1:"capa"===a.origem?1:e.origem.localeCompare(a.origem));u(n),g(0)}catch(t){if(!e)return;f("Erro ao carregar imagens.")}finally{e&&p(!1)}})(),()=>{e=!1};p(!1)},[a,t,N,s,o,l]);const k=d.length>0,C=(0,r.useMemo)(()=>!k||m<0||m>=d.length?null:d[m]||null,[d,m,k]),A=(0,r.useMemo)(()=>{if(!C||!C.url)return!1;const e=y.get(C.url);return void 0!==e&&e<1},[C,y]),I=(0,r.useCallback)(e=>{if(!C||!C.url)return;const a=e.target||e.currentTarget;if(a&&a.naturalWidth&&a.naturalHeight){const e=a.naturalWidth/a.naturalHeight;j(a=>new Map(a).set(C.url,e))}},[C]);(0,r.useEffect)(()=>{i&&C&&i(C)},[C,i]),(0,r.useEffect)(()=>{if(!k||"number"!==typeof n)return;if(Date.now()<v)return;const e=Math.floor(n*Math.max(0,d.length-1));Number.isFinite(e)&&e!==m&&g(e)},[n,k,d.length,m,v]);const L=(0,r.useCallback)(()=>{k&&(g(e=>e>0?e-1:d.length-1),w(Date.now()+1200))},[k,d.length]),S=(0,r.useCallback)(()=>{k&&(g(e=>e<d.length-1?e+1:0),w(Date.now()+1200))},[k,d.length]);return x&&!k?(0,_.jsx)("div",{className:"text-red-600",children:x}):h||k?(0,_.jsx)("div",{className:"h-full w-full relative",children:(0,_.jsxs)("div",{className:"absolute inset-0",children:[k&&d.length>1&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("button",{type:"button",className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow",onClick:L,"aria-label":"Imagem anterior",children:(0,_.jsx)(pa.A,{className:"w-5 h-5"})}),(0,_.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 z-10 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow",onClick:S,"aria-label":"Pr\xf3xima imagem",children:(0,_.jsx)(he.A,{className:"w-5 h-5"})})]}),(0,_.jsxs)("div",{className:"w-full h-full bg-black/5 overflow-y-auto overflow-x-hidden flex items-start justify-center",children:[C&&(0,_.jsx)(_.Fragment,{children:"capa"===C.origem?(0,_.jsx)("img",{src:C.url,alt:C.titulo||"Imagem",className:A?"w-full object-contain":"w-full h-full object-cover",style:{maxHeight:A?"none":"100%",minHeight:A?"100%":"auto",maxWidth:"100%",display:"block",objectPosition:A?"top center":"center center",filter:"saturate(1.3)"},loading:"eager",fetchPriority:"high",decoding:"async",onLoad:I}):(0,_.jsx)(Na,{src:C.url,alt:C.titulo||"Imagem",className:A?"w-full object-contain":"w-full h-full object-cover",isPreloaded:b(C.url),priority:"high",style:{maxHeight:A?"none":"100%",minHeight:A?"100%":"auto",maxWidth:"100%",objectPosition:A?"top center":"center center"},onLoad:e=>{if(!C||!C.url)return;const a=(null===e||void 0===e?void 0:e.target)||document.querySelector('img[src="'.concat(C.url,'"]'));if(a&&a.naturalWidth&&a.naturalHeight){const e=a.naturalWidth/a.naturalHeight;j(a=>new Map(a).set(C.url,e))}}})}),h&&k&&(0,_.jsx)("div",{className:"absolute top-4 right-4 z-20 bg-white/90 px-3 py-1.5 rounded-full text-xs text-gray-600 shadow",children:"Carregando mais imagens..."})]}),C&&(0,_.jsx)("div",{className:"absolute bottom-3 left-3 right-3 z-10 flex",children:(0,_.jsxs)("div",{className:"text-white px-3 py-2",style:{backgroundColor:"rgba(0,0,0,0.88)",borderRadius:"8px",maxWidth:"80%"},children:[C.titulo&&(0,_.jsx)("h4",{className:"text-sm font-semibold m-0",children:C.titulo}),(0,_.jsxs)("div",{className:"text-[11px] mt-0.5 space-x-2",children:[C.origem&&(0,_.jsx)("span",{className:"capitalize",children:C.origem}),C.autor&&(0,_.jsxs)("span",{children:["Por: ",C.autor]}),C.dataFoto&&(0,_.jsx)("span",{children:new Date(C.dataFoto).toLocaleDateString("pt-BR")})]}),C.descricao&&(0,_.jsx)("p",{className:"text-xs mt-1 m-0",children:C.descricao})]})})]})}):(0,_.jsx)("div",{className:"text-gray-600",children:"Nenhuma imagem dispon\xedvel."})},lt=r.memo(nt),it=e=>{const[a,t]=(0,r.useState)(!1),{isMobile:o}=(0,te.d)();return(0,r.useEffect)(()=>(M.A.debug("usePainelVisibility - painelInfo mudou:",e),e&&"object"===typeof e?(M.A.debug("usePainelVisibility: Definindo visibilidade como true"),t(!0),document.body.style.overflow="hidden"):(M.A.debug("usePainelVisibility: Definindo visibilidade como false"),t(!1),document.body.style.overflow=""),()=>{document.body.style.overflow=""}),[e]),{isVisible:a,isMobile:o}},ct=e=>{let{painelInfo:a,closePainel:t,children:o,isMaximized:s,onToggleMaximize:n,contentRef:l,rightNav:i,refreshKey:c,shareUrl:d,shareTitle:u}=e;const[m,g]=(0,r.useState)(0),{isVisible:h,isMobile:p}=it(a),x=((e,a)=>{const[t,o]=(0,r.useState)(window.innerWidth),[s,n]=(0,r.useState)(window.innerHeight),l={sm:640,md:768,lg:1024,xl:1280,"2xl":1536};(0,r.useEffect)(()=>{const e=()=>{o(window.innerWidth),n(window.innerHeight)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const i=(0,r.useMemo)(()=>{const o=e&&t>s,r=t>=l.md;let n;return n=e||a?"100%":t>=l.lg?"49%":"75%",{height:"100vh",maxHeight:"100vh",width:n,isDesktop:r,isMobileLandscape:o,shouldUseGrid:r&&a,breakpoints:l,zIndex:1e3}},[e,a,t,s]);return i})(p,s),f=x.isMobileLandscape,b=p&&!f,v=!b,w=v&&(s||f),{isImagePreloaded:y}=ka(null===a||void 0===a?void 0:a.id,!0);if((0,r.useEffect)(()=>{if(null!==a&&void 0!==a&&a.imagem_header&&h){(new Image).src=a.imagem_header;const e=document.createElement("link");return e.rel="preload",e.as="image",e.href=a.imagem_header,"fetchPriority"in e&&(e.fetchPriority="high"),document.head.appendChild(e),()=>{e.parentNode===document.head&&document.head.removeChild(e)}}},[null===a||void 0===a?void 0:a.imagem_header,h]),!a)return null;const j="\n    fixed\n    ".concat(b?"inset-x-0 top-0 w-full h-full":"top-0 bottom-0 right-0 w-full sm:w-3/4 lg:w-[49%] h-auto","\n    rounded-t-xl shadow-xl z-[9999] transform transition-all duration-500 ease-in-out\n    bg-white border-t-4 border-white mj-panel\n  "),N=h?"translate-y-0 opacity-100":"translate-y-full opacity-0",k="function"===typeof o?o({isMobile:p,isMobilePortrait:b,isMobileLandscape:f,shouldUseDesktopLayout:v,useSplitLayout:w}):o;return(0,_.jsxs)("div",{role:"dialog","aria-labelledby":"painel-titulo","aria-describedby":"painel-descricao","aria-modal":"true",className:"".concat(j," ").concat(N).concat(b?" painel-informacoes-mobile":"").concat(w?" mj-maximized":"").concat(w&&f?" mj-mobile-landscape":""),style:(0,C.A)({height:x.height,maxHeight:x.maxHeight,width:b?"100%":x.width,top:0,display:"flex",flexDirection:"column",position:"fixed"},b&&{borderRadius:x.isMobileLandscape?"0":"1rem 1rem 0 0",boxShadow:x.isMobileLandscape?"0 0 0 0":"0 -4px 6px -1px rgba(0, 0, 0, 0.1), 0 -2px 4px -1px rgba(0, 0, 0, 0.06)"}),children:[(0,_.jsx)(rt,{titulo:a.titulo,closePainel:t,toggleMaximize:n,isMaximized:s,imagemHeader:a.imagem_header,shareUrl:d,shareTitle:u}),i&&(0,_.jsx)("div",{className:"hidden sm:flex flex-col gap-1 absolute right-0 top-1/2 -translate-y-1/2 z-[10000]",children:i}),w?(0,_.jsxs)("div",{className:"flex-1 mj-split",children:[(0,_.jsx)("aside",{className:"mj-split-left",children:(0,_.jsx)(lt,{escolaId:a.id,refreshKey:c||0,scrollProgress:m,headerUrl:a.imagem_header})}),(0,_.jsx)("div",{ref:l,className:"mj-split-right overflow-y-auto mj-panel-content",onScroll:e=>{const a=e.currentTarget,t=a.scrollHeight-a.clientHeight,o=t>0?a.scrollTop/t:0;g(Math.min(1,Math.max(0,o)))},children:(0,_.jsx)("div",{className:"".concat(b?"p-3 sm:p-4":"p-6"," space-y-4 sm:space-y-5"),children:(0,_.jsx)("div",{className:"prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none mj-prose",children:k})})})]}):(0,_.jsxs)("div",{ref:l,className:"flex-1 overflow-y-auto mj-panel-content",children:[a.imagem_header&&(0,_.jsx)(st,{imagemUrl:a.imagem_header,className:"h-56 sm:h-64 md:h-72 lg:h-80 xl:h-96 w-full",isPreloaded:y(a.imagem_header)}),(0,_.jsx)("div",{className:"".concat(b?"p-3 sm:p-4":"p-6"," space-y-4 sm:space-y-5 -mt-2"),children:(0,_.jsx)("div",{className:"prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none mj-prose",children:k})})]})]})},dt=r.memo(ct),ut=e=>{if(!e||"string"!==typeof e)return null;const a=e.match(/\/d\/([a-zA-Z0-9-_]+)/);if(!a)return null;const t=a[1];return"https://docs.google.com/gview?url=https://drive.google.com/uc?id=".concat(t,"&embedded=true")},mt=e=>{let{viewMode:a,setViewMode:t}=e;return(0,_.jsxs)("div",{className:"flex items-center gap-2",role:"tablist","aria-label":"Modos de visualiza\xe7\xe3o dos documentos",children:[(0,_.jsxs)("button",{type:"button",role:"tab","aria-selected":"list"===a,"aria-label":"Visualizar em lista",onClick:()=>t("list"),className:"p-2 rounded-lg flex items-center gap-1 transition-colors focus:outline-none focus:ring-2 focus:ring-green-600 ".concat("list"===a?"bg-green-100 text-green-800 font-semibold":"text-gray-600 hover:bg-gray-100"),tabIndex:0,children:[(0,_.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),(0,_.jsx)("span",{className:"hidden sm:inline",children:"Lista"})]}),(0,_.jsxs)("button",{type:"button",role:"tab","aria-selected":"grid"===a,"aria-label":"Visualizar em grade",onClick:()=>t("grid"),className:"p-2 rounded-lg flex items-center gap-1 transition-colors focus:outline-none focus:ring-2 focus:ring-green-600 ".concat("grid"===a?"bg-green-100 text-green-800 font-semibold":"text-gray-600 hover:bg-gray-100"),tabIndex:0,children:[(0,_.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),(0,_.jsx)("span",{className:"hidden sm:inline",children:"Grade"})]})]})},gt=e=>{let{documentos:a,title:t="Documentos"}=e;const[o,s]=(0,r.useState)(null),[n,l]=(0,r.useState)("list"),i=(0,r.useRef)(null),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{o&&(d(!1),m(!1))},[o]),(0,r.useEffect)(()=>{!o&&(null===a||void 0===a?void 0:a.length)>0&&s(a[0])},[a,o]),(0,r.useEffect)(()=>{const e=i.current;if(!e||!o)return;const a=()=>{d(!1)},t=()=>{d(!0),m(!0)};return e.addEventListener("load",a),e.addEventListener("error",t),()=>{e.removeEventListener("load",a),e.removeEventListener("error",t)}},[o]),!a||0===a.length)return null;return(0,_.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,_.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,_.jsxs)("h3",{className:"text-xl font-semibold text-green-800",children:[t,":"]}),a.length>1&&(0,_.jsx)(mt,{viewMode:n,setViewMode:l})]}),a.length>1&&(0,_.jsx)("div",{className:"mb-6",children:"grid"===n?(0,_.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:a.map(e=>(0,_.jsx)("div",{className:"\n              flex flex-col justify-between h-full max-w-xs mx-auto\n              rounded-2xl transition-all duration-200 cursor-pointer\n              shadow-sm hover:shadow-lg\n              ".concat((null===o||void 0===o?void 0:o.id)===e.id?"bg-green-100 scale-[1.03]":"bg-white hover:bg-green-50","\n            "),onClick:()=>{s(e)},tabIndex:0,"aria-label":"Selecionar documento: ".concat(e.titulo),children:(0,_.jsxs)("div",{className:"p-5 flex-1 flex flex-col justify-between",children:[(0,_.jsx)("h4",{className:"font-semibold text-green-800 mb-2 line-clamp-2 text-lg",children:e.titulo}),e.autoria&&(0,_.jsxs)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-1",children:["Por: ",e.autoria]}),e.tipo&&(0,_.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-green-200 text-green-800 rounded-full",children:e.tipo})]})},e.id))}):(0,_.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,_.jsxs)("button",{onClick:()=>{s(e)},className:"w-full text-left p-3 rounded-lg transition-colors duration-200 ".concat((null===o||void 0===o?void 0:o.id)===e.id?"bg-green-100":"hover:bg-green-50"),children:[(0,_.jsx)("h4",{className:"font-medium text-green-800",children:e.titulo}),e.autoria&&(0,_.jsxs)("p",{className:"text-sm text-gray-600",children:["Por: ",e.autoria]}),e.tipo&&(0,_.jsx)("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-medium bg-green-200 text-green-800 rounded-full",children:e.tipo})]},e.id))})}),(()=>{if(!o)return null;const e=o.link_pdf.includes("drive.google.com/file/d/");return(0,_.jsx)("div",{className:"rounded-lg overflow-hidden shadow-lg bg-white",children:e?(0,_.jsxs)(_.Fragment,{children:[u?(0,_.jsx)("iframe",{ref:i,src:ut(o.link_pdf),width:"100%",height:"500px",allow:"autoplay",loading:"lazy",title:"".concat(o.titulo," (Google Docs Viewer)"),sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",className:"bg-white"}):(0,_.jsx)("iframe",{ref:i,src:o.link_pdf.replace("/view?usp=sharing","/preview"),width:"100%",height:"500px",allow:"autoplay",loading:"lazy",title:o.titulo,sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",className:"bg-white"}),c&&(0,_.jsxs)("div",{className:"p-6 text-center text-gray-600 bg-green-100",children:[(0,_.jsx)("p",{className:"mb-3 text-lg",children:"N\xe3o foi poss\xedvel carregar o documento diretamente."}),(0,_.jsxs)("a",{href:o.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,_.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Abrir em nova aba"]})]})]}):(0,_.jsx)("div",{className:"flex justify-center p-6",children:(0,_.jsxs)("a",{href:o.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-6 py-3 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,_.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Ver documento PDF"]})})})})()]})},ht=r.memo(gt),pt=e=>{let{videoUrl:a,title:t="V\xeddeo",escolaId:o}=e;const[s,n]=(0,r.useState)(null),[,l]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{(async()=>{if(a&&o)try{l(!0);const e=await(0,fa.jW)(a,o);n(e)}catch(e){console.warn("Erro ao buscar t\xedtulo personalizado:",e)}finally{l(!1)}})()},[a,o]),!a)return null;const i=(e=>{if(!e||"string"!==typeof e)return null;const a=e.split("?")[0],t=[/youtube\.com\/embed\/([^/?&]+)/,/youtube\.com\/watch\?v=([^&]+)/,/youtu\.be\/([^?&]+)/,/youtube\.com\/v\/([^?&]+)/];for(const o of t){const e=a.match(o);if(e&&e[1])return e[1]}return null})(a);return i?(0,_.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,_.jsxs)("h3",{className:"text-xl font-semibold text-green-800 mb-4",children:[(null===s||void 0===s?void 0:s.titulo)||t,":"]}),s&&(0,_.jsxs)("div",{className:"mb-4 p-4 bg-green-100 rounded-lg",children:[s.descricao&&(0,_.jsx)("p",{className:"text-gray-700 mb-2",children:s.descricao}),(0,_.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.categoria&&(0,_.jsx)("span",{className:"capitalize bg-green-200 text-green-800 px-2 py-1 rounded",children:s.categoria}),s.plataforma&&(0,_.jsx)("span",{className:"capitalize",children:s.plataforma}),s.duracao&&(0,_.jsxs)("span",{children:["Dura\xe7\xe3o: ",s.duracao]})]})]}),(0,_.jsx)("div",{className:"rounded-lg overflow-hidden shadow-lg bg-white",children:(0,_.jsx)("div",{className:"relative pb-[56.25%] h-0",children:(0,_.jsx)("iframe",{className:"absolute top-0 left-0 w-full h-full",src:"https://www.youtube.com/embed/".concat(i),title:(null===s||void 0===s?void 0:s.titulo)||t,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,loading:"lazy",referrerPolicy:"origin"})})})]}):(0,_.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,_.jsxs)("h3",{className:"text-xl font-semibold text-green-800 mb-4",children:[(null===s||void 0===s?void 0:s.titulo)||t,":"]}),(0,_.jsxs)("div",{className:"p-6 text-center text-gray-600 bg-gray-50 rounded-lg",children:[(0,_.jsx)("p",{className:"mb-3 text-lg",children:"Link do v\xeddeo inv\xe1lido ou n\xe3o suportado."}),(0,_.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,_.jsxs)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,_.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Tentar abrir no YouTube"]})]})]})},xt=r.memo(pt);var ft=t(85759);const bt=e=>{let{painelInfo:a,closePainel:t,escola_id:o,refreshKey:s=0}=e;const n=(0,r.useRef)(null),l=(0,r.useRef)(null),i=(0,r.useRef)({}),c=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(a){new URLSearchParams(window.location.search).get("panel")&&(c.current=!0)}},[a]);const[d,u]=(0,r.useState)(()=>{if(new URLSearchParams(window.location.search).get("panel"))return!0;try{const e=localStorage.getItem("opin:painelIsMaximized");if("true"===e)return!0;if("false"===e)return!1}catch(e){}return!0}),{gerarLinkCustomizado:m}=(e=>{const a=()=>{const a=(0,ne.N)((null===e||void 0===e?void 0:e.titulo)||""),t=window.location.pathname;let o;return o=t.includes("/mapa")?t.split("?")[0]:t.includes("/opin")?"/opin/mapa":"/mapa","".concat(window.location.origin).concat(o,"?panel=").concat(a)};return{gerarLinkCustomizado:a,copiarLink:async()=>{const e=a();try{await navigator.clipboard.writeText(e),alert("Link copiado!")}catch(t){const a=document.createElement("input");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),alert("Link copiado!")}},compartilhar:()=>{const t=a(),o="Confira este painel: ".concat(e.titulo);navigator.share?navigator.share({title:e.titulo,text:o,url:t}):window.open("https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(o),"&url=").concat(encodeURIComponent(t)),"_blank")}}})(a),{documentos:g}=ie(null===a||void 0===a?void 0:a.id),[h,p]=(0,r.useState)(!1),[x,f]=(0,r.useState)([]);var b,v;(0,r.useEffect)(()=>{if(a){if(new URLSearchParams(window.location.search).get("panel")){u(!0);try{localStorage.setItem("opin:painelIsMaximized","true")}catch(e){}}else try{const e=localStorage.getItem("opin:painelIsMaximized");"true"===e?u(!0):"false"===e&&u(!1)}catch(t){}}},[a]),((e,a)=>{const t=(0,r.useRef)(null),o=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(e)return o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{const e=a();if(e!==t.current)try{window.history.replaceState({},"",e),t.current=e}catch(o){console.warn("Erro ao atualizar URL:",o)}},300),()=>{o.current&&clearTimeout(o.current)}},[e,a])})(a,m),b=n,v=()=>{l.current&&(l.current.scrollTop=0),t()},(0,r.useEffect)(()=>{const e=e=>{const a=e.target;a.classList&&a.classList.contains("openlayers-container")||b.current&&!b.current.contains(e.target)&&v(e)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[b,v]),(0,r.useEffect)(()=>{console.log("PainelInformacoes: refreshKey mudou para",s)},[s]),(0,r.useEffect)(()=>{let e=!0;return async function(){try{p(!1),f([]);const t=null===a||void 0===a?void 0:a.id;if(!t)return;const o=await(0,ft.Sv)(t);if(!e)return;Array.isArray(o)&&o.length>0&&(p(!0),f(o))}catch(t){if(!e)return;p(!1),f([])}}(),()=>{e=!1}},[null===a||void 0===a?void 0:a.id,s]);const{globalVisibility:w}=(0,de.V)();if(!a)return null;const y="terra_indigena"===a.tipo,j="Sobre o site"===a.titulo,N=a?m():"";return(0,_.jsx)("div",{ref:n,children:(0,_.jsx)(dt,{painelInfo:a,closePainel:t,isMaximized:d,onToggleMaximize:()=>{u(e=>{const a=!e;try{localStorage.setItem("opin:painelIsMaximized",String(a))}catch(t){}return a})},contentRef:l,refreshKey:s,rightNav:null,shareUrl:N,shareTitle:null===a||void 0===a?void 0:a.titulo,children:e=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{useSplitLayout:t=!1}=e,o=null===a||void 0===a?void 0:a.cards_visibilidade;return j?(0,_.jsx)(Za,{painelInfo:a}):y?(0,_.jsx)(Va,{terraIndigena:a}):(0,_.jsxs)("div",{className:"relative",children:[(0,_.jsx)(Ha,{escola:a,shouldUseGrid:!0,refreshKey:s,sectionRefs:i.current,isMaximized:d,shouldHideInlineMedia:t}),(0,ce.Rf)(o,"documentos",w)&&g&&g.length>0&&(0,_.jsx)(ht,{documentos:g,title:"Produ\xe7\xf5es e materiais da escola"}),(0,ce.Rf)(o,"videos",w)&&(a.link_para_videos||h)&&(0,_.jsx)("div",{ref:e=>i.current.videos=e,children:a.link_para_videos?(0,_.jsx)(xt,{videoUrl:a.link_para_videos,title:(0,_.jsx)("span",{style:{fontSize:"0.75em"},children:"Produ\xe7\xf5es audiovisuais realizadas na ".concat(a.titulo)}),escolaId:a.id}):x.length>0&&(0,_.jsxs)("div",{children:[(0,_.jsx)("h3",{className:"text-xl font-semibold text-green-800 mb-4",style:{fontSize:"0.75em"},children:"Produ\xe7\xf5es audiovisuais realizadas na ".concat(a.titulo)}),x.map((e,t)=>(0,_.jsx)("div",{className:t>0?"mt-8":"",children:(0,_.jsx)(xt,{videoUrl:e.video_url,title:e.titulo||(0,_.jsx)("span",{style:{fontSize:"0.75em"},children:"Produ\xe7\xf5es audiovisuais realizadas na ".concat(a.titulo)}),escolaId:a.id})},e.id||t))]})})]})}(e)})})},vt=r.memo(bt);var wt=t(43303);const yt=["schoolData"],jt=e=>{var a;let{dataPoints:t,onPainelOpen:s,isLoading:n=!1}=e;M.A.debug("DataPoints recebidos no MapaEscolasIndigenas:",t?{quantidade:t.length,exemplo:t[0]?{titulo:t[0].titulo,latitude:t[0].Latitude,longitude:t[0].Longitude,tipo:t[0].tipo}:"Nenhum ponto"}:"Nenhum dataPoint");const{refreshKey:l}=(0,wt.b)(),i=(0,oe.zy)(),c=(0,oe.Zp)(),d=(0,r.useMemo)(()=>new URLSearchParams(i.search||"").get("panel"),[i.search]),u=(0,r.useMemo)(()=>{var e;if(null!==(e=i.state)&&void 0!==e&&e.schoolData)return i.state.schoolData;if(d&&""!==d&&t&&t.length>0){return t.find(e=>(0,ne.N)(e.titulo)===d)||null}return null},[d,t,i.state]),[m,g]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),x=(0,r.useMemo)(()=>t?t.filter(e=>e.pontuacao>=0):[],[t]),f=(0,r.useCallback)(e=>{e&&g(e)},[]),b=(0,r.useCallback)(()=>{M.A.debug("For\xe7ando refresh do painel de informa\xe7\xf5es")},[]);(0,r.useEffect)(()=>{if(u&&!h&&d){M.A.debug("MapaEscolasIndigenas: Abrindo painel automaticamente da URL para:",u.titulo),g(u),p(!0);try{localStorage.setItem("opin:painelIsMaximized","true")}catch(e){console.warn("Erro ao salvar estado de maximiza\xe7\xe3o:",e)}}!d&&h&&p(!1)},[u,h,d]),(0,r.useEffect)(()=>{var e;if(null!==(e=i.state)&&void 0!==e&&e.schoolData){const e=i.state.schoolData;(!m||m.id!==e.id)&&(M.A.debug("MapaEscolasIndigenas: Abrindo painel a partir do navigation state:",e.titulo),g(e))}},[null===(a=i.state)||void 0===a?void 0:a.schoolData,m]),(0,r.useEffect)(()=>{M.A.debug("MapaEscolasIndigenas: onPainelOpen dispon\xedvel:",!!s),M.A.debug("MapaEscolasIndigenas: abrirPainel dispon\xedvel:",!!f),s&&"function"===typeof s&&(M.A.debug("MapaEscolasIndigenas: Expondo fun\xe7\xe3o abrirPainel e refreshPainel"),s(f,b))},[f,s,b]);const v=(0,r.useCallback)(()=>{g(null),p(!1);const e=new URLSearchParams(i.search);e.has("panel")&&e.delete("panel");const a=e.toString(),t="".concat(i.pathname).concat(a?"?".concat(a):"").concat(i.hash||"");let r=i.state||null;if(r&&"object"===typeof r&&"schoolData"in r){const{schoolData:e}=r,a=(0,o.A)(r,yt);r=Object.keys(a).length>0?a:null}c(t,{replace:!0,state:r})},[i.hash,i.pathname,i.search,i.state,c]);return(0,_.jsxs)("div",{className:"relative h-screen w-full overflow-hidden",children:[(0,_.jsx)(se,{dataPoints:x,onPainelOpen:f,painelAberto:!!m,className:"h-full w-full",isMainLoading:n}),m&&(0,_.jsx)(vt,{painelInfo:m,closePainel:v,refreshKey:l})]})}}}]);
//# sourceMappingURL=308.de8fddb0.chunk.js.map