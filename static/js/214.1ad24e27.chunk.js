"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[214],{7830:(e,t,o)=>{o.r(t),o.d(t,{default:()=>G});var a=o(5043),r=o(154),n=o(5351),s=o(6528),l=o(5366),c=o(495),i=o(6644),d=o(9468),u=o(2463),g=o(3241),p=o(5424),f=o(3104),h=o(5921),m=o(5263),y=o(3361),x=o(1247),w=o(7790),v=o(1060),b=o(2861),S=o(6970),E=o(9333),P=o(9826);o(3976);const C={center:[-48.4129,-22.3794],zoom:7.63,maxZoom:18,minZoom:4,clusterDistance:30,proximityThreshold:5e-5,disableClusteringAtZoom:12,tooltipOffset:10,connectorStyle:{color:"#A0522D",width:1.2,lineDash:[3,3]}};var N=o(9845);var k=o(579);P.A.defs("EPSG:4674","+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"),(0,E.kz)(P.A);const F=5e-5,M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{borderColor:a=null,showShadow:r=!0,showGradient:n=!0,showGlow:s=!1,isNearbyPair:l=!1}=o,c=e,i=a||c,d=t/2,u=t/24,g=3*u,p=2*u,f="M".concat(d," ").concat(2*u,"C").concat(d-3.87*u," ").concat(2*u," ").concat(d-7*u," ").concat(5.13*u," ").concat(d-7*u," ").concat(9*u,"c0 ").concat(5.25*u," ").concat(7*u," ").concat(13*u," ").concat(7*u," ").concat(13*u,"s").concat(7*u," -").concat(7.75*u," ").concat(7*u," -").concat(13*u,"c0 -").concat(3.87*u," -").concat(3.13*u," -").concat(7*u," -").concat(7*u," -").concat(7*u,"z");return'\n    <svg width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'" xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        ').concat(r?'\n        <filter id="shadow-'.concat(t,'" x="-50%" y="-50%" width="200%" height="200%">\n          <feDropShadow dx="0" dy="').concat(2*u,'" stdDeviation="').concat(3*u,'" flood-color="rgba(0,0,0,0.3)"/>\n        </filter>\n        '):"","\n        ").concat(n?'\n        <linearGradient id="gradient-'.concat(t,'" x1="0%" y1="0%" x2="100%" y2="100%">\n          <stop offset="0%" style="stop-color:').concat(c,';stop-opacity:1" />\n          <stop offset="100%" style="stop-color:').concat(i,';stop-opacity:1" />\n        </linearGradient>\n        '):"","\n        ").concat(s?'\n        <filter id="glow-'.concat(t,'" x="-50%" y="-50%" width="200%" height="200%">\n          <feGaussianBlur stdDeviation="').concat(1*u,'" result="coloredBlur"/>\n          <feMerge> \n            <feMergeNode in="coloredBlur"/>\n            <feMergeNode in="SourceGraphic"/>\n          </feMerge>\n        </filter>\n        '):"","\n      </defs>\n      \n      \x3c!-- Brilho sutil de fundo --\x3e\n      ").concat(s?'\n      <circle cx="'.concat(d-2*u,'" cy="').concat(d-2*u,'" r="').concat(p,'" fill="white" opacity="0.2"/>\n      '):"",'\n      \n      \x3c!-- Marcador principal (gota invertida) --\x3e\n      <path d="').concat(f,'" \n            fill="').concat(n?"url(#gradient-".concat(t,")"):c,'" \n            ').concat(r?'filter="url(#shadow-'.concat(t,')"'):"","\n            ").concat(s?'filter="url(#glow-'.concat(t,')"'):"",'/>\n      \n      \x3c!-- C\xedrculo interno branco (bolinha) --\x3e\n      <circle cx="').concat(d,'" cy="').concat(9*u,'" r="').concat(g,'" fill="white" opacity="0.9"/>\n      \n      \x3c!-- Brilho sutil no c\xedrculo --\x3e\n      <circle cx="').concat(d-2*u,'" cy="').concat(7*u,'" r="').concat(.6*g,'" fill="white" opacity="0.4"/>\n      \n      \x3c!-- Indicador de par pr\xf3ximo (se aplic\xe1vel) --\x3e\n      ').concat(l?'\n      <circle cx="'.concat(t-4*u,'" cy="').concat(4*u,'" r="').concat(3*u,'" fill="#FF6B6B" opacity="0.8"/>\n      <text x="').concat(t-4*u,'" y="').concat(6*u,'" text-anchor="middle" font-size="').concat(8*u,'" fill="white" font-weight="bold">P</text>\n      '):"","\n    </svg>\n  ")},A=e=>{let{dataPoints:t=[],onPainelOpen:o,center:E=[-48.4129,-22.3794],zoom:P=7.63,className:C="h-screen w-full",terrasIndigenasData:A=null,estadoSPData:I=null,showTerrasIndigenas:j=!0,showEstadoSP:O=!0,showMarcadores:L=!0,showNomesEscolas:z=!1,showConectores:_=!0}=e;const D=(0,a.useRef)(null),T=(0,a.useRef)(null),G=(0,a.useRef)(null),R=(0,a.useRef)(null),B=(0,a.useRef)(null),Z=(0,a.useRef)(null),[W,J]=(0,a.useState)({lng:E[0],lat:E[1],zoom:P}),U=(0,a.useRef)(null),V=(0,a.useRef)(null),Y=(0,a.useRef)(null),X=(0,a.useRef)(new N.uy),[q,K]=(0,a.useState)(null),H=(0,a.useCallback)((()=>({satelliteLayer:new s.A({source:new d.A({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:'\xa9 <a href="https://www.esri.com/">Esri</a>',maxZoom:19,wrapX:!1,tilePixelRatio:1,tileSize:256}),preload:1,useInterimTilesOnError:!1})})),[]),Q=(0,a.useCallback)((e=>{const t=e.get("schoolData");if(!t)return null;const o=e.get("isNearbyPair"),a=(e.get("pairIndex"),M("#3B82F6",32,{borderColor:"#1E40AF",showShadow:!0,showGradient:!0,showGlow:!1,isNearbyPair:o})),r="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a),n=new h.Ay({image:new m.A({src:r,scale:o?1.3:1.2,anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction"})});return z&&n.setText(new y.A({text:t.titulo||"Escola",font:"bold 11px Arial",fill:new x.A({color:"#FFFFFF"}),stroke:new w.A({color:"#000000",width:2}),offsetY:o?-50:-40,textAlign:"center",textBaseline:"middle"})),n}),[z]),$=(0,a.useCallback)((e=>{const t=e.get("features"),o=t.length;if(1===o)return Q(t[0]);let a="#3B82F6",r=48;o>100?(a="#1E40AF",r=64):o>50?(a="#2563EB",r=56):o>20?(a="#3B82F6",r=52):o>10&&(a="#60A5FA",r=50);const n=Math.min(1.2+.02*o,2.5),s=Math.round(r*n),l=M(a,s,{borderColor:a,showShadow:!0,showGradient:!0,showGlow:o>20,isNearbyPair:!1}),c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(l);let i="14px";return o>100?i="18px":o>50?i="16px":o>20&&(i="15px"),new h.Ay({image:new m.A({src:c,scale:1,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),text:new y.A({text:o.toString(),font:"".concat("bold"," ").concat(i," Arial"),fill:new x.A({color:"#FFFFFF"}),stroke:new w.A({color:"#000000",width:2}),offsetY:.6*s})})}),[Q]),ee=(0,a.useCallback)((e=>e.titulo||"Escola Ind\xedgena"),[]),te=(0,a.useCallback)(((e,t)=>{if(!(0,N.Fr)())return;q&&(q.remove(),K(null));const o=document.createElement("div");o.className="mobile-tooltip",o.textContent=t,o.style.position="absolute",o.style.backgroundColor="rgba(0, 0, 0, 0.9)",o.style.color="white",o.style.padding="8px 12px",o.style.borderRadius="6px",o.style.fontSize="14px",o.style.fontFamily="Arial, sans-serif",o.style.fontWeight="500",o.style.maxWidth="250px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.zIndex="1000",o.style.pointerEvents="none",o.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",o.style.border="1px solid rgba(255, 255, 255, 0.2)";const a=e.coordinate,r=T.current.getPixelFromCoordinate(a);o.style.left=r[0]+10+"px",o.style.top=r[1]-10+"px",D.current.appendChild(o),K(o),setTimeout((()=>{o.parentNode&&(o.remove(),K(null))}),2e3)}),[q]);return(0,a.useEffect)((()=>{if(T.current)return;G.current=new c.A,R.current=new i.A({distance:z?15:5,source:G.current,geometryFunction:e=>{const t=e.getGeometry();return"Point"===t.getType()?t:null}}),B.current=new l.A({source:R.current,style:$,zIndex:15}),Y.current=new l.A({source:new c.A,style:new h.Ay({stroke:new w.A({color:"#A0522D",width:1.2,lineDash:[3,3]})}),zIndex:14});const{satelliteLayer:e}=H();Z.current=e,T.current=new r.A({target:D.current,layers:[Z.current,Y.current,B.current],view:new n.Ay({center:(0,u.Rb)(E),zoom:P,maxZoom:18,minZoom:4}),controls:(0,v.N)(),interactions:(0,b.N)()}),T.current.on("moveend",(()=>{const e=T.current.getView(),t=(0,u.WP)(e.getCenter()),o={lng:t[0].toFixed(4),lat:t[1].toFixed(4),zoom:e.getZoom().toFixed(2)};J(o)})),T.current.on("moveend",(()=>{B.current&&B.current.changed()})),T.current.on("click",(e=>{const t=T.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(t)if(t.get("features")){const a=t.get("features");if(1===a.length){const r=a[0].get("schoolData");r&&X.current.handleClick(t,(()=>te(e,r.titulo||"Escola Ind\xedgena")),(()=>null===o||void 0===o?void 0:o(r)))}else{console.log("OpenLayersMap: Cluster clicado com ".concat(a.length," escolas"));const e=t.getGeometry().getExtent(),o=T.current.getView().getZoom();let r=12;r=a.length>20?10:a.length>10?11:a.length>5?12:13,r=Math.max(r,o+1),console.log("OpenLayersMap: Fazendo zoom de ".concat(o," para ").concat(r)),T.current.getView().fit(e,{duration:800,padding:[80,80,80,80],maxZoom:r,callback:()=>{console.log("OpenLayersMap: Zoom conclu\xeddo para cluster com ".concat(a.length," escolas"))}})}}else{const a=t.get("schoolData");a&&X.current.handleClick(t,(()=>te(e,a.titulo||"Escola Ind\xedgena")),(()=>null===o||void 0===o?void 0:o(a)))}})),T.current.on("pointermove",(e=>{if((0,N.Fr)())return;q&&(q.remove(),K(null));const o=T.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(o)if(o.get("features")){const r=o.get("features");if(1===r.length){const o=r[0].get("schoolData");if(o){const a=t(e,o);K(a)}}else{const t=a(e,r.length);K(t)}}else{const a=o.get("schoolData");if(a){const o=t(e,a);K(o)}}}));const t=(e,t)=>{const o=document.createElement("div");o.className="ol-tooltip",o.textContent=ee(t),o.style.position="absolute",o.style.backgroundColor="rgba(0, 0, 0, 0.8)",o.style.color="white",o.style.padding="6px 10px",o.style.borderRadius="4px",o.style.fontSize="13px",o.style.fontFamily="Arial, sans-serif",o.style.fontWeight="normal",o.style.maxWidth="200px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.zIndex="1000",o.style.pointerEvents="none",o.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.2)";const a=e.coordinate,r=T.current.getPixelFromCoordinate(a);return o.style.left=r[0]+10+"px",o.style.top=r[1]-10+"px",D.current.appendChild(o),o},a=(e,t)=>{const o=document.createElement("div");o.className="ol-tooltip",o.textContent="".concat(t," escolas ind\xedgenas"),o.style.position="absolute",o.style.backgroundColor="rgba(0, 0, 0, 0.8)",o.style.color="white",o.style.padding="6px 10px",o.style.borderRadius="4px",o.style.fontSize="13px",o.style.fontFamily="Arial, sans-serif",o.style.fontWeight="normal",o.style.maxWidth="200px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.zIndex="1000",o.style.pointerEvents="none",o.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.2)";const a=e.coordinate,r=T.current.getPixelFromCoordinate(a);return o.style.left=r[0]+10+"px",o.style.top=r[1]-10+"px",D.current.appendChild(o),o};return()=>{T.current&&(T.current.setTarget(void 0),T.current=null),q&&(q.remove(),K(null)),X.current.reset()}}),[H,$,ee,te,o]),(0,a.useEffect)((()=>{if(!G.current||!t||!L)return;G.current.clear(),Y.current&&Y.current.getSource().clear();const e=t.filter((e=>{if(!e.latitude||!e.longitude)return!1;const t=parseFloat(e.latitude),o=parseFloat(e.longitude);return!isNaN(t)&&!isNaN(o)&&t>=-90&&t<=90&&o>=-180&&o<=180})),o=(e=>{const t=[],o=new Set;for(let a=0;a<e.length;a++)if(!o.has(a))for(let r=a+1;r<e.length;r++){if(o.has(r))continue;const n=e[a],s=e[r],l=Math.abs(parseFloat(n.latitude)-parseFloat(s.latitude)),c=Math.abs(parseFloat(n.longitude)-parseFloat(s.longitude));if(l<F&&c<F){t.push([a,r]),o.add(a),o.add(r);break}}return t})(e);new Set(o.flat());console.log("OpenLayersMap: Processando ".concat(e.length," marcadores v\xe1lidos")),console.log("OpenLayersMap: Encontrados ".concat(o.length," pares pr\xf3ximos")),e.forEach(((e,t)=>{if(e.latitude&&e.longitude){const a=new f.A({geometry:new g.A((0,u.Rb)([e.longitude,e.latitude]))});a.set("schoolData",e);const r=o.findIndex((e=>e.includes(t)));-1!==r&&(a.set("isNearbyPair",!0),a.set("pairIndex",r)),G.current.addFeature(a)}})),_&&o.forEach(((t,o)=>{const[a,r]=t,n=e[a],s=e[r];if(n&&s){const e=new f.A({geometry:new p.A([(0,u.Rb)([n.longitude,n.latitude]),(0,u.Rb)([s.longitude,s.latitude])])});Y.current.getSource().addFeature(e)}})),console.log("OpenLayersMap: Adicionados ".concat(e.length," marcadores com clustering inteligente")),console.log("OpenLayersMap: Criados ".concat(o.length," conectores"))}),[t,L,_]),(0,a.useEffect)((()=>{B.current&&B.current.setStyle($)}),[$]),(0,a.useEffect)((()=>{B.current&&(console.log("OpenLayersMap: Atualizando estilo dos marcadores - showNomesEscolas:",z),B.current.setStyle($),B.current.changed())}),[z,$]),(0,a.useEffect)((()=>{T.current&&G.current&&(console.log("OpenLayersMap: Recriando ClusterSource - showNomesEscolas:",z),B.current&&T.current.removeLayer(B.current),R.current=new i.A({distance:z?15:10,source:G.current,geometryFunction:e=>{const t=e.getGeometry();return"Point"===t.getType()?t:null}}),B.current=new l.A({source:R.current,style:$,zIndex:15}),T.current.addLayer(B.current))}),[z,$]),(0,a.useEffect)((()=>{Y.current&&Y.current.setVisible(_&&L)}),[_,L]),(0,a.useEffect)((()=>{var e,t;if(T.current){if(console.log("OpenLayersMap: Gerenciando camadas GeoJSON:",{showTerrasIndigenas:j,showEstadoSP:O,terrasIndigenasData:!!A,estadoSPData:!!I,terrasFeatures:(null===A||void 0===A||null===(e=A.features)||void 0===e?void 0:e.length)||0,estadoFeatures:(null===I||void 0===I||null===(t=I.features)||void 0===t?void 0:t.length)||0,mapLayers:T.current.getLayers().getLength()}),U.current&&(T.current.removeLayer(U.current),U.current=null),V.current&&(T.current.removeLayer(V.current),V.current=null),j&&A){var o,a;if(console.log("OpenLayersMap: Adicionando camada Terras Ind\xedgenas"),console.log("OpenLayersMap: Dados Terras Ind\xedgenas:",{type:A.type,features:(null===(o=A.features)||void 0===o?void 0:o.length)||0,crs:A.crs,firstFeature:null!==(a=A.features)&&void 0!==a&&a[0]?{type:A.features[0].type,properties:A.features[0].properties?Object.keys(A.features[0].properties):"Sem propriedades",geometry:A.features[0].geometry?{type:A.features[0].geometry.type,coordinates:A.features[0].geometry.coordinates?"".concat(A.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),!A.features||0===A.features.length)return void console.error("OpenLayersMap: Dados Terras Ind\xedgenas n\xe3o t\xeam features v\xe1lidas");const e=A.features[0];if(e.geometry&&e.geometry.coordinates){const t=e.geometry.coordinates[0][0];console.log("OpenLayersMap: Primeira coordenada das Terras Ind\xedgenas:",t),console.log("OpenLayersMap: Tipo das coordenadas:",typeof t[0],typeof t[1])}try{const e=new S.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).readFeatures(A);if(console.log("OpenLayersMap: Features lidas do GeoJSON:",e.length),e.length>0){const t=e[0],o=t.getGeometry();console.log("OpenLayersMap: Primeira feature processada:",{geometry:o?o.getType():"Sem geometria",extent:o?o.getExtent():"Sem extent",properties:t.getProperties()})}const t=new l.A({source:new c.A({features:e}),style:e=>{const t="Regularizada"===e.getProperties().fase_ti;return new h.Ay({fill:new x.A({color:t?"rgba(220, 20, 60, 0.3)":"rgba(139, 0, 0, 0.25)"}),stroke:new w.A({color:"#B22222",width:2,lineDash:[3,3]})})},zIndex:10});t.getSource().getFeatures().forEach((e=>{const t=e.getProperties();e.set("terraIndigenaInfo",{titulo:t.terrai_nom,tipo:"terra_indigena",etnia:t.etnia_nome,municipio:t.municipio_,uf:t.uf_sigla,superficie:t.superficie,fase:t.fase_ti,modalidade:t.modalidade,reestudo:t.reestudo_t,cr:t.cr,faixa_fron:t.faixa_fron,undadm_nom:t.undadm_nom,undadm_sig:t.undadm_sig,dominio_un:t.dominio_un,data_atual:t.data_atual,terrai_cod:t.terrai_cod,undadm_cod:t.undadm_cod})})),T.current.addLayer(t),U.current=t,console.log("OpenLayersMap: Camada Terras Ind\xedgenas adicionada com sucesso. Total de camadas:",T.current.getLayers().getLength())}catch(s){console.error("OpenLayersMap: Erro ao processar Terras Ind\xedgenas:",s)}}if(O&&I){var r,n;if(console.log("OpenLayersMap: Adicionando camada Estado SP"),console.log("OpenLayersMap: Dados Estado SP:",{type:I.type,features:(null===(r=I.features)||void 0===r?void 0:r.length)||0,crs:I.crs,firstFeature:null!==(n=I.features)&&void 0!==n&&n[0]?{type:I.features[0].type,properties:I.features[0].properties?Object.keys(I.features[0].properties):"Sem propriedades",geometry:I.features[0].geometry?{type:I.features[0].geometry.type,coordinates:I.features[0].geometry.coordinates?"".concat(I.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),!I.features||0===I.features.length)return void console.error("OpenLayersMap: Dados Estado SP n\xe3o t\xeam features v\xe1lidas");const e=I.features[0];if(e.geometry&&e.geometry.coordinates){const t=e.geometry.coordinates[0][0];console.log("OpenLayersMap: Primeira coordenada do Estado SP:",t),console.log("OpenLayersMap: Tipo das coordenadas Estado SP:",typeof t[0],typeof t[1])}try{const e=new S.A({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).readFeatures(I);if(console.log("OpenLayersMap: Features Estado SP lidas do GeoJSON:",e.length),e.length>0){const t=e[0],o=t.getGeometry();console.log("OpenLayersMap: Primeira feature Estado SP processada:",{geometry:o?o.getType():"Sem geometria",extent:o?o.getExtent():"Sem extent",properties:t.getProperties()})}const t=new l.A({source:new c.A({features:e}),style:new h.Ay({fill:new x.A({color:"rgba(0, 0, 0, 0.3)"}),stroke:new w.A({color:"#000000",width:2})}),zIndex:5,interactive:!1});T.current.addLayer(t),V.current=t,console.log("OpenLayersMap: Camada Estado SP adicionada com sucesso. Total de camadas:",T.current.getLayers().getLength())}catch(s){console.error("OpenLayersMap: Erro ao processar Estado SP:",s)}}console.log("OpenLayersMap: Finaliza\xe7\xe3o - Total de camadas no mapa:",T.current.getLayers().getLength())}}),[j,O,A,I]),(0,a.useEffect)((()=>{if(!T.current)return;const e=e=>{const t=T.current.forEachFeatureAtPixel(e.pixel,(e=>e));if(t){const e=t.get("terraIndigenaInfo");e&&o&&o(e)}};return T.current.on("click",e),()=>{T.current&&T.current.un("click",e)}}),[o]),(0,k.jsx)("div",{className:C,ref:D,children:(0,k.jsxs)("div",{className:"absolute bottom-4 left-4 z-10 bg-white bg-opacity-95 rounded-lg shadow-lg p-3",children:[(0,k.jsxs)("div",{className:"text-xs text-gray-600",children:["Lat: ",W.lat," | Lng: ",W.lng]}),(0,k.jsxs)("div",{className:"text-xs text-gray-600",children:["Zoom: ",W.zoom]})]})})},I={},j=e=>{const[t,o]=(0,a.useState)(null),[r,n]=(0,a.useState)(!1),[s,l]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(!e)return;(async()=>{if(I[e])return console.log("useGeoJSONCache: Dados de ".concat(e," encontrados no cache")),void o(I[e]);n(!0);try{var t,a;const r="".concat("/escolasindigenas","/").concat(e,".geojson");console.log("useGeoJSONCache: Carregando ".concat(e," de:"),r);const n=await fetch(r);if(!n.ok)throw new Error("Erro ao buscar GeoJSON (".concat(n.status,")"));const s=await n.json();console.log("useGeoJSONCache: ".concat(e," carregado com sucesso:"),{type:s.type,features:(null===(t=s.features)||void 0===t?void 0:t.length)||0,crs:s.crs,firstFeature:null!==(a=s.features)&&void 0!==a&&a[0]?{type:s.features[0].type,properties:s.features[0].properties?Object.keys(s.features[0].properties):"Sem propriedades",geometry:s.features[0].geometry?{type:s.features[0].geometry.type,coordinates:s.features[0].geometry.coordinates?"".concat(s.features[0].geometry.coordinates.length," arrays"):"Sem coordenadas"}:"Sem geometria"}:"Nenhum feature"}),I[e]=s,o(s)}catch(r){console.error("useGeoJSONCache: Erro ao carregar ".concat(e,":"),r),l(r)}finally{n(!1)}})()}),[e]),{data:t,loading:r,error:s}},O=[-48.4222,-22.8337],L=e=>{let{dataPoints:t,onPainelOpen:o,className:r="h-screen w-full"}=e;const{data:n,loading:s,error:l}=j("terras_indigenas"),{data:c,loading:i,error:d}=j("SP"),[u,g]=(0,a.useState)(!0),[p,f]=(0,a.useState)(!0),[h,m]=(0,a.useState)(!0),[y,x]=(0,a.useState)(!0),[w,v]=(0,a.useState)(!1),[b,S]=(0,a.useState)(!1),E=(0,a.useCallback)((()=>{v(window.innerWidth<=768)}),[]);(0,a.useEffect)((()=>(E(),window.addEventListener("resize",E),()=>{window.removeEventListener("resize",E)})),[E]);const P=(0,a.useCallback)((()=>S((e=>!e))),[]);(0,a.useEffect)((()=>{var e,t,o,a;console.log("MapSelector: Status das camadas GeoJSON:",{terrasIndigenas:{loading:s,error:l,hasData:!!n,features:(null===n||void 0===n||null===(e=n.features)||void 0===e?void 0:e.length)||0,type:null===n||void 0===n?void 0:n.type,firstFeature:null!==n&&void 0!==n&&null!==(t=n.features)&&void 0!==t&&t[0]?{type:n.features[0].type,properties:n.features[0].properties?Object.keys(n.features[0].properties):"Sem propriedades"}:"Nenhum feature"},estadoSP:{loading:i,error:d,hasData:!!c,features:(null===c||void 0===c||null===(o=c.features)||void 0===o?void 0:o.length)||0,type:null===c||void 0===c?void 0:c.type,firstFeature:null!==c&&void 0!==c&&null!==(a=c.features)&&void 0!==a&&a[0]?{type:c.features[0].type,properties:c.features[0].properties?Object.keys(c.features[0].properties):"Sem propriedades"}:"Nenhum feature"}})}),[n,c,s,i,l,d]);const N=e=>{let{onMinimize:t,isMobile:o,isMinimized:a}=e;return(0,k.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-white",children:[(0,k.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:"Camadas do Mapa"}),(0,k.jsx)("div",{className:"flex items-center gap-2",children:(0,k.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors p-1","aria-label":a?"Expandir":"Minimizar",type:"button",children:a?"\u25be":"\u25b4"})})]})},F=e=>{let{id:t,label:o,checked:a,onChange:r,disabled:n=!1,loading:s=!1,error:l=!1,total:c,color:i,subItems:d=null}=e;return(0,k.jsxs)("button",{type:"button",onClick:r,disabled:n,className:"w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors ".concat(a?"bg-gray-50":"hover:bg-gray-50"," ").concat(n?"opacity-50 cursor-not-allowed":""),children:[d?(0,k.jsx)("div",{className:"flex flex-col gap-1",children:d.map(((e,t)=>(0,k.jsxs)("div",{className:"flex items-center gap-1",children:[(0,k.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),(0,k.jsx)("span",{className:"text-xs text-gray-600",children:e.label})]},t)))}):(0,k.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i}}),(0,k.jsx)("span",{className:"text-sm text-gray-800",children:o}),void 0!==c&&(0,k.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",c,")"]}),s&&(0,k.jsx)("span",{className:"text-blue-500 ml-1",children:"(carregando...)"}),l&&(0,k.jsx)("span",{className:"text-red-500 ml-1",children:"(erro)"}),d?(0,k.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full bg-gray-300"}):(0,k.jsx)("div",{className:"ml-auto w-2 h-2 rounded-full",style:{backgroundColor:i}})]})},M=w?O:C.center,I=w?5.86:C.zoom;return(0,k.jsxs)("div",{className:r,style:{position:"relative"},children:[w?(0,k.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,k.jsxs)("div",{className:"bg-white border-t border-gray-100 shadow-lg",children:[(0,k.jsx)(N,{onMinimize:P,isMobile:!0,isMinimized:b}),!b&&(0,k.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-60 overflow-y-auto",children:[(0,k.jsx)(F,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:p,onChange:()=>f(!p),loading:i,error:d,color:"#10B981"}),(0,k.jsx)(F,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:h,onChange:()=>m(!h),total:null===t||void 0===t?void 0:t.length,color:"#3B82F6"}),(0,k.jsx)(F,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:u,onChange:()=>g(!u),loading:s,error:l,subItems:[{label:"Regularizadas",color:"#DC143C"},{label:"Declaradas",color:"#8B0000"}]}),(0,k.jsx)(F,{id:"conectores",label:"Mostrar Conectores",checked:y,onChange:()=>x(!y),disabled:!h,color:"#A0522D"})]})]})}):(0,k.jsxs)("div",{className:"fixed top-24 right-4 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:[(0,k.jsx)(N,{onMinimize:P,isMobile:!1,isMinimized:b}),!b&&(0,k.jsxs)("div",{className:"p-2 flex flex-col gap-1 max-h-96 overflow-y-auto",children:[(0,k.jsx)(F,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:p,onChange:()=>f(!p),loading:i,error:d,color:"#10B981"}),(0,k.jsx)(F,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:h,onChange:()=>m(!h),total:null===t||void 0===t?void 0:t.length,color:"#3B82F6"}),(0,k.jsx)(F,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:u,onChange:()=>g(!u),loading:s,error:l,subItems:[{label:"Regularizadas",color:"#DC143C"},{label:"Declaradas",color:"#8B0000"}]}),(0,k.jsx)(F,{id:"conectores",label:"Mostrar Conectores",checked:y,onChange:()=>x(!y),disabled:!h,color:"#A0522D"})]})]}),(0,k.jsx)(A,{dataPoints:h?t:[],onPainelOpen:o,className:"h-full w-full",center:M,zoom:I,terrasIndigenasData:n,estadoSPData:c,showTerrasIndigenas:u,showEstadoSP:p,showMarcadores:h,showConectores:y})]})};var z=o(6740);const _={titulo:"Sobre o site",audioUrl:"",descricao_detalhada:"Este \xe9 o OPIN (Observat\xf3rio dos Professores Ind\xedgenas no Estado de S\xe3o Paulo), que busca mapear as escolas ind\xedgenas no estado de S\xe3o Paulo.\n",imagens:[""]};var D=o(6799),T=o(3303);const G=e=>{let{dataPoints:t,onPainelOpen:o}=e;console.log("DataPoints recebidos no MapaEscolasIndigenas:",t?{quantidade:t.length,exemplo:t[0]?{titulo:t[0].titulo,latitude:t[0].latitude,longitude:t[0].longitude,tipo:t[0].tipo}:"Nenhum ponto"}:"Nenhum dataPoint");const{refreshKey:r}=(0,T.b)(),n=(0,a.useMemo)((()=>new URLSearchParams(window.location.search)),[]).get("panel"),s=(0,a.useMemo)((()=>{if(n&&""!==n&&t&&t.length>0){return t.find((e=>(0,D.N)(e.titulo)===n))||_}return _}),[n,t]),[l,c]=(0,a.useState)(s),i=(0,a.useMemo)((()=>t?t.filter((e=>e.pontuacao>=0)):[]),[t]),d=(0,a.useMemo)((()=>i.length),[i]);(0,a.useEffect)((()=>{console.group("MapaEscolasIndigenas - painelInfo state changed"),console.log("Novo valor de painelInfo:",{titulo:null===l||void 0===l?void 0:l.titulo,tipo:null===l||void 0===l?void 0:l.tipo,hasLink:!(null===l||void 0===l||!l.link_para_documentos),linkValue:null===l||void 0===l?void 0:l.link_para_documentos,isInitialPanel:l===s,isNull:null===l,isUndefined:void 0===l}),console.groupEnd()}),[l,s]);const u=(0,a.useCallback)((e=>{e&&c(e)}),[]),g=(0,a.useCallback)((()=>{console.log("For\xe7ando refresh do painel de informa\xe7\xf5es")}),[]);(0,a.useEffect)((()=>{console.log("MapaEscolasIndigenas: onPainelOpen dispon\xedvel:",!!o),console.log("MapaEscolasIndigenas: abrirPainel dispon\xedvel:",!!u),o&&"function"===typeof o&&(console.log("MapaEscolasIndigenas: Expondo fun\xe7\xe3o abrirPainel e refreshPainel"),o(u,g))}),[u,o,g]);const p=(0,a.useCallback)((()=>{c(null)}),[]);return(0,k.jsxs)("div",{className:"relative h-screen w-full overflow-hidden",children:[(0,k.jsx)(L,{dataPoints:i,onPainelOpen:u,className:"h-full w-full"}),l&&(0,k.jsxs)(k.Fragment,{children:[console.log("MapaEscolasIndigenas - Renderizando PainelInformacoes com:",{painelInfo:l,hasLink:null===l||void 0===l?void 0:l.link_para_documentos,linkValue:null===l||void 0===l?void 0:l.link_para_documentos}),(0,k.jsx)(z.A,{painelInfo:l,closePainel:p,refreshKey:r})]}),(0,k.jsxs)("div",{className:"absolute top-20 left-4 z-30 bg-white bg-opacity-95 rounded-lg shadow-lg p-3",children:[(0,k.jsxs)("div",{className:"text-sm font-semibold text-gray-800",children:["Escolas Ind\xedgenas: ",d]}),(0,k.jsx)("div",{className:"text-xs text-gray-600",children:"Mapa otimizado sem gaps"})]})]})}},9845:(e,t,o)=>{o.d(t,{Fr:()=>a,uy:()=>r});const a=()=>window.innerWidth<=768;class r{constructor(){this.lastClickedFeature=null,this.clickTimeout=null,this.clickDelay=300}handleClick(e,t,o){a()?this.lastClickedFeature===e?(this.clearTimeout(),this.lastClickedFeature=null,o(e)):(this.lastClickedFeature&&this.clearTimeout(),this.lastClickedFeature=e,t(e),this.clickTimeout=setTimeout((()=>{this.lastClickedFeature=null}),this.clickDelay)):o(e)}clearTimeout(){this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null)}reset(){this.clearTimeout(),this.lastClickedFeature=null}}}}]);
//# sourceMappingURL=214.1ad24e27.chunk.js.map