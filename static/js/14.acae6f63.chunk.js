"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[14],{237:(e,o,r)=>{r.d(o,{eP:()=>s,iy:()=>c,jW:()=>l,qP:()=>i,w_:()=>n});var t=r(9379),a=r(2880);const s=async e=>{try{console.log("=== DEBUG: addLegendaFoto ==="),console.log("Dados recebidos:",e);const r=(0,t.A)({},e);console.log("Dados iniciais:",r);try{console.log("Verificando se a coluna tipo_foto existe...");const{data:e,error:o}=await a.N.from("legendas_fotos").select("tipo_foto").limit(1);console.log("Teste da coluna tipo_foto:",{testData:e,testError:o}),o&&"42703"===o.code&&(console.warn("Coluna tipo_foto n\xe3o encontrada. Removendo do objeto de inser\xe7\xe3o."),delete r.tipo_foto)}catch(o){console.warn("Coluna tipo_foto n\xe3o encontrada. Removendo do objeto de inser\xe7\xe3o."),delete r.tipo_foto}console.log("Dados finais para inser\xe7\xe3o:",r);const{data:s,error:n}=await a.N.from("legendas_fotos").insert([r]).select().single();if(console.log("Resposta do Supabase:",{data:s,error:n}),n)throw console.error("Erro do Supabase:",n),n;return console.log("Legenda criada com sucesso:",s),s}catch(r){throw console.error("Erro ao adicionar legenda de foto:",r),r}},n=async(e,o)=>{try{console.log("=== DEBUG: updateLegendaFoto ==="),console.log("ID da legenda:",e),console.log("Dados para atualiza\xe7\xe3o:",o);const{data:r,error:t}=await a.N.from("legendas_fotos").update(o).eq("id",e).select().single();if(console.log("Resposta do Supabase:",{data:r,error:t}),t)throw console.error("Erro do Supabase ao atualizar:",t),t;return console.log("Legenda atualizada com sucesso:",r),r}catch(r){throw console.error("Erro ao atualizar legenda de foto:",r),r}},i=async function(e,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("getLegendaByImageUrl chamada com:",{imagemUrl:e,escolaId:o,tipoFoto:r});let s=a.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",o).eq("ativo",!0);if(r)try{s=s.eq("tipo_foto",r)}catch(t){console.warn("Coluna tipo_foto n\xe3o encontrada. Ignorando filtro por tipo.")}let{data:n,error:i}=await s.single();if(console.log("Busca exata resultou em:",{data:n,error:i}),i&&"PGRST116"===i.code||!n){console.log("Tentando busca por finaliza\xe7\xe3o...");const s=e.split("/").slice(-2).join("/");console.log("Caminho relativo extra\xeddo:",s);let n=a.N.from("legendas_fotos").select("*").ilike("imagem_url","%/".concat(s)).eq("escola_id",o).eq("ativo",!0);if(r)try{n=n.eq("tipo_foto",r)}catch(t){}const{data:i,error:l}=await n.single();if(console.log("Busca por finaliza\xe7\xe3o resultou em:",{data2:i,error2:l}),!l&&i)return i}if(i&&"PGRST116"!==i.code)throw i;return n||null}catch(s){return console.error("Erro ao buscar legenda por URL:",s),null}},l=async(e,o)=>{try{const{data:r,error:t}=await a.N.from("titulos_videos").select("*").eq("video_url",e).eq("escola_id",o).eq("ativo",!0).single();if(t&&"PGRST116"!==t.code)throw t;return r||null}catch(r){return console.error("Erro ao buscar t\xedtulo por URL:",r),null}},c=async()=>{try{console.log("=== TESTE: Verificando estrutura da tabela legendas_fotos ===");const{data:r,error:t}=await a.N.from("legendas_fotos").select("*").limit(1);if(console.log("Teste 1 - Tabela existe:",{tableData:r,tableError:t}),t)return void console.error("\u274c ERRO: Tabela legendas_fotos n\xe3o existe ou n\xe3o est\xe1 acess\xedvel:",t);const{data:s,error:n}=await a.N.from("legendas_fotos").select("id, escola_id, imagem_url, legenda, descricao_detalhada, autor_foto, data_foto, categoria, ativo, created_at, updated_at").limit(1);console.log("Teste 2 - Estrutura da tabela:",{structureData:s,structureError:n}),n?console.error("\u274c ERRO: Problema com estrutura da tabela:",n):console.log("\u2705 Estrutura b\xe1sica da tabela est\xe1 OK");try{const{data:e,error:o}=await a.N.from("legendas_fotos").select("tipo_foto").limit(1);console.log("Teste 3 - Coluna tipo_foto:",{tipoData:e,tipoError:o}),o&&"42703"===o.code?console.log("\u26a0\ufe0f AVISO: Coluna tipo_foto n\xe3o existe na tabela"):o?console.error("\u274c ERRO: Problema com coluna tipo_foto:",o):console.log("\u2705 Coluna tipo_foto existe")}catch(e){console.log("\u26a0\ufe0f AVISO: Coluna tipo_foto n\xe3o existe na tabela")}console.log("Teste 4 - Testando inser\xe7\xe3o...");const i={escola_id:999999,imagem_url:"test/test.jpg",legenda:"Teste de legenda",descricao_detalhada:"Descri\xe7\xe3o de teste",autor_foto:"Teste",data_foto:"2024-01-01",categoria:"teste",ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};try{const{data:e,error:o}=await a.N.from("legendas_fotos").insert([i]).select().single();if(console.log("Teste 4 - Inser\xe7\xe3o de teste:",{insertData:e,insertError:o}),o)console.error("\u274c ERRO: Problema com inser\xe7\xe3o:",o);else{console.log("\u2705 Inser\xe7\xe3o funcionando - removendo registro de teste...");const{error:o}=await a.N.from("legendas_fotos").delete().eq("id",e.id);o?console.error("\u26a0\ufe0f AVISO: N\xe3o foi poss\xedvel remover registro de teste:",o):console.log("\u2705 Registro de teste removido com sucesso")}}catch(o){console.error("\u274c ERRO: Falha na inser\xe7\xe3o de teste:",o)}console.log("=== FIM DO TESTE ===")}catch(r){console.error("\u274c ERRO GERAL no teste da tabela:",r)}}},2006:(e,o,r)=>{r.d(o,{FI:()=>d,Y8:()=>n,e0:()=>l,g2:()=>c,lz:()=>i,tP:()=>g});var t=r(9379),a=r(2880);const s={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},n=async e=>{try{const{data:o,error:r}=await a.N.from("historias_professor").select("*").eq("escola_id",e).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(r)throw r;if(!o||0===o.length)return[];return o.map((e=>{if(e.imagem_url)try{const{data:{publicUrl:o}}=a.N.storage.from(s.BUCKET_NAME).getPublicUrl(e.imagem_url);return(0,t.A)((0,t.A)({},e),{},{imagem_public_url:o})}catch(o){return(0,t.A)((0,t.A)({},e),{},{imagem_public_url:null,urlError:o.message})}return e}))}catch(o){throw console.error("Erro ao buscar hist\xf3rias do professor:",o),o}},i=async e=>{try{const{data:o,error:r}=await a.N.from("historias_professor").insert([{escola_id:e.escola_id,nome_professor:e.nome_professor||null,historia:e.historia,ordem:e.ordem||1,ativo:!1!==e.ativo}]).select().single();if(r)throw r;return o}catch(o){throw console.error("Erro ao criar hist\xf3ria do professor:",o),o}},l=async(e,o)=>{try{const{data:r,error:t}=await a.N.from("historias_professor").update({nome_professor:o.nome_professor,historia:o.historia,ordem:o.ordem,ativo:o.ativo,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(t)throw t;return r}catch(r){throw console.error("Erro ao atualizar hist\xf3ria do professor:",r),r}},c=async e=>{try{const{error:o}=await a.N.from("historias_professor").delete().eq("id",e);if(o)throw o}catch(o){throw console.error("Erro ao deletar hist\xf3ria do professor:",o),o}},d=async function(e,o,r){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";try{const n=(e=>{if(!s.ALLOWED_TYPES.includes(e.type))return{isValid:!1,error:"Tipo de arquivo n\xe3o suportado. Use apenas: ".concat(s.ALLOWED_TYPES.map((e=>e.split("/")[1].toUpperCase())).join(", "))};if(e.size>s.MAX_FILE_SIZE)return{isValid:!1,error:"Arquivo muito grande. Tamanho m\xe1ximo: ".concat(s.MAX_FILE_SIZE/1048576,"MB")};const o=e.name.split(".").pop().toLowerCase(),r=s.ALLOWED_TYPES.map((e=>e.split("/")[1]));return r.includes(o)?{isValid:!0}:{isValid:!1,error:"Extens\xe3o n\xe3o permitida. Use apenas: ".concat(r.join(", "))}})(e);if(!n.isValid)throw new Error(n.error);const i=await(e=>new Promise((o=>{const r=new Image;r.onload=()=>{const e=r.width>=s.MIN_DIMENSIONS.width&&r.height>=s.MIN_DIMENSIONS.height;o(e)},r.onerror=()=>o(!1),r.src=URL.createObjectURL(e)})))(e);i||console.warn("Imagem com dimens\xf5es menores que o recomendado");const l=((e,o,r)=>{const t=Date.now(),a=Math.random().toString(36).substring(2,8),s=e.name.split(".").pop().toLowerCase();return"historia_".concat(r,"_").concat(t,"_").concat(a,".").concat(s)})(e,0,r),c="".concat(o,"/").concat(l),{error:d}=await a.N.storage.from(s.BUCKET_NAME).upload(c,e,{cacheControl:"3600",upsert:!1});if(d)throw new Error("Erro no upload: ".concat(d.message));const{data:{publicUrl:g}}=a.N.storage.from(s.BUCKET_NAME).getPublicUrl(c),{data:u,error:m}=await a.N.from("historias_professor").update({descricao_imagem:t.trim()||null,updated_at:(new Date).toISOString()}).eq("id",r).select().single();if(m)throw await a.N.storage.from(s.BUCKET_NAME).remove([c]),new Error("Erro ao salvar metadados: ".concat(m.message));return{id:u.id,descricao_imagem:u.descricao_imagem}}catch(n){throw console.error("Erro no upload da imagem da hist\xf3ria do professor:",n),n}},g=async e=>{try{const{data:o,error:r}=await a.N.from("historias_professor").select("imagem_url").eq("id",e).single();if(r)throw r;if(!o.imagem_url)return;const{error:t}=await a.N.from("historias_professor").update({descricao_imagem:null,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;const{error:n}=await a.N.storage.from(s.BUCKET_NAME).remove([o.imagem_url]);n&&console.warn("Erro ao deletar imagem do storage:",n)}catch(o){throw console.error("Erro ao deletar imagem da hist\xf3ria do professor:",o),o}}},4581:(e,o,r)=>{r.d(o,{A:()=>l});var t=r(5043),a=r(579);const s=e=>{if(!e||"string"!==typeof e)return null;const o=e.match(/\/d\/([a-zA-Z0-9-_]+)/);if(!o)return null;const r=o[1];return"https://docs.google.com/gview?url=https://drive.google.com/uc?id=".concat(r,"&embedded=true")},n=e=>{let{viewMode:o,setViewMode:r}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",role:"tablist","aria-label":"Modos de visualiza\xe7\xe3o dos documentos",children:[(0,a.jsxs)("button",{type:"button",role:"tab","aria-selected":"list"===o,"aria-label":"Visualizar em lista","aria-pressed":"list"===o,onClick:()=>r("list"),className:"p-2 rounded-lg flex items-center gap-1 transition-colors focus:outline-none focus:ring-2 focus:ring-green-600 ".concat("list"===o?"bg-green-100 text-green-800 font-semibold":"text-gray-600 hover:bg-gray-100"),tabIndex:0,children:[(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Lista"})]}),(0,a.jsxs)("button",{type:"button",role:"tab","aria-selected":"grid"===o,"aria-label":"Visualizar em grade","aria-pressed":"grid"===o,onClick:()=>r("grid"),className:"p-2 rounded-lg flex items-center gap-1 transition-colors focus:outline-none focus:ring-2 focus:ring-green-600 ".concat("grid"===o?"bg-green-100 text-green-800 font-semibold":"text-gray-600 hover:bg-gray-100"),tabIndex:0,children:[(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Grade"})]})]})},i=e=>{let{documentos:o,title:r="Documentos"}=e;const[i,l]=(0,t.useState)(null),[c,d]=(0,t.useState)("list"),g=(0,t.useRef)(null),[u,m]=(0,t.useState)(!1),[f,h]=(0,t.useState)(!1);if((0,t.useEffect)((()=>{i&&(m(!1),h(!1))}),[i]),(0,t.useEffect)((()=>{!i&&(null===o||void 0===o?void 0:o.length)>0&&l(o[0])}),[o,i]),(0,t.useEffect)((()=>{const e=g.current;if(!e||!i)return;const o=()=>{m(!1)},r=()=>{m(!0),h(!0)};return e.addEventListener("load",o),e.addEventListener("error",r),()=>{e.removeEventListener("load",o),e.removeEventListener("error",r)}}),[i]),!o||0===o.length)return null;return(0,a.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-green-800",children:[r,":"]}),o.length>1&&(0,a.jsx)(n,{viewMode:c,setViewMode:d})]}),o.length>1&&(0,a.jsx)("div",{className:"mb-6",children:"grid"===c?(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:o.map((e=>(0,a.jsx)("div",{className:"\n              flex flex-col justify-between h-full max-w-xs mx-auto\n              rounded-2xl transition-all duration-200 cursor-pointer\n              shadow-sm hover:shadow-lg\n              ".concat((null===i||void 0===i?void 0:i.id)===e.id?"bg-green-100 scale-[1.03]":"bg-white hover:bg-green-50","\n            "),onClick:()=>{l(e)},tabIndex:0,"aria-label":"Selecionar documento: ".concat(e.titulo),children:(0,a.jsxs)("div",{className:"p-5 flex-1 flex flex-col justify-between",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-800 mb-2 line-clamp-2 text-lg",children:e.titulo}),e.autoria&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-1",children:["Por: ",e.autoria]}),e.tipo&&(0,a.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-green-200 text-green-800 rounded-full",children:e.tipo})]})},e.id)))}):(0,a.jsx)("div",{className:"space-y-2",children:o.map((e=>(0,a.jsxs)("button",{onClick:()=>{l(e)},className:"w-full text-left p-3 rounded-lg transition-colors duration-200 ".concat((null===i||void 0===i?void 0:i.id)===e.id?"bg-green-100":"hover:bg-green-50"),children:[(0,a.jsx)("h4",{className:"font-medium text-green-800",children:e.titulo}),e.autoria&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Por: ",e.autoria]}),e.tipo&&(0,a.jsx)("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-medium bg-green-200 text-green-800 rounded-full",children:e.tipo})]},e.id)))})}),(()=>{if(!i)return null;const e=i.link_pdf.includes("drive.google.com/file/d/");return(0,a.jsx)("div",{className:"rounded-lg overflow-hidden shadow-lg bg-white",children:e?(0,a.jsxs)(a.Fragment,{children:[f?(0,a.jsx)("iframe",{ref:g,src:s(i.link_pdf),width:"100%",height:"500px",allow:"autoplay",loading:"lazy",title:"".concat(i.titulo," (Google Docs Viewer)"),sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",className:"bg-white"}):(0,a.jsx)("iframe",{ref:g,src:i.link_pdf.replace("/view?usp=sharing","/preview"),width:"100%",height:"500px",allow:"autoplay",loading:"lazy",title:i.titulo,sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",className:"bg-white"}),u&&(0,a.jsxs)("div",{className:"p-6 text-center text-gray-600 bg-green-100",children:[(0,a.jsx)("p",{className:"mb-3 text-lg",children:"N\xe3o foi poss\xedvel carregar o documento diretamente."}),(0,a.jsxs)("a",{href:i.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Abrir em nova aba"]})]})]}):(0,a.jsx)("div",{className:"flex justify-center p-6",children:(0,a.jsxs)("a",{href:i.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-6 py-3 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Ver documento PDF"]})})})})()]})},l=t.memo(i)}}]);
//# sourceMappingURL=14.acae6f63.chunk.js.map