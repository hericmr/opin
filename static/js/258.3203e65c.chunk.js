"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[258],{237:(o,e,r)=>{r.d(e,{eP:()=>s,iy:()=>c,jW:()=>i,qP:()=>n,w_:()=>l});var t=r(9379),a=r(2880);const s=async o=>{try{console.log("=== DEBUG: addLegendaFoto ==="),console.log("Dados recebidos:",o);const r=(0,t.A)({},o);console.log("Dados iniciais:",r),Object.keys(r).forEach((o=>{""!==r[o]&&null!==r[o]||delete r[o]}));try{console.log("Verificando se a coluna tipo_foto existe...");const{data:o,error:e}=await a.N.from("legendas_fotos").select("tipo_foto").limit(1);console.log("Teste da coluna tipo_foto:",{testData:o,testError:e}),e&&"42703"===e.code&&(console.warn("Coluna tipo_foto n\xe3o encontrada. Removendo do objeto de inser\xe7\xe3o."),delete r.tipo_foto)}catch(e){console.warn("Coluna tipo_foto n\xe3o encontrada. Removendo do objeto de inser\xe7\xe3o."),delete r.tipo_foto}console.log("Dados finais para inser\xe7\xe3o:",r);const{data:s,error:l}=await a.N.from("legendas_fotos").insert([r]).select().single();if(console.log("Resposta do Supabase:",{data:s,error:l}),l)throw console.error("Erro do Supabase:",l),l;return console.log("Legenda criada com sucesso:",s),s}catch(r){throw console.error("Erro ao adicionar legenda de foto:",r),r}},l=async(o,e)=>{try{console.log("=== DEBUG: updateLegendaFoto ==="),console.log("ID da legenda:",o),console.log("Dados para atualiza\xe7\xe3o:",e);const r=(0,t.A)({},e);Object.keys(r).forEach((o=>{""!==r[o]&&null!==r[o]||delete r[o]})),console.log("Dados limpos para atualiza\xe7\xe3o:",r);const{data:s,error:l}=await a.N.from("legendas_fotos").update(r).eq("id",o).select().single();if(console.log("Resposta do Supabase:",{data:s,error:l}),l)throw console.error("Erro do Supabase ao atualizar:",l),l;return console.log("Legenda atualizada com sucesso:",s),s}catch(r){throw console.error("Erro ao atualizar legenda de foto:",r),r}},n=async function(o,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("getLegendaByImageUrl chamada com:",{imagemUrl:o,escolaId:e,tipoFoto:r});let s=a.N.from("legendas_fotos").select("*").eq("imagem_url",o).eq("escola_id",e).eq("ativo",!0);if(r)try{s=s.eq("tipo_foto",r)}catch(t){console.warn("Coluna tipo_foto n\xe3o encontrada. Ignorando filtro por tipo.")}let{data:l,error:n}=await s.single();if(console.log("Busca exata resultou em:",{data:l,error:n}),n&&"PGRST116"===n.code||!l){console.log("Tentando busca por finaliza\xe7\xe3o...");const s=o.split("/").slice(-2).join("/");console.log("Caminho relativo extra\xeddo:",s);let l=a.N.from("legendas_fotos").select("*").ilike("imagem_url","%/".concat(s)).eq("escola_id",e).eq("ativo",!0);if(r)try{l=l.eq("tipo_foto",r)}catch(t){}const{data:n,error:i}=await l.single();if(console.log("Busca por finaliza\xe7\xe3o resultou em:",{data2:n,error2:i}),!i&&n)return n}if(n&&"PGRST116"!==n.code)throw n;return l||null}catch(s){return console.error("Erro ao buscar legenda por URL:",s),null}},i=async(o,e)=>{try{const{data:r,error:t}=await a.N.from("titulos_videos").select("*").eq("video_url",o).eq("escola_id",e).eq("ativo",!0).single();if(t&&"PGRST116"!==t.code)throw t;return r||null}catch(r){return console.error("Erro ao buscar t\xedtulo por URL:",r),null}},c=async()=>{try{console.log("=== TESTE: Verificando estrutura da tabela legendas_fotos ===");const{data:r,error:t}=await a.N.from("legendas_fotos").select("*").limit(1);if(console.log("Teste 1 - Tabela existe:",{tableData:r,tableError:t}),t)return void console.error("\u274c ERRO: Tabela legendas_fotos n\xe3o existe ou n\xe3o est\xe1 acess\xedvel:",t);const{data:s,error:l}=await a.N.from("legendas_fotos").select("id, escola_id, imagem_url, legenda, descricao_detalhada, autor_foto, data_foto, categoria, ativo, created_at, updated_at").limit(1);console.log("Teste 2 - Estrutura da tabela:",{structureData:s,structureError:l}),l?console.error("\u274c ERRO: Problema com estrutura da tabela:",l):console.log("\u2705 Estrutura b\xe1sica da tabela est\xe1 OK");try{const{data:o,error:e}=await a.N.from("legendas_fotos").select("tipo_foto").limit(1);console.log("Teste 3 - Coluna tipo_foto:",{tipoData:o,tipoError:e}),e&&"42703"===e.code?console.log("\u26a0\ufe0f AVISO: Coluna tipo_foto n\xe3o existe na tabela"):e?console.error("\u274c ERRO: Problema com coluna tipo_foto:",e):console.log("\u2705 Coluna tipo_foto existe")}catch(o){console.log("\u26a0\ufe0f AVISO: Coluna tipo_foto n\xe3o existe na tabela")}console.log("Teste 4 - Testando inser\xe7\xe3o...");const n={escola_id:999999,imagem_url:"test/test.jpg",legenda:"Teste de legenda",descricao_detalhada:"Descri\xe7\xe3o de teste",autor_foto:"Teste",data_foto:"2024-01-01",categoria:"teste",ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};try{const{data:o,error:e}=await a.N.from("legendas_fotos").insert([n]).select().single();if(console.log("Teste 4 - Inser\xe7\xe3o de teste:",{insertData:o,insertError:e}),e)console.error("\u274c ERRO: Problema com inser\xe7\xe3o:",e);else{console.log("\u2705 Inser\xe7\xe3o funcionando - removendo registro de teste...");const{error:e}=await a.N.from("legendas_fotos").delete().eq("id",o.id);e?console.error("\u26a0\ufe0f AVISO: N\xe3o foi poss\xedvel remover registro de teste:",e):console.log("\u2705 Registro de teste removido com sucesso")}}catch(e){console.error("\u274c ERRO: Falha na inser\xe7\xe3o de teste:",e)}console.log("=== FIM DO TESTE ===")}catch(r){console.error("\u274c ERRO GERAL no teste da tabela:",r)}}},2006:(o,e,r)=>{r.d(e,{Y8:()=>l,e0:()=>i,g2:()=>c,lz:()=>n});var t=r(9379),a=r(2880);const s={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},l=async o=>{try{const{data:e,error:r}=await a.N.from("historias_professor").select("*").eq("escola_id",o).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(r)throw r;if(!e||0===e.length)return[];return e.map((o=>{if(o.imagem_url)try{const{data:{publicUrl:e}}=a.N.storage.from(s.BUCKET_NAME).getPublicUrl(o.imagem_url);return(0,t.A)((0,t.A)({},o),{},{imagem_public_url:e})}catch(e){return(0,t.A)((0,t.A)({},o),{},{imagem_public_url:null,urlError:e.message})}return o}))}catch(e){throw console.error("Erro ao buscar hist\xf3rias do professor:",e),e}},n=async o=>{try{const{data:e,error:r}=await a.N.from("historias_professor").insert([{escola_id:o.escola_id,nome_professor:o.nome_professor||null,historia:o.historia,ordem:o.ordem||1,ativo:!1!==o.ativo}]).select().single();if(r)throw r;return e}catch(e){throw console.error("Erro ao criar hist\xf3ria do professor:",e),e}},i=async(o,e)=>{try{const{data:r,error:t}=await a.N.from("historias_professor").update({nome_professor:e.nome_professor,historia:e.historia,ordem:e.ordem,ativo:e.ativo,updated_at:(new Date).toISOString()}).eq("id",o).select().single();if(t)throw t;return r}catch(r){throw console.error("Erro ao atualizar hist\xf3ria do professor:",r),r}},c=async o=>{try{const{error:e}=await a.N.from("historias_professor").delete().eq("id",o);if(e)throw e}catch(e){throw console.error("Erro ao deletar hist\xf3ria do professor:",e),e}}}}]);
//# sourceMappingURL=258.3203e65c.chunk.js.map