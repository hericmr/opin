"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[711],{40237:(e,a,o)=>{o.d(a,{eP:()=>l,iy:()=>s,jW:()=>c,qP:()=>r,t$:()=>n,w_:()=>i});var t=o(92880);const s=async()=>{try{const{error:e}=await t.N.from("legendas_fotos").select("count").limit(1);return e?(console.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(console.log("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return console.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},r=async function(e,a){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let s=t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a);!1!==o.ativo&&(s=s.eq("ativo",!0)),o.categoria&&(s=s.eq("categoria",o.categoria)),o.tipo_foto&&(s=s.eq("tipo_foto",o.tipo_foto));const{data:r,error:n}=await s.order("created_at",{ascending:!1});return n?(console.warn("Erro ao buscar legenda:",n.message),null):r&&r.length>0?r[0]:null}catch(s){return console.warn("Erro ao buscar legenda:",s.message),null}},n=async function(e,a){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(console.log("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(a,")")),o.categoria||o.tipo_foto){console.log("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const t=await r(e,a,o);if(t)return console.log("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),t}console.log("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:s,error:n}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(n)console.warn("  \u274c Erro na busca por URL e escola:",n.message);else if(s&&s.length>0)return console.log("  \u2705 Encontrada por URL e escola"),s[0];console.log("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:l,error:i}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).order("created_at",{ascending:!1});if(i)console.warn("  \u274c Erro na busca incluindo inativas:",i.message);else if(l&&l.length>0)return console.log("  \u2705 Encontrada incluindo legendas inativas"),l[0];const c=e.split("/").pop();console.log("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(c));const{data:d,error:u}=await t.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(c)).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(u)console.warn("  \u274c Erro na busca por nome do arquivo:",u.message);else if(d&&d.length>0)return console.log("  \u2705 Encontrada por nome do arquivo"),d[0];return console.log("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(s){return console.warn("Erro ao buscar legenda flex\xedvel:",s.message),null}},l=async e=>{try{const{data:a,error:o}=await t.N.from("legendas_fotos").insert([e]).select().single();if(o)throw o;return a}catch(a){throw console.error("Erro ao adicionar legenda:",a),a}},i=async(e,a)=>{try{const{data:o,error:s}=await t.N.from("legendas_fotos").update(a).eq("id",e).select().single();if(s)throw s;return o}catch(o){throw console.error("Erro ao atualizar legenda:",o),o}},c=async(e,a)=>{try{const{data:o,error:s}=await t.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("categoria","video").single();if(s){if("PGRST116"===s.code)return null;throw s}return o}catch(o){return console.warn("Erro ao buscar t\xedtulo do v\xeddeo:",o.message),null}}},42509:(e,a,o)=>{o.r(a),o.d(a,{default:()=>Eo});var t=o(65043),s=o(1642),r=o(75351),n=o(56528),l=o(99468),i=o(62463),c=o(41060),d=o(9333),u=o(89826),m=(o(43976),o(35366)),g=o(20495),h=o(63104),x=o(43241),p=o(45921),f=o(85263),b=o(73361),v=o(61247),w=o(47790);const j="".concat("/opin","/map-marker.svg"),y=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=e.get("markerData")||e.get("schoolData"),t=e.get("isNearbyPair");if(!o)return null;const s=new p.Ay({image:new f.A({src:j,scale:t?1.2:1,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),geometry:e.getGeometry()});if(a&&o.titulo){return[s,new p.Ay({text:new b.A({text:o.titulo,font:"12px Arial",fill:new v.A({color:"#1F2937"}),stroke:new w.A({color:"#FFFFFF",width:2}),offsetY:-15,textAlign:"center"}),geometry:e.getGeometry()})]}return s};var N=o(89379);const k=()=>{const e=window.innerWidth;if(e>768)return!1;const a=e<=768,o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t=void 0!==window.orientation;"ontouchstart"in window||navigator.maxTouchPoints;return!(!a||!o&&!t)||a};class C{constructor(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.map=e,this.options=(0,N.A)({enableHover:!1!==a.enableHover,enableClick:!1!==a.enableClick,enableDoubleClick:!1!==a.enableDoubleClick,enableTouch:!1!==a.enableTouch,hoverDelay:a.hoverDelay||200,clickDelay:a.clickDelay||300},a),this.eventHandlers=new Map,this.hoveredFeature=null,this.clickedFeature=null,this.clickTimeout=null,this.hoverTimeout=null,this.tooltipElement=null,console.log("[OpenLayersInteractions] Intera\xe7\xf5es inicializadas"),this.initializeInteractions()}isMobile(){const e=k(),a="ontouchstart"in window||navigator.maxTouchPoints>0;return console.log("[OpenLayersInteractions] Detec\xe7\xe3o de mobile:",{mobile:e,hasTouch:a,windowWidth:window.innerWidth,userAgent:navigator.userAgent}),e||a}initializeInteractions(){this.options.enableHover&&this.setupHoverInteraction(),this.options.enableClick&&this.setupClickInteraction(),this.options.enableDoubleClick&&this.setupDoubleClickInteraction(),this.options.enableTouch&&this.isMobile()&&this.setupTouchInteraction()}setupHoverInteraction(){this.map.on("pointermove",(e=>{this.handlePointerMove(e)})),this.map.on("pointerleave",(()=>{this.handlePointerLeave()}))}setupClickInteraction(){this.map.on("click",(e=>{this.handleClick(e)}))}setupDoubleClickInteraction(){this.map.on("dblclick",(e=>{this.handleDoubleClick(e)}))}setupTouchInteraction(){console.log("[OpenLayersInteractions] Touch interaction configurada para mobile")}handlePointerMove(e){if(this.isMobile())return;const a=this.map.forEachFeatureAtPixel(e.pixel,(e=>e));a&&!this.hoveredFeature&&console.log("[OpenLayersInteractions] Feature detectado:",{type:a.get("type"),schoolData:a.get("schoolData"),terraIndigenaInfo:a.get("terraIndigenaInfo")}),a!==this.hoveredFeature&&(this.hoveredFeature&&this.clearHover(),a&&this.applyHover(a,e))}handlePointerLeave(){this.clearHover()}handleClick(e){const a=this.map.forEachFeatureAtPixel(e.pixel,(e=>e));a&&(this.isMobile()?this.handleMobileClick(a,e):this.clickedFeature!==a?(this.clickedFeature=a,this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout((()=>{this.clickedFeature=null}),this.options.clickDelay),this.executeClickHandler(a,e)):this.handleDoubleClick(e))}handleDoubleClick(e){const a=this.map.forEachFeatureAtPixel(e.pixel,(e=>e));a&&(this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.clickedFeature=null,this.executeDoubleClickHandler(a,e))}handleTouchEnd(e){const a=this.map.forEachFeatureAtPixel(e.pixel,(e=>e));a&&this.executeClickHandler(a,e)}handleMobileClick(e,a){if(this.clickedFeature===e)return console.log("[OpenLayersInteractions] Segundo clique em mobile - abrindo painel"),this.forceHideTooltip(),void this.executeClickHandler(e,a);console.log("[OpenLayersInteractions] Primeiro clique em mobile - mostrando tooltip"),this.clickedFeature=e,this.options.showTooltip&&this.showTooltip(e,a),this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout((()=>{console.log("[OpenLayersInteractions] Timeout mobile - escondendo tooltip e resetando"),this.forceHideTooltip()}),3e3),this.executeHoverHandler(e,a)}applyHover(e,a){this.hoveredFeature=e,this.applyHoverStyle(e),this.options.showTooltip&&!this.isMobile()&&this.showTooltip(e,a),this.executeHoverHandler(e,a)}clearHover(){this.hoveredFeature&&(this.clearHoverStyle(this.hoveredFeature),this.isMobile()||this.hideTooltip(),this.executeHoverOutHandler(this.hoveredFeature),this.hoveredFeature=null)}applyHoverStyle(e){this.options.hoverStyleFunction&&this.options.hoverStyleFunction(e,!0)}clearHoverStyle(e){this.options.hoverStyleFunction&&this.options.hoverStyleFunction(e,!1)}showTooltip(e,a){this.tooltipElement&&this.hideTooltip();const o=this.getTooltipContent(e);console.log("[OpenLayersInteractions] Conte\xfado do tooltip:",o),o?(this.tooltipElement=this.createTooltipElement(o,a),this.map.getTargetElement().appendChild(this.tooltipElement),console.log("[OpenLayersInteractions] Tooltip criado e adicionado ao DOM")):console.log("[OpenLayersInteractions] Sem conte\xfado para tooltip")}hideTooltip(){this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null,console.log("[OpenLayersInteractions] Tooltip escondido"))}forceHideTooltip(){this.hideTooltip(),this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.clickedFeature=null,console.log("[OpenLayersInteractions] Tooltip for\xe7adamente escondido e estado resetado")}createTooltipElement(e,a){const o=document.createElement("div");o.className="ol-tooltip";const t=e.includes("Terra Ind\xedgena");if(this.isMobile()){const s='<span class="tooltip-clickable">'.concat(e,"</span>");o.innerHTML=s;const r=t?{backgroundColor:"#fef2f2",borderColor:"rgba(239, 68, 68, 0.3)"}:{backgroundColor:"#bbf7d0",borderColor:"rgba(34, 197, 94, 0.3)"};Object.assign(o.style,(0,N.A)({position:"absolute",padding:"8px 12px",borderRadius:"8px",fontSize:"14px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:"700",color:"#000000",pointerEvents:"auto",zIndex:"1000",maxWidth:"250px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",border:"2px solid ".concat(r.borderColor),cursor:"default"},r));const n=o.querySelector(".tooltip-clickable");n&&(Object.assign(n.style,{cursor:"pointer",textDecoration:"underline",textDecorationColor:"#3B82F6",textDecorationThickness:"2px",transition:"all 0.2s ease",display:"inline-block",padding:"2px 4px",borderRadius:"4px",fontWeight:"800"}),n.addEventListener("click",(()=>{console.log("[OpenLayersInteractions] Nome clicado no tooltip mobile");const e=this.map.forEachFeatureAtPixel(a.pixel,(e=>e));e&&this.executeClickHandler(e,a)})),n.addEventListener("mouseenter",(()=>{n.style.backgroundColor="rgba(59, 130, 246, 0.1)",n.style.textDecorationColor="#1D4ED8",n.style.transform="scale(1.05)"})),n.addEventListener("mouseleave",(()=>{n.style.backgroundColor="transparent",n.style.textDecorationColor="#3B82F6",n.style.transform="scale(1)"})))}else{o.innerHTML=e;const a=t?{backgroundColor:"#fef2f2"}:{backgroundColor:"#bbf7d0"};Object.assign(o.style,(0,N.A)({position:"absolute",padding:"6px 10px",borderRadius:"6px",fontSize:"12px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:"700",color:"#000000",pointerEvents:"none",zIndex:"1000",maxWidth:"200px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},a))}const s=a.coordinate,r=this.map.getPixelFromCoordinate(s);return o.style.left=r[0]+10+"px",o.style.top=r[1]-10+"px",o}getTooltipContent(e){if(console.log("[OpenLayersInteractions] Obtendo conte\xfado do tooltip para feature:",{type:e.get("type"),schoolData:e.get("schoolData"),terraIndigenaInfo:e.get("terraIndigenaInfo")}),this.options.tooltipContentFunction){const a=this.options.tooltipContentFunction(e);return console.log("[OpenLayersInteractions] Conte\xfado do tooltip (fun\xe7\xe3o customizada):",a),a}const a=e.get("schoolData");if(a){const e=a.titulo||"Escola Ind\xedgena";return console.log("[OpenLayersInteractions] T\xedtulo extra\xeddo (padr\xe3o):",e),console.log("[OpenLayersInteractions] Conte\xfado do tooltip (padr\xe3o escola - FOR\xc7ADO apenas t\xedtulo):",e),e}const o=e.get("terraIndigenaInfo");if(o){const e="Terra Ind\xedgena ".concat(o.titulo||"Ind\xedgena");return console.log("[OpenLayersInteractions] Conte\xfado do tooltip (padr\xe3o terra ind\xedgena):",e),e}return console.log("[OpenLayersInteractions] Nenhum conte\xfado encontrado para tooltip"),null}executeClickHandler(e,a){const o=this.eventHandlers.get("click");o&&"function"===typeof o&&o(e,a)}executeDoubleClickHandler(e,a){const o=this.eventHandlers.get("doubleClick");o&&"function"===typeof o&&o(e,a)}executeHoverHandler(e,a){const o=this.eventHandlers.get("hover");o&&"function"===typeof o&&o(e,a)}executeHoverOutHandler(e){const a=this.eventHandlers.get("hoverOut");a&&"function"===typeof a&&a(e)}on(e,a){this.eventHandlers.set(e,a)}off(e){this.eventHandlers.delete(e)}clearHandlers(){this.eventHandlers.clear()}updateOptions(e){this.options=(0,N.A)((0,N.A)({},this.options),e),e.enableHover,e.enableClick}destroy(){this.clickTimeout&&clearTimeout(this.clickTimeout),this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hideTooltip(),this.clearHover(),this.clearHandlers()}}function A(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new C(e,(0,N.A)((0,N.A)({},{enableHover:!0,enableClick:!0,enableDoubleClick:!0,enableTouch:!0,showTooltip:!0,hoverDelay:200,clickDelay:300}),a))}var E=o(6454);function _(e,a){var o;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!a)return;const s=null!==(o=t.durationMs)&&void 0!==o?o:350,r=e.getView(),n={center:a,duration:s};"number"===typeof t.zoom&&(n.zoom=t.zoom),r.animate(n)}const L=0,S=1,I=2,z=3,M=z,P={debug:function(){if(M<=L){for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];console.log("[DEBUG]",...a)}},info:function(){if(M<=S){for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];console.info("[INFO]",...a)}},warn:function(){if(M<=I){for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];console.warn("[WARN]",...a)}},error:function(){if(M<=z){for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];console.error("[ERROR]",...a)}},group:e=>{M<=L&&console.group(e)},groupEnd:()=>{M<=L&&console.groupEnd()}};var T=o(70579);const D=e=>{let{dataPoints:a=[],onPainelOpen:o,showMarcadores:s=!0,showNomesEscolas:r=!1,map:n,className:l="h-full w-full"}=e;const c=(0,t.useRef)(null),d=(0,t.useRef)(null),[,u]=t.useState(null),b=(0,t.useCallback)((()=>{n&&(P.debug("[OpenLayersMarkers] Inicializando marcadores individuais..."),c.current=new g.A,d.current=new m.A({source:c.current,style:e=>y(e,r),zIndex:100}),n.addLayer(d.current),v())}),[n,r]),v=(0,t.useCallback)((()=>{if(!n||!d.current)return;P.debug("[OpenLayersMarkers] Configurando intera\xe7\xf5es com tooltips...");const e=function(e,a,o){console.log("[createMarkerInteractions] Criando intera\xe7\xf5es para marcadores...");const t=A(e,{showTooltip:!0,tooltipContentFunction:e=>{console.log("[createMarkerInteractions] Fun\xe7\xe3o de conte\xfado do tooltip chamada para:",e);const a=e.get("schoolData");if(a){const e=a.titulo||"Escola Ind\xedgena";return console.log("[createMarkerInteractions] T\xedtulo extra\xeddo:",e),console.log("[createMarkerInteractions] Conte\xfado do tooltip gerado (FOR\xc7ADO apenas t\xedtulo):",e),e}return console.log("[createMarkerInteractions] Sem dados de escola para tooltip"),null}});return a&&(console.log("[createMarkerInteractions] Configurando handler de clique personalizado"),t.on("click",a)),o&&t.on("hover",o),console.log("[createMarkerInteractions] Intera\xe7\xf5es criadas com sucesso"),t}(n,w,N);e.on("click",w),e.on("hover",N),e.on("hoverOut",k),P.debug("[OpenLayersMarkers] Intera\xe7\xf5es configuradas e integradas com o mapa")}),[n]),w=(0,t.useCallback)(((e,a)=>{const t=e.get("schoolData");if(t&&o){var s;const a=null===(s=e.getGeometry())||void 0===s?void 0:s.getCoordinates();n&&a&&(function(e,a){var o;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!a)return;const s=null!==(o=t.durationMs)&&void 0!==o?o:350,r=t.zoom,n="number"===typeof t.fractionX?t.fractionX:.25,l="number"===typeof t.fractionY?t.fractionY:.5,i=e.getSize();if(!i)return _(e,a,{durationMs:s,zoom:r});const[c,d]=i,u=Math.max(0,Math.min(1,n))*c,m=Math.max(0,Math.min(1,l))*d,g=e.getPixelFromCoordinate(a);if(!g)return _(e,a,{durationMs:s,zoom:r});const h=[g[0]-u+c/2,g[1]-m+d/2],x=e.getCoordinateFromPixel(h);if(!x)return _(e,a,{durationMs:s,zoom:r});const p=e.getView(),f={center:x,duration:s};"number"===typeof r&&(f.zoom=r),p.animate(f)}(n,a,{durationMs:550,fractionX:.25}),function(e,a){var o,t;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!a)return;const r=null!==(o=s.radiusPx)&&void 0!==o?o:18,n=null!==(t=s.durationMs)&&void 0!==t?t:900,l=document.createElement("div");l.className="ol-click-pulse",l.style.width="".concat(2*r,"px"),l.style.height="".concat(2*r,"px"),l.style.marginLeft="".concat(-r,"px"),l.style.marginTop="".concat(-r,"px");const i=new E.A({element:l,positioning:"center-center",stopEvent:!1});e.addOverlay(i),i.setPosition(a);const c=()=>{try{e.removeOverlay(i)}catch(a){}};l.addEventListener("animationend",c,{once:!0}),setTimeout(c,n+100)}(n,a)),P.debug("[OpenLayersMarkers] Marcador clicado:",t.titulo),o(t)}}),[o,n]),N=(0,t.useCallback)(((e,a)=>{u(e),d.current&&(d.current.setStyle((a=>a===e?((e,a)=>{if(!a)return null;const o=new p.Ay({image:new f.A({src:j,scale:1.3,anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction"}),geometry:e.getGeometry()});return Array.isArray(a)?[...a,o]:[a,o]})(a,y(a,r)):y(a,r))),d.current.changed())}),[r]),k=(0,t.useCallback)((()=>{u(null),d.current&&(d.current.setStyle((e=>y(e,r))),d.current.changed())}),[r]),C=(0,t.useCallback)((()=>{if(!c.current||!a)return;if(P.debug("[OpenLayersMarkers] Atualizando marcadores...",a.length,"showMarcadores:",s),c.current.clear(),!s)return void P.debug("[OpenLayersMarkers] Marcadores desabilitados, removendo todos");const e=a.filter((e=>{if(!e.latitude||!e.longitude)return!1;const a=parseFloat(e.latitude),o=parseFloat(e.longitude);return!isNaN(a)&&!isNaN(o)&&a>=-90&&a<=90&&o>=-180&&o<=180}));P.debug("[OpenLayersMarkers] Pontos v\xe1lidos:",e.length),e.forEach(((e,a)=>{if(e.latitude&&e.longitude){const o=new h.A({geometry:new x.A((0,i.Rb)([e.longitude,e.latitude]))});o.set("markerData",e),o.set("schoolData",e),o.set("markerId","marker_".concat(a)),o.set("type","marker"),c.current.addFeature(o)}})),P.debug("[OpenLayersMarkers] ".concat(e.length," marcadores individuais adicionados"))}),[a,s]),L=(0,t.useCallback)((()=>{d.current&&(d.current.setStyle((e=>y(e,r))),d.current.changed())}),[r]);return(0,t.useEffect)((()=>(n&&b(),()=>{d.current&&n&&n.removeLayer(d.current)})),[n,b]),(0,t.useEffect)((()=>{C()}),[C]),(0,t.useEffect)((()=>{L()}),[L]),(0,T.jsx)("div",{className:l})};var F=o(3908);const R={terrasIndigenas:{regularizada:{fill:"rgba(220, 20, 60, 0.3)",stroke:"#B22222",hover:{fill:"rgba(220, 20, 60, 0.45)",stroke:"#FF0000"}},declarada:{fill:"rgba(139, 0, 0, 0.25)",stroke:"#B22222",hover:{fill:"rgba(139, 0, 0, 0.4)",stroke:"#FF0000"}}},estadoSP:{fill:"rgba(0, 0, 0, 0.3)",stroke:"#000000",hover:{fill:"rgba(0, 0, 0, 0.4)",stroke:"#333333"}}},O=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!e.properties)return new p.Ay({fill:new v.A({color:R.terrasIndigenas.regularizada.fill}),stroke:new w.A({color:R.terrasIndigenas.regularizada.stroke,width:2})});const o="Regularizada"===e.properties.fase_ti?R.terrasIndigenas.regularizada:R.terrasIndigenas.declarada,t=a?o.hover:o;return new p.Ay({fill:new v.A({color:t.fill}),stroke:new w.A({color:t.stroke,width:a?3:2,lineDash:a?[]:[3,3]})})};const H={center:[-48.4129,-22.3794],zoom:7.63,maxZoom:18,minZoom:4,mobile:{center:[-48.5935,-21.9212],zoom:5.7},clusterDistance:15,clusterMinDistance:3,clusterAnimationDuration:300,proximityThreshold:5e-5,disableClusteringAtZoom:12,tooltipOffset:10,tooltipDelay:200,interaction:{enableHover:!0,enableClick:!0,enableDoubleClick:!0,enableTouch:!0,clickDelay:300,hoverDelay:200},performance:{enableLazyLoading:!0,maxFeaturesPerTile:1e3,enableFeatureCulling:!0,enableTileCaching:!0},ANIMATION_CONFIG:{duration:{marker:300,cluster:500,zoom:800,pan:600},easing:{marker:"ease-out",cluster:"ease-in-out",zoom:"ease-out",pan:"ease-out"}}},q={small:"#60A5FA",medium:"#3B82F6",large:"#2563EB",xlarge:"#1E40AF"},U={min:11,max:20,size:52},B={min:21,max:50,size:56},W={min:51,max:100,size:64},V="EPSG:4326",G="EPSG:3857",Z="EPSG:4674",K={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:'\xa9 <a href="https://www.esri.com/">Esri</a>',maxZoom:19,wrapX:!1,tilePixelRatio:1,tileSize:256},X=(q.small,U.size,q.medium,B.size,q.large,W.size,q.xlarge,(0,t.forwardRef)(((e,a)=>{let{data:o,onPainelOpen:s,showTerrasIndigenas:r=!0,map:n,className:l="h-full w-full"}=e;const i=(0,t.useRef)(null),c=(0,t.useRef)(null),d=(0,t.useRef)(null),[,u]=t.useState(null),[h,x]=t.useState(null),f=(0,t.useMemo)((()=>k()),[]),b=(0,t.useCallback)((()=>{if(n&&o)if(o.features&&Array.isArray(o.features)&&0!==o.features.length)try{const e=new F.A({dataProjection:Z||V,featureProjection:G}).readFeatures(o);i.current=new g.A({features:e}),c.current=new m.A({source:i.current,style:e=>O(e,!1),zIndex:10}),e.forEach((e=>{const a=e.getProperties();e.set("terraIndigenaInfo",{titulo:a.terrai_nom,tipo:"terra_indigena",etnia:a.etnia_nome,municipio:a.municipio_,uf:a.uf_sigla,superficie:a.superficie,fase:a.fase_ti,modalidade:a.modalidade,reestudo:a.reestudo_t,cr:a.cr,faixa_fron:a.faixa_fron,undadm_nom:a.undadm_nom,undadm_sig:a.undadm_sig,dominio_un:a.dominio_un,data_atual:a.data_atual,terrai_cod:a.terrai_cod,undadm_cod:a.undadm_cod})})),n.addLayer(c.current),j(),console.log("[OpenLayersTerrasIndigenas] Camada criada com ".concat(e.length," features"))}catch(e){console.error("[OpenLayersTerrasIndigenas] Erro ao criar camada:",e)}else console.warn("[OpenLayersTerrasIndigenas] Dados inv\xe1lidos ou vazios:",o)}),[n,o]),j=(0,t.useCallback)((()=>{n&&c.current&&(d.current=function(e,a,o){const t=A(e,{showTooltip:!0,tooltipContentFunction:e=>{const a=e.get("terraIndigenaInfo");return a?"Terra Ind\xedgena ".concat(a.titulo||"Ind\xedgena"):null}});return a&&t.on("click",a),o&&t.on("hover",o),t}(n,y,N),d.current.on("click",y),d.current.on("hover",N),d.current.on("hoverOut",C))}),[n]),y=(0,t.useCallback)(((e,a)=>{if(!e)return;const o=e.get("terraIndigenaInfo");if(o)if(f)s&&s(o);else if(h===e)s&&s(o),x(null);else{x(e);const a=e.getGeometry();if(a){const e=a.getExtent();n.getView().fit(e,{duration:H.ANIMATION_CONFIG.duration.zoom,padding:[50,50,50,50],maxZoom:15})}}}),[f,s,h,n]),N=(0,t.useCallback)(((e,a)=>{f||(u(e),c.current&&(c.current.setStyle((a=>O(a,a===e))),c.current.changed()))}),[f]),C=(0,t.useCallback)((e=>{u(null),c.current&&(c.current.setStyle((e=>O(e,!1))),c.current.changed())}),[]),E=(0,t.useCallback)((e=>{c.current&&(c.current.setStyle((a=>{if(a===e){return function(e,a){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{fillColor:t="rgba(59, 130, 246, 0.3)",strokeColor:s="#1E40AF",strokeWidth:r=3,lineDash:n=[5,5]}=o,l=new p.Ay({fill:new v.A({color:t}),stroke:new w.A({color:s,width:r,lineDash:n})});return Array.isArray(a)?[...a,l]:[a,l]}(a,O(a,!1))}return O(a,!1)})),c.current.changed())}),[]),_=(0,t.useCallback)((e=>{c.current&&(c.current.setStyle((e=>O(e,!1))),c.current.changed())}),[]);return(0,t.useEffect)((()=>(n&&o&&r&&b(),()=>{d.current&&d.current.destroy(),c.current&&n&&n.removeLayer(c.current)})),[n,o,r,b]),(0,t.useEffect)((()=>{h?E(h):c.current&&_()}),[h,E,_]),(0,t.useEffect)((()=>{if(h){const e=setTimeout((()=>{x(null)}),H.interaction.clickDelay);return()=>clearTimeout(e)}}),[h]),r&&o?(0,T.jsx)("div",{className:l}):null}))),Y=(0,t.forwardRef)(((e,a)=>{let{data:o,showEstadoSP:s=!0,map:r,className:n="h-full w-full"}=e;const l=(0,t.useRef)(null),i=(0,t.useRef)(null),c=(0,t.useCallback)((()=>{if(r&&o)if(o.features&&Array.isArray(o.features)&&0!==o.features.length)try{const e=new F.A({dataProjection:Z||V,featureProjection:G}).readFeatures(o);l.current=new g.A({features:e}),i.current=new m.A({source:l.current,style:e=>function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=a?R.estadoSP.hover:R.estadoSP;return new p.Ay({fill:new v.A({color:o.fill}),stroke:new w.A({color:o.stroke,width:a?2:1})})}(e,!1),zIndex:5,interactive:!1}),r.addLayer(i.current),console.log("[OpenLayersEstadoSP] Camada criada com ".concat(e.length," features"))}catch(e){console.error("[OpenLayersEstadoSP] Erro ao criar camada:",e)}else console.warn("[OpenLayersEstadoSP] Dados inv\xe1lidos ou vazios:",o)}),[r,o]);return(0,t.useEffect)((()=>(r&&o&&s&&c(),()=>{i.current&&r&&r.removeLayer(i.current)})),[r,o,s,c]),s&&o?(0,T.jsx)("div",{className:n}):null})),J=e=>{let{terrasIndigenasData:a,estadoSPData:o,showTerrasIndigenas:s=!0,showEstadoSP:r=!0,onPainelOpen:n,map:l,className:i="h-full w-full"}=e;const c=(0,t.useRef)(null),d=(0,t.useRef)(null),[u,m]=t.useState({terrasIndigenas:{visible:s,loaded:!1,error:null},estadoSP:{visible:r,loaded:!1,error:null}}),g=(0,t.useMemo)((()=>({terrasIndigenas:a&&a.features&&a.features.length>0,estadoSP:o&&o.features&&o.features.length>0})),[a,o]),h=(0,t.useCallback)(((e,a)=>{m((o=>(0,N.A)((0,N.A)({},o),{},{[e]:(0,N.A)((0,N.A)({},o[e]),a)})))}),[]),x=(0,t.useCallback)(((e,a)=>{console.error("[OpenLayersLayers] Erro na camada ".concat(e,":"),a),h(e,{error:a.message})}),[h]),p=(0,t.useCallback)((e=>{h(e,{loaded:!0,error:null})}),[h]),f=(0,t.useCallback)((()=>{const e={total:0,visible:0,loaded:0,errors:0};return Object.values(u).forEach((a=>{e.total++,a.visible&&e.visible++,a.loaded&&e.loaded++,a.error&&e.errors++})),e}),[u]),b=(0,t.useCallback)((()=>({terrasIndigenas:(0,N.A)((0,N.A)({},u.terrasIndigenas),{},{hasData:g.terrasIndigenas,featureCount:g.terrasIndigenas?a.features.length:0}),estadoSP:(0,N.A)((0,N.A)({},u.estadoSP),{},{hasData:g.estadoSP,featureCount:g.estadoSP?o.features.length:0})})),[u,g,a,o]);return(0,t.useEffect)((()=>{const e=f(),a=b();console.log("[OpenLayersLayers] Status das camadas:",{stats:e,info:a,hasValidData:g})}),[u,f,b,g]),(0,t.useEffect)((()=>{m((e=>({terrasIndigenas:(0,N.A)((0,N.A)({},e.terrasIndigenas),{},{visible:s}),estadoSP:(0,N.A)((0,N.A)({},e.estadoSP),{},{visible:r})})))}),[s,r]),g.terrasIndigenas||g.estadoSP?(0,T.jsxs)("div",{className:i,children:[g.terrasIndigenas&&(0,T.jsx)(X,{ref:c,data:a,onPainelOpen:n,showTerrasIndigenas:s,map:l,onLoad:()=>p("terrasIndigenas"),onError:e=>x("terrasIndigenas",e)}),g.estadoSP&&(0,T.jsx)(Y,{ref:d,data:o,showEstadoSP:r,map:l,onLoad:()=>p("estadoSP"),onError:e=>x("estadoSP",e)})]}):(0,T.jsx)("div",{className:i,children:(0,T.jsx)("div",{className:"text-center text-gray-500 p-4",children:"Nenhuma camada GeoJSON dispon\xedvel"})})},$=()=>{const[e,a]=(0,t.useState)({width:"undefined"!==typeof window?window.innerWidth:1024,height:"undefined"!==typeof window?window.innerHeight:768}),[o,s]=(0,t.useState)(!1),[r,n]=(0,t.useState)(!1),[l,i]=(0,t.useState)(!1);(0,t.useEffect)((()=>{const e=()=>{const e=window.innerWidth,o=window.innerHeight;a({width:e,height:o}),s(e<=767),n(e>=768&&e<=1023),i(e>=1024)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[]);return{screenSize:e,isMobile:o,isTablet:r,isDesktop:l,zoomConfig:o?{bottom:120,buttonSize:44,spacing:8,left:.25}:r?{bottom:40,buttonSize:40,spacing:6,left:.5}:{bottom:60,buttonSize:36,spacing:6,left:.5},accessibility:{prefersReducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches,prefersHighContrast:window.matchMedia("(prefers-contrast: high)").matches,isLandscape:e.width>e.height}}},Q=e=>{let{mapRef:a}=e;const{zoomConfig:o,accessibility:s,isMobile:r,isTablet:n}=$(),l=(0,t.useRef)(null);return(0,t.useEffect)((()=>{if(!l.current||null===a||void 0===a||!a.current)return;const e=a.current.getControls().getArray().find((e=>e.getClassName&&e.getClassName().includes("ol-zoom")));if(e){const a=e.element;a.style.bottom="".concat(o.bottom,"px"),a.style.left="".concat(o.left,"em");a.querySelectorAll(".ol-zoom-in, .ol-zoom-out").forEach((e=>{e.style.minHeight="".concat(o.buttonSize,"px"),e.style.minWidth="".concat(o.buttonSize,"px"),e.style.marginBottom="".concat(o.spacing,"px"),s.prefersReducedMotion&&(e.style.transition="none"),s.prefersHighContrast&&(e.style.backgroundColor="white",e.style.border="2px solid black",e.style.color="black")}))}}),[o,s,a]),(0,t.useEffect)((()=>{if(!l.current)return;const e=l.current;e.classList.remove("mobile-optimized","tablet-optimized","desktop-optimized"),r?e.classList.add("mobile-optimized"):n?e.classList.add("tablet-optimized"):e.classList.add("desktop-optimized")}),[r,n]),(0,T.jsx)("div",{ref:l,className:"responsive-zoom-controls","data-device":r?"mobile":n?"tablet":"desktop","data-accessibility":JSON.stringify(s)})},ee=t.forwardRef(((e,a)=>(0,T.jsx)("div",(0,N.A)({id:"map",className:"w-full h-full",ref:a},e))));u.A.defs("EPSG:4674","+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"),(0,d.kz)(u.A);const ae=e=>{let{dataPoints:a=[],onPainelOpen:o,center:d=H.center,zoom:u=H.zoom,className:m="h-screen w-full",terrasIndigenasData:g=null,estadoSPData:h=null,showTerrasIndigenas:x=!0,showEstadoSP:p=!0,showMarcadores:f=!0,showNomesEscolas:b=!1}=e;const v=(0,t.useRef)(null),w=(0,t.useRef)(null),j=(0,t.useRef)(null),[,y]=(0,t.useState)({lng:d[0],lat:d[1],zoom:u}),N=(0,t.useMemo)((()=>k()),[]),C=N?H.mobile.center:d,A=N?H.mobile.zoom:u,E=(0,t.useCallback)((()=>({satelliteLayer:new n.A({source:new l.A({url:K.url,attributions:K.attributions,maxZoom:K.maxZoom,wrapX:K.wrapX,tilePixelRatio:K.tilePixelRatio,tileSize:K.tileSize}),preload:1,useInterimTilesOnError:!1})})),[]),_=(0,t.useCallback)((()=>{if(w.current)return;const{satelliteLayer:e}=E();j.current=e,w.current=new s.A({target:v.current,layers:[j.current],view:new r.Ay({center:(0,i.Rb)(C),zoom:A,maxZoom:H.maxZoom,minZoom:H.minZoom,enableRotation:!1}),controls:(0,c.N)()}),w.current.on("moveend",(()=>{const e=w.current.getView(),a=(0,i.WP)(e.getCenter()),o={lng:a[0].toFixed(4),lat:a[1].toFixed(4),zoom:e.getZoom().toFixed(2)};y(o)})),console.log("[OpenLayersMap] Mapa inicializado com sucesso")}),[C,A,E]),L=(0,t.useCallback)((()=>{if(!w.current)return;const e=k(),a=e?H.mobile.center:d,o=e?H.mobile.zoom:u,t=w.current.getView(),s=(0,i.WP)(t.getCenter()),r=t.getZoom();s[0]===a[0]&&s[1]===a[1]&&r===o||(t.setCenter((0,i.Rb)(a)),t.setZoom(o))}),[d,u]);return(0,t.useEffect)((()=>(_(),()=>{w.current&&(w.current.setTarget(void 0),w.current=null)})),[_]),(0,t.useEffect)((()=>{L()}),[L]),(0,T.jsx)(ee,{ref:v,children:w.current&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(D,{dataPoints:a,onPainelOpen:o,showMarcadores:f,showNomesEscolas:b,map:w.current}),(0,T.jsx)(J,{terrasIndigenasData:g,estadoSPData:h,showTerrasIndigenas:x,showEstadoSP:p,onPainelOpen:o,map:w.current}),(0,T.jsx)(Q,{mapRef:w})]})})},oe={},te=e=>{const[a,o]=(0,t.useState)(null),[s,r]=(0,t.useState)(!1),[n,l]=(0,t.useState)(null);return(0,t.useEffect)((()=>{if(!e)return;(async()=>{if(oe[e])return P.debug("useGeoJSONCache: Dados de ".concat(e," encontrados no cache")),void o(oe[e]);r(!0);try{var a;const t="".concat("/opin","/").concat(e,".geojson");P.debug("useGeoJSONCache: Carregando ".concat(e," de:"),t);const s=await fetch(t);if(!s.ok)throw new Error("Erro ao buscar GeoJSON (".concat(s.status,")"));const r=await s.json();P.debug("useGeoJSONCache: ".concat(e," carregado com sucesso:"),{type:r.type,features:(null===(a=r.features)||void 0===a?void 0:a.length)||0}),oe[e]=r,o(r)}catch(t){P.error("useGeoJSONCache: Erro ao carregar ".concat(e,":"),t),l(t)}finally{r(!1)}})()}),[e]),{data:a,loading:s,error:n}},se=(e,a)=>(0,t.useMemo)((()=>e?{minimized:{path:"M5 15l7-7 7 7",ariaLabel:"Expandir menu"},expanded:{path:"M19 9l-7 7-7-7",ariaLabel:"Minimizar menu"}}:{minimized:{path:"M19 9l-7 7-7-7",ariaLabel:"Expandir menu"},expanded:{path:"M5 15l7-7 7 7",ariaLabel:"Minimizar menu"}}),[e]),re=e=>{let{isMobile:a,isMinimized:o,className:t="w-4 h-4"}=e;const s=se(a),r=o?s.minimized:s.expanded;return(0,T.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-label":r.ariaLabel,children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:r.path})})};var ne=o(29134);const le=e=>{let{dataPoints:a,onPainelOpen:o,painelAberto:s=!1,className:r="h-screen w-full",isMainLoading:n=!1}=e;const{data:l,loading:i,error:c}=te("terras_indigenas"),{data:d,loading:u,error:m}=te("SP"),[g,h]=(0,t.useState)(!0),[x,p]=(0,t.useState)(!0),[f,b]=(0,t.useState)(!0),{isMobile:v}=(0,ne.d)(),[w,j]=(0,t.useState)(!1),y=(0,t.useCallback)((()=>j((e=>!e))),[]),[N,k]=(0,t.useState)((()=>{const e="undefined"!==typeof window?localStorage.getItem("opin:textScale"):null;return e?parseFloat(e):1}));(0,t.useEffect)((()=>{const e=Math.min(1.3,Math.max(.9,N));if(e!==N)return void k(e);document.documentElement.style.fontSize="".concat(16*e,"px");try{localStorage.setItem("opin:textScale",String(e))}catch(a){}}),[N]);(0,t.useEffect)((()=>{var e,a;P.debug("MapSelector: Status das camadas GeoJSON:",{terrasIndigenas:{loading:i,error:c,hasData:!!l,features:(null===l||void 0===l||null===(e=l.features)||void 0===e?void 0:e.length)||0},estadoSP:{loading:u,error:m,hasData:!!d,features:(null===d||void 0===d||null===(a=d.features)||void 0===a?void 0:a.length)||0}})}),[l,d,i,u,c,m]),(0,t.useEffect)((()=>{!s&&v&&(P.debug("MapSelector: Painel fechado em mobile, reativando marcadores"),b(!0))}),[s,v]);const C=e=>{let{onMinimize:a,isMobile:o,isMinimized:t}=e;return(0,T.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-green-900/80 to-green-800/80 text-white",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"})}),(0,T.jsx)("h3",{className:"text-sm font-semibold tracking-wide",children:"Camadas do Mapa"})]}),(0,T.jsx)("div",{className:"flex items-center gap-2",children:(0,T.jsx)("button",{onClick:a,className:"text-white hover:bg-white/10 transition-all duration-200 p-1.5 rounded-md","aria-label":t?"Expandir":"Minimizar",type:"button",children:(0,T.jsx)(re,{isMobile:o,isMinimized:t,className:"w-4 h-4"})})})]})},A=e=>{let{id:a,label:o,checked:t,onChange:s,disabled:r=!1,loading:l=!1,error:i=!1}=e;return(0,T.jsxs)("button",{type:"button",onClick:s,disabled:r,className:"group w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 focus:outline-none focus:ring-0 ".concat(t?"bg-white/10":"bg-white/5 hover:bg-white/10"," ").concat(r?"opacity-50 cursor-not-allowed":"cursor-pointer"),children:[(0,T.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,T.jsx)("div",{className:"flex items-center gap-2",children:(0,T.jsx)("span",{className:"text-sm font-medium ".concat(t?"text-white":"text-white/90"),children:o})}),(0,T.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[l&&!n&&(0,T.jsx)("div",{className:"flex items-center gap-1 text-white/80",children:(0,T.jsx)("span",{className:"text-xs",children:"Carregando..."})}),i&&(0,T.jsxs)("div",{className:"flex items-center gap-1 text-red-300",children:[(0,T.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,T.jsx)("span",{className:"text-xs",children:"Erro"})]})]})]}),(0,T.jsx)("div",{className:"flex-shrink-0 ml-2",role:"switch","aria-checked":t,"aria-label":o,children:(0,T.jsx)("div",{className:"relative inline-flex h-5 w-10 items-center rounded-full transition-colors duration-200 ".concat(t?"bg-green-500/70":"bg-gray-300"),children:(0,T.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white shadow transition-transform duration-200 ".concat(t?"translate-x-5":"translate-x-1")})})})]})},E=v?H.mobile.center:H.center,_=v?H.mobile.zoom:H.zoom;return P.debug("MapSelector - Configura\xe7\xe3o do mapa:",{isMobile:v,zoom:_,center:E}),(0,T.jsxs)("div",{className:r,style:{position:"relative"},children:[v?(0,T.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-20",children:(0,T.jsxs)("div",{className:"bg-green-900/30 backdrop-blur-md shadow-2xl rounded-t-2xl text-white",children:[(0,T.jsx)(C,{onMinimize:y,isMobile:!0,isMinimized:w}),!w&&(0,T.jsxs)("div",{className:"p-4 flex flex-col gap-3 max-h-80 overflow-y-auto",children:[(0,T.jsx)(A,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:x,onChange:()=>p(!x),loading:u,error:m}),(0,T.jsx)(A,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:f,onChange:()=>b(!f)}),(0,T.jsx)(A,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:g,onChange:()=>h(!g),loading:i,error:c})]})]})}):(0,T.jsxs)("div",{className:"fixed top-16 left-4 w-72 bg-green-900/30 backdrop-blur-md rounded-2xl shadow-2xl z-20 overflow-hidden text-white",children:[(0,T.jsx)(C,{onMinimize:y,isMobile:!1,isMinimized:w}),!w&&(0,T.jsxs)("div",{className:"p-4 flex flex-col gap-3 max-h-96 overflow-y-auto",children:[(0,T.jsx)(A,{id:"estado-sp",label:"Estado de S\xe3o Paulo",checked:x,onChange:()=>p(!x),loading:u,error:m}),(0,T.jsx)(A,{id:"marcadores",label:"Escolas Ind\xedgenas",checked:f,onChange:()=>b(!f)}),(0,T.jsx)(A,{id:"terras-indigenas",label:"Terras Ind\xedgenas",checked:g,onChange:()=>h(!g),loading:i,error:c})]})]}),v?(0,T.jsxs)("button",{type:"button",onClick:()=>k((e=>e>=1.3?1:Math.round(100*(e+.15))/100)),className:"fixed top-[calc(50%-5rem)] left-4 z-30 rounded-xl bg-green-900/90 hover:bg-green-800 p-2.5 flex items-center cursor-pointer pointer-events-auto transition-all duration-200","aria-label":"Ajustar tamanho do texto",title:"Tamanho do texto: ".concat(Math.round(100*N),"% (toque para alterar)"),children:[(0,T.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,T.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.6117 5.00684C6.86862 5.02589 7.11696 5.11134 7.3324 5.25488C7.57862 5.41908 7.77125 5.65263 7.88514 5.92578L11.9232 15.6162C12.1352 16.1258 11.8947 16.7115 11.3851 16.9238C10.8755 17.1362 10.2901 16.8942 10.0775 16.3848L9.08338 14H3.91736L2.92322 16.3857C2.71049 16.8948 2.12502 17.1359 1.6156 16.9238C1.10605 16.7114 0.865522 16.1258 1.07752 15.6162L5.11658 5.92578L5.16248 5.8252C5.27895 5.59518 5.45376 5.39859 5.66932 5.25488L5.76307 5.19727C5.98766 5.07035 6.24213 5.00195 6.50135 5.00195L6.6117 5.00684ZM4.75135 12H8.25037L6.50037 7.80176L4.75135 12Z",fill:"#CDE8CF"}),(0,T.jsx)("path",{d:"M18.0209 6.00098C18.0385 6.00133 18.0561 6.00165 18.0736 6.00293C18.0913 6.00421 18.1089 6.00562 18.1263 6.00781C18.1434 6.00996 18.1602 6.01358 18.1771 6.0166C18.1869 6.01835 18.1968 6.01946 18.2064 6.02148C18.234 6.02726 18.2614 6.03388 18.2885 6.04199C18.2921 6.04309 18.2956 6.04476 18.2992 6.0459C18.317 6.05145 18.3344 6.05789 18.3519 6.06445C18.368 6.07049 18.3841 6.07618 18.3998 6.08301C18.5114 6.13159 18.6161 6.20168 18.7074 6.29297L22.7074 10.293C23.0977 10.6835 23.0979 11.3166 22.7074 11.707C22.3169 12.0975 21.6839 12.0973 21.2933 11.707L19.0004 9.41406V16C19.0004 16.5522 18.5526 16.9999 18.0004 17C17.4481 17 17.0004 16.5523 17.0004 16V9.41406L14.7074 11.707C14.3169 12.0975 13.6839 12.0973 13.2933 11.707C12.9028 11.3165 12.9028 10.6835 13.2933 10.293L17.2933 6.29297C17.3386 6.2477 17.3876 6.20587 17.4408 6.16992C17.4934 6.13439 17.5488 6.10452 17.6058 6.08008C17.6512 6.06059 17.6989 6.04587 17.7474 6.0332C17.7614 6.02955 17.7753 6.0255 17.7894 6.02246C17.8033 6.01948 17.8173 6.01704 17.8314 6.01465C17.847 6.01199 17.8626 6.00973 17.8783 6.00781C17.8961 6.00565 17.914 6.00415 17.932 6.00293C17.948 6.00184 17.9639 6.00131 17.9799 6.00098C17.9866 6.00084 17.9936 6 18.0004 6C18.0072 6 18.0141 6.00084 18.0209 6.00098Z",fill:"#CDE8CF"})]}),(0,T.jsx)("div",{className:"hidden lg:block ml-2 text-green-100 text-sm",children:"Tamanho do texto"})]}):(0,T.jsxs)("button",{type:"button",onClick:()=>k((e=>e>=1.3?1:Math.round(100*(e+.15))/100)),className:"fixed top-[calc(50%-5rem)] left-4 z-30 rounded-xl bg-green-900/90 hover:bg-green-800 p-2.5 flex items-center cursor-pointer pointer-events-auto transition-all duration-200","aria-label":"Ajustar tamanho do texto",title:"Tamanho do texto: ".concat(Math.round(100*N),"% (clique para alterar)"),children:[(0,T.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,T.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.6117 5.00684C6.86862 5.02589 7.11696 5.11134 7.3324 5.25488C7.57862 5.41908 7.77125 5.65263 7.88514 5.92578L11.9232 15.6162C12.1352 16.1258 11.8947 16.7115 11.3851 16.9238C10.8755 17.1362 10.2901 16.8942 10.0775 16.3848L9.08338 14H3.91736L2.92322 16.3857C2.71049 16.8948 2.12502 17.1359 1.6156 16.9238C1.10605 16.7114 0.865522 16.1258 1.07752 15.6162L5.11658 5.92578L5.16248 5.8252C5.27895 5.59518 5.45376 5.39859 5.66932 5.25488L5.76307 5.19727C5.98766 5.07035 6.24213 5.00195 6.50135 5.00195L6.6117 5.00684ZM4.75135 12H8.25037L6.50037 7.80176L4.75135 12Z",fill:"#CDE8CF"}),(0,T.jsx)("path",{d:"M18.0209 6.00098C18.0385 6.00133 18.0561 6.00165 18.0736 6.00293C18.0913 6.00421 18.1089 6.00562 18.1263 6.00781C18.1434 6.00996 18.1602 6.01358 18.1771 6.0166C18.1869 6.01835 18.1968 6.01946 18.2064 6.02148C18.234 6.02726 18.2614 6.03388 18.2885 6.04199C18.2921 6.04309 18.2956 6.04476 18.2992 6.0459C18.317 6.05145 18.3344 6.05789 18.3519 6.06445C18.368 6.07049 18.3841 6.07618 18.3998 6.08301C18.5114 6.13159 18.6161 6.20168 18.7074 6.29297L22.7074 10.293C23.0977 10.6835 23.0979 11.3166 22.7074 11.707C22.3169 12.0975 21.6839 12.0973 21.2933 11.707L19.0004 9.41406V16C19.0004 16.5522 18.5526 16.9999 18.0004 17C17.4481 17 17.0004 16.5523 17.0004 16V9.41406L14.7074 11.707C14.3169 12.0975 13.6839 12.0973 13.2933 11.707C12.9028 11.3165 12.9028 10.6835 13.2933 10.293L17.2933 6.29297C17.3386 6.2477 17.3876 6.20587 17.4408 6.16992C17.4934 6.13439 17.5488 6.10452 17.6058 6.08008C17.6512 6.06059 17.6989 6.04587 17.7474 6.0332C17.7614 6.02955 17.7753 6.0255 17.7894 6.02246C17.8033 6.01948 17.8173 6.01704 17.8314 6.01465C17.847 6.01199 17.8626 6.00973 17.8783 6.00781C17.8961 6.00565 17.914 6.00415 17.932 6.00293C17.948 6.00184 17.9639 6.00131 17.9799 6.00098C17.9866 6.00084 17.9936 6 18.0004 6C18.0072 6 18.0141 6.00084 18.0209 6.00098Z",fill:"#CDE8CF"})]}),(0,T.jsx)("div",{className:"hidden lg:block ml-2 text-green-100 text-sm",children:"Tamanho do texto"})]}),(0,T.jsx)(ae,{dataPoints:f?a:[],onPainelOpen:o,className:"h-full w-full",center:E,zoom:_,terrasIndigenasData:l,estadoSPData:d,showTerrasIndigenas:g,showEstadoSP:x,showMarcadores:f})]})},ie=t.memo(le);var ce=o(1045),de=o(16799);var ue=o(92880);const me=e=>{const[a,o]=(0,t.useState)([]),[s,r]=(0,t.useState)(!0),[n,l]=(0,t.useState)(null);return(0,t.useEffect)((()=>{(async()=>{if(console.log("\ud83d\udd04 Iniciando busca de documentos para escola:",e,"tipo:",typeof e),!e)return console.log("\u26a0\ufe0f Nenhum ID de escola fornecido, retornando array vazio"),o([]),void r(!1);try{r(!0),console.log("\ud83d\udce1 Consultando tabela documentos_escola...");const{data:a,error:t}=await ue.N.auth.getSession();console.log("\ud83d\udd10 Estado da autentica\xe7\xe3o:",{temSessao:!(null===a||void 0===a||!a.session),error:t});const{error:s}=await ue.N.from("documentos_escola").select("count").limit(1);console.log("\ud83d\udd11 Verifica\xe7\xe3o de permiss\xf5es:",{podeAcessar:!s,error:s?{code:s.code,message:s.message,details:s.details,hint:s.hint}:null});const{data:n,error:l}=await ue.N.from("documentos_escola").select("*");l?console.error("\u274c Erro ao buscar todos os documentos:",{code:l.code,message:l.message,details:l.details,hint:l.hint}):(console.log("\ud83d\udcca Todos os documentos na tabela:",n),n&&n.length>0?(console.log("\ud83d\udcca Exemplo de documento:",n[0]),console.log("\ud83d\udcca Tipos de escola_id encontrados:",n.map((e=>({id:e.id,escola_id:e.escola_id,tipo_escola_id:typeof e.escola_id,valor_escola_id:e.escola_id}))))):console.log("\u26a0\ufe0f Tabela est\xe1 vazia ou n\xe3o temos permiss\xe3o para ver os dados")),console.log("\ud83d\udd0d Buscando documentos para escola_id:",e);const{data:i,error:c}=await ue.N.from("documentos_escola").select("*").eq("escola_id",e.toString()).order("created_at",{ascending:!1});if(c)throw console.error("\u274c Erro na consulta Supabase:",{code:c.code,message:c.message,details:c.details,hint:c.hint}),c;if(console.log("\u2705 Documentos encontrados:",(null===i||void 0===i?void 0:i.length)||0),0===(null===i||void 0===i?void 0:i.length)){console.log("\u2139\ufe0f Nenhum documento encontrado para a escola ID:",e),console.log("\u2139\ufe0f Tentando buscar com diferentes formatos de escola_id...");const{data:a,error:o}=await ue.N.from("documentos_escola").select("*").eq("escola_id",Number(e)),{data:t,error:s}=await ue.N.from("documentos_escola").select("*").eq("escola_id",String(e));console.log("Resultados com escola_id como n\xfamero:",{count:(null===a||void 0===a?void 0:a.length)||0,error:o}),console.log("Resultados com escola_id como string:",{count:(null===t||void 0===t?void 0:t.length)||0,error:s})}else console.log("\ud83d\udcc4 Dados dos documentos:",i);o(i||[])}catch(a){console.error("\u274c Erro ao buscar documentos:",a),l(a.message)}finally{r(!1)}})()}),[e]),{documentos:a,isLoading:s,error:n}};var ge=o(193),he=o(7669),xe=o(21209),pe=o(74387),fe=o(79816),be=o(50225),ve=o(99769),we=o(56863),je=o(86093),ye=o(94183);const Ne=(0,t.memo)((e=>{let{children:a,columns:o="auto-fit",gap:t=4,className:s=""}=e;return(0,T.jsx)("div",{className:"grid ".concat({"auto-fit":"grid-cols-2 lg:grid-cols-3",2:"grid-cols-2",3:"grid-cols-2 lg:grid-cols-3",4:"grid-cols-2 lg:grid-cols-4"}[o]," gap-").concat(t," ").concat(s," [&>*]:bg-green-100"),children:a})})),ke=(0,t.memo)((e=>{let{data:a,className:o=""}=e;return a&&0!==a.length?(0,T.jsx)("div",{className:"bg-green-100 rounded-lg overflow-hidden ".concat(o),children:(0,T.jsx)("table",{className:"w-full",children:(0,T.jsx)("tbody",{children:a.map(((e,a)=>(0,T.jsxs)("tr",{className:a%2===0?"bg-white":"bg-green-50",children:[(0,T.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-700 border-r border-green-200",children:e.label}),(0,T.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.value})]},a)))})})}):null})),Ce=(0,t.memo)((e=>{let{stats:a,className:o=""}=e;return a&&0!==a.length?(0,T.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 ".concat(o," [&>*]:border-b [&>*]:border-gray-200 [&>*]:pb-2 [&>*]:mb-2"),children:a.map(((e,a)=>(0,T.jsxs)("div",{className:"text-center rounded-lg p-4",children:[(0,T.jsx)("div",{className:"flex justify-center mb-2",children:e.icon&&(0,T.jsx)(e.icon,{className:"w-6 h-6 text-gray-700"})}),(0,T.jsx)("div",{className:"text-3xl font-medium text-green-800 mb-1",children:e.value}),(0,T.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:e.label})]},a)))}):null})),Ae=(0,t.memo)((e=>{let{title:a,icon:o,children:s,description:r,defaultCollapsed:n=!1,className:l="",layout:i="default",layoutProps:c={}}=e;const[d,u]=(0,t.useState)(n);return(0,T.jsxs)("section",{className:"\n        bg-white rounded-2xl p-5 \n        shadow-sm transition-all duration-200\n        ".concat(l,"\n      "),children:[(0,T.jsx)("button",{onClick:()=>u(!d),className:" w-full flex items-center justify-between  text-base font-semibold mb-4 text-gray-900 hover:text-gray-800  transition-colors focus:outline-none ","aria-expanded":!d,"aria-controls":"".concat(a,"-content"),children:(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[o&&(0,T.jsx)(o,{className:"w-5 h-5 text-gray-700"}),(0,T.jsx)("span",{className:"tracking-wide",children:a})]})}),!d&&(0,T.jsxs)("div",{id:"".concat(a,"-content"),className:"space-y-4",role:"region","aria-labelledby":"".concat(a,"-button"),children:[r&&(0,T.jsx)("div",{className:"bg-green-100 rounded-lg p-4",children:(0,T.jsx)("p",{className:"text-gray-700 text-sm leading-relaxed",children:r})}),(()=>{if(!s)return null;switch(i){case"grid":return(0,T.jsx)(Ne,(0,N.A)((0,N.A)({},c),{},{children:s}));case"table":return(0,T.jsx)(ke,{data:c.data,className:c.className});case"stats":return(0,T.jsx)(Ce,{stats:c.stats,className:c.className});default:return(0,T.jsx)("div",{className:"space-y-4",children:s})}})()]})]})})),Ee=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"",_e=e=>{let{icon:a,label:o,value:t,type:s="text"}=e;return(0,T.jsxs)("div",{className:"bg-green-50 hover:bg-green-100 rounded-lg p-2 sm:p-3 transition-all duration-200 hover:shadow-sm h-[120px] flex flex-col",children:[(0,T.jsxs)("div",{className:"flex items-center justify-center gap-1 sm:gap-2 mb-2 sm:mb-3 flex-shrink-0 h-[40px]",children:[(0,T.jsx)(a,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700 flex-shrink-0"}),(0,T.jsx)("span",{className:"text-xs text-gray-600 font-medium leading-tight",children:o})]}),(0,T.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(()=>{switch(s){case"boolean":return t?(0,T.jsxs)("span",{className:"flex items-center gap-1 text-green-600 text-sm",children:[(0,T.jsx)(ge.A,{className:"w-4 h-4 flex-shrink-0"}),"Sim"]}):(0,T.jsxs)("span",{className:"flex items-center gap-1 text-red-500 text-sm",children:[(0,T.jsx)(he.A,{className:"w-4 h-4 flex-shrink-0"}),"N\xe3o"]});case"number":return(0,T.jsx)("div",{className:"text-center w-full flex items-center justify-center h-full",children:(0,T.jsx)("div",{className:"text-3xl font-medium text-green-800",style:{fontSize:"1.875rem",fontWeight:"500",color:"#166534"},children:t||"0"})});default:return(0,T.jsx)("span",{className:"text-sm text-gray-800 break-words text-center w-full",children:t})}})()})]})},Le=e=>{let{escola:a}=e;if(!(a.logradouro||a.numero||a.bairro||a.cep))return(0,T.jsx)("div",{className:"mt-2 p-2 bg-green-100 rounded-md",children:(0,T.jsx)("p",{className:"text-xs text-gray-700 leading-snug",children:Ee(a.endereco)})});return(0,T.jsxs)("div",{className:"mt-2 space-y-1",children:[[{field:"logradouro",label:"Logradouro"},{field:"numero",label:"N\xfamero"},{field:"complemento",label:"Complemento"},{field:"bairro",label:"Bairro"}].map((e=>{let{field:o,label:t}=e;return a[o]&&(0,T.jsxs)("div",{className:"flex items-start gap-2 p-1.5 bg-green-100 rounded-md",children:[(0,T.jsx)(xe.A,{className:"w-5 h-5 text-gray-600 mt-0.5 flex-shrink-0"}),(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsx)("div",{className:"text-xs font-medium text-gray-700 mb-0.5",children:t}),(0,T.jsx)("div",{className:"text-xs text-gray-800 leading-snug",children:a[o]})]})]},o)})),(a.cep||a.estado)&&(0,T.jsxs)("div",{className:"flex items-start gap-2 p-1.5 bg-green-100 rounded-md",children:[(0,T.jsx)(xe.A,{className:"w-5 h-5 text-gray-600 mt-0.5 flex-shrink-0"}),(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsx)("div",{className:"text-xs font-medium text-gray-700 mb-0.5",children:"Localiza\xe7\xe3o"}),(0,T.jsx)("div",{className:"text-xs text-gray-800 leading-snug",children:[a.municipio,a.estado,a.cep].filter(Boolean).join(", ")})]})]})]})},Se=e=>{let{escola:a}=e;if(!(a.Latitude&&a.Longitude))return null;return(0,T.jsxs)("button",{onClick:()=>{window.open("https://www.google.com/maps?q=".concat(a.Latitude,",").concat(a.Longitude),"_blank")},className:"mt-2 w-full flex items-center justify-center gap-2 p-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors text-xs font-medium",children:[(0,T.jsx)(pe.A,{className:"w-5 h-5"}),"Ver no Google Maps"]})},Ie=e=>{let{links:a,expanded:o,onToggle:t}=e;const s=(a||"").split(",").map((e=>e.trim())).filter(Boolean);return 0===s.length?null:(0,T.jsxs)("div",{className:"bg-green-100 rounded-md",children:[(0,T.jsxs)("button",{onClick:()=>t("social"),className:"w-full flex justify-between items-center p-1.5 hover:bg-green-200 text-xs","aria-expanded":o.social,children:[(0,T.jsxs)("span",{className:"flex items-center gap-2 text-gray-700 font-medium",children:[(0,T.jsx)(fe.A,{className:"w-5 h-5 text-blue-600"}),"Redes sociais (",s.length,")"]}),(0,T.jsx)(be.A,{className:"w-5 h-5 text-gray-400 transition-transform ".concat(o.social?"rotate-90":"")})]}),o.social&&(0,T.jsx)("div",{className:"px-2 pb-2 border-t border-green-200 bg-white",children:(0,T.jsx)("div",{className:"mt-1 space-y-1",children:s.map(((e,a)=>(0,T.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 p-1.5 bg-green-100 rounded-md hover:bg-green-200 group text-xs",children:[(0,T.jsx)(ve.A,{className:"w-5 h-5 text-blue-600"}),(0,T.jsx)("span",{className:"truncate flex-1 text-gray-700",children:e}),(0,T.jsx)(we.A,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-600"})]},a)))})})]})},ze=(0,t.memo)((e=>{let{escola:a}=e;const[o,s]=(0,t.useState)({});if(!a)return null;const r=e=>{s((a=>(0,N.A)((0,N.A)({},a),{},{[e]:!a[e]})))},n=[{icon:je.A,label:"Munic\xedpio",value:Ee(a.municipio)},{icon:ye.A,label:"Funda\xe7\xe3o",value:a.ano_criacao,type:"number"},{icon:fe.A,label:"Redes sociais",value:a.usa_redes_sociais,type:"boolean"}].filter((e=>e.value));return(0,T.jsxs)(T.Fragment,{children:[a.povos_indigenas&&(0,T.jsx)("div",{className:"mb-4",children:(0,T.jsxs)("div",{className:"text-lg sm:text-xl font-bold text-green-800",children:["Povos Ind\xedgenas: ",(0,T.jsx)("span",{className:"font-semibold text-black",children:a.povos_indigenas})]})}),(0,T.jsxs)(Ae,{title:"Localiza\xe7\xe3o",icon:xe.A,children:[(0,T.jsxs)("div",{className:"grid grid-cols-3 lg:grid-cols-3 gap-0.5 sm:gap-1 mb-4 items-stretch",children:[n.map(((e,a)=>(0,T.jsx)(_e,(0,N.A)({},e),a))),a.diretoria_ensino&&(0,T.jsx)(_e,{icon:je.A,label:"Diretoria de ensino",value:a.diretoria_ensino})]}),(0,T.jsxs)("div",{className:"space-y-1.5",children:[a.endereco&&(0,T.jsxs)("div",{className:"bg-green-100 rounded-md",children:[(0,T.jsxs)("button",{onClick:()=>r("endereco"),className:"w-full flex justify-between items-center p-1.5 hover:bg-green-200 text-xs","aria-expanded":o.endereco,children:[(0,T.jsxs)("span",{className:"flex items-center gap-2 text-gray-700 font-medium",children:[(0,T.jsx)(je.A,{className:"w-5 h-5"}),"Endere\xe7o"]}),(0,T.jsx)(be.A,{className:"w-5 h-5 text-gray-400 transition-transform ".concat(o.endereco?"rotate-90":"")})]}),o.endereco&&(0,T.jsxs)("div",{className:"px-2 pb-2 border-t border-green-200 bg-white",children:[(0,T.jsx)(Le,{escola:a}),(0,T.jsx)(Se,{escola:a})]})]}),(0,T.jsx)(Ie,{links:a.links_redes_sociais,expanded:o,onToggle:r})]})]})]})})),Me=e=>{let{htmlContent:a}=e;return(0,T.jsx)("div",{className:"historia-escola-content prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 prose-strong:text-green-800 prose-em:text-green-700 prose-blockquote:border-l-green-300 prose-blockquote:bg-green-50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:rounded-r-lg prose-ul:text-black prose-ol:text-black prose-li:text-black prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm",dangerouslySetInnerHTML:{__html:a}})},Pe=()=>(0,T.jsxs)("header",{className:"mb-6 sm:mb-8 max-w-4xl mx-auto w-full",children:[(0,T.jsxs)("div",{className:"flex items-center gap-3 mb-3 sm:mb-4",children:[(0,T.jsx)("span",{className:"bg-green-200 rounded-full flex items-center justify-center w-16 h-16 sm:w-28 sm:h-28",children:(0,T.jsx)("img",{src:"".concat("/opin","/onca.svg"),alt:"\xcdcone de on\xe7a",className:"w-18 h-18 sm:w-36 sm:h-36",style:{filter:"none",borderRadius:"0",boxShadow:"none",margin:"0",padding:"0",border:"none",outline:"none",transform:"translateY(17px)"},"aria-hidden":"true"})}),(0,T.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-black m-0",children:"Hist\xf3ria da Escola"})]}),(0,T.jsx)("div",{className:"h-1 w-20 sm:w-24 bg-green-200 rounded-full"})]}),Te=(0,t.memo)((e=>{let{escola:a,refreshKey:o=0}=e;if(null===a||void 0===a||!a.historia_da_escola)return null;const t=a.historia_da_escola;return(0,T.jsxs)("div",{className:"mt-8 mb-12 flex flex-col items-center",children:[(0,T.jsx)(Pe,{}),(0,T.jsx)("article",{className:" px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg prose prose-sm sm:prose-base md:prose-lg lg:prose-xl prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 max-w-4xl mx-auto w-full ",children:(0,T.jsx)(Me,{htmlContent:t})})]})}));var De=o(56735),Fe=o(12065),Re=o(43531),Oe=o(80197),He=o(98242);const qe=(0,t.memo)((e=>{let{value:a}=e;return void 0===a||null===a?null:(0,T.jsx)("span",{className:"font-medium text-center w-full block ".concat(a?"text-green-600":"text-neutral-400"),children:a?"Sim":"N\xe3o"})}));const Ue=e=>{let{items:a,maxVisible:o=3}=e;return a&&0!==a.length?(0,T.jsx)("div",{className:"-mt-1",children:(0,T.jsx)("ul",{className:"list-none text-gray-800 text-xs pl-0 ml-0",children:a.map(((e,a)=>(0,T.jsxs)("li",{className:"leading-tight m-0 p-0 pl-0 ml-0 flex items-start",children:[(0,T.jsx)("span",{className:"mr-1 text-green-700 select-none",style:{minWidth:"1em",display:"inline-block"},children:"\u2022"}),(0,T.jsx)("span",{children:e})]},a)))})}):null},Be=e=>{let{icon:a,label:o,value:t,type:s="text"}=e;return(0,T.jsxs)("div",{className:"bg-green-50 hover:bg-green-100 rounded-lg p-2 sm:p-3 transition-all duration-200 hover:shadow-sm h-[120px] flex flex-col",children:[(0,T.jsxs)("div",{className:"flex items-center justify-center gap-1 sm:gap-2 mb-2 sm:mb-3 flex-shrink-0 h-[40px]",children:[(0,T.jsx)(a,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700 flex-shrink-0"}),(0,T.jsx)("span",{className:"text-xs text-gray-600 font-medium leading-tight",children:o})]}),(0,T.jsx)("div",{className:"flex-1 flex items-center justify-center",children:"number"===s?(0,T.jsx)("div",{className:"text-center w-full flex items-center justify-center h-full",children:(0,T.jsx)("div",{className:"text-3xl font-medium text-green-800",style:{fontSize:"1.875rem",fontWeight:"500",color:"#166534"},children:t||"0"})}):(0,T.jsx)("div",{className:"text-sm text-gray-800 font-medium break-words text-center w-full",children:t})})]})},We=(0,t.memo)((e=>{let{escola:a}=e;if(!a)return null;const o=a.turnos_funcionamento||a.turnos_funcionamento||"",t=(s=a.modalidade_ensino)&&"string"===typeof s?s.split("\u2013").map((e=>e.trim())).filter(Boolean):[];var s;const r=[o&&{icon:De.A,label:"Turnos de Funcionamento",value:o},{icon:Fe.A,label:"N\xfamero de Alunos",value:a.numero_alunos||"0",type:"number"},{icon:Re.A,label:"L\xednguas Faladas",value:a.linguas_faladas}].filter(Boolean),n=[{icon:Oe.A,label:"Material Pedag\xf3gico N\xe3o Ind\xedgena",value:(0,T.jsx)(qe,{value:a.material_nao_indigena})},{icon:Oe.A,label:"Material Pedag\xf3gico Ind\xedgena",value:(0,T.jsx)(qe,{value:a.material_indigena})},{icon:Oe.A,label:"PPP Pr\xf3prio",value:(0,T.jsx)(qe,{value:a.ppp_proprio})},{icon:Oe.A,label:"PPP com Comunidade",value:(0,T.jsx)(qe,{value:a.ppp_comunidade})}];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(Ae,{children:[(0,T.jsxs)("div",{className:"mb-4 bg-green-50 rounded-lg p-4",children:[(0,T.jsxs)("div",{className:"flex items-start gap-3 mb-2",children:[(0,T.jsx)(He.A,{className:"w-5 h-5 text-gray-700 mt-0.5 flex-shrink-0"}),(0,T.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Modalidade de Ensino"})]}),(0,T.jsx)("div",{className:"ml-8",children:(0,T.jsx)(Ue,{items:t,maxVisible:3})})]}),(0,T.jsx)("div",{className:"grid grid-cols-3 lg:grid-cols-3 gap-0.5 sm:gap-1 mt-1 items-stretch",children:r.map(((e,a)=>(0,T.jsx)(Be,{icon:e.icon,label:e.label,value:e.value,type:e.type},a)))})]}),(0,T.jsxs)(Ae,{title:"Materiais Pedag\xf3gicos",icon:Oe.A,description:"Diferenciados e n\xe3o diferenciados, produzidos dentro e fora da comunidade.",children:[(0,T.jsx)("div",{className:"mb-3",children:(0,T.jsx)(Be,{icon:n[0].icon,label:n[0].label,value:n[0].value})}),n.length>1&&(0,T.jsx)("div",{className:"space-y-3",children:(()=>{const e=n.slice(1),a=[];for(let o=0;o<e.length;o+=3)a.push(e.slice(o,o+3));return a.map(((e,a)=>(0,T.jsx)("div",{className:"grid gap-0.5 sm:gap-1 items-stretch ".concat(3===e.length?"grid-cols-3":2===e.length?"grid-cols-2":"grid-cols-1"),children:e.map(((e,o)=>(0,T.jsx)(Be,{icon:e.icon,label:e.label,value:e.value},"".concat(a,"-").concat(o))))},a)))})()})]})]})}));var Ve=o(52499),Ge=o(31184),Ze=o(26920),Ke=o(1799),Xe=o(64758),Ye=o(98493),Je=o(141),$e=o(31441);const Qe=e=>{let{icon:a,label:o,value:t}=e;return(0,T.jsxs)("div",{className:"bg-green-50 hover:bg-green-100 rounded-lg p-2 sm:p-3 transition-all duration-200 hover:shadow-sm h-[120px] flex flex-col",children:[(0,T.jsxs)("div",{className:"flex items-center justify-center gap-1 sm:gap-2 mb-2 sm:mb-3 flex-shrink-0 h-[40px]",children:[(0,T.jsx)(a,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700 flex-shrink-0"}),(0,T.jsx)("span",{className:"text-xs text-gray-600 font-medium leading-tight",children:o})]}),(0,T.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,T.jsx)("div",{className:"text-sm text-gray-800 font-medium break-words text-center w-full",children:t})})]})},ea=(0,t.memo)((e=>{let{escola:a}=e;if(!a)return null;const o=[{icon:Ve.A,label:"Acesso \xe0 \xc1gua",value:a.acesso_agua},{icon:Ge.A,label:"Coleta de Lixo",value:a.coleta_lixo},{icon:Ze.A,label:"Acesso \xe0 Internet",value:(0,T.jsx)(qe,{value:a.acesso_internet})},{icon:Ke.A,label:"Equipamentos Tecnol\xf3gicos",value:a.equipamentos},{icon:xe.A,label:"Modo de Acesso \xe0 Escola",value:a.modo_acesso},{icon:Xe.A,label:"Cozinha",value:(0,T.jsx)(qe,{value:a.cozinha})},{icon:Ye.A,label:"Merenda Escolar",value:(0,T.jsx)(qe,{value:a.merenda_escolar})},{icon:Je.A,label:"Merenda Diferenciada",value:(0,T.jsx)(qe,{value:a.diferenciada})}];return(0,T.jsxs)(Ae,{title:"Infraestrutura",icon:$e.A,children:[a.espaco_escolar&&(0,T.jsx)("div",{className:"p-2 text-sm text-gray-800 border-b border-gray-200 whitespace-pre-wrap",children:a.espaco_escolar}),(0,T.jsx)("div",{className:"grid grid-cols-3 lg:grid-cols-3 gap-0.5 sm:gap-1 mt-3 items-stretch",children:o.map(((e,a)=>(0,T.jsx)(Qe,{icon:e.icon,label:e.label,value:e.value},a)))})]})}));var aa=o(21172),oa=o(12427),ta=o(86635),sa=o(29449),ra=o(74562),na=o(63626);const la=e=>{let{icon:a,label:o,value:t,description:s,type:r="text"}=e;return(0,T.jsxs)("div",{className:"bg-green-50 hover:bg-green-100 rounded-lg p-2 sm:p-3 transition-all duration-200 hover:shadow-sm h-[120px] flex flex-col",children:[(0,T.jsxs)("div",{className:"flex items-center justify-center gap-1 sm:gap-2 mb-2 sm:mb-3 flex-shrink-0 h-[40px]",children:[(0,T.jsx)(a,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700 flex-shrink-0"}),(0,T.jsx)("span",{className:"text-xs text-gray-600 font-medium leading-tight",children:o})]}),(0,T.jsx)("div",{className:"flex-1 flex items-center justify-center",children:"number"===r?(0,T.jsx)("div",{className:"text-center w-full flex items-center justify-center h-full",children:(0,T.jsx)("div",{className:"text-3xl font-medium text-green-800",style:{fontSize:"1.875rem",fontWeight:"500",color:"#166534"},children:t||"0"})}):(0,T.jsx)("div",{className:"text-sm text-gray-800 font-medium mb-2 break-words text-center w-full",children:t})}),s&&(0,T.jsx)("div",{className:"text-xs text-gray-600 whitespace-pre-line leading-relaxed break-words mt-2",children:s})]})},ia=e=>{const a=String(e).trim().toLowerCase();return"sim"===a?(0,T.jsxs)("div",{className:"flex items-center gap-1 text-green-700",children:[(0,T.jsx)(ge.A,{className:"w-5 h-5"}),"Sim"]}):"n\xe3o"===a||"nao"===a?(0,T.jsxs)("div",{className:"flex items-center gap-1 text-gray-500",children:[(0,T.jsx)(he.A,{className:"w-5 h-5"}),"N\xe3o"]}):e},ca=(0,t.memo)((e=>{let{escola:a}=e;if(!a)return null;const o=(e=>{if(!e)return null;const[a,...o]=e.split("/"),t=o.join("/").trim();return{status:"sim"===a.trim().toLowerCase()?"Sim":a.trim(),descricao:t||null}})(a.formacao_professores),t=(e=>{if(!e)return null;const[a,...o]=e.split("/"),t=o.join("/").trim();return{status:"sim"===a.trim().toLowerCase()?"Sim":a.trim(),descricao:t||null}})(a.formacao_continuada);return(0,T.jsxs)(Ae,{title:"Gestores",icon:aa.A,children:[(0,T.jsxs)("div",{className:"space-y-4 mt-1",children:[(0,T.jsxs)("div",{className:"grid grid-cols-3 lg:grid-cols-3 gap-0.5 sm:gap-1 items-stretch",children:[(0,T.jsx)(la,{icon:oa.A,label:"Professores Ind\xedgenas",value:a.professores_indigenas,type:"number"}),(0,T.jsx)(la,{icon:ta.A,label:"Professores N\xe3o Ind\xedgenas",value:a.professores_nao_indigenas,type:"number"}),(0,T.jsx)(la,{icon:Re.A,label:"Professores que falam l\xedngua ind\xedgena",value:ia(a.professores_falam_lingua)})]}),(null===o||void 0===o?void 0:o.status)&&(0,T.jsx)(la,{icon:sa.A,label:"Forma\xe7\xe3o dos Professores",value:ia(o.status),description:o.descricao})]}),(0,T.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,T.jsx)(la,{icon:ra.A,label:"Gest\xe3o/Nome",value:a.gestao}),(0,T.jsx)(la,{icon:aa.A,label:"Outros Funcion\xe1rios",value:a.outros_funcionarios}),(null===t||void 0===t?void 0:t.status)&&(0,T.jsx)(la,{icon:na.A,label:"Visitas de Supervisores e Forma\xe7\xe3o Continuada",value:ia(t.status),description:t.descricao})]})]})}));var da=o(46192),ua=o(24621),ma=o(21204);const ga=e=>{let{icon:a,label:o,value:t}=e;const s="n\xe3o"===(null===t||void 0===t?void 0:t.trim().toLowerCase());return(0,T.jsx)("div",{className:"bg-green-50 hover:bg-green-100 rounded-lg p-5 transition-all duration-200 hover:shadow-sm min-h-[120px] flex flex-col",children:(0,T.jsxs)("div",{className:"flex items-start gap-4 flex-1",children:[(0,T.jsx)(a,{className:"w-5 h-5 text-gray-700 mt-0.5 flex-shrink-0"}),(0,T.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col space-y-4",children:[(0,T.jsx)("div",{className:"text-sm font-medium text-gray-700 flex-shrink-0",children:o}),(0,T.jsx)("div",{className:"flex-1 flex items-start",children:s?(0,T.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[(0,T.jsx)(he.A,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),"N\xe3o"]}):(0,T.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed break-words",children:t})})]})]})})},ha=(0,t.memo)((e=>{let{escola:a}=e;if(!a)return null;const o=[{field:"projetos_andamento",icon:Oe.A,label:"Projetos em andamento"},{field:"parcerias_universidades",icon:da.A,label:"Parcerias com universidades"},{field:"acoes_ongs",icon:Fe.A,label:"A\xe7\xf5es com ONGs ou coletivos"},{field:"desejos_comunidade",icon:ua.A,label:"Desejos da comunidade para a escola"},{field:"parcerias_municipio",icon:ma.A,label:"Parcerias com o munic\xedpio"}].filter((e=>a[e.field]&&a[e.field].trim()));return 0===o.length?null:(0,T.jsx)(Ae,{title:"Projetos e Parcerias",icon:ma.A,children:(0,T.jsx)("div",{className:"grid grid-cols-1 gap-6 items-stretch",children:o.map((e=>(0,T.jsx)(ga,{icon:e.icon,label:e.label,value:a[e.field]},e.field)))})})}));var xa=o(38438),pa=o(82006),fa=o(40237),ba=o(57908),va=o(49147),wa=o(35757);const ja=e=>{let{images:a=[],currentImageIndex:o=0,isOpen:s=!1,onClose:r,onImageChange:n,showNavigation:l=!0,showControls:i=!0,showCounter:c=!0,showCaption:d=!0}=e;const[u,m]=(0,t.useState)(1),[g,h]=(0,t.useState)(0),[x,p]=(0,t.useState)(o);(0,t.useEffect)((()=>{m(1),h(0),p(o)}),[o,s]);const f=a[x],b=(0,t.useCallback)((()=>{m(1),h(0),r()}),[r]),v=()=>{m(1),h(0)},w=(0,t.useCallback)((()=>{if(x<a.length-1){const e=x+1;p(e),n&&n(e)}}),[x,a.length,n]),j=(0,t.useCallback)((()=>{if(x>0){const e=x-1;p(e),n&&n(e)}}),[x,n]);return(0,t.useEffect)((()=>{const e=e=>{"Escape"===e.key&&b()};if(s)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[s,b]),(0,t.useEffect)((()=>{const e=e=>{if(s)switch(e.key){case"ArrowLeft":e.preventDefault(),j();break;case"ArrowRight":e.preventDefault(),w();break;case"r":case"R":e.preventDefault(),h((e=>(e+90)%360));break;case"+":case"=":e.preventDefault(),m((e=>Math.min(e+.25,3)));break;case"-":e.preventDefault(),m((e=>Math.max(e-.25,.5)));break;case"0":e.preventDefault(),v()}};if(s)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[s,x,a.length,w,j]),s&&f?(0,T.jsxs)("div",{className:"image-zoom-modal",onClick:b,children:[(0,T.jsx)("button",{onClick:b,className:"image-zoom-close","aria-label":"Fechar",children:(0,T.jsx)(he.A,{size:24})}),i&&(0,T.jsxs)("div",{className:"image-zoom-controls",children:[(0,T.jsx)("button",{onClick:e=>{e.stopPropagation(),m((e=>Math.min(e+.25,3)))},className:"image-zoom-control-button","aria-label":"Aumentar zoom",children:(0,T.jsx)(ba.A,{size:20})}),(0,T.jsx)("button",{onClick:e=>{e.stopPropagation(),m((e=>Math.max(e-.25,.5)))},className:"image-zoom-control-button","aria-label":"Diminuir zoom",children:(0,T.jsx)(va.A,{size:20})}),(0,T.jsx)("button",{onClick:e=>{e.stopPropagation(),h((e=>(e+90)%360))},className:"image-zoom-control-button","aria-label":"Rotacionar",children:(0,T.jsx)(wa.A,{size:20})}),(0,T.jsx)("button",{onClick:e=>{e.stopPropagation(),v()},className:"image-zoom-control-button text-xs px-3","aria-label":"Resetar",children:"Reset"})]}),l&&a.length>1&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("button",{onClick:e=>{e.stopPropagation(),j()},className:"image-zoom-navigation prev",disabled:0===x,"aria-label":"Imagem anterior",children:(0,T.jsx)(xa.A,{size:24})}),(0,T.jsx)("button",{onClick:e=>{e.stopPropagation(),w()},className:"image-zoom-navigation next",disabled:x===a.length-1,"aria-label":"Pr\xf3xima imagem",children:(0,T.jsx)(be.A,{size:24})})]}),c&&a.length>1&&(0,T.jsxs)("div",{className:"image-zoom-counter",children:[x+1," / ",a.length]}),(0,T.jsxs)("div",{className:"image-zoom-container",children:[(0,T.jsx)("div",{className:"image-zoom-image-wrapper",children:(0,T.jsx)("img",{src:f.url||f.publicURL||f.imagem_public_url,alt:f.descricao||f.descricao_imagem||"Imagem",className:"image-zoom-image",style:{transform:"scale(".concat(u,") rotate(").concat(g,"deg)"),cursor:"grab"},onClick:e=>e.stopPropagation(),onMouseDown:e=>{e.preventDefault()}})}),d&&(f.descricao||f.descricao_imagem)&&(0,T.jsxs)("div",{className:"image-zoom-caption",children:[(0,T.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:f.descricao||f.descricao_imagem}),(0,T.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[f.categoria&&(0,T.jsx)("span",{className:"capitalize bg-gray-100 px-2 py-1 rounded text-gray-800",children:f.categoria}),f.autor&&(0,T.jsxs)("span",{children:["Fot\xf3grafo: ",f.autor]}),f.dataFoto&&(0,T.jsxs)("span",{children:["Data: ",new Date(f.dataFoto).toLocaleDateString("pt-BR")]})]}),f.descricaoDetalhada&&(0,T.jsx)("p",{className:"text-gray-600 leading-relaxed",children:f.descricaoDetalhada})]})]}),(0,T.jsx)("div",{className:"image-zoom-instructions",children:(0,T.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,T.jsx)("div",{children:"ESC: Fechar | \u2190 \u2192: Navegar | R: Rotacionar"}),(0,T.jsx)("div",{children:"+ -: Zoom | 0: Reset"})]})})]}):null};var ya=o(53986);const Na=["src","alt","className","isPreloaded","placeholder","onLoad","onError"],ka=e=>{let{src:a,alt:o,className:s="",isPreloaded:r=!1,placeholder:n=null,onLoad:l,onError:i}=e,c=(0,ya.A)(e,Na);const[d,u]=(0,t.useState)(!1),[m,g]=(0,t.useState)(!1),[h,x]=(0,t.useState)(!1);(0,t.useEffect)((()=>{r&&(u(!0),x(!0))}),[r]);return m?n||null:(0,T.jsxs)("div",{className:"relative overflow-hidden ".concat(s),children:[!d&&(0,T.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:(0,T.jsx)("div",{className:"flex flex-col items-center space-y-2",children:(0,T.jsx)("div",{className:"text-xs text-gray-500",children:"Carregando..."})})}),(0,T.jsx)("img",(0,N.A)({src:a,alt:o,className:"w-full h-full object-cover transition-all duration-500 ease-out ".concat(h?"opacity-100 scale-100":"opacity-0 scale-105"),onLoad:()=>{u(!0),g(!1),x(!0),l&&l()},onError:()=>{g(!0),u(!1),i&&i()}},c))]})},Ca=function(e){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[o,s]=(0,t.useState)(new Map),[r,n]=(0,t.useState)(!1),l=(0,t.useRef)(null),i=async e=>{const a=e.map((e=>(e=>new Promise(((a,o)=>{const t=new Image;t.onload=()=>a(e),t.onerror=()=>o(new Error("Failed to load image: ".concat(e))),t.src=e})))(e).catch((a=>(console.warn("Erro ao preload da imagem:",e,a),null)))));return(await Promise.all(a)).filter(Boolean)},c=async()=>{if(e&&a){n(!0),console.log("\ud83d\uddbc\ufe0f Iniciando preload de imagens para escola:",e);try{const{data:a}=await ue.N.storage.from("imagens-das-escolas").list("".concat(e,"/")),{data:o}=await ue.N.storage.from("imagens-professores").list("".concat(e,"/")),t=[];if(a&&a.length>0&&a.forEach((a=>{const{data:{publicUrl:o}}=ue.N.storage.from("imagens-das-escolas").getPublicUrl("".concat(e,"/").concat(a.name));t.push(o)})),o&&o.length>0&&o.forEach((a=>{const{data:{publicUrl:o}}=ue.N.storage.from("imagens-professores").getPublicUrl("".concat(e,"/").concat(a.name));t.push(o)})),console.log("\ud83d\uddbc\ufe0f Preload: ".concat(t.length," imagens encontradas")),t.length>0){const e=5,a=[];for(let s=0;s<t.length;s+=e)a.push(t.slice(s,s+e));for(let t=0;t<a.length;t++){const e=a[t];console.log("\ud83d\uddbc\ufe0f Preload lote ".concat(t+1,"/").concat(a.length,": ").concat(e.length," imagens")),await i(e),t<a.length-1&&await new Promise((e=>setTimeout(e,200)))}const o=new Map;t.forEach((e=>{o.set(e,!0)})),s(o),console.log("\u2705 Preload conclu\xeddo:",t.length,"imagens")}}catch(o){console.error("\u274c Erro durante preload:",o)}finally{n(!1)}}};(0,t.useEffect)((()=>{if(e&&a)return l.current&&clearTimeout(l.current),l.current=setTimeout((()=>{c()}),500),()=>{l.current&&clearTimeout(l.current)}}),[e,a]);return{isPreloading:r,preloadedImages:o,isImagePreloaded:e=>o.has(e),startPreload:c}},Aa=e=>{let{escola_id:a,refreshKey:o=0,isMaximized:s=!1}=e;const[r,n]=(0,t.useState)([]),[l,i]=(0,t.useState)(!0),[c,d]=(0,t.useState)(null),[u,m]=(0,t.useState)(null),[g,h]=(0,t.useState)(0),{isImagePreloaded:x}=Ca(a,!0),p=(0,t.useCallback)((()=>{m(null),h(0)}),[]);return(0,t.useEffect)((()=>{o>0&&(console.log("ImagemHistoriadoProfessor: refreshKey mudou, for\xe7ando recarga"),n([]),i(!0),d(null))}),[o]),(0,t.useEffect)((()=>{a&&(i(!0),d(null),ue.N.storage.from("imagens-professores").list("".concat(a,"/")).then((async e=>{let{data:o,error:t}=e;if(t)return d(t.message),void i(!1);if(o&&o.length>0){console.log("Arquivos de professores encontrados:",o.length);const e=await Promise.all(o.map((async(e,o)=>{var s,r,n,l,i;const{data:{publicUrl:c}}=ue.N.storage.from("imagens-professores").getPublicUrl("".concat(a,"/").concat(e.name));let d="professor";e.name.startsWith("professora_")?d="professora":e.name.startsWith("professor_")&&(d="professor");let u=null;try{const o="".concat(a,"/").concat(e.name);console.log("Buscando legenda para professor:",o),u=await(0,fa.t$)(o,a,{categoria:"professor",tipo_foto:"professor"}),console.log("Legenda encontrada:",u)}catch(t){console.warn("Erro ao buscar legenda:",t)}return{id:o+1,publicURL:c,genero:d,nome:e.name,created_at:e.created_at||"",legenda:(null===(s=u)||void 0===s?void 0:s.legenda)||"Imagem do ".concat(d),descricaoDetalhada:null===(r=u)||void 0===r?void 0:r.descricao_detalhada,autor:null===(n=u)||void 0===n?void 0:n.autor_foto,dataFoto:null===(l=u)||void 0===l?void 0:l.data_foto,categoria:null===(i=u)||void 0===i?void 0:i.categoria}})));n(e)}else n([]);i(!1)})).catch((e=>{d("Erro inesperado: ".concat(e.message)),i(!1)})))}),[a]),l?(0,T.jsx)("div",{className:"text-gray-500",children:"Carregando imagens do professor..."}):c?(0,T.jsxs)("div",{className:"text-red-600",children:["Erro ao carregar imagens: ",c]}):r.length?s?null:(0,T.jsxs)("section",{className:"my-6",children:[(0,T.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:r.map(((e,a)=>(0,T.jsxs)("figure",{className:"rounded-lg overflow-hidden bg-white shadow-sm flex flex-col cursor-pointer transition hover:shadow-md",onClick:()=>{e.publicURL&&(h(a),m(e))},children:[(0,T.jsx)("div",{className:"w-full aspect-[4/3] bg-gray-100 flex items-center justify-center",children:(0,T.jsx)(ka,{src:e.publicURL,alt:e.legenda,className:"w-full h-full object-cover object-center transition-transform duration-200 hover:scale-105",isPreloaded:x(e.publicURL),style:{maxHeight:"350px"}})}),e.legenda&&(0,T.jsxs)("figcaption",{className:"p-3 bg-white",children:[(0,T.jsx)("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:e.legenda}),(0,T.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.categoria&&(0,T.jsx)("span",{className:"capitalize bg-gray-100 px-2 py-1 rounded",children:e.categoria}),e.autor&&(0,T.jsxs)("span",{children:["Por: ",e.autor]}),e.dataFoto&&(0,T.jsx)("span",{children:new Date(e.dataFoto).toLocaleDateString("pt-BR")})]}),e.descricaoDetalhada&&(0,T.jsx)("p",{className:"text-xs text-gray-600 mt-2 line-clamp-2",children:e.descricaoDetalhada})]})]},e.id)))}),(0,T.jsx)(ja,{images:r,currentImageIndex:g,isOpen:!!u,onClose:p,onImageChange:h,showNavigation:!0,showControls:!0,showCounter:!0,showCaption:!0})]}):null},Ea=t.memo(Aa);var _a=o(56478),La=o(84583);const Sa=["src","alt","name","size","customSize","shape","variant","loading","error","clickable","className","borderColor","backgroundColor","textColor","badge","badgePosition","badgeColor","badgeSize","onClick","onError","onLoad","fallbackIcon","showInitials","maxInitials","lazy","priority"],Ia=e=>{let{src:a,alt:o,name:s,size:r="medium",customSize:n,shape:l="circle",variant:i="default",loading:c=!1,error:d=!1,clickable:u=!1,className:m="",borderColor:g="border-green-200",backgroundColor:h="bg-gray-100",textColor:x="text-gray-600",badge:p,badgePosition:f="bottom-right",badgeColor:b="bg-green-500",badgeSize:v="small",onClick:w,onError:j,onLoad:y,fallbackIcon:k="user",showInitials:C=!0,maxInitials:A=2,lazy:E=!0,priority:_=!1}=e,L=(0,ya.A)(e,Sa);const[S,I]=(0,t.useState)(!1),[z,M]=(0,t.useState)(!!a),P=(0,t.useMemo)((()=>{if(n)return{container:"w-full h-full",text:"text-sm",icon:"w-6 h-6",badge:"w-3 h-3",customSize:n};const e={xs:{container:"w-6 h-6",text:"text-xs",icon:"w-3 h-3",badge:"w-2 h-2"},small:{container:"w-8 h-8",text:"text-xs",icon:"w-4 h-4",badge:"w-2 h-2"},medium:{container:"w-12 h-12 sm:w-16 sm:h-16",text:"text-sm sm:text-base",icon:"w-6 h-6 sm:w-8 sm:h-8",badge:"w-3 h-3"},large:{container:"w-16 h-16 sm:w-20 sm:h-20",text:"text-base sm:text-lg",icon:"w-8 h-8 sm:w-10 sm:h-10",badge:"w-4 h-4"},xlarge:{container:"w-20 h-20 sm:w-24 sm:h-24",text:"text-lg sm:text-xl",icon:"w-10 h-10 sm:w-12 sm:h-12",badge:"w-5 h-5"},xxlarge:{container:"w-24 h-24 sm:w-32 sm:h-32",text:"text-xl sm:text-2xl",icon:"w-12 h-12 sm:w-16 sm:h-16",badge:"w-6 h-6"}};return e[r]||e.medium}),[r,n]),D=(0,t.useMemo)((()=>{const e={circle:"rounded-full",square:"rounded-lg",rounded:"rounded-xl",none:"rounded-none"};return e[l]||e.circle}),[l]),F=(0,t.useMemo)((()=>{const e={default:{border:"border-2",shadow:"shadow-md",hover:"hover:shadow-lg"},minimal:{border:"border",shadow:"shadow-sm",hover:"hover:shadow-md"},flat:{border:"border-2",shadow:"shadow-none",hover:"hover:shadow-sm"},elevated:{border:"border-2",shadow:"shadow-lg",hover:"hover:shadow-xl"}};return e[i]||e.default}),[i]),R=(0,t.useMemo)((()=>{const e={"top-left":"top-0 left-0","top-right":"top-0 right-0","bottom-left":"bottom-0 left-0","bottom-right":"bottom-0 right-0",center:"top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"},a={small:"w-3 h-3",medium:"w-4 h-4",large:"w-5 h-5"};return{position:e[f]||e["bottom-right"],size:a[v]||a.small}}),[f,v]),O=(0,t.useMemo)((()=>{if(!s||!C)return"";return s.trim().split(" ").slice(0,A).map((e=>e.charAt(0).toUpperCase())).filter((e=>e.match(/[A-Z]/))).join("")}),[s,C,A]),H=(0,t.useMemo)((()=>{const e={user:ra.A,alert:_a.A,loading:La.A};return e[k]||e.user}),[k]),q=a&&!S&&!c,U=!q&&O&&!d,B=!q&&!U&&!d,W="\n    ".concat(P.container,"\n    ").concat(D,"\n    ").concat(F.border,"\n    ").concat(g,"\n    ").concat(F.shadow,"\n    ").concat(u||w?"cursor-pointer":"","\n    ").concat(F.hover,"\n    transition-all duration-200\n    relative overflow-hidden\n    flex items-center justify-center\n    ").concat(m,"\n  ").trim().replace(/\s+/g," ");return(0,T.jsxs)("div",(0,N.A)((0,N.A)({className:W,style:n?{width:n,height:n}:void 0,onClick:e=>{(u||w)&&(null===w||void 0===w||w(e))},role:u||w?"button":void 0,tabIndex:u||w?0:void 0},L),{},{children:[c&&(0,T.jsx)("div",{className:"absolute inset-0 ".concat(h," flex items-center justify-center"),children:(0,T.jsx)("span",{className:"text-xs text-green-600",children:"Carregando..."})}),q&&(0,T.jsx)("img",(0,N.A)({src:a,alt:o||"Avatar de ".concat(s)||0,className:"w-full h-full object-cover ".concat(z?"opacity-0":"opacity-100"," transition-opacity duration-200"),onLoad:()=>{M(!1),I(!1),null===y||void 0===y||y()},onError:()=>{M(!1),I(!0),null===j||void 0===j||j()},loading:E?"lazy":"eager"},_&&{fetchPriority:"high"})),z&&q&&(0,T.jsx)("div",{className:"absolute inset-0 ".concat(h," flex items-center justify-center"),children:(0,T.jsx)("span",{className:"text-xs text-green-600",children:"Carregando..."})}),U&&(0,T.jsx)("span",{className:"".concat(P.text," font-semibold ").concat(x),children:O}),B&&(0,T.jsx)(H,{className:"".concat(P.icon," ").concat(x)}),d&&(0,T.jsx)("div",{className:"absolute inset-0 ".concat(h," flex items-center justify-center"),children:(0,T.jsx)(_a.A,{className:"".concat(P.icon," text-red-500")})}),p&&(0,T.jsx)("div",{className:"absolute ".concat(R.position," ").concat(R.size," ").concat(b," rounded-full border-2 border-white"),children:"string"===typeof p?(0,T.jsx)("span",{className:"text-xs text-white font-bold flex items-center justify-center h-full",children:p}):p})]}))},za={default:{borderColor:"border-green-200",backgroundColor:"bg-green-50",textColor:"text-green-700",badgeColor:"bg-green-500",hoverBorderColor:"hover:border-green-300"},professor:{borderColor:"border-blue-200",backgroundColor:"bg-blue-50",textColor:"text-blue-700",badgeColor:"bg-blue-500",hoverBorderColor:"hover:border-blue-300"},escola:{borderColor:"border-orange-200",backgroundColor:"bg-orange-50",textColor:"text-orange-700",badgeColor:"bg-orange-500",hoverBorderColor:"hover:border-orange-300"},neutral:{borderColor:"border-gray-200",backgroundColor:"bg-gray-50",textColor:"text-gray-700",badgeColor:"bg-gray-500",hoverBorderColor:"hover:border-gray-300"},indigena:{borderColor:"border-amber-200",backgroundColor:"bg-amber-50",textColor:"text-amber-800",badgeColor:"bg-amber-600",hoverBorderColor:"hover:border-amber-300"},success:{borderColor:"border-emerald-200",backgroundColor:"bg-emerald-50",textColor:"text-emerald-700",badgeColor:"bg-emerald-500",hoverBorderColor:"hover:border-emerald-300"},warning:{borderColor:"border-yellow-200",backgroundColor:"bg-yellow-50",textColor:"text-yellow-800",badgeColor:"bg-yellow-500",hoverBorderColor:"hover:border-yellow-300"},error:{borderColor:"border-red-200",backgroundColor:"bg-red-50",textColor:"text-red-700",badgeColor:"bg-red-500",hoverBorderColor:"hover:border-red-300"}},Ma=e=>{let{fotoUrl:a,nomeProfessor:o,tamanho:t="medium",className:s="",showFallback:r=!0,theme:n="professor",variant:l="default",shape:i="circle",clickable:c=!1,badge:d,badgePosition:u="bottom-right",onClick:m,onError:g,onLoad:h,size:x,customSize:p,escolaId:f}=e;const b=x||{small:"medium",medium:"large",large:"xlarge",xlarge:"xxlarge"}[t]||"large",{isImagePreloaded:v}=Ca(f,!!f),w=za[n]||za.professor;return a||r?(0,T.jsx)(Ia,{src:a,name:o,alt:o?"Foto de ".concat(o):"Foto do professor",size:p?void 0:b,customSize:p,shape:i,variant:l,theme:n,clickable:c,badge:d,badgePosition:u,className:s,onClick:m,onError:g,onLoad:h,showInitials:!0,maxInitials:2,fallbackIcon:"user",lazy:!v(a),borderColor:w.borderColor,backgroundColor:w.backgroundColor,textColor:w.textColor,badgeColor:w.badgeColor}):null},Pa=(0,t.memo)((e=>{let{escola:a,refreshKey:o=0,isMaximized:s=!1}=e;const[r,n]=(0,t.useState)([]),[l,i]=(0,t.useState)(!0),[c,d]=(0,t.useState)(null),[u,m]=(0,t.useState)(0),[g,h]=(0,t.useState)(null),x=(0,t.useCallback)((()=>h(null)),[]);(0,t.useEffect)((()=>{const e=e=>{"Escape"===e.key&&x()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[x]),(0,t.useEffect)((()=>{if(null===a||void 0===a||!a.id)return void i(!1);(async()=>{try{i(!0),d(null);const e=await(0,pa.Y8)(a.id);n(e||[]),m(0)}catch(e){d(e.message)}finally{i(!1)}})()}),[null===a||void 0===a?void 0:a.id,o]);const p=(0,t.useCallback)((()=>{m((e=>e<r.length-1?e+1:0))}),[r.length]),f=(0,t.useCallback)((()=>{m((e=>e>0?e-1:r.length-1))}),[r.length]);if((0,t.useEffect)((()=>{const e=e=>{r.length<=1||("ArrowRight"===e.key?p():"ArrowLeft"===e.key&&f())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[r.length,p,f]),l)return(0,T.jsx)("div",{className:"mt-8 mb-12 max-w-4xl mx-auto px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg border border-green-100/50",children:(0,T.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,T.jsx)("span",{className:"ml-2 text-gray-600",children:"Carregando hist\xf3rias do professor..."})})});if(c)return(0,T.jsx)("div",{className:"mt-8 mb-12 max-w-4xl mx-auto px-4 sm:px-6 md:px-8 py-6 bg-white rounded-2xl shadow-lg border border-red-100/50",children:(0,T.jsx)("div",{className:"text-center py-8",children:(0,T.jsxs)("p",{className:"text-red-600",children:["Erro ao carregar hist\xf3rias do professor: ",c]})})});if(!r.length)return null;const b=r[u],v=r.length>1;return(0,T.jsxs)("div",{className:"mt-8 mb-12 flex flex-col w-full",children:[(0,T.jsxs)("header",{className:"historia-professor-header mb-6 sm:mb-8 w-full ".concat(s?"":"max-w-4xl"),children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[(0,T.jsxs)("div",{className:"flex items-center gap-3",children:[(0,T.jsx)("span",{className:"bg-green-200 rounded-full flex items-center justify-center w-16 h-16 sm:w-28 sm:h-28",children:(0,T.jsx)("img",{src:"".concat("/opin","/passaro.svg"),alt:"\xcdcone de p\xe1ssaro",className:"w-12 h-12 sm:w-24 sm:h-24",style:{filter:"none",borderRadius:"0",boxShadow:"none",margin:"0",padding:"0",border:"none",outline:"none"},"aria-hidden":"true"})}),(0,T.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-black m-0",children:"Depoimento dos Professores"})]}),v&&(0,T.jsx)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:(0,T.jsxs)("span",{children:[u+1," de ",r.length]})})]}),(0,T.jsx)("div",{className:"h-1 w-20 sm:w-24 bg-green-300 rounded-full"})]}),(0,T.jsxs)("article",{className:"\n          px-4 sm:px-6 md:px-8 py-6\n          bg-white rounded-2xl shadow-lg\n          prose prose-sm sm:prose-base md:prose-lg lg:prose-xl\n          prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify\n          prose-img:rounded-xl prose-img:shadow-lg\n          prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600\n          w-full\n          ".concat(s?"":"max-w-4xl","\n        "),children:[(0,T.jsxs)("section",{className:"text-base sm:text-lg leading-relaxed text-neutral-800",children:[b.nome_professor&&(0,T.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,T.jsx)("div",{className:"flex-shrink-0",children:(0,T.jsx)(Ma,{fotoUrl:b.foto_rosto,nomeProfessor:b.nome_professor,customSize:"200px",className:"shadow-lg",escolaId:a.id})}),(0,T.jsxs)("div",{className:"w-full text-center",children:[(0,T.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-green-800 mb-4 m-0",children:b.nome_professor}),(0,T.jsx)("div",{className:"historia-professor-content prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 prose-strong:text-green-800 prose-em:text-green-700 prose-blockquote:border-l-green-300 prose-blockquote:bg-green-50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:rounded-r-lg prose-ul:text-black prose-ol:text-black prose-li:text-black prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm",dangerouslySetInnerHTML:{__html:b.historia}})]})]}),!b.nome_professor&&(0,T.jsx)("div",{className:"historia-professor-content prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none prose-headings:text-green-900 prose-p:text-black prose-p:leading-relaxed prose-p:text-justify prose-img:rounded-xl prose-img:shadow-lg prose-a:text-green-700 prose-a:no-underline prose-a:border-b-2 prose-a:border-green-100 hover:prose-a:border-green-600 prose-strong:text-green-800 prose-em:text-green-700 prose-blockquote:border-l-green-300 prose-blockquote:bg-green-50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:rounded-r-lg prose-ul:text-black prose-ol:text-black prose-li:text-black prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm",dangerouslySetInnerHTML:{__html:b.historia}}),b.imagem_public_url&&(0,T.jsx)("figure",{className:"my-6",children:(0,T.jsxs)("div",{className:"relative",children:[(0,T.jsx)("img",{src:b.imagem_public_url,alt:b.descricao_imagem||"Imagem da hist\xf3ria do professor",className:"w-full max-w-2xl mx-auto rounded-xl shadow-lg cursor-pointer transition-transform duration-200 hover:scale-105",onClick:()=>h(b),loading:"lazy"}),b.descricao_imagem&&(0,T.jsx)("figcaption",{className:"text-center text-sm text-gray-600 mt-2",children:b.descricao_imagem})]})})]}),v&&(0,T.jsxs)("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200",children:[(0,T.jsxs)("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 text-green-700 hover:text-green-800 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Hist\xf3ria anterior",children:[(0,T.jsx)(xa.A,{className:"w-5 h-5"}),(0,T.jsx)("span",{className:"hidden sm:inline",children:"Anterior"})]}),(0,T.jsx)("div",{className:"flex gap-2",children:r.map(((e,a)=>(0,T.jsx)("button",{onClick:()=>m(a),className:"w-3 h-3 rounded-full border-2 ".concat(a===u?"bg-green-600 border-green-600":"bg-white border-gray-300"," transition-colors"),"aria-label":"Ir para hist\xf3ria ".concat(a+1)},a)))}),(0,T.jsxs)("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 text-green-700 hover:text-green-800 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Pr\xf3xima hist\xf3ria",children:[(0,T.jsx)("span",{className:"hidden sm:inline",children:"Pr\xf3xima"}),(0,T.jsx)(be.A,{className:"w-5 h-5"})]})]}),g&&(0,T.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",onClick:x,children:(0,T.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center p-4",onClick:e=>e.stopPropagation(),children:[(0,T.jsx)("button",{className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-80 z-10",onClick:x,"aria-label":"Fechar zoom",children:(0,T.jsx)(he.A,{className:"w-6 h-6"})}),(0,T.jsx)("img",{src:g.imagem_public_url,alt:g.descricao_imagem||"Imagem da hist\xf3ria do professor",className:"max-w-full max-h-full object-contain rounded-xl shadow-2xl border-4 border-white"}),g.descricao_imagem&&(0,T.jsx)("figcaption",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-center text-sm text-white bg-black bg-opacity-50 rounded-lg px-3 py-1.5 max-w-2xl",children:g.descricao_imagem})]})}),(0,T.jsx)(Ea,{escola_id:a.id,refreshKey:o,isMaximized:s})]})]})}));var Ta=o(35349);const Da=e=>{let{escola_id:a,refreshKey:o=0,isMaximized:s=!1}=e;const[r,n]=(0,t.useState)([]),[l,i]=(0,t.useState)(!0),[c,d]=(0,t.useState)(null),[u,m]=(0,t.useState)(0),[g,h]=(0,t.useState)(""),x=(0,t.useRef)({}),[p,f]=(0,t.useState)(0),{isImagePreloaded:b}=Ca(a,!0),v=(0,t.useCallback)((()=>{console.log("Limpando cache e recarregando imagens..."),x.current={},f((e=>e+1))}),[]);(0,t.useEffect)((()=>{o>0&&(console.log("ImagensdasEscolas: refreshKey mudou, for\xe7ando recarga"),v())}),[o,v]);const w=(0,t.useCallback)((()=>{d(null),m(0),document.body.style.overflow="auto"}),[]);return(0,t.useEffect)((()=>{const e=e=>{"Escape"===e.key&&w()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[w]),(0,t.useEffect)((()=>{if(!a)return void i(!1);const e="".concat(a,"_v").concat(p);if(x.current[e])return console.log("Usando cache para escola",a),n(x.current[e]),void i(!1);(async()=>{console.log("Buscando imagens para escola",a);try{const{data:o,error:t}=await ue.N.storage.from("imagens-das-escolas").list("".concat(a,"/"));if(t)throw t;if(!o||0===o.length)return console.log("Nenhum arquivo encontrado para escola",a),n([]),void i(!1);console.log("Arquivos encontrados:",o.length);const s=await Promise.all(o.map((async(e,o)=>{var s,r,n,l,i;const c="".concat(a,"/").concat(e.name),{data:{publicUrl:d}}=ue.N.storage.from("imagens-das-escolas").getPublicUrl(c);let u=null;try{console.log("Buscando legenda para:",c),u=await(0,fa.t$)(c,a,{categoria:"escola",tipo_foto:"escola"}),console.log("Legenda encontrada:",u)}catch(t){console.warn("Erro ao buscar legenda para",c,":",t)}return{id:"".concat(a,"-").concat(e.name),publicURL:d,descricao:(null===(s=u)||void 0===s?void 0:s.legenda)||"Imagem ".concat(o+1),descricaoDetalhada:null===(r=u)||void 0===r?void 0:r.descricao_detalhada,autor:null===(n=u)||void 0===n?void 0:n.autor_foto,dataFoto:null===(l=u)||void 0===l?void 0:l.data_foto,categoria:null===(i=u)||void 0===i?void 0:i.categoria,urlError:null}})));console.log("Imagens processadas:",s.length),x.current[e]=s,n(s),0===s.length&&h("Nenhuma imagem encontrada para esta escola.")}catch(g){console.error("Erro ao processar imagens:",g),h("Erro ao carregar imagens da escola.")}finally{i(!1)}})()}),[a,p]),l?(0,T.jsx)("div",{className:"text-gray-500 flex items-center gap-2",children:"Carregando imagens da escola..."}):g?(0,T.jsxs)("div",{className:"text-red-600 flex items-center gap-2",children:[(0,T.jsx)("span",{children:g}),(0,T.jsx)("button",{onClick:v,className:"text-blue-600 hover:text-blue-800",title:"Tentar novamente",children:(0,T.jsx)(Ta.A,{className:"w-5 h-5"})})]}):r.length?s?null:(0,T.jsxs)("section",{className:"my-6",children:[(0,T.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:r.map((e=>(0,T.jsxs)("figure",{className:"rounded-lg overflow-hidden bg-white shadow-sm flex flex-col cursor-pointer transition hover:shadow-md",onClick:()=>{if(e.publicURL){const a=r.findIndex((a=>a.publicURL===e.publicURL));m(a),d(e)}},children:[(0,T.jsx)("div",{className:"w-full aspect-[4/3] bg-gray-100 flex items-center justify-center",children:(0,T.jsx)(ka,{src:e.publicURL,alt:e.descricao,className:"w-full h-full object-cover object-center transition-transform duration-200 hover:scale-105",isPreloaded:b(e.publicURL),style:{maxHeight:"350px"}})}),e.descricao&&(0,T.jsxs)("figcaption",{className:"p-3 bg-white",children:[(0,T.jsx)("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:e.descricao}),(0,T.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.categoria&&(0,T.jsx)("span",{className:"capitalize bg-gray-100 px-2 py-1 rounded",children:e.categoria}),e.autor&&(0,T.jsxs)("span",{children:["Por: ",e.autor]}),e.dataFoto&&(0,T.jsx)("span",{children:new Date(e.dataFoto).toLocaleDateString("pt-BR")})]}),e.descricaoDetalhada&&(0,T.jsx)("p",{className:"text-xs text-gray-600 mt-2 line-clamp-2",children:e.descricaoDetalhada})]})]},e.id)))}),(0,T.jsx)(ja,{images:r,currentImageIndex:u,isOpen:!!c,onClose:w,onImageChange:m,showNavigation:!0,showControls:!0,showCounter:!0,showCaption:!0})]}):(0,T.jsxs)("div",{className:"text-yellow-700 flex items-center gap-2",children:[(0,T.jsx)("span",{children:"Nenhuma imagem encontrada para esta escola."}),(0,T.jsx)("button",{onClick:v,className:"text-blue-600 hover:text-blue-800",title:"Tentar novamente",children:(0,T.jsx)(Ta.A,{className:"w-5 h-5"})})]})},Fa=t.memo(Da),Ra=(0,t.memo)((e=>{let{children:a,shouldUseGrid:o}=e;const t=o?"masonry-grid":"space-y-4";return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("style",{children:"\n  .masonry-grid {\n    column-count: 1;\n    column-gap: 1.5rem;\n    column-fill: balance;\n  }\n  \n  .masonry-grid > * {\n    display: block;\n    break-inside: avoid;\n    page-break-inside: avoid;\n    margin-bottom: 1.5rem;\n  }\n  \n  /* Mobile: 1 coluna */\n  @media (max-width: 767px) {\n    .masonry-grid {\n      column-count: 1;\n    }\n  }\n  \n  /* Tablet e Desktop: 2 colunas */\n  @media (min-width: 768px) {\n    .masonry-grid {\n      column-count: 2;\n    }\n  }\n"}),(0,T.jsx)("div",{className:"".concat(t," transition-all duration-300 ease-in-out"),children:a})]})})),Oa=(0,t.memo)((e=>{let{escola:a,shouldUseGrid:o=!1,refreshKey:t=0,sectionRefs:s,isMaximized:r=!1}=e;if(console.log("EscolaInfo recebeu:",a),!a)return console.log("EscolaInfo: escola \xe9 null ou undefined"),null;const n=[{Component:ze,props:{escola:a}},{Component:We,props:{escola:a}},{Component:ea,props:{escola:a}},{Component:ca,props:{escola:a}},{Component:ha,props:{escola:a}}];return(0,T.jsxs)("div",{className:"space-y-8",children:[(0,T.jsx)("div",{ref:e=>s&&(s.dados=e),children:(0,T.jsx)(Ra,{shouldUseGrid:o,children:n.map(((e,a)=>{let{Component:o,props:t}=e;return(0,T.jsx)(o,(0,N.A)({},t),a)}))})}),(0,T.jsx)("div",{ref:e=>s&&(s.historia=e),children:(0,T.jsx)(Te,{escola:a,refreshKey:t})}),(0,T.jsx)(Fa,{escola_id:a.id,refreshKey:t,isMaximized:r}),(0,T.jsx)("div",{ref:e=>s&&(s.depoimentos=e),children:(0,T.jsx)(Pa,{escola:a,refreshKey:t,isMaximized:r})})]})})),Ha=["className"],qa=e=>{let{className:a="w-5 h-5"}=e,o=(0,ya.A)(e,Ha);return(0,T.jsx)("svg",(0,N.A)((0,N.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",fill:"currentColor",className:a},o),{},{children:(0,T.jsx)("path",{d:"M200,80H184V64a32,32,0,0,0-56-21.13A32,32,0,0,0,72.21,60.42,32,32,0,0,0,24,88v40a104,104,0,0,0,208,0V112A32,32,0,0,0,200,80ZM152,48a16,16,0,0,1,16,16V80H136V64A16,16,0,0,1,152,48ZM88,64a16,16,0,0,1,32,0v40a16,16,0,0,1-32,0ZM40,88a16,16,0,0,1,32,0v16a16,16,0,0,1-32,0Zm176,40a88,88,0,0,1-175.92,3.75A31.93,31.93,0,0,0,80,125.13a31.93,31.93,0,0,0,44.58,3.35,32.21,32.21,0,0,0,11.8,11.44A47.88,47.88,0,0,0,120,176a8,8,0,0,0,16,0,32,32,0,0,1,32-32,8,8,0,0,0,0-16H152a16,16,0,0,1-16-16V96h64a16,16,0,0,1,16,16Z"})}))},Ua=(0,t.memo)((e=>{let{label:a,value:o,className:t="",isTextArea:s=!1}=e;if(!o)return null;const r=t.includes("flex flex-col")?"flex flex-col gap-1 text-sm py-0.5":"grid grid-cols-[auto,1fr] gap-x-2 text-sm py-0.5";return(0,T.jsxs)("div",{className:"".concat(r," ").concat(t),children:[(0,T.jsxs)("span",{className:"font-medium text-neutral-800",children:[a,":"]}),s?(0,T.jsx)("div",{className:"text-neutral-600",children:(0,T.jsx)("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",children:o})}):(0,T.jsx)("span",{className:"text-neutral-600 break-words",children:o})]})})),Ba=e=>(0,T.jsx)(qa,(0,N.A)({className:"w-8 h-8"},e)),Wa=(0,t.memo)((e=>{let{terraIndigena:a}=e;if(!a)return console.log("TerraIndigenaInfo: terraIndigena \xe9 null ou undefined"),null;return(0,T.jsxs)(Ae,{title:"Informa\xe7\xf5es da Terra Ind\xedgena",icon:Ba,children:[(0,T.jsx)(Ua,{label:"Povos Ind\xedgenas",value:a.etnia}),(0,T.jsx)(Ua,{label:"Localiza\xe7\xe3o",value:"".concat(a.municipio||"",", ").concat(a.uf||"").trim()}),(0,T.jsx)(Ua,{label:"Superf\xedcie",value:a.superficie?"Superf\xedcie: ".concat(parseFloat(a.superficie).toFixed(2)," ha"):null}),(0,T.jsx)(Ua,{label:"Fase",value:a.fase}),(0,T.jsx)(Ua,{label:"Modalidade",value:a.modalidade}),(0,T.jsx)(Ua,{label:"Reestudo",value:a.reestudo}),(0,T.jsx)(Ua,{label:"Coordena\xe7\xe3o Regional",value:a.cr}),(0,T.jsx)(Ua,{label:"Faixa de Fronteira",value:a.faixa_fron}),(0,T.jsx)(Ua,{label:"Unidade Administrativa",value:a.undadm_nom}),(0,T.jsx)(Ua,{label:"Sigla Unidade",value:a.undadm_sig}),(0,T.jsx)(Ua,{label:"Dom\xednio",value:a.dominio_un}),(0,T.jsx)(Ua,{label:"Data de Atualiza\xe7\xe3o",value:a.data_atual}),(0,T.jsx)(Ua,{label:"C\xf3digo Terra Ind\xedgena",value:a.terrai_cod}),(0,T.jsx)(Ua,{label:"C\xf3digo Unidade Administrativa",value:a.undadm_cod})]})}));var Va=o(519),Ga=o(39501),Za=o(65410),Ka=o(52291);const Xa=e=>{let{children:a,text:o,position:s="top"}=e;const[r,n]=(0,t.useState)(!1);return(0,T.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),onFocus:()=>n(!0),onBlur:()=>n(!1),children:[a,r&&(0,T.jsxs)("div",{className:"\n          absolute z-50 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-xl whitespace-nowrap\n          ".concat({top:"bottom-full left-1/2 transform -translate-x-1/2 mb-3",bottom:"top-full left-1/2 transform -translate-x-1/2 mt-3"}[s],"\n          animate-in fade-in-0 zoom-in-95 duration-200\n        "),children:[o,(0,T.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})},Ya=e=>{let{onClick:a,url:o,title:s,description:r=""}=e;const[n,l]=(0,t.useState)(!1),i=["Conhe\xe7a a escola ind\xedgena: ".concat(s),"Descubra esta escola ind\xedgena: ".concat(s),"Escola ind\xedgena incr\xedvel: ".concat(s),"Educa\xe7\xe3o ind\xedgena em destaque: ".concat(s),"Conhe\xe7a esta escola: ".concat(s),"Escola ind\xedgena que inspira: ".concat(s),"Educa\xe7\xe3o que transforma: ".concat(s),"Escola ind\xedgena de refer\xeancia: ".concat(s)],c=i[Math.floor(Math.random()*i.length)],d=o||window.location.href,u=[{name:"WhatsApp",icon:(0,T.jsx)(Re.A,{className:"w-5 h-5"}),color:"bg-green-500 hover:bg-green-600",component:Va.Kz,props:{url:d,title:c}},{name:"Facebook",icon:(0,T.jsx)(Ga.A,{className:"w-5 h-5"}),color:"bg-blue-600 hover:bg-blue-700",component:Va.uI,props:{url:d,quote:c}},{name:"Twitter",icon:(0,T.jsx)(Za.A,{className:"w-5 h-5"}),color:"bg-sky-500 hover:bg-sky-600",component:Va.r6,props:{url:d,title:c}},{name:"LinkedIn",icon:(0,T.jsx)(Ka.A,{className:"w-5 h-5"}),color:"bg-blue-700 hover:bg-blue-800",component:Va.wk,props:{url:d,title:s,summary:r}}];return(0,T.jsx)("div",{className:"px-4 py-4 border-t border-green-200 bg-gradient-to-b from-white to-green-50",children:(0,T.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,T.jsx)("div",{className:"text-center mb-3",children:(0,T.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"Compartilhe esta escola"})}),(0,T.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,T.jsx)(Xa,{text:n?"Link copiado!":"Copiar link",children:(0,T.jsxs)("button",{onClick:async()=>{try{await navigator.clipboard.writeText(o),l(!0),setTimeout((()=>l(!1)),3e3)}catch(e){const a=document.createElement("input");a.value=o,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),l(!0),setTimeout((()=>l(!1)),3e3)}},className:"\n                flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg transition-all duration-200\n                focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1\n                ".concat(n?"bg-green-100 text-green-800":"bg-green-500 hover:bg-green-600 text-white","\n              "),"aria-label":"Copiar link",children:[n?(0,T.jsx)(ge.A,{className:"w-4 h-4"}):(0,T.jsx)(ve.A,{className:"w-4 h-4"}),(0,T.jsx)("span",{className:"text-xs font-medium",children:n?"Copiado":"Link"})]})}),u.map(((e,a)=>{const o=e.component;return(0,T.jsx)(Xa,{text:"Compartilhar no ".concat(e.name),children:(0,T.jsx)(o,(0,N.A)((0,N.A)({},e.props),{},{className:"transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1","aria-label":"Compartilhar no ".concat(e.name),children:(0,T.jsxs)("div",{className:"\n                    flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-white\n                    ".concat(e.color,"\n                  "),children:[e.icon,(0,T.jsx)("span",{className:"text-xs font-medium",children:e.name})]})}))},a)}))]})]})})},Ja=t.memo(Ya);var $a=o(41360);const Qa=(0,t.memo)((e=>{let{copiarLink:a,compartilhar:o,painelInfo:s}=e;const r=(0,t.useMemo)((()=>(0,$a.aH)(s)),[s]),n=(0,t.useMemo)((()=>(0,$a.Ec)(s)),[s]),l=(0,t.useMemo)((()=>(0,$a.M)(s)),[s]);return(0,T.jsx)(Ja,{onClick:o,url:r,title:l,description:n})}));var eo=o(87977);const ao=e=>{let{descricao:a,className:o=""}=e;const s=(0,t.useMemo)((()=>a?eo.A.sanitize((e=>{if(!e)return"";let a=e.replace(/\n\n+/g,"</p><p>");return a=a.replace(/\n/g,"<br>"),a.startsWith("<p>")||(a="<p>"+a),a.endsWith("</p>")||(a+="</p>"),a=a.replace(/>\s+</g,"><"),a})(a),{ALLOWED_TAGS:["b","i","em","strong","a","p","br","ul","ol","li","div","span","img","h1","h2","h3","h4","h5","h6","center","blockquote","code","pre","hr","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","target","rel","class","style","src","alt","width","height","id","title","aria-label","aria-describedby"],ADD_TAGS:["center","blockquote"],ADD_ATTR:["target","className","title"],KEEP_CONTENT:!0,ALLOW_DATA_ATTR:!1}):""),[a]);return a?(0,T.jsx)("div",{className:"mb-6 ".concat(o),children:(0,T.jsx)("div",{className:"prose prose-lg lg:prose-xl max-w-none px-1",style:{"--tw-prose-body":"#1f2937","--tw-prose-headings":"#111827","--tw-prose-links":"#059669","--tw-prose-bold":"#111827","--tw-prose-counters":"#1f2937","--tw-prose-bullets":"#4b5563","--tw-prose-hr":"#e5e7eb","--tw-prose-quotes":"#111827","--tw-prose-quote-borders":"#10b981","--tw-prose-captions":"#6b7280","--tw-prose-code":"#111827","--tw-prose-pre-code":"#e5e7eb","--tw-prose-pre-bg":"#1f2937","--tw-prose-th-borders":"#d1d5db","--tw-prose-td-borders":"#e5e7eb",lineHeight:"1.8",fontSize:"1.125rem",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',letterSpacing:"0.015em"},dangerouslySetInnerHTML:{__html:s},"aria-live":"polite"})}):null},oo=t.memo(ao),to=(0,t.memo)((e=>{let{painelInfo:a}=e;return(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsx)("div",{className:"prose prose-lg lg:prose-xl max-w-none",children:(0,T.jsx)("div",{className:"bg-green-100 rounded-lg p-6",children:(0,T.jsx)(oo,{descricao:a.descricao_detalhada})})}),a.audioUrl&&(0,T.jsx)("div",{className:"mt-6",children:(0,T.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,T.jsx)("source",{src:a.audioUrl,type:"audio/mpeg"}),"Seu navegador n\xe3o suporta o elemento de \xe1udio."]})})]})}));var so=o(2922),ro=o(64224);const no=["EE","EEI"],lo=e=>{if(!e||"string"!==typeof e)return"";return e.split(/\s+/).map((e=>no.includes(e.toUpperCase())?e.toUpperCase():e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())).join(" ")},io=e=>{if(!e)return"";const a=e.toLowerCase();if(a.includes("escola estadual")&&a.includes("aldeia")){const a=e.split(" "),o=a.findIndex((e=>e.toLowerCase().includes("aldeia")));if(-1!==o&&o<a.length-1){const e=a.slice(o+1).join(" ");return"E.E.I ".concat(lo(e))}}return lo(e)},co=e=>{let{titulo:a,closePainel:o,toggleMaximize:t,isMaximized:s,imagemHeader:r}=e;const n=window.innerWidth<=768,l=n&&window.innerWidth>window.innerHeight,i=l&&window.innerWidth<=850,c=!n&&s?"mj-header-half-right":"";return(0,T.jsxs)("header",{className:"relative border-b border-green-100 ".concat(l?"min-h-[60px]":""),children:[(0,T.jsx)("div",{className:"px-3 sm:px-4 md:px-6 lg:px-8 py-2 sm:py-2 md:py-3 ".concat(c),children:(0,T.jsx)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between pr-12",children:(0,T.jsxs)("div",{className:"space-y-1",children:[(0,T.jsx)("h2",{id:"painel-titulo",className:"font-bold text-gray-900 leading-tight tracking-tight break-words ".concat(i?"text-lg":l?"text-xl sm:text-2xl":"text-2xl sm:text-3xl md:text-4xl"),style:i?{fontSize:"clamp(1.125rem, 4.5vw, 1.5rem)"}:{},children:io(a)}),(0,T.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600",children:[(0,T.jsx)(xe.A,{className:"w-3 h-3"})," ",(0,T.jsxs)("span",{className:"text-xs sm:text-sm font-medium",children:[" ","Escola Estadual Ind\xedgena"]})]})]})})}),(0,T.jsxs)("div",{className:"absolute top-2 sm:top-4 right-2 sm:right-4 flex items-center gap-2",children:[!n&&(0,T.jsx)("button",{onClick:t,className:"p-2 text-green-700 hover:text-green-900 hover:bg-green-100 transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2","aria-label":s?"Restaurar painel":"Maximizar painel",title:s?"Restaurar":"Maximizar",children:s?(0,T.jsx)(so.A,{size:18,className:"stroke-2","aria-hidden":"true"}):(0,T.jsx)(ro.A,{size:18,className:"stroke-2","aria-hidden":"true"})}),(0,T.jsx)("button",{onClick:o,className:"text-gray-700 hover:text-gray-900 hover:bg-green-100 transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 ".concat(l?"p-1.5":"p-2"),"aria-label":"Fechar painel",children:(0,T.jsx)(he.A,{size:l?18:20,"aria-hidden":"true",className:"stroke-2"})})]})]})},uo=e=>{let{imagemUrl:a,className:o="",isPreloaded:s=!1}=e;const[r,n]=(0,t.useState)(!1);return!a||r?null:(0,T.jsxs)("div",{className:"escola-header-image escola-header-shimmer relative overflow-hidden ".concat(o),children:[(0,T.jsx)("div",{className:"absolute inset-0",children:(0,T.jsx)(ka,{src:a,alt:"Imagem da escola",className:"w-full h-full object-cover transition-all duration-700 ease-out",isPreloaded:s,onLoad:()=>{n(!1)},onError:()=>{n(!0)}})}),(0,T.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-black/20 via-black/10 to-black/30"}),(0,T.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"}),(0,T.jsx)("div",{className:"absolute inset-0 opacity-5",children:(0,T.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.05)_0%,transparent_50%)]"})}),(0,T.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-radial from-white/5 to-transparent rounded-full blur-xl"})]})},mo=e=>{let{escolaId:a,refreshKey:o=0,showTeacher:s=!0,showSchool:r=!0,scrollProgress:n,headerUrl:l,onCurrentItemChange:i}=e;const[c,d]=(0,t.useState)([]),[u,m]=(0,t.useState)(0),[g,h]=(0,t.useState)(!0),[x,p]=(0,t.useState)(""),{isImagePreloaded:f}=Ca(a,!0),[b,v]=(0,t.useState)(0),w=(0,t.useCallback)((async(e,o)=>{const{data:t,error:s}=await ue.N.storage.from(e).list("".concat(a,"/"));if(s)throw s;if(!t||0===t.length)return[];return await Promise.all(t.map((async(t,s)=>{var r,n,l,i;const c="".concat(a,"/").concat(t.name),{data:{publicUrl:d}}=ue.N.storage.from(e).getPublicUrl(c);let u=null;try{u=await(0,fa.t$)(c,a,{categoria:o,tipo_foto:o})}catch(m){}return{id:"".concat(e,"-").concat(t.name),url:d,titulo:(null===(r=u)||void 0===r?void 0:r.legenda)||"Imagem ".concat(s+1),descricao:(null===(n=u)||void 0===n?void 0:n.descricao_detalhada)||"",autor:(null===(l=u)||void 0===l?void 0:l.autor_foto)||"",dataFoto:(null===(i=u)||void 0===i?void 0:i.data_foto)||"",origem:o}})))}),[a]);(0,t.useEffect)((()=>{let e=!0;return a?(h(!0),p(""),(async()=>{try{const o=[];r&&o.push(w("imagens-das-escolas","escola")),s&&o.push(w("imagens-professores","professor"));let t=(await Promise.all(o)).flat();if(l){const e=t.some((e=>e.url===l)),o={id:"header-".concat(a),url:l,titulo:"",descricao:"",autor:"",dataFoto:"",origem:"capa"};t=e?t:[o,...t]}if(!e)return;const n=t.sort(((e,a)=>"capa"===e.origem?-1:"capa"===a.origem?1:e.origem.localeCompare(a.origem)));d(n),m(0)}catch(o){if(!e)return;p("Erro ao carregar imagens.")}finally{e&&h(!1)}})(),()=>{e=!1}):(d([]),void h(!1))}),[a,o,w,r,s]);const j=c.length>0,y=(0,t.useMemo)((()=>j?c[u]:null),[c,u,j]);(0,t.useEffect)((()=>{i&&y&&i(y)}),[y,i]),(0,t.useEffect)((()=>{if(!j||"number"!==typeof n)return;if(Date.now()<b)return;const e=Math.floor(n*Math.max(0,c.length-1));Number.isFinite(e)&&e!==u&&m(e)}),[n,j,c.length,u,b]);const N=(0,t.useCallback)((()=>{j&&(m((e=>e>0?e-1:c.length-1)),v(Date.now()+1200))}),[j,c.length]),k=(0,t.useCallback)((()=>{j&&(m((e=>e<c.length-1?e+1:0)),v(Date.now()+1200))}),[j,c.length]);return g?(0,T.jsx)("div",{className:"text-gray-500",children:"Carregando imagens..."}):x?(0,T.jsx)("div",{className:"text-red-600",children:x}):j?(0,T.jsx)("div",{className:"h-full w-full relative",children:(0,T.jsxs)("div",{className:"absolute inset-0",children:[(0,T.jsx)("button",{type:"button",className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow",onClick:N,"aria-label":"Imagem anterior",children:(0,T.jsx)(xa.A,{className:"w-5 h-5"})}),(0,T.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 z-10 bg-white/80 hover:bg-white text-gray-700 rounded-full p-2 shadow",onClick:k,"aria-label":"Pr\xf3xima imagem",children:(0,T.jsx)(be.A,{className:"w-5 h-5"})}),(0,T.jsx)("div",{className:"w-full h-full bg-black/5 overflow-hidden",children:(0,T.jsx)(ka,{src:y.url,alt:y.titulo||"Imagem",className:"w-full h-full object-cover",isPreloaded:f(y.url),style:{maxHeight:"100%",maxWidth:"100%"}})}),(0,T.jsx)("div",{className:"absolute bottom-3 left-3 right-3 z-10 flex",children:(0,T.jsxs)("div",{className:"text-white px-3 py-2",style:{backgroundColor:"rgba(0,0,0,0.88)",borderRadius:"8px",maxWidth:"80%"},children:[y.titulo&&(0,T.jsx)("h4",{className:"text-sm font-semibold m-0",children:y.titulo}),(0,T.jsxs)("div",{className:"text-[11px] mt-0.5 space-x-2",children:[y.origem&&(0,T.jsx)("span",{className:"capitalize",children:y.origem}),y.autor&&(0,T.jsxs)("span",{children:["Por: ",y.autor]}),y.dataFoto&&(0,T.jsx)("span",{children:new Date(y.dataFoto).toLocaleDateString("pt-BR")})]}),y.descricao&&(0,T.jsx)("p",{className:"text-xs mt-1 m-0",children:y.descricao})]})})]})}):(0,T.jsx)("div",{className:"text-gray-600",children:"Nenhuma imagem dispon\xedvel."})},go=t.memo(mo),ho=e=>{const[a,o]=(0,t.useState)(!1),{isMobile:s}=(0,ne.d)();return(0,t.useEffect)((()=>(P.debug("usePainelVisibility - painelInfo mudou:",e),e&&"object"===typeof e?(P.debug("usePainelVisibility: Definindo visibilidade como true"),o(!0),document.body.style.overflow="hidden"):(P.debug("usePainelVisibility: Definindo visibilidade como false"),o(!1),document.body.style.overflow=""),()=>{document.body.style.overflow=""})),[e]),{isVisible:a,isMobile:s}},xo=e=>{let{painelInfo:a,closePainel:o,children:s,isMaximized:r,onToggleMaximize:n,contentRef:l,rightNav:i,refreshKey:c}=e;const[d,u]=(0,t.useState)(0),[m,g]=(0,t.useState)(null),{isVisible:h,isMobile:x}=ho(a),p=((e,a)=>{const[o,s]=(0,t.useState)(window.innerWidth),[r,n]=(0,t.useState)(window.innerHeight),l={sm:640,md:768,lg:1024,xl:1280,"2xl":1536};(0,t.useEffect)((()=>{const e=()=>{s(window.innerWidth),n(window.innerHeight)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const i=(0,t.useMemo)((()=>{const t=e&&o>r,s=o>=l.md;let n;return n=e||a?"100%":o>=l.lg?"49%":"75%",{height:"100vh",maxHeight:"100vh",width:n,isDesktop:s,isMobileLandscape:t,shouldUseGrid:s&&a,breakpoints:l,zIndex:1e3}}),[e,a,o,r]);return i})(x,r),{isImagePreloaded:f}=Ca(null===a||void 0===a?void 0:a.id,!0);if(!a)return null;const b="\n    fixed\n    ".concat(x?"inset-x-0 top-0 w-full h-full":"top-0 bottom-0 right-0 w-full sm:w-3/4 lg:w-[49%] h-auto","\n    rounded-t-xl shadow-xl z-[9999] transform transition-all duration-500 ease-in-out\n    bg-white border-t-4 border-white mj-panel\n  "),v=h?"translate-y-0 opacity-100":"translate-y-full opacity-0";return(0,T.jsxs)("div",{role:"dialog","aria-labelledby":"painel-titulo","aria-describedby":"painel-descricao","aria-modal":"true",className:"".concat(b," ").concat(v).concat(x?" painel-informacoes-mobile":"").concat(!x&&r?" mj-maximized":""),style:(0,N.A)({height:p.height,maxHeight:p.maxHeight,width:x?"100%":p.width,top:0,display:"flex",flexDirection:"column",position:"fixed"},x&&{borderRadius:p.isMobileLandscape?"0":"1rem 1rem 0 0",boxShadow:p.isMobileLandscape?"0 0 0 0":"0 -4px 6px -1px rgba(0, 0, 0, 0.1), 0 -2px 4px -1px rgba(0, 0, 0, 0.06)"}),children:[(0,T.jsx)(co,{titulo:a.titulo,closePainel:o,toggleMaximize:n,isMaximized:r,imagemHeader:a.imagem_header}),i&&(0,T.jsx)("div",{className:"hidden sm:flex flex-col gap-1 absolute right-0 top-1/2 -translate-y-1/2 z-[10000]",children:i}),r&&!x?(0,T.jsxs)("div",{className:"flex-1 mj-split",children:[(0,T.jsx)("aside",{className:"mj-split-left",children:(0,T.jsx)(go,{escolaId:a.id,refreshKey:c||0,scrollProgress:d,headerUrl:a.imagem_header,onCurrentItemChange:g})}),(0,T.jsx)("div",{ref:l,className:"mj-split-right overflow-y-auto mj-panel-content",onScroll:e=>{const a=e.currentTarget,o=a.scrollHeight-a.clientHeight,t=o>0?a.scrollTop/o:0;u(Math.min(1,Math.max(0,t)))},children:(0,T.jsx)("div",{className:"".concat(x?"p-3 sm:p-4":"p-6"," space-y-4 sm:space-y-5"),children:(0,T.jsx)("div",{className:"prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none mj-prose",children:s})})})]}):(0,T.jsxs)("div",{ref:l,className:"flex-1 overflow-y-auto mj-panel-content",children:[a.imagem_header&&(0,T.jsx)(uo,{imagemUrl:a.imagem_header,className:"h-56 sm:h-64 md:h-72 lg:h-80 xl:h-96 w-full",isPreloaded:f(a.imagem_header)}),(0,T.jsx)("div",{className:"".concat(x?"p-3 sm:p-4":"p-6"," space-y-4 sm:space-y-5 -mt-2"),children:(0,T.jsx)("div",{className:"prose prose-sm sm:prose-base md:prose-lg lg:prose-xl max-w-none mj-prose",children:s})})]})]})},po=t.memo(xo),fo=e=>{if(!e||"string"!==typeof e)return null;const a=e.match(/\/d\/([a-zA-Z0-9-_]+)/);if(!a)return null;const o=a[1];return"https://docs.google.com/gview?url=https://drive.google.com/uc?id=".concat(o,"&embedded=true")},bo=e=>{let{viewMode:a,setViewMode:o}=e;return(0,T.jsxs)("div",{className:"flex items-center gap-2",role:"tablist","aria-label":"Modos de visualiza\xe7\xe3o dos documentos",children:[(0,T.jsxs)("button",{type:"button",role:"tab","aria-selected":"list"===a,"aria-label":"Visualizar em lista",onClick:()=>o("list"),className:"p-2 rounded-lg flex items-center gap-1 transition-colors focus:outline-none focus:ring-2 focus:ring-green-600 ".concat("list"===a?"bg-green-100 text-green-800 font-semibold":"text-gray-600 hover:bg-gray-100"),tabIndex:0,children:[(0,T.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),(0,T.jsx)("span",{className:"hidden sm:inline",children:"Lista"})]}),(0,T.jsxs)("button",{type:"button",role:"tab","aria-selected":"grid"===a,"aria-label":"Visualizar em grade",onClick:()=>o("grid"),className:"p-2 rounded-lg flex items-center gap-1 transition-colors focus:outline-none focus:ring-2 focus:ring-green-600 ".concat("grid"===a?"bg-green-100 text-green-800 font-semibold":"text-gray-600 hover:bg-gray-100"),tabIndex:0,children:[(0,T.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),(0,T.jsx)("span",{className:"hidden sm:inline",children:"Grade"})]})]})},vo=e=>{let{documentos:a,title:o="Documentos"}=e;const[s,r]=(0,t.useState)(null),[n,l]=(0,t.useState)("list"),i=(0,t.useRef)(null),[c,d]=(0,t.useState)(!1),[u,m]=(0,t.useState)(!1);if((0,t.useEffect)((()=>{s&&(d(!1),m(!1))}),[s]),(0,t.useEffect)((()=>{!s&&(null===a||void 0===a?void 0:a.length)>0&&r(a[0])}),[a,s]),(0,t.useEffect)((()=>{const e=i.current;if(!e||!s)return;const a=()=>{d(!1)},o=()=>{d(!0),m(!0)};return e.addEventListener("load",a),e.addEventListener("error",o),()=>{e.removeEventListener("load",a),e.removeEventListener("error",o)}}),[s]),!a||0===a.length)return null;return(0,T.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,T.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,T.jsxs)("h3",{className:"text-xl font-semibold text-green-800",children:[o,":"]}),a.length>1&&(0,T.jsx)(bo,{viewMode:n,setViewMode:l})]}),a.length>1&&(0,T.jsx)("div",{className:"mb-6",children:"grid"===n?(0,T.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:a.map((e=>(0,T.jsx)("div",{className:"\n              flex flex-col justify-between h-full max-w-xs mx-auto\n              rounded-2xl transition-all duration-200 cursor-pointer\n              shadow-sm hover:shadow-lg\n              ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-green-100 scale-[1.03]":"bg-white hover:bg-green-50","\n            "),onClick:()=>{r(e)},tabIndex:0,"aria-label":"Selecionar documento: ".concat(e.titulo),children:(0,T.jsxs)("div",{className:"p-5 flex-1 flex flex-col justify-between",children:[(0,T.jsx)("h4",{className:"font-semibold text-green-800 mb-2 line-clamp-2 text-lg",children:e.titulo}),e.autoria&&(0,T.jsxs)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-1",children:["Por: ",e.autoria]}),e.tipo&&(0,T.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-green-200 text-green-800 rounded-full",children:e.tipo})]})},e.id)))}):(0,T.jsx)("div",{className:"space-y-2",children:a.map((e=>(0,T.jsxs)("button",{onClick:()=>{r(e)},className:"w-full text-left p-3 rounded-lg transition-colors duration-200 ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-green-100":"hover:bg-green-50"),children:[(0,T.jsx)("h4",{className:"font-medium text-green-800",children:e.titulo}),e.autoria&&(0,T.jsxs)("p",{className:"text-sm text-gray-600",children:["Por: ",e.autoria]}),e.tipo&&(0,T.jsx)("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-medium bg-green-200 text-green-800 rounded-full",children:e.tipo})]},e.id)))})}),(()=>{if(!s)return null;const e=s.link_pdf.includes("drive.google.com/file/d/");return(0,T.jsx)("div",{className:"rounded-lg overflow-hidden shadow-lg bg-white",children:e?(0,T.jsxs)(T.Fragment,{children:[u?(0,T.jsx)("iframe",{ref:i,src:fo(s.link_pdf),width:"100%",height:"500px",allow:"autoplay",loading:"lazy",title:"".concat(s.titulo," (Google Docs Viewer)"),sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",className:"bg-white"}):(0,T.jsx)("iframe",{ref:i,src:s.link_pdf.replace("/view?usp=sharing","/preview"),width:"100%",height:"500px",allow:"autoplay",loading:"lazy",title:s.titulo,sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",className:"bg-white"}),c&&(0,T.jsxs)("div",{className:"p-6 text-center text-gray-600 bg-green-100",children:[(0,T.jsx)("p",{className:"mb-3 text-lg",children:"N\xe3o foi poss\xedvel carregar o documento diretamente."}),(0,T.jsxs)("a",{href:s.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,T.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Abrir em nova aba"]})]})]}):(0,T.jsx)("div",{className:"flex justify-center p-6",children:(0,T.jsxs)("a",{href:s.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-6 py-3 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,T.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Ver documento PDF"]})})})})()]})},wo=t.memo(vo),jo=e=>{let{videoUrl:a,title:o="V\xeddeo",escolaId:s}=e;const[r,n]=(0,t.useState)(null),[,l]=(0,t.useState)(!1);if((0,t.useEffect)((()=>{(async()=>{if(a&&s)try{l(!0);const e=await(0,fa.jW)(a,s);n(e)}catch(e){console.warn("Erro ao buscar t\xedtulo personalizado:",e)}finally{l(!1)}})()}),[a,s]),!a)return null;const i=(e=>{if(!e||"string"!==typeof e)return null;const a=e.split("?")[0],o=[/youtube\.com\/embed\/([^/?&]+)/,/youtube\.com\/watch\?v=([^&]+)/,/youtu\.be\/([^?&]+)/,/youtube\.com\/v\/([^?&]+)/];for(const t of o){const e=a.match(t);if(e&&e[1])return e[1]}return null})(a);return i?(0,T.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,T.jsxs)("h3",{className:"text-xl font-semibold text-green-800 mb-4",children:[(null===r||void 0===r?void 0:r.titulo)||o,":"]}),r&&(0,T.jsxs)("div",{className:"mb-4 p-4 bg-green-100 rounded-lg",children:[r.descricao&&(0,T.jsx)("p",{className:"text-gray-700 mb-2",children:r.descricao}),(0,T.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[r.categoria&&(0,T.jsx)("span",{className:"capitalize bg-green-200 text-green-800 px-2 py-1 rounded",children:r.categoria}),r.plataforma&&(0,T.jsx)("span",{className:"capitalize",children:r.plataforma}),r.duracao&&(0,T.jsxs)("span",{children:["Dura\xe7\xe3o: ",r.duracao]})]})]}),(0,T.jsx)("div",{className:"rounded-lg overflow-hidden shadow-lg bg-white",children:(0,T.jsx)("div",{className:"relative pb-[56.25%] h-0",children:(0,T.jsx)("iframe",{className:"absolute top-0 left-0 w-full h-full",src:"https://www.youtube.com/embed/".concat(i),title:(null===r||void 0===r?void 0:r.titulo)||o,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,loading:"lazy",referrerPolicy:"origin"})})})]}):(0,T.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto",children:[(0,T.jsxs)("h3",{className:"text-xl font-semibold text-green-800 mb-4",children:[(null===r||void 0===r?void 0:r.titulo)||o,":"]}),(0,T.jsxs)("div",{className:"p-6 text-center text-gray-600 bg-gray-50 rounded-lg",children:[(0,T.jsx)("p",{className:"mb-3 text-lg",children:"Link do v\xeddeo inv\xe1lido ou n\xe3o suportado."}),(0,T.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 text-base font-medium text-white bg-green-700 hover:bg-green-800 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg",children:[(0,T.jsxs)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,T.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Tentar abrir no YouTube"]})]})]})},yo=t.memo(jo),No=e=>{let{painelInfo:a,closePainel:o,escola_id:s,refreshKey:r=0}=e;const n=(0,t.useRef)(null),l=(0,t.useRef)(null),i=(0,t.useRef)({}),[c,d]=(0,t.useState)(0),[u,m]=(0,t.useState)(!1),{gerarLinkCustomizado:g,copiarLink:h,compartilhar:x}=(e=>{const a=()=>window.location.origin+window.location.pathname+"?panel="+(0,de.N)(e.titulo);return{gerarLinkCustomizado:a,copiarLink:async()=>{const e=a();try{await navigator.clipboard.writeText(e),alert("Link copiado!")}catch(o){const a=document.createElement("input");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),alert("Link copiado!")}},compartilhar:()=>{const o=a(),t="Confira este painel: ".concat(e.titulo);navigator.share?navigator.share({title:e.titulo,text:t,url:o}):window.open("https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(t),"&url=").concat(encodeURIComponent(o)),"_blank")}}})(a),{documentos:p}=me(null===a||void 0===a?void 0:a.id);var f,b;((e,a)=>{const o=(0,t.useRef)(null),s=(0,t.useRef)(null);(0,t.useEffect)((()=>{if(e)return s.current&&clearTimeout(s.current),s.current=setTimeout((()=>{const e=a();if(e!==o.current)try{window.history.replaceState({},"",e),o.current=e}catch(t){console.warn("Erro ao atualizar URL:",t)}}),300),()=>{s.current&&clearTimeout(s.current)}}),[e,a])})(a,g),f=n,b=o,(0,t.useEffect)((()=>{const e=e=>{const a=e.target;a.classList&&a.classList.contains("openlayers-container")||f.current&&!f.current.contains(e.target)&&b(e)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[f,b]),(0,t.useEffect)((()=>{console.log("PainelInformacoes: refreshKey mudou para",r)}),[r]);const v=(0,t.useMemo)((()=>{const e=[];return e.push({key:"dados",label:"Dados"}),e.push({key:"historia",label:"Hist\xf3ria"}),e.push({key:"depoimentos",label:"Depoimentos"}),a&&a.link_para_videos&&e.push({key:"videos",label:"V\xeddeos"}),e}),[a]);(0,t.useEffect)((()=>{const e=l.current;if(!e)return;const a=()=>{const a=e.getBoundingClientRect();let o=0,t=1/0;v.forEach(((e,s)=>{const r=i.current[e.key];if(!r)return;const n=r.getBoundingClientRect(),l=Math.abs(n.top-a.top-80);l<t&&(t=l,o=s)})),d(o)};return e.addEventListener("scroll",a,{passive:!0}),a(),()=>e.removeEventListener("scroll",a)}),[v]);if(!a)return null;const w="terra_indigena"===a.tipo,j="Sobre o site"===a.titulo;return(0,T.jsx)("div",{ref:n,children:(0,T.jsxs)(po,{painelInfo:a,closePainel:o,isMaximized:u,onToggleMaximize:()=>m((e=>!e)),contentRef:l,refreshKey:r,rightNav:null,children:[j?(0,T.jsx)(to,{painelInfo:a}):w?(0,T.jsx)(Wa,{terraIndigena:a}):(0,T.jsxs)("div",{className:"relative",children:[(0,T.jsx)(Oa,{escola:a,shouldUseGrid:!0,refreshKey:r,sectionRefs:i.current,isMaximized:u}),p&&p.length>0&&(0,T.jsx)(wo,{documentos:p,title:"Produ\xe7\xf5es e materiais da escola"}),a.link_para_videos&&(0,T.jsx)("div",{ref:e=>i.current.videos=e,children:(0,T.jsx)(yo,{videoUrl:a.link_para_videos,title:(0,T.jsx)("span",{style:{fontSize:"0.75em"},children:"Produ\xe7\xf5es audiovisuais realizadas na ".concat(a.titulo)}),escolaId:a.id})})]}),(0,T.jsx)(Qa,{copiarLink:h,compartilhar:x,painelInfo:a})]})})},ko=t.memo(No);var Co=o(43303);const Ao=e=>{var a,o;let{dataPoints:s,onPainelOpen:r,isLoading:n=!1}=e;P.debug("DataPoints recebidos no MapaEscolasIndigenas:",s?{quantidade:s.length,exemplo:s[0]?{titulo:s[0].titulo,latitude:s[0].Latitude,longitude:s[0].Longitude,tipo:s[0].tipo}:"Nenhum ponto"}:"Nenhum dataPoint");const{refreshKey:l}=(0,Co.b)(),i=(0,ce.zy)(),c=(0,t.useMemo)((()=>new URLSearchParams(window.location.search)),[]).get("panel"),d=(0,t.useMemo)((()=>{var e;if(null!==(e=i.state)&&void 0!==e&&e.schoolData)return i.state.schoolData;if(c&&""!==c&&s&&s.length>0){return s.find((e=>(0,de.N)(e.titulo)===c))||null}return null}),[c,s,i.state]),[u,m]=(0,t.useState)(d),[g,h]=(0,t.useState)(!!d),x=(0,t.useMemo)((()=>s?s.filter((e=>e.pontuacao>=0)):[]),[s]),p=(0,t.useCallback)((e=>{e&&m(e)}),[]),f=(0,t.useCallback)((()=>{P.debug("For\xe7ando refresh do painel de informa\xe7\xf5es")}),[]);(0,t.useEffect)((()=>{d&&!g&&(P.debug("MapaEscolasIndigenas: Abrindo painel automaticamente para:",d.titulo),m(d),h(!0))}),[d,g]),(0,t.useEffect)((()=>{var e;if(null!==(e=i.state)&&void 0!==e&&e.schoolData){const e=i.state.schoolData;(!u||u.id!==e.id)&&(P.debug("MapaEscolasIndigenas: Abrindo painel a partir do navigation state:",e.titulo),m(e))}}),[null===(a=i.state)||void 0===a||null===(o=a.schoolData)||void 0===o?void 0:o.id,null===u||void 0===u?void 0:u.id]),(0,t.useEffect)((()=>{P.debug("MapaEscolasIndigenas: onPainelOpen dispon\xedvel:",!!r),P.debug("MapaEscolasIndigenas: abrirPainel dispon\xedvel:",!!p),r&&"function"===typeof r&&(P.debug("MapaEscolasIndigenas: Expondo fun\xe7\xe3o abrirPainel e refreshPainel"),r(p,f))}),[p,r,f]);const b=(0,t.useCallback)((()=>{m(null)}),[]);return(0,T.jsxs)("div",{className:"relative h-screen w-full overflow-hidden",children:[(0,T.jsx)(ie,{dataPoints:x,onPainelOpen:p,painelAberto:!!u,className:"h-full w-full",isMainLoading:n}),u&&(0,T.jsx)(ko,{painelInfo:u,closePainel:b,refreshKey:l}),(0,T.jsx)("div",{className:"fixed top-1/2 -translate-y-1/2 left-4 z-30 pointer-events-auto",children:(0,T.jsx)(ce.N_,{to:"/",className:"block rounded-xl bg-green-900/90 hover:bg-green-800 p-2.5 cursor-pointer transition-all duration-200","aria-label":"Sair do mapa e voltar para a p\xe1gina inicial",title:"Sair do mapa",children:(0,T.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,T.jsx)("path",{d:"M16 17L21 12L16 7",stroke:"#CDE8CF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,T.jsx)("path",{d:"M21 12H9",stroke:"#CDE8CF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,T.jsx)("path",{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"#CDE8CF",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})})]})},Eo=t.memo(Ao)},82006:(e,a,o)=>{o.d(a,{Y8:()=>n,e0:()=>i,g2:()=>c,lz:()=>l});var t=o(89379),s=o(92880);const r={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},n=async e=>{try{const{data:a,error:o}=await s.N.from("historias_professor").select("*").eq("escola_id",e).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(o)throw o;if(!a||0===a.length)return[];return a.map((e=>{if(e.imagem_url)try{const{data:{publicUrl:a}}=s.N.storage.from(r.BUCKET_NAME).getPublicUrl(e.imagem_url);return(0,t.A)((0,t.A)({},e),{},{imagem_public_url:a})}catch(a){return(0,t.A)((0,t.A)({},e),{},{imagem_public_url:null,urlError:a.message})}return e}))}catch(a){throw console.error("Erro ao buscar hist\xf3rias do professor:",a),a}},l=async e=>{try{const{data:a,error:o}=await s.N.from("historias_professor").insert([{escola_id:e.escola_id,nome_professor:e.nome_professor||null,historia:e.historia,ordem:e.ordem||1,ativo:!1!==e.ativo,foto_rosto:e.foto_rosto||null}]).select().single();if(o)throw o;return a}catch(a){throw console.error("Erro ao criar hist\xf3ria do professor:",a),a}},i=async(e,a)=>{try{const{data:o,error:t}=await s.N.from("historias_professor").update({nome_professor:a.nome_professor,historia:a.historia,ordem:a.ordem,ativo:a.ativo,foto_rosto:a.foto_rosto||null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(t)throw t;return o}catch(o){throw console.error("Erro ao atualizar hist\xf3ria do professor:",o),o}},c=async e=>{try{const{error:a}=await s.N.from("historias_professor").delete().eq("id",e);if(a)throw a}catch(a){throw console.error("Erro ao deletar hist\xf3ria do professor:",a),a}}}}]);
//# sourceMappingURL=711.826c220f.chunk.js.map