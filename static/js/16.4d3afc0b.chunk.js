"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[16],{20016:(e,a,t)=>{t.r(a),t.d(a,{default:()=>n});var r=t(65043),o=t(40237),s=t(70579);const n=()=>{const[e,a]=(0,r.useState)([]),[t,n]=(0,r.useState)(!1),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const r=(new Date).toLocaleTimeString();a(a=>[...a,{timestamp:r,message:e,type:t}])};return(0,s.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-4xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Teste de Funcionalidade de Legendas"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("button",{onClick:async()=>{n(!0),a([]);try{i("=== INICIANDO TESTES DE LEGENDAS ===","header"),i("Teste 1: Verificando estrutura da tabela..."),await(0,o.iy)(),i("\u2705 Teste da estrutura da tabela conclu\xeddo"),i("Teste 2: Criando legenda de teste...");const e={escola_id:1,imagem_url:"test/test-image.jpg",legenda:"Legenda de teste",descricao_detalhada:"Descri\xe7\xe3o detalhada de teste",autor_foto:"Teste Autor",data_foto:"2024-01-01",categoria:"teste",ativo:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},a=await(0,o.eP)(e);i("\u2705 Legenda criada com ID: ".concat(a.id)),i("Teste 3: Buscando legenda criada...");const t=await(0,o.qP)("test/test-image.jpg",1);t?i("\u2705 Legenda encontrada: ".concat(t.legenda)):i("\u274c Legenda n\xe3o encontrada","error"),i("Teste 4: Atualizando legenda...");const r={legenda:"Legenda atualizada",updated_at:(new Date).toISOString()},s=await(0,o.w_)(a.id,r);i("\u2705 Legenda atualizada: ".concat(s.legenda)),i("Teste 5: Verificando se a atualiza\xe7\xe3o foi salva...");const n=await(0,o.qP)("test/test-image.jpg",1);n&&"Legenda atualizada"===n.legenda?i("\u2705 Atualiza\xe7\xe3o salva corretamente"):i("\u274c Atualiza\xe7\xe3o n\xe3o foi salva corretamente","error"),i("=== TESTES CONCLU\xcdDOS COM SUCESSO ===","success")}catch(e){i("\u274c ERRO NOS TESTES: ".concat(e.message),"error"),console.error("Erro nos testes:",e)}finally{n(!1)}},disabled:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 mr-4",children:t?"Executando Testes...":"Executar Testes"}),(0,s.jsx)("button",{onClick:()=>{a([])},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Limpar Logs"})]}),(0,s.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4 max-h-96 overflow-y-auto",children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Logs dos Testes:"}),0===e.length?(0,s.jsx)("p",{className:"text-gray-500",children:"Nenhum teste executado ainda."}):(0,s.jsx)("div",{className:"space-y-1",children:e.map((e,a)=>(0,s.jsxs)("div",{className:"text-sm font-mono ".concat("error"===e.type?"text-red-600":"success"===e.type?"text-green-600":"header"===e.type?"text-blue-600 font-bold":"text-gray-800"),children:["[",e.timestamp,"] ",e.message]},a))})]}),(0,s.jsxs)("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,s.jsx)("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Instru\xe7\xf5es:"}),(0,s.jsxs)("ol",{className:"text-sm text-yellow-700 space-y-1 list-decimal list-inside",children:[(0,s.jsx)("li",{children:'Clique em "Executar Testes" para verificar se a funcionalidade de legendas est\xe1 funcionando'}),(0,s.jsx)("li",{children:"Verifique os logs para identificar poss\xedveis problemas"}),(0,s.jsx)("li",{children:"Se houver erros, execute o script SQL no Supabase para corrigir a estrutura da tabela"}),(0,s.jsx)("li",{children:"Teste novamente ap\xf3s corrigir problemas no banco de dados"})]})]})]})}},40237:(e,a,t)=>{t.d(a,{eP:()=>d,iy:()=>s,jW:()=>l,qP:()=>n,s7:()=>u,t$:()=>i,w_:()=>c});var r=t(52480),o=t(5452);const s=async()=>{try{const{error:e}=await r.N.from("legendas_fotos").select("count").limit(1);return e?(o.A.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",e.message),!1):(o.A.debug("Tabela legendas_fotos acess\xedvel"),!0)}catch(e){return o.A.warn("Erro ao testar tabela legendas_fotos:",e.message),!1}},n=async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let s=r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a);!1!==t.ativo&&(s=s.eq("ativo",!0)),t.categoria&&(s=s.eq("categoria",t.categoria)),t.tipo_foto&&(s=s.eq("tipo_foto",t.tipo_foto));const{data:n,error:i}=await s.order("created_at",{ascending:!1});return i?(o.A.warn("Erro ao buscar legenda:",i.message),null):n&&n.length>0?n[0]:null}catch(s){return o.A.warn("Erro ao buscar legenda:",s.message),null}},i=async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(o.A.debug("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(e," (escola: ").concat(a,")")),t.categoria||t.tipo_foto){o.A.debug("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const r=await n(e,a,t);if(r)return o.A.debug("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),r}o.A.debug("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:s,error:i}=await r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(i)o.A.warn("  \u274c Erro na busca por URL e escola:",i.message);else if(s&&s.length>0)return o.A.debug("  \u2705 Encontrada por URL e escola"),s[0];o.A.debug("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:d,error:c}=await r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).order("created_at",{ascending:!1});if(c)o.A.warn("  \u274c Erro na busca incluindo inativas:",c.message);else if(d&&d.length>0)return o.A.debug("  \u2705 Encontrada incluindo legendas inativas"),d[0];const l=e.split("/").pop();o.A.debug("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(l));const{data:g,error:u}=await r.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(l)).eq("escola_id",a).eq("ativo",!0).order("created_at",{ascending:!1});if(u)o.A.warn("  \u274c Erro na busca por nome do arquivo:",u.message);else if(g&&g.length>0)return o.A.debug("  \u2705 Encontrada por nome do arquivo"),g[0];return o.A.debug("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(s){return o.A.warn("Erro ao buscar legenda flex\xedvel:",s.message),null}},d=async e=>{try{const{data:a,error:t}=await r.N.from("legendas_fotos").insert([e]).select().single();if(t)throw t;return a}catch(a){throw o.A.error("Erro ao adicionar legenda:",a),a}},c=async(e,a)=>{try{const{data:t,error:o}=await r.N.from("legendas_fotos").update(a).eq("id",e).select().single();if(o)throw o;return t}catch(t){throw o.A.error("Erro ao atualizar legenda:",t),t}},l=async(e,a)=>{try{const{data:t,error:o}=await r.N.from("legendas_fotos").select("*").eq("imagem_url",e).eq("escola_id",a).eq("categoria","video").single();if(o){if("PGRST116"===o.code)return null;throw o}return t}catch(t){return o.A.warn("Erro ao buscar t\xedtulo do v\xeddeo:",t.message),null}},g=async(e,a,t)=>{try{const o=await n(e,a,{ativo:!1});if(o){const{data:e,error:a}=await r.N.from("legendas_fotos").update({ordem:t,updated_at:(new Date).toISOString()}).eq("id",o.id).select().single();if(a)throw a;return e}{const o=(e.split("/").pop()||"Imagem").replace(/\.[^/.]+$/,"").replace(/[_-]/g," ")||"Imagem",{data:s,error:n}=await r.N.from("legendas_fotos").insert([{escola_id:a,imagem_url:e,legenda:o,ordem:t,ativo:!0,tipo_foto:"escola",categoria:"geral",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(n)throw n;return s}}catch(s){throw o.A.error("Erro ao atualizar ordem da imagem:",s),s}},u=async(e,a)=>{try{return await Promise.all(e.map(e=>{let{imageUrl:t,ordem:r}=e;return g(t,a,r)}))}catch(t){throw o.A.error("Erro ao atualizar ordens das imagens:",t),t}}}}]);
//# sourceMappingURL=16.4d3afc0b.chunk.js.map