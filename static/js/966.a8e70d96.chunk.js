"use strict";(self.webpackChunkopin_observatorio_professores_indigenas=self.webpackChunkopin_observatorio_professores_indigenas||[]).push([[966],{40237:(o,e,r)=>{r.d(e,{eP:()=>i,iy:()=>t,jW:()=>l,qP:()=>s,s7:()=>u,t$:()=>n,w_:()=>c});var a=r(52480);const t=async()=>{try{const{error:o}=await a.N.from("legendas_fotos").select("count").limit(1);return o?(console.warn("Tabela legendas_fotos n\xe3o encontrada ou sem permiss\xe3o:",o.message),!1):(console.log("Tabela legendas_fotos acess\xedvel"),!0)}catch(o){return console.warn("Erro ao testar tabela legendas_fotos:",o.message),!1}},s=async function(o,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let t=a.N.from("legendas_fotos").select("*").eq("imagem_url",o).eq("escola_id",e);!1!==r.ativo&&(t=t.eq("ativo",!0)),r.categoria&&(t=t.eq("categoria",r.categoria)),r.tipo_foto&&(t=t.eq("tipo_foto",r.tipo_foto));const{data:s,error:n}=await t.order("created_at",{ascending:!1});return n?(console.warn("Erro ao buscar legenda:",n.message),null):s&&s.length>0?s[0]:null}catch(t){return console.warn("Erro ao buscar legenda:",t.message),null}},n=async function(o,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(console.log("\ud83d\udd0d Buscando legenda flex\xedvel para: ".concat(o," (escola: ").concat(e,")")),r.categoria||r.tipo_foto){console.log("  \ud83d\udccb Tentativa 1: Busca com prefer\xeancias espec\xedficas");const a=await s(o,e,r);if(a)return console.log("  \u2705 Encontrada com prefer\xeancias espec\xedficas"),a}console.log("  \ud83d\udccb Tentativa 2: Busca apenas por URL e escola");const{data:t,error:n}=await a.N.from("legendas_fotos").select("*").eq("imagem_url",o).eq("escola_id",e).eq("ativo",!0).order("created_at",{ascending:!1});if(n)console.warn("  \u274c Erro na busca por URL e escola:",n.message);else if(t&&t.length>0)return console.log("  \u2705 Encontrada por URL e escola"),t[0];console.log("  \ud83d\udccb Tentativa 3: Busca incluindo legendas inativas");const{data:i,error:c}=await a.N.from("legendas_fotos").select("*").eq("imagem_url",o).eq("escola_id",e).order("created_at",{ascending:!1});if(c)console.warn("  \u274c Erro na busca incluindo inativas:",c.message);else if(i&&i.length>0)return console.log("  \u2705 Encontrada incluindo legendas inativas"),i[0];const l=o.split("/").pop();console.log("  \ud83d\udccb Tentativa 4: Busca por nome do arquivo: ".concat(l));const{data:d,error:u}=await a.N.from("legendas_fotos").select("*").ilike("imagem_url","%".concat(l)).eq("escola_id",e).eq("ativo",!0).order("created_at",{ascending:!1});if(u)console.warn("  \u274c Erro na busca por nome do arquivo:",u.message);else if(d&&d.length>0)return console.log("  \u2705 Encontrada por nome do arquivo"),d[0];return console.log("  \u274c Nenhuma legenda encontrada com todas as estrat\xe9gias"),null}catch(t){return console.warn("Erro ao buscar legenda flex\xedvel:",t.message),null}},i=async o=>{try{const{data:e,error:r}=await a.N.from("legendas_fotos").insert([o]).select().single();if(r)throw r;return e}catch(e){throw console.error("Erro ao adicionar legenda:",e),e}},c=async(o,e)=>{try{const{data:r,error:t}=await a.N.from("legendas_fotos").update(e).eq("id",o).select().single();if(t)throw t;return r}catch(r){throw console.error("Erro ao atualizar legenda:",r),r}},l=async(o,e)=>{try{const{data:r,error:t}=await a.N.from("legendas_fotos").select("*").eq("imagem_url",o).eq("escola_id",e).eq("categoria","video").single();if(t){if("PGRST116"===t.code)return null;throw t}return r}catch(r){return console.warn("Erro ao buscar t\xedtulo do v\xeddeo:",r.message),null}},d=async(o,e,r)=>{try{const t=await s(o,e,{ativo:!1});if(t){const{data:o,error:e}=await a.N.from("legendas_fotos").update({ordem:r,updated_at:(new Date).toISOString()}).eq("id",t.id).select().single();if(e)throw e;return o}{const{data:t,error:s}=await a.N.from("legendas_fotos").insert([{escola_id:e,imagem_url:o,ordem:r,ativo:!0,tipo_foto:"escola",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select().single();if(s)throw s;return t}}catch(t){throw console.error("Erro ao atualizar ordem da imagem:",t),t}},u=async(o,e)=>{try{return await Promise.all(o.map(o=>{let{imageUrl:r,ordem:a}=o;return d(r,e,a)}))}catch(r){throw console.error("Erro ao atualizar ordens das imagens:",r),r}}},82006:(o,e,r)=>{r.d(e,{Y8:()=>n,e0:()=>c,g2:()=>l,lz:()=>i});var a=r(89379),t=r(52480);const s={BUCKET_NAME:"historia-professor-imagens",MAX_FILE_SIZE:5242880,ALLOWED_TYPES:["image/jpeg","image/jpg","image/png","image/webp","image/gif"],MAX_IMAGES_PER_HISTORIA:1,MIN_DIMENSIONS:{width:200,height:200}},n=async o=>{try{const{data:e,error:r}=await t.N.from("historias_professor").select("*").eq("escola_id",o).eq("ativo",!0).order("ordem",{ascending:!0}).order("created_at",{ascending:!0});if(r)throw r;if(!e||0===e.length)return[];return e.map(o=>{if(o.imagem_url)try{const{data:{publicUrl:e}}=t.N.storage.from(s.BUCKET_NAME).getPublicUrl(o.imagem_url);return(0,a.A)((0,a.A)({},o),{},{imagem_public_url:e})}catch(e){return(0,a.A)((0,a.A)({},o),{},{imagem_public_url:null,urlError:e.message})}return o})}catch(e){throw console.error("Erro ao buscar hist\xf3rias do professor:",e),e}},i=async o=>{try{const{data:e,error:r}=await t.N.from("historias_professor").insert([{escola_id:o.escola_id,nome_professor:o.nome_professor||null,historia:o.historia,ordem:o.ordem||1,ativo:!1!==o.ativo,foto_rosto:o.foto_rosto||null}]).select().single();if(r)throw r;return e}catch(e){throw console.error("Erro ao criar hist\xf3ria do professor:",e),e}},c=async(o,e)=>{try{const{data:r,error:a}=await t.N.from("historias_professor").update({nome_professor:e.nome_professor,historia:e.historia,ordem:e.ordem,ativo:e.ativo,foto_rosto:e.foto_rosto||null,updated_at:(new Date).toISOString()}).eq("id",o).select().single();if(a)throw a;return r}catch(r){throw console.error("Erro ao atualizar hist\xf3ria do professor:",r),r}},l=async o=>{try{const{error:e}=await t.N.from("historias_professor").delete().eq("id",o);if(e)throw e}catch(e){throw console.error("Erro ao deletar hist\xf3ria do professor:",e),e}}},85759:(o,e,r)=>{r.d(e,{MK:()=>n,Sv:()=>t,Y5:()=>i,dq:()=>s});var a=r(52480);async function t(o){const{data:e,error:r}=await a.N.from("titulos_videos").select("*").eq("escola_id",o).eq("ativo",!0).order("created_at",{ascending:!1});if(r)throw r;return e}async function s(o){const{data:e,error:r}=await a.N.from("titulos_videos").insert([o]).select();if(r)throw r;return null===e||void 0===e?void 0:e[0]}async function n(o,e){const{data:r,error:t}=await a.N.from("titulos_videos").update(e).eq("id",o).select();if(t)throw t;return null===r||void 0===r?void 0:r[0]}async function i(o){const{error:e}=await a.N.from("titulos_videos").delete().eq("id",o);if(e)throw e;return!0}}}]);
//# sourceMappingURL=966.a8e70d96.chunk.js.map